function open_book(a){var b=$(".bk-viewinside").length>0,c=(a=a||!b,$(".editor_toolbelt"));return a!==b&&($(".bk-read").click(),is_touch_device()&&(a?c.slideDown("normal"):c.slideUp("fast"))),a||$(".bk-page, .bk-cover-back .catalog").scrollTop(0),a!==b}function popup_toggle(b,a){var c="image-zoom"==a?".image-zoom":".popup-underlayer, .popup."+a;b?($(c).fadeIn(),$(".popup-underlayer").attr({onclick:"popup_toggle(false,'"+a+"')"}).children("div").scrollTop(0),$(document).on("keydown",function(b){27==b.keyCode&&popup_toggle(!1,a)})):($(c).hide(),$(document).off("keydown")),bk_blur(b),"function"==typeof hj_editor_history&&hj_editor_history(b?"add":"detach","[popup_toggle]"+a)}function bk_blur(a){var b=$(".bk-list");a?b.addClass("blur"):b.removeClass("blur"),$("body").scrollTop(0).css({overflow:a?"hidden":"auto"})}function notifications_toggle(a){popup_toggle(a,"notifications"),a&&($(".mh-head .fa-bell").attr("data-count",0),$(".popup.notifications").delay(2e3).queue(function(){hj_update({action:"notifications_read"}),$(this).find("li").attr("data-unread",0);var a=$('link[rel="shortcut icon"]');a.attr({href:a.attr("data-a")}),$(this).dequeue()}),"function"==typeof notifications_toggled&&notifications_toggled(),window.hj_username&&hj_fcm_init(),hj_mixpanel("Notification Toggle"),ga_event_push("Notification Toggle",{event_category:"Notifications",event_label:"Notification Toggle"}))}function notifications_query(a,b){hj_update({action:"notifications_query",lastest:a||0}).then(function(a){1==a.Status&&notifications_new(a.Values.notifications.map(function(a){return{notification_id:a.notification_id,msg:a["message"+(/zh/i.test(hj_lang())?"":"_en")],clk:a.onclick,unread:a.unread,icon:a.icon,date:date_format(a.ts||"")}}),!0),(b=b||function(){})()})}function notifications_click(a){notifications_toggle(!1),hj_mixpanel("Notification Click",{notification_id:a}),ga_event_push("Notification Click",{event_category:"Notifications",event_label:"Notification Click"})}function notifications_new(a,g){a=a||[];var b=$(".popup.notifications ul"),c=[];if(a.forEach(function(a){c.push($("<li>",{title:a.msg,onclick:"notifications_click(this.dataset.notification_id);"+("clk"in a?a.clk:""),"data-unread":"unread"in a?a.unread:"","data-date":"date"in a?a.date||date_format():"","data-notification_id":"notification_id"in a?a.notification_id:0}).text(a.msg).prepend($("<i>",{class:"icon"in a&&a.icon.length>0?a.icon:"far fa-envelope-open"})))}),g){var d=b.find("li[data-pinned]");d.length>0?d.filter(":first").before(c):b.append(c)}else b.prepend(c);var e=b.find("li[data-unread='1']").length,f=$('link[rel="shortcut icon"]');return e>0&&f.attr("href",f.attr("data-b")),$(".mh-head .fa-bell").attr("data-count",e),a.length}