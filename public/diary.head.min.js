function open_book(t){var o=$(".bk-viewinside").length>0,n=(t=t||!o,$(".editor_toolbelt"));return t!==o&&($(".bk-read").click(),is_touch_device()&&(t?n.slideDown("normal"):n.slideUp("fast"))),t||$(".bk-page, .bk-cover-back .catalog").scrollTop(0),t!==o}function popup_toggle(t,o){var n="image-zoom"==o?".image-zoom":".popup-underlayer, .popup."+o;t?($(n).fadeIn(),$(".popup-underlayer").attr("onclick","popup_toggle(false, '"+o+"');").children("div").scrollTop(0),$(document).on("keydown",function(t){27===t.keyCode&&popup_toggle(!1,o)})):($(n).hide(),$(document).off("keydown")),bk_blur(t),"function"==typeof hj_editor_history&&hj_editor_history(t?"add":"detach","[popup_toggle]"+o)}function bk_blur(t){var o=$(".bk-list");t?o.addClass("blur"):o.removeClass("blur"),$("body").scrollTop(0).css("overflow",t?"hidden":"auto")}function notifications_toggle(t){popup_toggle(t,"notifications"),t&&($(".mh-head .fa-bell").attr("data-count",0),$(".popup.notifications").delay(2e3).queue(function(){hj_update({action:"notifications_read"}),$(this).find("li").attr("data-unread",0);var t=$('link[rel="shortcut icon"]');t.attr("href",t.attr("data-a")),$(this).dequeue()}),hj_mixpanel("Notification Toggle"),ga_event_push("Notification Toggle"))}function notifications_query(t,o){hj_update({action:"notifications_query",lastest:t||0}).then(function(t){if(1==t.Status){var n=[];t.Values.notifications.forEach(function(t){n.push({msg:t.message,clk:t.onclick,unread:t.unread,icon:t.icon,date:t.date})}),notifications_new(n,!0)}(o=o||function(){})()})}function notifications_new(t,o){t=t||[];var n=$(".popup.notifications ul"),e=[];if(t.forEach(function(t){e.push($("<li>",{title:t.msg,onclick:"notifications_toggle(false);"+("clk"in t?t.clk:""),"data-unread":"unread"in t?t.unread:"","data-date":"date"in t?t.date:""}).text(t.msg).prepend($("<i>",{class:"icon"in t&&t.icon.length>0?t.icon:"far fa-envelope-open"})))}),o){var i=n.find("li[data-pinned]");i.length>0?i.filter(":first").before(e):n.append(e)}else n.prepend(e);var a=$('link[rel="shortcut icon"]');return a.attr("href",a.attr("data-b")),$(".mh-head .fa-bell").attr("data-count",n.find("li[data-unread='1']").length),t.length}