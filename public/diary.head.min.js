function open_book(t){var i=$(".bk-viewinside").length>0,o=(t=t||!i,$(".editor_toolbelt"));return t!==i&&($(".bk-read").click(),is_touch_device()&&(t?o.slideDown("normal"):o.slideUp("fast"))),t||$(".bk-page, .bk-cover-back .catalog").scrollTop(0),t!==i}function popup_toggle(t,i){var o="image-zoom"==i?".image-zoom":".popup-underlayer, .popup."+i;t?($(o).fadeIn(),$(".popup-underlayer").attr({onclick:"popup_toggle(false,'"+i+"')"}).children("div").scrollTop(0),$(document).on("keydown",function(t){27==t.keyCode&&popup_toggle(!1,i)})):($(o).hide(),$(document).off("keydown")),bk_blur(t),"function"==typeof hj_editor_history&&hj_editor_history(t?"add":"detach","[popup_toggle]"+i)}function bk_blur(t){var i=$(".bk-list");t?i.addClass("blur"):i.removeClass("blur"),$("body").scrollTop(0).css({overflow:t?"hidden":"auto"})}function notifications_toggle(t){popup_toggle(t,"notifications"),t&&($(".mh-head .fa-bell").attr("data-count",0),$(".popup.notifications").delay(2e3).queue(function(){hj_update({action:"notifications_read"}),$(this).find("li").attr("data-unread",0);var t=$('link[rel="shortcut icon"]');t.attr({href:t.attr("data-a")}),$(this).dequeue()}),"function"==typeof notifications_toggled&&notifications_toggled(),window.hj_username&&hj_fcm_init(),hj_mixpanel("Notification Toggle"),ga_event_push("Notification Toggle",{event_category:"Notifications",event_label:"Notification Toggle"}))}function notifications_query(t,i){hj_update({action:"notifications_query",lastest:t||0}).then(function(t){1==t.Status&&notifications_new(t.Values.notifications.map(function(t){return{notification_id:t.notification_id,msg:t["message"+(/zh/i.test(hj_lang())?"":"_en")],clk:t.onclick,unread:t.unread,icon:t.icon,date:date_format(t.ts||"")}}),!0);(i=i||function(){})()})}function notifications_click(t){notifications_toggle(!1),hj_mixpanel("Notification Click",{notification_id:t}),ga_event_push("Notification Click",{event_category:"Notifications",event_label:"Notification Click"})}function notifications_new(t,i){t=t||[];var o=$(".popup.notifications ul"),n=[];if(t.forEach(function(t){n.push($("<li>",{title:t.msg,onclick:"notifications_click(this.dataset.notification_id);"+("clk"in t?t.clk:""),"data-unread":"unread"in t?t.unread:"","data-date":"date"in t?t.date||date_format():"","data-notification_id":"notification_id"in t?t.notification_id:0}).text(t.msg).prepend($("<i>",{class:"icon"in t&&t.icon.length>0?t.icon:"far fa-envelope-open"})))}),i){var e=o.find("li[data-pinned]");e.length>0?e.filter(":first").before(n):o.append(n)}else o.prepend(n);var a=o.find("li[data-unread='1']").length,c=$('link[rel="shortcut icon"]');return a>0&&c.attr("href",c.attr("data-b")),$(".mh-head .fa-bell").attr("data-count",a),t.length}