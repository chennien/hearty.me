function open_book(i){var t=$(".bk-viewinside").length>0,i=i||!t,n=$(".editor_toolbelt");return i!==t&&($(".bk-read").click(),is_touch_device()&&(i?n.slideDown("normal"):n.slideUp("fast"))),i||$(".bk-page, .bk-cover-back .catalog").scrollTop(0),i!==t}function popup_toggle(i,t){if((t||"").length){var n="image-zoom"==t?".image-zoom":".popup-underlayer, .popup."+t;i?($(n).fadeIn(),$(".popup-underlayer").attr({onclick:"popup_toggle(!1,'"+t+"')"}).children("div").scrollTop(0),$(document).on("keydown",function(i){27==i.keyCode&&popup_toggle(!1,t)})):($(n).hide(),$(document).off("keydown")),bk_blur(i),"function"==typeof hj_editor_history&&hj_editor_history(i?"add":"detach","[popup_toggle]"+t)}}function bk_blur(i){var t=$(".bk-list");i?t.addClass("blur"):t.removeClass("blur"),$("body").scrollTop(0).css({overflow:i?"hidden":"auto"})}function notifications_toggle(i){popup_toggle(i,"notifications"),i&&($(".mh-head .fa-bell").attr("data-count",0),$(".popup.notifications").delay(2e3).queue(function(){hj_update({action:"notifications_read"}),$(this).find("li").attr("data-unread",0);var i=$('link[rel="shortcut icon"]');i.attr({href:i.attr("data-a")}),$(this).dequeue()}),"function"==typeof notifications_toggled&&notifications_toggled(),window.hj_username&&hj_fcm_init(),hj_mixpanel("Notification Toggle"),ga_event_push("Notification Toggle",{event_category:"Notifications",event_label:"Notification Toggle"}))}function notifications_query(i,t){hj_update({action:"notifications_query",lastest:i||0}).then(function(i){1==i.Status&&notifications_new(i.Values.notifications.map(function(i){return{notification_id:i.notification_id,msg:i["message"+(/zh/i.test(hj_lang())?"":"_en")],clk:i.onclick,unread:i.unread,icon:i.icon,date:date_format(i.ts||"")}}),!0),(t=t||function(){})()})}function notifications_click(i){notifications_toggle(!1),hj_mixpanel("Notification Click",{notification_id:i}),ga_event_push("Notification Click",{event_category:"Notifications",event_label:"Notification Click"})}function notifications_new(i,t){i=i||[];var n=$(".popup.notifications ul"),o=[];if(i.forEach(function(i){o.push($("<li>",{title:i.msg,onclick:"notifications_click(this.dataset.notification_id);"+("clk"in i?i.clk:""),"data-unread":"unread"in i?i.unread:"","data-date":"date"in i?i.date||date_format():"","data-notification_id":"notification_id"in i?i.notification_id:0}).text(i.msg).prepend($("<i>",{class:"icon"in i&&i.icon.length>0?i.icon:"far fa-envelope-open"})))}),t){var a=n.find("li[data-pinned]");a.length>0?a.filter(":first").before(o):n.append(o)}else n.prepend(o);var e=n.find("li[data-unread='1']").length,c=$('link[rel="shortcut icon"]');return e>0&&c.attr("href",c.attr("data-b")),$(".mh-head .fa-bell").attr("data-count",e),i.length}