"use strict";function hj_update(e){return $.ajax({url:location.origin+"/update"+(window.hj_username?"?u="+hj_username:""),type:"post",crossDomain:!0,dataType:"json",data:e,async:!0,xhrFields:{withCredentials:!0}})}function update(e){if(window.navigator.onLine){var t=$.ajax({url:location.origin+"/update",type:"post",crossDomain:!0,dataType:"json",data:e,async:!1,xhrFields:{withCredentials:!0},success:function(e){return $(e).selector}});return(t.status>=200&&t.status<300||304===t.status)&&JSON.parse(t.responseText)}return!1}function is_touch_device(){return!((navigator.userAgent||"").indexOf("Edge/")>0)&&("ontouchstart"in window||"maxTouchPoints"in navigator&&navigator.maxTouchPoints>0)}function check_OS(e){var t=navigator.userAgent||"",n=/iP(ad|hone|od)/i.test(t)?["iOS"]:t.match(/Windows|Macintosh|Android|iP(ad|hone|od)/gi)||[];return n=n.length>0?n[0]:"",null==e?n:e==n}function check_browser(e){var t=navigator.userAgent||"",n=/^((?!chrome|android).)*safari|Hearty_iOS/i.test(t)?["Safari"]:t.match(/(Ya|UC|QQ|BIDU|LB)browser|MetaSr|Maxthon|Edge|Opera(| Mini)|OPR|Firefox|Chrom(e|ium)|MSIE/gi)||[];return n=n.length>0?n[0]:"",null==e?n:e==n}function check_hjapp(e){var t=(navigator.userAgent||"").match(/Hearty_(iOS|Android)/)||[];return t=t.length>0&&t[0].replace(/Hearty_/i,""),null==e?t:e==t}function check_hjpwa(){return window.matchMedia("(display-mode: standalone)").matches}function hj_getScript(e,t,n){return $.ajax({type:"GET",dataType:"script",url:e,success:t||{},error:n||{},cache:!0,scriptCharset:"utf-8"})}function hj_getScript_npm(e,t,n){n=n||{},hj_getScript("//cdn.jsdelivr.net/npm/"+(e=e||"jquery@3.4.1/dist/jquery.min.js"),t=t||{},function(){hj_getScript("//unpkg.com/"+e,t,n)})}function hj_getScript_gh(e,t,n){(e=e||{}).repo="repo"in e?e.repo:"chennien/hearty.me",e.path="path"in e?e.path:"",e.commit="commit"in e?e.commit:"master",t=t||{},n=n||{},hj_getScript("//cdn.jsdelivr.net/gh/"+e.repo+"@"+e.commit+"/"+e.path,t,function(){hj_getScript("//cachefly.jsdelivr.net/gh/"+e.repo+"@"+e.commit+"/"+e.path,t,function(){hj_getScript("//cdn.statically.io/gh/"+e.repo+"/"+e.commit+"/"+e.path,t,n)})})}function serverReachable(){if(window.navigator.onLine){var e=$.ajax({type:"HEAD",url:location.origin+"/update?"+(new Date).getTime().toString(16),async:!1}).status;return e>=200&&e<300||304===e}return!1}function hj__include(e,t){var n;"js"==e?(n=document.createElement("script")).src=t:((n=document.createElement("link")).rel="stylesheet",n.href=t);(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(n)}function cssFeatureSupported(e,t){if("CSS"in window)return window.CSS.supports(e,t);var n=document.createElement("div");return n.style[e]=t,n.style[e]===t}function getUrlPara(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),n=location.search.substr(1).match(t);return null!=n?decodeURIComponent(n[2]):null}function getcookie(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){var a=n[i].trim();if(0===a.indexOf(t))return a.substring(t.length,a.length)}return""}function setcookie(e,t,n){var i=new Date;i.setMonth(i.getMonth()+(n||3)),document.cookie=e+"="+t+";expires="+i+";domain=."+document.domain+";path=/;secure"}function hj_alert(e){alert(e)}function hj_vibrate(e){"vibrate"in navigator&&navigator.vibrate([e||80])}function open_url(e){check_hjapp("Android")?location.href=e+(e.indexOf("?")>0?"&":"?")+"wvtab=1":window.open(e,"_blank")}function account_status(){return hj_update({action:"account_status"})}function msg(e,t,n){e=(e||"").toString(),t=t||"知道了",n=n||function(){},$(".alertify-cover:visible").length>0?$.wait(1500).then(function(){msg(e,t,n)}):(alertify.set({labels:{ok:t}}),alertify.alert(e||"<i class='far fa-info-circle'></i> 溫度日記忙線中，請稍後再試",n))}function alertify_input_custom(e,t){var n=$("#alertify .alertify-text");return null!=e&&"object"==typeof e&&("password"==e.type&&n.wrap("<form></form>"),"autocomplete"in e||(e.autocomplete="off"),"autocapitalize"in e||(e.autocapitalize="off"),e.required="",n.attr(e)),null!=t&&"object"==typeof t&&n.css(t),n}function alertify_input_shake(){return shake($("#alertify .alertify-text"))}function press_enter(e,action){13==(e.keyCode?e.keyCode:e.which)&&(action.indexOf("(")>0?eval(action):eval(action+"();"))}function timestamping(){return Date.now?Date.now()/1e3|0:(new Date).getTime()}function hj_localdate(e){var t="show_year"in e&&e.show_year,n="timestamp"in e&&e.timestamp||timestamping();if("is_string"in e&&e.is_string){var i={month:"long",day:"numeric"};return t&&(i.year="numeric"),new Date(1e3*parseInt(n)).toLocaleDateString("zh-TW",i)}var a=new Date(36e5*Math.ceil(parseInt(n)/3600)-6e4*(new Date).getTimezoneOffset()).toISOString().split("T")[0];return a=a.split("-"),t||a.shift(),a.join("/")}function dynamic_function(e){this[e].apply(null,Array.prototype.slice.call(arguments,1))}function htmlspecialchars(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):""}function shake(e){for(var t=20,n=0;n<8;n++)e.animate({"margin-left":"+="+(t=-t)+"px","margin-right":"-="+t+"px"},50);return navigator.vibrate&&navigator.vibrate([800]),e}function signout(e){null==e?(alertify.set({labels:{ok:"否",cancel:"登出 🔑"},buttonReverse:!1}),alertify.confirm("確定要登出嗎？",function(e){e||(ga_event_push("Sign Out",{event_category:"Auth",event_label:"Sign Out"}),window.sessionStorage.clear(),setcookie("hearty_screenlock","",1),hj_href("signout"))})):(window.sessionStorage.clear(),setcookie("hearty_screenlock","",1),hj_href("signout"))}function leave_InAppBrowser(){var e=getUrlPara("openExternalBrowser");if((navigator.userAgent||"").indexOf("Line/")>0&&!e){var t=location.href;location.href=t+(t.indexOf("?")>0?"&":"?")+"openExternalBrowser=1"}else if(e)try{(t=new URL(location)).searchParams.delete("openExternalBrowser"),window.history.replaceState({},document.title,t.pathname+t.search)}catch(e){}}function numberWithCommas(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function capitalizeFirstLetter(e){return null==e?"":e.charAt(0).toUpperCase()+e.slice(1)}function user_country(){var e=getcookie("hearty_user_country");if(e)return decodeURIComponent(e)||"";hj_getScript_gh({repo:"vdurmont/userinfo-js",path:"dist/userinfo.min.js",commit:"1.1.1"},function(){"UserInfo"in window&&"getInfo"in window.UserInfo&&window.UserInfo.getInfo(function(e){var t=new Date;return t.setDate(t.getDate()+1),document.cookie="hearty_user_country="+e.country.code+";expires="+t+";domain=."+document.domain+";path=/;secure",e.country.code})})}function hj_mixpanel(e,t){void 0!==window.mixpanel&&(null==t?window.mixpanel.track(e):window.mixpanel.track(e,t))}function ga_event_push(e,t){void 0!==window.gtag&&window.gtag("event",e,t)}function scroll2focused(e){(e=e||$("body")).find("input[type='text'], input[type='email'], input[type='number'], input[type='date'], input[type='tel'], input[type='url'], textarea").focus(function(){$("html, body").animate({scrollTop:$(this).offset().top-$(window).innerHeight()/4+"px"},"fast")})}function hj_survey(e,t,n){var i=(t||$("body")).find("[data-gform]"),a=[];if(i.filter("[required]").each(function(){var e=$(this).is("[name]")?i.filter($("[name='"+$(this).attr("name")+"']")):$(this),t=hj_survey_val(e);null!=t&&t.length||a.push({e:e,t:e.attr("title")||""})}),i.filter("[minlength]").each(function(){var e=$(this).val().length;e>0&&e<Number($(this).attr("minlength"))&&a.push({e:$(this),t:$(this).attr("title")||""})}),i.filter("[maxlength]").each(function(){$(this).val().length>Number($(this).attr("maxlength"))&&a.push({e:$(this),t:$(this).attr("title")||""})}),i.filter('[type="email"]').each(function(){(!/@/.test($(this).val())||$(this).val().length<6)&&a.push({e:$(this),t:$(this).attr("title")||""})}),i.filter("[pattern]").each(function(){new RegExp($(this).attr("pattern")).test(hj_survey_val($(this)))||a.push({e:$(this),t:$(this).attr("title")||""})}),a.length>0)return shake(a[0].e),a[0].e.focus(),a[0].t;var r={};return i.each(function(){var e=hj_survey_val($(this).is("[name]")?i.filter($("[name='"+$(this).attr("name")+"']")):$(this));null!=e&&(r["entry."+$(this).attr("data-gform")]=e.trim())}),Object.keys(r).length>0&&hj_update({action:"gform_post",uri:e,data:$.param(r)}).then(function(e){"function"==typeof n&&n(e)}),!0}function hj_survey_val(e){return e.is('[type="checkbox"]')?e.map(function(){return $(this).filter(":checked").val()}).toArray().join(", "):e.is('[type="radio"]')?e.filter(":checked").val():e.val()}function ios_body_position_fix(){/Hearty_iOS\/1.(1|2.0)/.test(navigator.userAgent||"")&&window.scrollTo(0,0)}function img_cdn_fallback(e){if(null!=e)return e.replace(/i[0-3].wp.com/gi,"cdn.statically.io/img");$("img[src*='.wp.com/']").attr("onerror","this.onerror=null; this.src=img_cdn_fallback(this.src)")}function hj_lang_zhcn(){return"zh-cn"==(navigator.language||"").toLowerCase()}function hj_localize_cn(){var e=hj_lang_zhcn();return e&&hj_getScript_gh({path:"public/editor.zhongwen.min.js",commit:"1.0.22"},function(){"function"==typeof zh_translatePage&&zh_translatePage()}),e}function hj_rating(){var e='給溫度日記 5顆小星星<br><i class="fal fa-star"></i> <i class="fal fa-star"></i> <i class="fal fa-star"></i> <i class="fal fa-star"></i> <i class="fal fa-star"></i>',t={Google:['<i class="fab fa-google"></i> Google',"//hearty.me/wv?o=g.page/heartyme/review"],iOS:['<i class="fab fa-app-store"></i> AppStore',"//itunes.apple.com/app/id1423459636?action=write-review"],Android:['<i class="fab fa-google-play"></i> Android',"market://details?id=com.hearty.me"]},n=check_hjapp();is_touch_device()?n?(alertify.set({labels:{ok:t.Google[0],cancel:t[n][0]},buttonReverse:!0}),alertify.confirm(e+"<br><br>邀請請您於這裡給評：",function(i){i?(location.assign(t.Google[1]),hj_rating_2nd(e,t[n])):(location.assign(t[n][1]),hj_rating_2nd(e,t.Google))}),check_hjapp("iOS")&&location.assign("//hearty.me/wv?r=rating")):open_url("//g.page/heartyme/review"):open_url("//goo.gl/kQ7KbC")}function hj_rating_2nd(e,t){msg(e,t[0],function(){location.assign(t[1])})}function hj_firebase_init(){if(window.firebase&&(firebase.initializeApp({apiKey:"AIzaSyAfAW9Zrxe1p-7VGwvCFRVrogSfxLvfptU",authDomain:"hearty-me.firebaseapp.com",databaseURL:"https://hearty-me.firebaseio.com",projectId:"hearty-me",storageBucket:"hearty-me.appspot.com",messagingSenderId:"61745568427",appId:"1:61745568427:web:d7cc2cd1fdd72814b335ee",measurementId:"G-TY63VJYXKY"}),firebase.analytics(),!check_hjapp())){var e=firebase.messaging();e.usePublicVapidKey("BJGwjWY6MviBp3gKYq8yjJ7LQT-TUBfWphAMmq3biKDqINUv1s6l_qkvyEqF27ox3sxOoJCO_B7VDFS2qtYqozk"),e.onMessage(e=>{var t=e.data;new Notification(t.title,{body:t.body,icon:t.badge})}),window.Notification&&"granted"==Notification.permission&&hj_fcm_init()}}function hj_fcm_init(){check_hjapp()?location.assign("//hearty.me/wv?r=pushnotification"+(window.hj_username?"&username="+hj_username:"")):window.firebase&&window.Notification&&Notification.requestPermission().then(e=>{switch(e){case"granted":var t=firebase.messaging();t.getToken().then(e=>{e?hj_fcm_register(e):console.warn("No Instance ID token available. Request permission to generate one")}).catch(e=>{console.warn("Error occurred while retrieving token. ",e)}),t.onTokenRefresh(()=>{t.getToken().then(e=>{hj_fcm_register(e)}).catch(e=>{console.warn("Unable to retrieve refreshed token ",e)})});break;case"denied":var n="hearty_notification_denied",i=new Date;getcookie(n)||(alertify.set({labels:{ok:"別理我",cancel:"<i class='fas fa-toggle-on'></i> 立即開啟"},buttonReverse:!0}),alertify.confirm("<i class='far fa-bell-slash'></i> 尚未授予通知權限<br>若收到了站上訊息、筆友私訊，都不能讓你知道 <i class='far fa-sad-tear'></i>",function(e){if(!e)switch(check_browser()){case"Safari":open_url("//support.apple.com/guide/safari/sfri40734/mac#ibrw95cba9bb");break;case"Firefox":open_url("//mzl.la/20jwSoU#w_nadadaliccoioigoihaasecgaoacoeeooaka");break;default:open_url("//support.google.com/chrome/answer/3220216")}i.setDate(i.getDate()+1),document.cookie=n+"=1; expires="+i.toGMTString()+"; path=/;secure"}),hj_mixpanel("Push Notification Deny"),ga_event_push("Push Notification Deny"))}})}function hj_fcm_register(e){return console.log("FCMtoken: "+e),hj_update({action:"fcm_register",fcmtoken:e,on_mobile:+is_touch_device()})}function hj_href(e){$("body").addClass("loading"),top.location.href=location.origin+"/"+e}function hj_go_href(e){$("body").addClass("loading"),top.location.href="//go.hearty.me/"+e}$.ajaxSetup({scriptCharset:"utf-8",cache:!0}),$.wait=function(e){var t=$.Deferred();return setTimeout(function(){t.resolve()},e),t},hj_firebase_init();