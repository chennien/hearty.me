var yt_player;function onYouTubeIframeAPIReady(){yt_player=new YT.Player("yt_player",{videoId:"vYFnZdUiUyg",events:{onReady:function(t){t.target.setVolume(50),yt_player.current_video=0},onStateChange:function(t){if(t.data==YT.PlayerState.ENDED){var e=$(".ytbox .yt_list");yt_player.current_video<e.find("li[data-yt]").length-1?yt_player.current_video++:(yt_player.current_video=0,e.scrollTop(0)),ytbox_play()}}}})}function ytbox_play(){var t=$(".ytbox .yt_list li[data-yt]"),e=t.eq(yt_player.current_video),a=e.attr("data-yt");"loadVideoById"in yt_player&&yt_player.loadVideoById({videoId:a,suggestedQuality:"large"}),t.removeAttr("data-playing"),e.attr("data-playing","")}function ytbox_toggle(t,e){null==$(".ytbox").data("init")&&(e=e||"vYFnZdUiUyg",$("<iframe>",{id:"yt_player",src:"//www.youtube.com/embed/"+e+"?"+$.param({enablejsapi:1,controls:1,fs:1,modestbranding:1,cc_load_policy:1,rel:0,autoplay:0,playsinline:1}),allow:"autoplay; encrypted-media",allowfullscreen:""}).appendTo($(".yt_player > div:first-child")),hj_video("load_player_api"),ytbox_query(),$(".ytbox .yt_list ol").sortable({items:"> li",axis:"y",cursor:"row-resize",scroll:!0,handle:".arr",placeholder:"dragging",start:function(){$(this).children("li").attr("data-opacity","")},stop:function(){$(this).children("li").removeAttr("data-opacity")},update:function(){ytbox_sorting()},change:function(){$("li.dragging").css({margin:0}).delay(10).queue(function(){$(this).css({margin:"10px auto"}).dequeue()})}}).disableSelection(),$(".ytbox").data("init",1)),popup_toggle(t,"ytbox"),t&&saved(!1);var a=t?"Open":"Close";hj_mixpanel("YTbox "+a),ga_event_push("YTbox "+a,{event_category:"YTbox "+a,event_label:"YTbox "+a})}function ytbox_sorting(){var t=$(".ytbox .yt_list li[data-yt]").map(function(){return Number($(this).attr("data-play_id"))}).toArray();t.length>1&&hj_update({action:"ytbox_sorting",videos:JSON.stringify(t)}).then(function(t){switch(t.Status){case 1:hj_mixpanel("Video Sorting"),ga_event_push("Video Sorting",{event_category:"YTbox",event_label:"Video Sorting"});break;case 2:signin_required()}})}function ytbox_add(t){var e=$(".ytbox .yt_list ol"),a=["nQWFzMvCfLE","FYjxHPtKihw","C9ujBoud26k","bVjedGudN8w","_r3aag869Tg"];t=t||a[Math.floor(Math.random()*a.length)],alertify.set({labels:{ok:"<i class='fas fa-plus'></i> 加入歌單",cancel:"取消"},buttonReverse:!1}),alertify.prompt("<i class='fab fa-youtube'></i> Youtube 網址",function(t,a){if(t)if(a=YoutubeURLparser(a)){var i=hj_video("get_title",a);if(!i)return void msg("<i class='fal fa-video-slash'></i> 影片可能已刪除、未公開，或是不允許嵌入<br>請重新檢查原連結","好",function(){ytbox_add(""),alertify_input_shake()});i=capitalizeFirstLetter(i)||"新影片",hj_update({action:"ytbox_add",video:a,title:i,order:e.children("li[data-yt]").length}).then(function(t){switch(t.Status){case 1:e.append(ytbox_btns_binding(ytbox_create({play_id:t.Values.play_id,title:i,youtube:a}))),$(".ytbox .yt_list").scrollTop(e.height()),alertify.success("<i class='far fa-play'></i> "+(null==i?"":"「"+i+"」")+"已加入"),hj_mixpanel("Video Added",{post_id:"ytbox",youtube:a}),ga_event_push("Video Added",{event_category:"YTbox",event_label:"Video_Added"});break;case 2:signin_required()}})}else msg("<i class='fal fa-video-slash'></i> Youtube 網址格式不正確","好",function(){ytbox_add(""),alertify_input_shake()})},"https://www.youtube.com/watch?v="+t),alertify_input_custom({type:"url",placeholder:"https://www.youtube.com/watch?v=vYFnZdUiUyg",onclick:"select_input_text($(this))",onpaste:"$.wait(50).then(function(){$('.alertify-text').blur()})",onchange:"if(!!YoutubeURLparser(this.value)) $('.alertify-button-ok').click()"}),ytbox_delete_btns(!1)}function ytbox_detach(t){var e=$(".ytbox .yt_list li[data-play_id='"+t+"']"),a=e.attr("title");alertify.set({labels:{ok:"否",cancel:"<i class='fas fa-trash-alt'></i> 刪除"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-exclamation-triangle'></i> 確認刪除「"+a+"」嗎？",function(a){a||hj_update({action:"ytbox_detach",play_id:t}).then(function(t){switch(t.Status){case 1:e.slideUp("fast",function(){$(this).remove()}),hj_vibrate(80),hj_mixpanel("Video Detach"),ga_event_push("Video Detach",{event_category:"YTbox",event_label:"Video Detach"});break;case 2:signin_required()}ytbox_delete_btns()})})}function ytbox_query(){hj_update({action:"ytbox_query"}).then(function(t){switch(t.Status){case 1:var e=[],a=$(".ytbox .yt_list ol");t.Values.videos.forEach(function(t,a){e.push(ytbox_btns_binding(ytbox_create({play_id:t.play_id,title:t.title,youtube:t.youtube})))}),a.html(e).attr("data-empty","還沒加入任何歌曲，點 ➕ 新增一首");break;case 2:signin_required()}})}function ytbox_create(t){return $("<li>",{title:t.title,"data-play_id":t.play_id,"data-yt":t.youtube}).html($("<span>",{class:"arr",title:"排序"}).add($("<span>",{"data-delete":"",title:"刪除"})))}function ytbox_delete_btns(t){$d=$(".ytbox .yt_list li [data-delete]"),null==t?$d.toggle():t?$d.fadeIn():$d.fadeOut()}function ytbox_btns_binding(t){return t.on("click",function(){yt_player.current_video=$(this).index(),ytbox_play()}).find("[data-delete]").on("click",function(e){e.stopPropagation(),ytbox_detach(t.attr("data-play_id"))}),t}