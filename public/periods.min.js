"use strict";function period_add(a,b,e,g){a=a||0;var f=(new Date).toLocaleDateString("sv"),m=new Date((new Date).getTime()+864e5).toLocaleDateString("sv"),j="20[0-2][0-9]-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])",k=(b=b||"",e=e||"",g=g||0,date_format(b||f)),h=e?date_format(e):"",l=$(".periods"),_=$("<div>",{class:"td td1 period_interval"+(a>0&&(g<18||g>=38)?" ng":"")}).text(a>0?g:""),n=$("<div>",{class:"td td1 period_removal",title:_h("e-pd-10"),html:$("<span>",{class:"period_remove",onclick:"period_remove("+a+")"})}),d={td:$("<div>",{class:"td td2 period_start display","data-dayid":a,"data-day":b==f?_h("e-pd-8"):k,title:k,onclick:"period_editing_toggle(true,this.dataset.dayid,0)"}),td_inner:$("<div>",{onclick:"event.stopPropagation()"}),edit:$("<input>",{type:"date",pattern:j,max:m,onchange:"if(!this.value) this.value='"+f+"'; else period_update('start',"+a+",this.value)",required:!0,autofocus:!b}).val(b),ok:$("<div>",{class:"ok",onclick:"period_editing_toggle(false,"+a+")",title:_h("e-ok-0")})},c={td:$("<div>",{class:"td td2 period_end display","data-dayid":a,"data-day":e==f?_h("e-pd-8"):h,title:h,onclick:"period_editing_toggle(true,this.dataset.dayid,1)"}),td_inner:$("<div>",{onclick:"event.stopPropagation()"}),edit:$("<input>",{type:"date",pattern:j,list:"ls_"+a,min:b?period_add_days(b,2):"",max:b?[f,period_add_days(b,14)].reduce(function(a,b){return a<b?a:b}):f,onchange:"if(this.value!=='') period_update('end',"+a+",this.value)",title:h,disabled:!b}).val(e),list:$("<datalist>",{id:"ls_"+a}),ok:$("<div>",{class:"ok",onclick:"period_editing_toggle(false,"+a+")",title:_h("e-ok-0")})};(check_OS("iOS")||check_browser("Safari"))&&d.edit.add(c.edit).each(function(){$(this).attr({type:"text",pattern:j,onclick:"$(this).datepicker('show').select()",readonly:""}).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showAnim:"slideDown",minDate:$(this).attr("min")||"",maxDate:$(this).attr("max")||"",showButtonPanel:!0})}),l.find("[data-dayid='0']").parent().remove(),d=d.td.html(d.td_inner.append(d.edit.add(d.ok)));for(let i=6;i<9;i++)c.list.append($("<option>").val(period_add_days(b,i)));c=c.td.html(c.td_inner.append(c.edit.add(c.list).add(c.ok))),$("<div>",{class:"period tr"}).append(d.add(c).add(_).add(n)).prependTo(l.find(".records")),a||period_editing_toggle(!0,0,0),hj_mixpanel("Period Day Added",{day_id:a}),ga_event_push("Period Day Added",{event_category:"Period Day",event_label:"Added"})}function period_add_days(a,b){return(a=new Date(new Date(a).getTime()+864e5*b)).getFullYear()+"-"+("0"+(a.getMonth()+1)).slice(-2)+"-"+("0"+a.getDate()).slice(-2)}function period_lookup(){var a=$(".periods");a.find(".records").slideUp("fast",function(){hj_update({action:"period_lookup"}).then(function(c){if(1===c.Status){var b=c.Values,d=b.period_day_next;a.find(".day_cycle").text(b.period_day_cycle),a.find(".day_next").text(date_format(d)),period_days_between(d),a.find(".period").remove(),b.periods.forEach(function(a){period_add(a.day_id,a.day_start,a.day_end,a.day_interval)}),b.periods.length>0?a.find(".prediction").slideDown():a.find(".prediction").slideUp(),period_remove_btn(!1),a.find(".records").slideDown("slow")}})}),hj_mixpanel("Period Day Lookup"),ga_event_push("Period Day Lookup",{event_category:"Period Day",event_label:"Lookup"})}function period_editing_toggle(c,d,a){var b=$(".periods");b.find("[data-dayid]").addClass("display"),c&&(b.find("[data-dayid='"+d+"']").removeClass("display").find("input").eq(null==a?0:a).focus(),period_remove_btn(!1))}function period_update(c,b,a){if(null!=a&&""!=a){var e=$(".periods"),f=e.find(".period_"+c+"[data-dayid='"+b+"']"),d=date_format(a);period_editing_toggle(!1,b),f.attr({"data-day":d,title:d}),hj_update({action:"period_update",type:c,day_id:b||0,day:a}).then(function(a){if(1===a.Status){var d=a.Values.day_id;"start"==c?period_lookup():b||e.find("[data-dayid=0]").attr({"data-dayid":d,onclick:"period_editing_toggle(true,"+d+",1)"}),hj_mixpanel("Period Day Updated",{day_id:b}),ga_event_push("Period Day Updated",{event_category:"Period Day",event_label:"Updated"})}})}}function period_remove_btn(d){var a=$(".periods"),b=a.find(".period_interval").add(a.find(".day_trash")),c=a.find(".period_removal");a.find(".period").length?d?(c.fadeIn(),b.slideUp()):(c.fadeOut(),b.slideDown()):(c.fadeOut(),b.slideUp())}function period_remove(a){var b=$(".periods");a?(alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-times"></i> '+_h("e-pd-9")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-moon"></i> '+_h("e-pd-10"),function(c){c||hj_update({action:"period_remove",day_id:a}).then(function(c){1===c.Status?(period_lookup(),b.find(".period_removal").fadeOut(),hj_vibrate(30),hj_mixpanel("Period Day Removed",{day_id:a}),ga_event_push("Period Day Removed",{event_category:"Period Day",event_label:"Removed"})):signin_required(),period_remove_btn(!1)})})):b.find("[data-dayid=0]").parent().fadeOut(300,function(){$(this).remove()})}function period_days_between(c){var d=new Date((new Date).setHours(0,0,0)),a=Math.round((new Date(new Date(c).setHours(0,0,0)).getTime()-d.getTime())/864e5),b=$(".periods .days_left");!0==a<=0?(a=Math.abs(a))<7?(a++,b.text(_h("e-pd-11",{$d:a,$th:nth(a)}))):b.text(_h("e-pd-1")):b.text(_h("e-pd-12",{$d:a}))}period_lookup()