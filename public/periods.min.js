"use strict";function period_add(e,d,t,i){var e=e||0,a=today(),o=new Date(new Date().getTime()+864e5).toLocaleDateString("sv"),n="20[0-2][0-9]-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])",d=d||"",t=t||"",i=i||0,r=date_format(d||a),p=t?date_format(t):"",s=$(".periods"),l=$("<div>",{class:"td td1 period_interval"+(e>0&&(i<18||i>=38)?" ng":"")}).text(e>0?i:""),c=$("<div>",{class:"td td1 period_removal",title:_h("e-pd-10"),html:$("<span>",{class:"period_remove",onclick:"period_remove("+e+")"})}),u={td:$("<div>",{class:"td td2 period_start display","data-dayid":e,"data-day":d==a?_h("e-pd-8"):r,title:r,onclick:"period_editing_toggle(true,this.dataset.dayid,0)"}),td_inner:$("<div>",{onclick:"event.stopPropagation()"}),edit:$("<input>",{type:"date",pattern:n,max:o,onchange:"if(!this.value) this.value='"+a+"'; else period_update('start',"+e+",this.value)",required:!0,autofocus:!d}).val(d),ok:$("<div>",{class:"ok",onclick:"period_editing_toggle(false,"+e+")",title:_h("e-ok-0")})},f={td:$("<div>",{class:"td td2 period_end display","data-dayid":e,"data-day":t==a?_h("e-pd-8"):p,title:p,onclick:"period_editing_toggle(true,this.dataset.dayid,1)"}),td_inner:$("<div>",{onclick:"event.stopPropagation()"}),edit:$("<input>",{type:"date",pattern:n,list:"ls_"+e,min:d?period_add_days(d,2):"",max:d?[a,period_add_days(d,14)].reduce(function(e,d){return e<d?e:d}):a,onchange:"if(this.value!=='') period_update('end',"+e+",this.value)",title:p,disabled:!d}).val(t),list:$("<datalist>",{id:"ls_"+e}),ok:$("<div>",{class:"ok",onclick:"period_editing_toggle(false,"+e+")",title:_h("e-ok-0")})};(check_OS("iOS")||check_browser("Safari"))&&u.edit.add(f.edit).each(function(){$(this).attr({type:"text",pattern:n,onclick:"$(this).datepicker('show').select()",readonly:""}).datepicker({dateFormat:"yy-mm-dd",changeMonth:!0,showAnim:"slideDown",minDate:$(this).attr("min")||"",maxDate:$(this).attr("max")||"",showButtonPanel:!0})}),s.find("[data-dayid='0']").parent().remove(),u=u.td.html(u.td_inner.append(u.edit.add(u.ok)));for(let y=6;y<9;y++)f.list.append($("<option>").val(period_add_days(d,y)));f=f.td.html(f.td_inner.append(f.edit.add(f.list).add(f.ok))),$("<div>",{class:"period tr"}).append(u.add(f).add(l).add(c)).prependTo(s.find(".records")),e||period_editing_toggle(!0,0,0),ga_evt_push("Period Day Added",{event_category:"Period Day",event_label:"Added"})}function period_add_days(e,d){return(e=new Date(new Date(e).getTime()+864e5*d)).getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)}function period_lookup(){var e=$(".periods");e.find(".records").slideUp("fast",function(){hj_update({action:"period_lookup"}).then(function(d){if(1===d.Status){var t=d.Values,i=t.period_day_next;e.find(".day_cycle").text(t.period_day_cycle),e.find(".day_next").text(date_format(i)),period_days_between(i),e.find(".period").remove(),t.periods.forEach(function(e){period_add(e.day_id,e.day_start,e.day_end,e.day_interval)}),t.periods.length>0?e.find(".prediction").slideDown():e.find(".prediction").slideUp(),period_remove_btn(!1),e.find(".records").slideDown("slow")}})}),ga_evt_push("Period Day Lookup",{event_category:"Period Day",event_label:"Lookup"})}function period_editing_toggle(e,d,t){var i=$(".periods");i.find("[data-dayid]").addClass("display"),e&&(i.find("[data-dayid='"+d+"']").removeClass("display").find("input").eq(null==t?0:t).focus(),period_remove_btn(!1))}function period_update(e,d,t){if(null!=t&&""!=t){var i=$(".periods"),a=i.find(".period_"+e+"[data-dayid='"+d+"']"),o=date_format(t);period_editing_toggle(!1,d),a.attr({"data-day":o,title:o}),hj_update({action:"period_update",type:e,day_id:d||0,day:t}).then(function(t){if(1===t.Status){var a=t.Values.day_id;"start"==e?period_lookup():d||i.find("[data-dayid=0]").attr({"data-dayid":a,onclick:"period_editing_toggle(true,"+a+",1)"}),ga_evt_push("Period Day Updated",{event_category:"Period Day",event_label:"Updated"})}})}}function period_remove_btn(e){var d=$(".periods"),t=d.find(".period_interval").add(d.find(".day_trash")),i=d.find(".period_removal");d.find(".period").length?e?(i.fadeIn(),t.slideUp()):(i.fadeOut(),t.slideDown()):(i.fadeOut(),t.slideUp())}function period_remove(e){var d=$(".periods");if(!e){d.find("[data-dayid=0]").parent().fadeOut(300,function(){$(this).remove()});return}alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-times"></i> '+_h("e-pd-9")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-moon"></i> '+_h("e-pd-10"),function(t){t||hj_update({action:"period_remove",day_id:e}).then(function(e){1===e.Status?(period_lookup(),d.find(".period_removal").fadeOut(),hj_vibrate(30),ga_evt_push("Period Day Removed",{event_category:"Period Day",event_label:"Removed"})):signin_required(),period_remove_btn(!1)})})}function period_days_between(e){var d=new Date(new Date().setHours(0,0,0)),t=Math.round((new Date(new Date(e).setHours(0,0,0)).getTime()-d.getTime())/864e5),i=$(".periods .days_left");!0==t<=0?(t=Math.abs(t))<7?(t++,i.text(_h("e-pd-11",{$d:t,$th:nth(t)}))):i.text(_h("e-pd-1")):i.text(_h("e-pd-12",{$d:t}))}period_lookup();