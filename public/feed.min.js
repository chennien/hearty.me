"use strict";var btn_alias="feed";function feed_hotkey_init(){is_touch_device()||$(document).on("keydown",function(d){var b=d.keyCode,c=$(".feed_wall"),a=c.find("article");(38==b||40==b)&&(d.preventDefault(),a.length>0&&((a=(38==b?a.filter("[data-active]").prev().get(0):a.filter("[data-active]").next().get(0))||a.eq(0).get(0)).click(),c.scrollTop(a.offsetTop||c.get(0).scrollHeight)))})}function feed_scrolltop(a){a=a||$("html,body"),check_browser("Safari")?a.stop().animate({scrollTop:0},450):a.stop().scrollTop(0)}function hj_feed_history_init(){1025>$("body").width()&&"function"==typeof history.pushState&&(hj_feed_history_push(),window.addEventListener("popstate",function(){var a=$(".page .story"),b=$(".feed").scrollLeft();$(".feed .profile").is(":visible")?(profile_popup(),hj_feed_history_push()):a.is(":visible")?(nav_toggle_feed(+(0==b)),b>0?a.delay(500).queue(function(){$(this).hide().dequeue()}):a.show(),hj_feed_history_push()):hj_href("d"),null!=$("nav.menu").data("mmenu")&&$("nav.menu").data("mmenu").close()},!1))}function hj_feed_history_push(){history.pushState(null,document.title,location.href)}function nav_toggle_feed(b){var a=$(".feed");if(b=b||0,a.length>0){var c=a.width()*b;check_browser("Safari")?a.animate({scrollLeft:c},450):a.scrollLeft(c)}}function read_post(b){var c=Number(b.post_id)||0,a=$(".page .story"),e=a.find("article"),f=a.find(".covid19"),d=is_touch_device();d||a.fadeOut("fast"),$.ajax({url:location.href,type:"post",data:{action:"read",post_id:c},async:!0,dataType:"json"}).then(function(g){1===g.Status?(g=g.Values,e.find("h2").attr({title:g.title}),document.title=g.title+" | \u{1F49D} \u6EAB\u5EA6\u65E5\u8A18 Hearty Journal",g.post=(g.post||"").trim(),e.find("p").html(linkify(g.post)),/co(vid|ronavirus)|vaccin(e|ation)|(epi|pan)demic|delta|omicron|新冠|冠(狀|状)|病毒|肺炎|疫(情|苗)|(防|抗)疫|武(漢|汉)/ig.test(g.title+g.post)?f.show():f.hide(),e.find(".published").attr({title:g.published}),e.attr({"data-username":b.username,"data-post_id":c}).find(".avatar").attr({title:b.nickname,"data-profile_image":b.profile_image,"data-gender":b.gender}).find("div").css({"background-image":"url("+webp_profile_image(b.profile_image)+")"}),$(".page .illustration").hide(),d?a.show().scrollTop(0):a.slideDown("fast",function(){$(this).scrollTop(0)}),$(".feed_wall article").removeAttr("data-active").filter("[data-post_id='"+c+"']").attr("data-active","")):nav_toggle_feed(0)}).fail(function(){msg()}),nav_toggle_feed(1)}function linkify(a){return(a||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\b(?:https):\/\/(|(\w+)\.)(hearty\.(me|app|gift|tw|page\.link|eu\.org)|hj\.rs|ht\.mk|nien\.(co(m|)|org)|youtu(be\.com|\.be))(\/(\S+)?|)/gim,'<a target="_blank" href="$&" rel="ugc" title="$&">$&</a>').replace(/((?!([\(])).|^|\s)#(\S+)(?![^<]*>|[^<>｛｝]*<\/)/g,'$1<a title="$3" onclick="msg(\'#$3\')">#$3</a>').replace(/[^\S\r\n]?\*([^\*{}=#<>｛｝]+)\*[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,'<mark title="$1">$1</mark>').replace(/[^\S\r\n]?[{|｛]([^\*{}=#<>｛｝]+)[}|｝][^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,'<u title="$1">$1</u>').replace(/[^\S\r\n]?=([^\*{}=#<>｛｝]+)=[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,'<u title="$1" data-double>$1</u>')}function focus_active_post(b){nav_toggle_feed(0);var a=$(".feed_wall article"+(null==b?"[data-active]":"[data-post_id='"+b+"']"));return"scrollIntoView"in document.documentElement&&a.length>0&&a.get(0).scrollIntoView(),a.delay(400).animate({zoom:1.1},300,function(){$(this).animate({zoom:1},300),hj_vibrate(30)}),a}function bookmark(a,b){hj_update({action:"bookmark",post_id:a}).then(function(b){switch(b.Status){case 1:hj_mixpanel("Post Bookmarked",{post_id:a}),ga_event_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:alertify.set({labels:{ok:'<i class="fas fa-sign-in-alt"></i> '+_h("f-signin-0"),cancel:_h("f-no")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-door-open"></i> '+_h("f-signin-1"),function(a){a&&hj_href("#signin?r=/feed")})}}),b.toggleClass("fal fas")}function profile_popup(b,c,d,e,f){var a=$(".feed .profile");null==b?a.fadeOut("fast"):(a.find("[data-a]").css({"background-image":"url(//i.hearty.app/u/"+d+")"}),a.find("[data-n]").attr({title:c,"data-gender":e}),a.find("[data-link]").attr({"data-username":b,"data-nickname":c,"data-post_id":f}),a.find("[data-penpal_add]").attr({"data-username":b}),a.fadeIn("fast"))}function feed_share_this(b,c){var a="https://hearty.app/"+b+"/"+c+"?st="+encodeURIComponent($(".story h2").attr("title")||"");/iOS|Android/i.test(check_hjapp())?location.assign("//hearty.me/wv?s="+encodeURIComponent(a.replace(/(^\w+:|^)\/\//,""))):is_touch_device()&&"share"in navigator?navigator.share({title:document.title,url:a}).catch(function(a){}):(alertify.set({labels:{ok:_h("f-no"),cancel:'<i class="fas fa-copy"></i> '+_h("f-url-0")},buttonReverse:!0}),alertify.prompt('<i class="fal fa-file-alt"></i> '+_h("f-url-1")+'<br><br><a class="qrcode"></a>',function(a){a||hj_copy($("#alertify .alertify-text"))},a),alertify_input_custom({type:"url",inputmode:"none",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy"}),get_qrcode($("#alertify .qrcode"),a)),hj_copy_text(a)}function how2publish(){alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("f-publish_ask-4"),cancel:_h("f-publish_ask-3")},buttonReverse:!1}),alertify.confirm('<h3><i class="fal fa-info-circle"></i> '+_h("f-publish_ask-0")+"</h3>"+_h("f-publish_ask-1")+'\u3010 <i class="fal fa-share-alt"></i> \u3011'+_h("f-publish_ask-2"),function(a){a&&hj_href("d")})}function report_abuse(a){account_status().then(function(b){if(1==b.Status){var c=$(".page .story article"),d=(c.find("h2").attr("title")||"\u7121\u6A19\u984C").trim();alertify.set({labels:{ok:_h("f-no"),cancel:'<i class="fas fa-check-circle"></i> '+_h("f-report_ask-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-flag-alt"></i> '+_h("f-report_ask-0",{$title:d}),function(b){b||hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.527303026":"\u6295\u7A3F\u65E5\u8A18 (\u906D\u6AA2\u8209)","entry.355700800":a,"entry.1592095357":(c.find("p").text()||"n/a").trim(),"entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}).then(function(b){1===b.Status&&(msg("\u{1F4DD} "+_h("f-report_ask-2",{$title:d})),hj_mixpanel("Feed Post Reported",{post_id:a}),ga_event_push("Feed Post Reported",{event_category:"Posts",event_label:"Comment Reported"}))})})}else msg('<i class="fal fa-door-open"></i> '+_h("f-signin-1"))})}function feed_translate(){/zh/i.test(hj_lang())||hj_getScript("//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit")}function googleTranslateElementInit(){new google.translate.TranslateElement({pageLanguage:"zh-TW",includedLanguages:"en,jp,zh-TW,ja,ko",layout:google.translate.TranslateElement.InlineLayout.SIMPLE,autoDisplay:!1},"google_translate_element")}hj_getScript("//cdn.jsdelivr.net/combine/npm/@webcreate/infinite-ajax-scroll@3.1.0-beta.1/dist/infinite-ajax-scroll.min.js,npm/pulltorefreshjs@0.1.22/dist/index.umd.min.js").then(function(){$(function(){post_font();var a=new InfiniteAjaxScroll(".feed_wall",{scrollContainer:".feed_wall",item:".article",next:".pager_next",pagination:".pager",spinner:{element:".bouncingLoader",delay:600}});a.on("page",function(a){document.title=a.title,history.replaceState(history.state,a.title,a.url)}),a.on("appended",function(a){a.items.length||$(".no_more").fadeIn()}),PullToRefresh.init({mainElement:".feed_wall",triggerElement:".feed_wall",instructionsRefreshing:_h("f-refresh-0"),instructionsPullToRefresh:_h("f-refresh-1"),instructionsReleaseToRefresh:_h("f-refresh-2"),distIgnore:200,onRefresh:function(){hj_href("feed?p=1")}});var b=Number(getUrlPara("post")||0);b>0&&focus_active_post(b).attr("data-active",""),$(".page .story").scroll(function(){var a=$(".nav_btn.fa-chevron-up");$(this).scrollTop()>200?a.stop().fadeIn("slow"):a.stop().fadeOut("slow")}).hide(),$(".mh-head .left").on("click",function(){nav_toggle($(".menu"),!0)}),$(".page_back").on("click",function(){nav_toggle_feed(0)}),$(".nav_btn.fa-plus,.page_publish").on("click",how2publish),$(".nav_btn.fa-chevron-up").on("click",function(){feed_scrolltop($(".page .story"))}).hide(),$("[data-focus_post]").on("click",function(){focus_active_post()}),$(".profile").on("click",function(){profile_popup()}).find("ul").on("click",function(a){a.stopPropagation()}).find("[data-link]").on("click",function(){window.open(location.origin+"/"+this.dataset.username+"/"+this.dataset.post_id+"?feed=1","_blank"),profile_popup()}),feed_translate(),feed_hotkey_init(),hj_feed_history_init(),document.title=_h("f-title")+" | \u{1F49D} Hearty Journal \u6EAB\u5EA6\u65E5\u8A18"})}),leave_InAppBrowser()