"use strict";var btn_alias="feed";function feed_scrolltop(e){e=e||$("html, body"),check_browser("Safari")?e.stop().animate({scrollTop:0},450):e.stop().scrollTop(0)}function hj_feed_history_init(){is_touch_device()&&"function"==typeof history.pushState&&(history.pushState(null,document.title,location.href),window.addEventListener("popstate",function(e){$(".page .illustration").is(":hidden")&&(nav_toggle_feed(+(0==$(".feed").scrollLeft())),history.pushState(null,document.title,location.href)),null!=$("nav.menu").data("mmenu")&&$("nav.menu").data("mmenu").close()},!1))}function nav_toggle_feed(e){var t=$(".feed");if(e=e||0,t.length>0){var a=t.width()*e;check_browser("Safari")?t.animate({scrollLeft:a},450):t.scrollLeft(a)}}function read_post(e){var t=Number(e.post_id)||0,a=$(".page .story"),i=a.find("article"),n=is_touch_device();n||a.fadeOut("fast"),$.ajax({url:location.href,type:"post",data:{action:"read",post_id:t},async:!0,dataType:"json"}).then(function(o){switch(o.Status){case 1:o=o.Values,i.find("h2").attr({title:o.title}),i.find("p").text(o.post),i.find(".published").attr({title:o.published}),i.attr({"data-username":e.username,"data-post_id":t}).find(".avatar").attr({title:e.nickname}).find("div").attr({style:"background-image: url('//i0.wp.com/hearty.me/uploads/images/users/"+e.profile_image+"');"}),$(".page .illustration").hide(),n?a.show().scrollTop(0):a.slideDown("fast",function(){$(this).scrollTop(0)}),$(".feed_wall article").removeAttr("data-active").filter("[data-post_id='"+t+"']").attr("data-active","");break;default:nav_toggle_feed(0)}}).fail(function(){msg()}),nav_toggle_feed(1)}function focus_active_post(e){nav_toggle_feed(0);var t=$(".feed_wall article"+(null==e?"[data-active]":"[data-post_id='"+e+"']"));return"scrollIntoView"in document.documentElement&&t.length>0&&t.get(0).scrollIntoView(),t.delay(400).queue(function(){shake($(this)),$(this).dequeue()}),t}function bookmark(e,t){hj_update({action:"bookmark",post_id:e}).then(function(t){switch(t.Status){case 1:hj_vibrate(80),hj_mixpanel("Post Bookmarked",{post_id:e}),ga_event_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:alertify.set({labels:{ok:"<i class='fas fa-sign-in-alt'></i> 登入",cancel:"取消"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-door-open'></i> 登入以使用完整功能",function(e){e&&(window.top.location.href=location.origin+"/#signin?r=/feed")})}}),t.toggleClass("fal fas")}function navigate_journal(e,t,a){alertify.set({labels:{ok:"<i class='fas fa-hand-point-right'></i> 走吧",cancel:"取消"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-book-alt'></i> 前往「"+a+"」的日記本",function(a){a&&window.open(location.origin+"/"+e+"/"+t,"_blank")})}function feed_share_this(e,t){var a=location.origin+"/"+e+"/"+t;if("share"in navigator)navigator.share({url:a});else{if(!1===check_hjapp())return!1;location.assign("//hearty.me/wv?s="+encodeURIComponent(a.replace(/(^\w+:|^)\/\//,"")))}}function how2publish(){alertify.set({labels:{ok:"<i class='fas fa-hand-point-right'></i> 我的日記本",cancel:"好的"},buttonReverse:!1}),alertify.confirm("<h3><i class='fal fa-info-circle'></i> 如何投稿</h3>在日記中，點選【 <i class='fal fa-share-alt'></i> 】可投稿文章",function(e){e&&(location.href=location.origin+"/d")})}function report_abuse(e){var t=$(".page .story article"),a=(t.find("h2").attr("title")||"無標題").trim();alertify.set({labels:{ok:"否",cancel:"<i class='fas fa-check-circle'></i> 送出"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-flag-alt'></i> 要檢舉貼文「"+a+"」嗎？",function(i){i||hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.355700800":e,"entry.1592095357":(t.find("p").text()||"n/a").trim(),"entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}).then(function(t){switch(t.Status){case 1:msg("📝 已檢舉「"+a+"」，貼文將由溫度小編審閱後進行處理"),hj_mixpanel("Feed Post Reported",{post_id:e}),ga_event_push("Feed Post Reported",{event_category:"Posts",event_label:"Comment Reported"})}})})}hj_getScript("//cdn.jsdelivr.net/combine/npm/@webcreate/infinite-ajax-scroll@3.0.0-beta.5/dist/infinite-ajax-scroll.min.js,npm/pulltorefreshjs@0.1.20/dist/index.umd.min.js").then(function(){$(function(){var e=new InfiniteAjaxScroll(".feed_wall",{scrollContainer:".feed_wall",item:".article",next:".pager_next",pagination:".pager",spinner:{element:".bouncingLoader",delay:600}});e.on("page",e=>{document.title=e.title,history.replaceState(history.state,e.title,e.url)}),e.on("appended",e=>{0==e.items.length&&$(".no_more").fadeIn()}),PullToRefresh.init({mainElement:".feed_wall",triggerElement:".feed_wall",instructionsRefreshing:"刷新中",instructionsPullToRefresh:"下拉刷新",instructionsReleaseToRefresh:"放開以刷新",distIgnore:200,onRefresh:function(){location.href=location.origin+"/feed?p=1"}});var t=Number(getUrlPara("post")||0);t>0&&focus_active_post(t).attr("data-active",""),$(".page .story").scroll(function(){var e=$(".nav_btn.fa-chevron-up");$(this).scrollTop()>200?e.stop().fadeIn("slow"):e.stop().fadeOut("slow")}).hide(),$(".mh-head .left").on("click",function(){nav_toggle($(".menu"),!0)}),$(".page_back").on("click",function(){nav_toggle_feed(0),$(".page .story").hide()}),$(".nav_btn.fa-plus, .page_publish").on("click",how2publish),$(".nav_btn.fa-chevron-up").on("click",function(){feed_scrolltop($(".page .story"))}).hide(),$("[data-focus_post]").on("click",function(){focus_active_post()}),("share"in navigator||!1!==check_hjapp())&&$(".article_buttom .fa-share").show(),hj_feed_history_init()})}),leave_InAppBrowser();