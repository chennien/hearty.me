"use strict";function test_init(){cf_colo(),dns_check(),detect_features();var t=$(".features");t.find("[data-i='device']").text(navigator.userAgent||""),t.find("[data-i='touchpoints']").text("maxTouchPoints"in navigator&&navigator.maxTouchPoints?navigator.maxTouchPoints:""),t.find("[data-i='mouse']").attr({"data-status":matchMedia("(pointer:fine)").matches?1:0}),navigator.connection&&"effectiveType"in navigator.connection&&$(".network [data-i='speed']").prepend((navigator.connection.effectiveType||"").toUpperCase()+" "),$("header [data-screenshot]").on("click",function(){screenshot($("section"))}),t.find("[data-i='ads'],[data-i='trackers']").on("click",function(){alert("提醒您：若攔截外掛的規則設定太嚴苛，將可能誤判及屏蔽正常程式，導致網頁故障")}),$("footer").on("click",function(){window.open("//hearty.me/help","_blank")}),$.ajax({type:"GET",dataType:"script",url:"//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.37/public/plugin.smallchat.min.js",cache:!0,scriptCharset:"utf-8"})}function cf_colo(){"fetch"in window&&fetch(location.origin+"/cdn-cgi/trace",{method:"GET",mode:"cors",cache:"no-cache"}).then(t=>t.text()).then(t=>{t=t.replace(/(\r\n|\n|\r)/gm,"");var e=$(".network[title='ip']"),a=t.split("ip=")[1].split("ts=")[0];ip_check(a),e.find("[data-i='ip']").text(a),e.find("[data-i='cf_colo']").text(t.split("colo=")[1].split("http=")[0])}).catch(t=>{console.log("發生錯誤：",t)})}function ip_check(t){"fetch"in window&&fetch("//api.hearty.app/ip/"+t,{method:"GET",mode:"cors",cache:"no-cache"}).then(t=>t.json()).then(t=>{var e=$(".network[title='ip']");for(var a in t)"countryCode"!=a?e.find("[data-i='"+a+"']").text(t[a]):e.find("[data-i='countryCode']").attr({src:"//i.hearty.app/w/countryflags.io/"+(t[a]||"").toLowerCase()+"/shiny/32.png"})}).catch(t=>{console.log("發生錯誤：",t)})}function dns_check(){if("fetch"in window){var t,e=(Math.floor(1e9*Math.random())+1).toString();if("sendBeacon"in navigator)for(t=1;t<=10;t++)try{navigator.sendBeacon("//"+t+"."+e+".bash.ws")}catch(t){}fetch(location.href,{method:"POST",mode:"cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uri:e})}).then(t=>t.json()).then(t=>{"error"in t?console.log("Error"):t.forEach(function(t){if("type"in t)switch(t.type){case"dns":var e=$("ul[title='"+t.type+"']");for(var a in t)"country"!=a?("asn"==a&&(t[a]=t[a].replace(" "," | ")),e.find("[data-i='"+a+"']").text(t[a])):e.find("[data-i='country']").attr({src:"//i.hearty.app/w/countryflags.io/"+(t[a]||"").toLowerCase()+"/shiny/32.png"})}})}).catch(t=>{console.log("發生錯誤：",t)})}}function detect_features(){var t=$("ul.features");Promise.all([{i:"ads",u:"pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"},{i:"trackers",u:"www.google-analytics.com/analytics.js"},{i:"jsdelivr",u:"cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.37/README.md"},{i:"images",u:"i.hearty.app/i/favicon.png"},{i:"firebase",u:"cdn.jsdelivr.net/npm/firebase/firebase.js"},{i:"picsee",u:"go.hearty.me/about.php"}].map(function(e){try{fetch("//"+e.u,{method:"HEAD",mode:"no-cors",cache:"no-cache"}).then(function(){t.find("li[data-i='"+e.i+"']").attr({"data-status":1})}).catch(function(){t.find("li[data-i='"+e.i+"']").attr({"data-status":0})})}catch(a){t.find("li[data-i='"+e.i+"']").attr({"data-status":0})}}))}function screenshot(t){var e=$("body");return e.addClass("loading"),$.ajax({type:"GET",dataType:"script",url:"//cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js",cache:!0,scriptCharset:"utf-8",success:function(){window.html2canvas(t.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:t.get(0).offsetWidth,height:t.get(0).offsetHeight+25}).then(t=>{$("<a>",{target:"_blank",href:t.toDataURL("image/png"),download:"溫度日記連線檢測_"+(new Date).toISOString().split("T")[0].replace(/-/g,"")+".png",rel:"noopener"}).get(0).click(),e.removeClass("loading")})}})}$(function(){test_init()});