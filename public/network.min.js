"use strict";function test_init(){cf_colo(),dns_check(),detect_features();var t=$(".features");t.find("[data-i='device']").text(navigator.userAgent||""),t.find("[data-i='touchpoints']").text("maxTouchPoints"in navigator&&navigator.maxTouchPoints?navigator.maxTouchPoints:""),$("<img>",{src:"data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="}).on("load",function(){t.find("[data-i='webp']").attr({"data-status":1})}),t.find("[data-i='mouse']").attr({"data-status":matchMedia("(pointer:fine)").matches?1:0}),navigator.connection&&"effectiveType"in navigator.connection&&$(".network [data-i='speed']").prepend((navigator.connection.effectiveType||"").toUpperCase()+" "),$("header [data-screenshot]").on("click",function(){screenshot($("section"))}),t.find("[data-i='ads'],[data-i='trackers']").on("click",function(){alert("提醒您：若攔截外掛的規則設定太嚴苛，將可能誤判及屏蔽正常程式，導致網頁故障")}),$("footer").on("click",function(){top.location.href="//hearty.me/help"}),$.ajax({type:"GET",dataType:"script",url:"//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.40/public/plugin.smallchat.min.js",cache:!0,scriptCharset:"utf-8"})}function cf_colo(){"fetch"in window&&fetch(location.origin+"/cdn-cgi/trace",{method:"GET",mode:"cors",cache:"no-cache"}).then(t=>t.text()).then(t=>{t=t.replace(/(\r\n|\n|\r)/gm,"");var e=$(".network[title='ip']"),a=t.split("ip=")[1].split("ts=")[0];ip_check(a),e.find("[data-i='ip']").text(a),e.find("[data-i='cf_colo']").text(t.split("colo=")[1].split("http=")[0]),"undefined"!=typeof gtag&&gtag("event","Run Test"),"undefined"!=typeof mixpanel&&mixpanel.track("Run Test"),"undefined"!=typeof fbq&&fbq("trackCustom","Run Test")}).catch(t=>{console.log("發生錯誤：",t)})}function ip_check(t){"fetch"in window&&fetch("//api.hearty.app/ip/"+t,{method:"GET",mode:"cors",cache:"no-cache"}).then(t=>t.json()).then(t=>{var e=$(".network[title='ip']");for(let a in t)"countryCode"!=a?e.find("[data-i='"+a+"']").text(t[a]):country_flag(t[a],e.find("[data-i='countryCode']"))}).catch(t=>{console.log("發生錯誤：",t)})}function dns_check(){if("fetch"in window){var t=(Math.floor(1e9*Math.random())+1).toString();if("sendBeacon"in navigator)for(let e=1;e<=10;e++)try{navigator.sendBeacon("//"+e+"."+t+".bash.ws")}catch(t){}fetch(location.href,{method:"POST",mode:"cors",cache:"no-cache",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({uri:t})}).then(t=>t.json()).then(t=>{"error"in t?console.log("Error"):t.forEach(function(t){if("type"in t)switch(t.type){case"dns":var e=$("ul[title='"+t.type+"']");for(let a in t)"country"!=a?("asn"==a&&(t[a]=t[a].replace(" "," | ")),e.find("[data-i='"+a+"']").text(t[a])):country_flag(t[a],e.find("[data-i='country']"))}})}).catch(t=>{console.log("發生錯誤：",t)})}}function country_flag(t,e){return e.attr({src:"//i.hearty.app/w/flagcdn.com/32x24/"+(t||"tw").toLowerCase()+".png"}).on("error",function(){this.src.indexOf("i.hearty.app")>0&&(this.src=this.src.replace(".hearty.app/w","0.wp.com"))})}function detect_features(){var t=$("ul.features");Promise.all([{i:"ads",u:"pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"},{i:"trackers",u:"www.google-analytics.com/analytics.js"},{i:"jsdelivr",u:"cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.40/public/editor.min.js"},{i:"images",u:"i.hearty.app/i/1x1.png"},{i:"firebase",u:"www.gstatic.com/firebasejs/8.6.1/firebase.js"},{i:"picsee",u:"go.hearty.me/tools.php"}].map(function(e){try{fetch("//"+e.u,{method:"HEAD",mode:"no-cors",cache:"no-cache"}).then(function(){t.find("li[data-i='"+e.i+"']").attr({"data-status":1})}).catch(function(){t.find("li[data-i='"+e.i+"']").attr({"data-status":0})})}catch(a){t.find("li[data-i='"+e.i+"']").attr({"data-status":0})}}))}function screenshot(t){var e=$("body");return e.addClass("loading"),$.ajax({type:"GET",dataType:"script",url:"//cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.7/dist/html2canvas.min.js",cache:!0,scriptCharset:"utf-8",success:function(){window.html2canvas(t.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:t.get(0).offsetWidth,height:t.get(0).offsetHeight+25}).then(t=>{$("<a>",{target:"_blank",href:t.toDataURL("image/png"),download:"溫度日記連線檢測_"+(new Date).toISOString().split("T")[0].replace(/-/g,"")+".png",rel:"noopener"}).get(0).click(),e.removeClass("loading")})}})}top.location.hostname.split(".").splice(-2).join(".")!==self.location.hostname.split(".").splice(-2).join(".")&&(top.location.href=self.location.href),$(function(){test_init()});