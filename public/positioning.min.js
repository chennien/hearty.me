window.positioning_gps_deferred=$.Deferred();if(navigator.geolocation){if("permissions" in navigator&&"query" in navigator.permissions)
navigator.permissions.query({name:"geolocation"}).then(function(status){positioning_gps_trigger(!1,status.state);status.onchange=function(){positioning_gps_trigger(!1,this.state)}})}
positioning_agps();function positioning_gps_trigger(on,state){if(on||state=="granted"){navigator.geolocation.getCurrentPosition(positioning_gps,positioning_gps_error_handling,{enableHighAccuracy:!0,maximumAge:Infinity,timeout:10000})}}
function positioning_gps(pos){if(!getcookie("hearty_position_gps").length){$.post(window.location.origin+"/positioning.php",{action:"positioning_gps",latitude:pos.coords.latitude,longitude:pos.coords.longitude,accuracy:pos.coords.accuracy},function(c){window.positioning_gps_deferred.resolve();if(typeof ga!=="undefined")
ga("send","event","Positioning","Query GPS Data","Queued")})}}
function positioning_agps(){if(!getcookie("hearty_position_agps").length){$.get("//hearty.me/ip",function(r){var ip_addr=r.trim();$.post(window.location.origin+"/positioning.php",{action:"positioning_agps",ip_addr:ip_addr},function(c){if(typeof ga!=="undefined")
ga("send","event","Positioning","Query AGPS Data","Queued")})})}}
function positioning_agps_cloudflare(){if(!getcookie("hearty_position_agps").length){$.get(window.location.origin+"/cdn-cgi/trace",function(r){var ip_addr=r.replace(/\n/gm,' ').trim().split("ip=")[1].split(" ts=")[0];$.post(window.location.origin+"/positioning.php",{action:"positioning_agps",ip_addr:ip_addr},function(c){if(typeof ga!=="undefined")
ga("send","event","Positioning","Query AGPS Data","Queued")})})}}
function positioning_agps_ipify(){if(!getcookie("hearty_position_agps").length){var ip_addr=$.ajax({url:"//api.ipify.org",type:"GET",crossDomain:!0,dataType:"text",async:!1,success:function(r){return $(r)["selector"]}}).responseText;$.post("//"+window.location.hostname+"/positioning.php",{action:"positioning_agps",ip_addr:ip_addr},function(c){if(typeof ga!=="undefined")
ga("send","event","Positioning","Query AGPS Data","Queued")})}}
function positioning_gps_error_handling(err){window.positioning_gps_deferred.reject();var s="";switch(err.code){case err.PERMISSION_DENIED:s="Denied";alertify.error("🚫 您的裝置拒絕提供位置資訊");break;case err.POSITION_UNAVAILABLE:s="Unavailable";if(!getcookie("hearty_position_gps_unavailable").length){msg("📍 您的裝置目前無法定位，請試著重新整理頁面");var e=new Date();e.setTime(e.getTime()+(60*60*1000));document.cookie="hearty_position_gps_unavailable=1;expires="+e+';domain=.'+document.domain+';path=/'}
break;case err.TIMEOUT:s="Timeout";break;default:s="Unknown Error";break}
if(typeof ga!=="undefined")ga("send","event","Positioning","Query GPS Data",s);$(".loading_logo").fadeOut()}
function positioning_gps_reset_support(){var ua=navigator.userAgent.toLowerCase()||"",url="support.google.com/chrome/answer/142065";switch(!0){case ua.indexOf("chrome")>-1:break;case ua.indexOf("safari")>-1:url=/ipad|iphone|ipod/.test(ua)?"support.apple.com/HT207092":"support.apple.com/HT204690";break;case ua.indexOf("firefox")>-1:url="support.mozilla.org/kb/does-firefox-share-my-location-websites";break;case ua.indexOf("opr")>-1||ua.indexOf('opera')>-1:url="help.opera.com/geolocation";break;case ua.indexOf("edge")>-1:url="support.microsoft.com/zh-tw/help/4468240";break;case ua.indexOf("trident")>-1:url="support.microsoft.com/zh-tw/help/17479";break}
return"//"+url}