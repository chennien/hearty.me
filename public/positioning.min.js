var positioning_gps_deferred=$.Deferred();function positioning_gps_trigger(i,o){(i||"granted"==o)&&navigator.geolocation.getCurrentPosition(positioning_gps,positioning_gps_error_handling,{enableHighAccuracy:!0,maximumAge:1/0,timeout:1e4})}function positioning_gps(i){getcookie("hearty_position_gps").length||$.ajax({type:"POST",url:location.origin+"/positioning.php",data:{action:"positioning_gps",latitude:i.coords.latitude,longitude:i.coords.longitude,accuracy:i.coords.accuracy},async:!0}).then(function(){window.positioning_gps_deferred.resolve(),ga_evt_push("Positioning",{event_category:"Query GPS Data",event_label:"Queued"})})}function positioning_agps(){getcookie("hearty_position_agps").length||hj_ip().then(function(i){var o=(i.ip||"").trim();$.ajax({type:"POST",url:location.origin+"/positioning.php",data:{action:"positioning_agps",ip_addr:o},async:!0}).then(function(){ga_evt_push("Positioning",{event_category:"Query AGPS Data",event_label:"Queued"})})})}function positioning_gps_error_handling(i){window.positioning_gps_deferred.reject();var o="";switch(i.code){case i.PERMISSION_DENIED:o="Denied",alertify.error('<i class="fas fa-ban"></i> 裝置不提供定位 Location Access is Denied');break;case i.POSITION_UNAVAILABLE:o="Unavailable",getcookie("hearty_position_gps_unavailable").length||(setcookie("hearty_position_gps_unavailable",1,1),msg('<i class="fal fa-map-marker-alt-slash"></i> 無法定位 No Location Info'));break;case i.TIMEOUT:o="Timeout";break;default:o="Unknown Error"}$("body").removeClass("loading"),ga_evt_push("Positioning",{event_category:"Query GPS Data",event_label:o})}function positioning_gps_reset_support(){var i;switch(check_browser()){case"Safari":i="support.apple.com/HT20"+(check_OS("iOS")?"7092":"4690");break;case"Firefox":i="support.mozilla.org/kb/does-firefox-share-my-location-websites";break;case"OPR":i="help.opera.com/geolocation";break;case"Edg":i="support.microsoft.com/help/4536154";break;default:i="support.google.com/chrome/answer/142065"}return"//"+i}navigator.geolocation&&"permissions"in navigator&&"query"in navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(i){positioning_gps_trigger(!1,i.state),i.onchange=function(){positioning_gps_trigger(!1,this.state)}}),positioning_agps();