var positioning_gps_deferred=$.Deferred();function positioning_gps_trigger(a,b){(a||"granted"==b)&&navigator.geolocation.getCurrentPosition(positioning_gps,positioning_gps_error_handling,{enableHighAccuracy:!0,maximumAge:1/0,timeout:1e4})}function positioning_gps(a){getcookie("hearty_position_gps").length||$.ajax({type:"POST",url:location.origin+"/positioning.php",data:{action:"positioning_gps",latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy},async:!0}).then(function(){window.positioning_gps_deferred.resolve(),ga_event_push("Positioning",{event_category:"Query GPS Data",event_label:"Queued"})})}function positioning_agps(){getcookie("hearty_position_agps").length||hj_ip().then(function(a){var b=(a.ip||"").trim();$.ajax({type:"POST",url:location.origin+"/positioning.php",data:{action:"positioning_agps",ip_addr:b},async:!0}).then(function(){ga_event_push("Positioning",{event_category:"Query AGPS Data",event_label:"Queued"})})})}function positioning_gps_error_handling(b){window.positioning_gps_deferred.reject();var a="";switch(b.code){case b.PERMISSION_DENIED:a="Denied",alertify.error('<i class="fas fa-ban"></i> \u88DD\u7F6E\u4E0D\u63D0\u4F9B\u5B9A\u4F4D Location Access is Denied');break;case b.POSITION_UNAVAILABLE:a="Unavailable",getcookie("hearty_position_gps_unavailable").length||(setcookie("hearty_position_gps_unavailable",1,1),msg('<i class="fal fa-map-marker-alt-slash"></i> \u7121\u6CD5\u5B9A\u4F4D No Location Info'));break;case b.TIMEOUT:a="Timeout";break;default:a="Unknown Error"}$("body").removeClass("loading"),ga_event_push("Positioning",{event_category:"Query GPS Data",event_label:a})}function positioning_gps_reset_support(){var a;switch(check_browser()){case"Safari":a="support.apple.com/HT20"+(check_OS("iOS")?"7092":"4690");break;case"Firefox":a="support.mozilla.org/kb/does-firefox-share-my-location-websites";break;case"OPR":a="help.opera.com/geolocation";break;case"Edg":a="support.microsoft.com/help/4536154";break;default:a="support.google.com/chrome/answer/142065"}return"//"+a}navigator.geolocation&&"permissions"in navigator&&"query"in navigator.permissions&&navigator.permissions.query({name:"geolocation"}).then(function(a){positioning_gps_trigger(!1,a.state),a.onchange=function(){positioning_gps_trigger(!1,this.state)}}),positioning_agps()