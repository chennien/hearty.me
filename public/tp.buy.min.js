"use strict";window.jQuery||alert("Please disable Adblock & clean caches.\n請停用 Adblock及清除快取")||window.open("//goo.gl/o8y9R1","_blank");var _h$={tp:[{back:"Back",title:"TapPay Payment | Hearty Journal 溫度日記",prd:"Hearty Journal",item:"Item",plan:"Plan",amt:"Amount",card:["Credit Card Payment","Credit Card Subscription"],orgs:"VISA, MasterCard, JCB & Union Pay",pay:"Checkout",agree:["I hereby authorize and permit to sign the power of attorney to execute the credit card payment by Hearty Journal.","You must authorize the credit card payment to purchase the subscription plan."],mpay:"Or use mobile payment",alipay:"Alipay",footer:"This site uses TapPay SSL 2048-bit payment system. Your payment is securely processed by the bank and we never handle your credit card information. TapPay is PCI-DSS compliant, ensuring the safety of your data.",ok:"OK",no:"Cancel",ask:["Encountering payment issues?","If you can’t complete the payment, your credit card might not support 3D Secure Authentication (SMS OTP). Please disable it for this transaction and try again.","Disable 3D Secure","3D Secure disabled. Please continue with the payment process."],done:["Payment completed. Thank you for upgrading to the VIP plan of Hearty Journal.","Order No. $no"],fail:["Transaction failed. Please check the card number or use a different payment method. If the issue persists, please contact support.","Transaction failed. Please check the card number or use a different card. If the issue persists, please contact support.","Order No. $no","Contact us"],err:["Sorry, an unexpected error occurred."]},{back:"回前頁",title:"TapPay付款 | 溫度日記 Hearty Journal",prd:"溫度日記 Hearty Journal",item:"方案",plan:"內容",amt:"金額",card:["信用卡付款","信用卡訂閱"],orgs:"VISA、MasterCard、JCB、銀聯卡",pay:"結帳",agree:["我同意自下次交易起由溫度日記向 TapPay發動信用卡授權指示","您需同意信用卡授權，才能購買訂閱方案"],mpay:"或使用行動支付",alipay:"支付寶",footer:"本站採⽤喬睿科技(TapPay) SSL 2048-bit 交易系統。刷卡時，將於銀⾏端完成交易，本站絕不會經手您的信⽤卡資料。TapPay系統亦通過 PCI-DSS安全稽核，保障您的資料安全無虞。",ok:"好的",no:"取消",ask:["遇到刷卡問題？","如您無法順利刷卡，可能由於信用卡不支援 3D簡訊驗證，請於本次交易中暫停驗證","暫停簡訊驗證","簡訊驗證已暫停，請您繼續付款流程"],done:["付款完成，謝謝您購買溫度日記 VIP","訂單編號：$no"],fail:["交易失敗，請確認輸入資料無誤，或更換信用卡，或另選付款方式，如問題持續請聯繫客服","刷卡失敗，請確認輸入資料無誤，或更換信用卡，如問題持續請聯繫客服","訂單編號：$no","聯繫客服"],err:["不好意思，似乎出錯了"]},{back:"回前页",title:"TapPay支付 | 温度日记 Hearty Journal",prd:"温度日记 Hearty Journal",item:"方案",plan:"内容",amt:"金额",card:["银行卡付款","银行卡订阅"],orgs:"VISA、MasterCard、JCB、银联卡",pay:"结帐",agree:["我同意自下次交易起由温度日记向 TapPay发动银行卡授权指示","您需同意银行卡授权，才能购买订阅方案"],mpay:"或使用移动支付",alipay:"支付宝",footer:"本站採⽤乔睿科技(TapPay) SSL 2048-bit 交易系统。刷卡时，将于银⾏端完成交易，本站绝不会经手您的银行卡数据。TapPay系统亦通过 PCI-DSS安全稽核，保障您的数据安全无虞。",ok:"好的",no:"取消",ask:["遇到刷卡问题？","如您无法顺利刷卡，可能由于银行卡不支援 3D简讯验证，请于本次交易中暂停验证","暂停简讯验证","简讯验证已暂停，请您继续支付流程"],fail:["交易失败，请确认输入数据无误，或更换银行卡，或另选支付方式，如问题持续请联繫客服","刷卡失败，请确认输入数据无误，或更换银行卡，如问题持续请联繫客服","订单编号：$no","联繫客服"],err:["抱歉，似乎出错了"]}][tp_lang()]};function tp_params(t){let e=$("body");if(t)return $.param(e.get(0).dataset);if(!(location.search||"").length){top.location.href="//bitly.com/3fmoEYD";return}e.attr({"data-pkg":getUrlPara("pkg"),"data-3ds":getUrlPara("3ds"),"data-recurring":getUrlPara("recurring"),"data-ip":getUrlPara("ip"),"data-cc":getUrlPara("cc")}),"function"==typeof history.replaceState&&history.replaceState(null,"",location.pathname)}function tp_init(){TPDirect.setupSDK(146938,"app_tqcNPY9hA34zrTxrpSiJ263QjhRojqktIxruWM47YobDh83m7E1GKlf3XPN4",0==$("body").attr("data-prod")?"sandbox":"production")}function tp_dpay_btn(t){return tp_loading(!t),$("#dpay_btn").prop({disabled:!t})}function tp_init_dpay(){try{TPDirect.card.setup("#dpay",{color:"rgb(0,0,0)",fontSize:"15px",lineHeight:"24px",fontWeight:"300",errorColor:"red",placeholderColor:""},{isUsedCcv:!1,isMaskCreditCardNumber:!0,maskCreditCardNumberRange:{beginIndex:6,endIndex:11}});let t=$("#dpay_btn").on("click",function(t){t.preventDefault(),tp_dpay_btn(!1),TPDirect.card.getPrime(function(t){tp_pay(1,t.card.prime||"")})});TPDirect.card.onUpdate(function(e){t.prop({disabled:!e.canGetPrime})}),$("#agree").on("click",function(t){t.preventDefault(),msg('<i class="fal fa-badge-check"></i> '+_h("tp-agree-1"))})}catch(e){console.error("Dpay Error")}}function tp_init_apay(){try{let t=$("#apay");TPDirect.paymentRequestApi.checkAvailability()&&(TPDirect.paymentRequestApi.setupApplePay({merchantIdentifier:"merchant.hearty.tappay"}),TPDirect.paymentRequestApi.setupPaymentRequest({supportedNetworks:["VISA","MASTERCARD","JCB"],supportedMethods:["apple_pay"],displayItems:[{label:$("#item").text(),amount:{currency:"TWD",value:"1"}}],total:{label:_h("tp-prd"),amount:{currency:"TWD",value:parseInt($("#amt").text())}}},function(e){window.ApplePaySession&&e.canMakePaymentWithActiveCard?t.on("click",function(){TPDirect.paymentRequestApi.getPrime(function(t){tp_pay(8,t.prime||"")})}).show():t.remove()}))}catch(e){$ap.remove(),console.error("Apay Error")}}function tp_init_gpay(){let t=$("#gpay");try{TPDirect.googlePay.setupGooglePay({googleMerchantId:"BCR2DN4TRGFNNFJ3",tappayGoogleMerchantId:"hearty_TAISHIN",allowedCardAuthMethods:["PAN_ONLY","CRYPTOGRAM_3DS"],merchantName:"Hearty Creative Inc.",allowPrepaidCards:!0}),TPDirect.googlePay.setupPaymentRequest({allowedNetworks:["VISA","MASTERCARD","JCB"],price:parseInt($("#amt").text()).toString(),currency:"TWD"},function(e,a){a.canUseGooglePay?TPDirect.googlePay.setupGooglePayButton({el:"#gpay",color:"white",type:"short",getPrimeCallback:function(t,e){tp_pay(9,e||"")}}):t.remove()})}catch(e){t.remove(),console.error("Gpay Error")}}function tp_pay(t,e){e.length>0&&$.ajax({type:"post",url:location.origin+"/shop/tp.prime?"+tp_params(!0),async:!0,crossDomain:!0,dataType:"json",data:{payvia:t,prime:e}}).then(function(e){let a=e.Values||"";switch(e.Status||""){case 0:tp_pay_err("0","#"+(a.orderno||"*"));break;case 1:let r=a.orderno||"";fetch("//docs.google.com/forms/d/e/1FAIpQLSeooQCNhp2ubbIvshtucFLF5PVOE_ZRaHFAgBPvrVT_MDl_bg/formResponse",{method:"POST",mode:"no-cors",body:new URLSearchParams({"entry.553484449":$("[data-hid]").text()||"","entry.729548178":r,"entry.147291994":[,"dp",,,,,,,"ap","gp"][t]||"","entry.20989936":"url_3ds"in a?"Y":"N","entry.792614445":navigator.userAgent||"","entry.2000689905":new Date((new Date).getTime()+288e5).toISOString().split("T")[0]})}),"url_3ds"in a?top.location.href=a.url_3ds:(msg('<i class="fal fa-check-circle"></i> '+_h("tp-done-0")+'<br><i class="fal fa-file"></i> '+_h("tp-done-1",{$no:r||"*"})),top.location.href=location.origin+"/shop/tp.thankyou?o="+r);break;case 2:tp_pay_report("2",JSON.stringify(a||""));let n=$("body"),o=1==n.attr("data-recurring");alertify.set({labels:{ok:'<i class="fas fa-question-circle"></i> '+_h("tp-fail-3"),cancel:_h("tp-no")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-comment-alt-times"></i> '+_h("tp-fail-"+(o?1:0))+' (❁\xb4ㅁ`)ﾉ<br><i class="fal fa-file"></i> '+_h("tp-fail-2",{$no:a.orderno||"*"}),function(t){t&&tp_support()}),o||n.attr("data-3ds",0),tp_dpay_btn(!0);break;case 3:tp_pay_err("3",a.err||"");break;default:tp_pay_err("D",JSON.stringify(e||""))}}).fail(function(t){tp_pay_err("F",JSON.stringify(t||""))})}function tp_pay_err(t,e){tp_pay_report(t=t||"",e=e||""),e('<i class="far fa-sad-tear"></i> ['+t+"] "+_h("tp-err")+"<br>"+e),tp_dpay_btn(!0)}function tp_pay_report(t,e){fetch("//docs.google.com/forms/d/e/1FAIpQLSe15z1D2VmTe7W_F4uRjth7xSRT8rNUxyKG9qrcVRVRXM9nMA/formResponse",{method:"POST",mode:"no-cors",body:new URLSearchParams({"entry.553484449":$("[data-hid]").text()||"","entry.729548178":t,"entry.20989936":e,"entry.792614445":navigator.userAgent||"","entry.2000689905":new Date((new Date).getTime()+288e5).toISOString().split("T")[0]})})}function np_init_alipay(){$("#alipay").on("click",function(){tp_loading(!0),top.location.href=location.origin+"/shop/np.buy?alipay=1&"+tp_params(!0)}).show()}function ask(){let t=$("body");1==t.attr("data-3ds")?(alertify.set({labels:{ok:'<i class="fas fa-toggle-on"></i> '+_h("tp-ask-2"),cancel:_h("tp-no")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-credit-card"></i> '+_h("tp-ask-1"),function(e){e&&(t.attr("data-3ds",0),msg('<i class="fal fa-comment-alt-slash"></i> '+_h("tp-ask-3")))})):tp_support()}function TWD2local(t){return $.ajax({url:"//api.hearty.app/currency/TWD",type:"GET",crossDomain:!0,dataType:"json",async:!0}).then(function(e){return parseFloat(e.conversion_rates[t]||e.conversion_rates.USD)||0})}function getUrlPara(t){let e=RegExp("(^|&)"+t+"=([^&]*)(&|$)"),a=location.search.substr(1).match(e);return null!=a?decodeURIComponent(a[2]):null}function msg(t){alertify.set({labels:{ok:'<i class="fas fa-check"></i> '+_h("tp-ok")}}),alertify.alert(t)}function tp_loading(t){var e=$("body");!1===t?e.removeClass("loading"):e.addClass("loading").delay(1e4).queue(function(){$(this).removeClass("loading").dequeue()})}function tp_support(){$("<a>",{target:"_blank",href:"//hearty.me/d?f=2"}).get(0).click()}function tp_lang(){let t=[0,navigator.language||""];return/zh-cn/i.test(t[1])?t[0]=2:/zh/i.test(t[1])&&(t[0]=1),t[0]}function _h_init(){"object"==typeof _h$&&$("[data-h]").length>0&&$("body *,title").each(function(){let t=Object.assign({},$(this).get(0).dataset);for(let e in t)if("h"==e){let a=_h(t[e]).replace(/\n/g,"");$(this).is("title")?$(this).text(a):$(this).prepend(_h(t[e]).replace(/\n/g,"<br>")).attr({title:a}),$(this).removeAttr("data-h")}else if("h_date"==e){let r=t[e];r=r?date_format(t[e],!0):"",$(this).attr({"data-date":r,title:r}).removeAttr("data-"+e)}else if(e.startsWith("h_")){let n=_h(t[e]),o={};"title"==(e=e.substr(2))&&($(this).is("input,textarea,[contenteditable]")?o.placeholder=n:$(this).is("img")&&(o.alt=n)),o[0>["title","href","src","download"].indexOf(e)?"data-"+e:e]=n,$(this).attr(o).removeAttr("data-h_"+e)}})}function _h(t,e){if(t=(t||"").toString().split("-"),!window._h$||!(t.length>1)||!(t[0]in _h$)||!(t[1]in _h$[t[0]]))return t[0]&&(t="("+t.join("-")+")",console.warn("_h$"+t+" is missing")),t;{let a=_h$[t[0]][t[1]][t[2]];if(null==a&&(a=_h$[t[0]][t[1]]||""),"object"==typeof e)for(let r in e)a=a.replace(r,e[r]);return a}}function tp_isapp(t){let e=(navigator.userAgent||"").match(/Hearty_(iOS|Android|macOS)/)||[];return e=e.length>0&&e[0].replace(/Hearty_/i,""),null==t?e:t==e}$(function(){tp_init(),tp_init_dpay(),0==getUrlPara("recurring")?(tp_isapp()||tp_init_gpay(),tp_init_apay(),np_init_alipay(),$("#agree").parent().remove()):($(".mobile_pay").remove(),$("h4").attr("data-h","tp-card-1"));let t=getUrlPara("cur");t&&TWD2local(t).then(function(e){let a=t+" "+Math.ceil((parseInt($("#amt").text())||0)*e*10)/10;$("[data-cur]").text(a).attr({title:a})}),_h_init(),tp_params(!1),$(".tp_logo").on("click",function(){alertify.alert('<i class="fal fa-shield-check"></i> '+_h("tp-footer"))})});