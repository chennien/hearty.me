"use strict";function hj_update__push(a){return $.ajax({url:location.href,type:"post",crossDomain:!0,dataType:"json",data:a,async:!0,xhrFields:{withCredentials:!0}})}function get_recipients(){var b=$(".recipients"),a=parseInt($("input[name='uid_selection']:checked").val()||0),c=$("input[data-uid_interval]").map(function(){return parseInt(this.value||1)}).get().sort(),d=$("textarea[data-uid_listed]").val().split(",").map(function(a){return parseInt(a.trim())||1}).sort();b.slideUp("fast"),$(".recipient_data .result").empty(),hj_update__push({action:"get_recipients",uid_interval:0==a?JSON.stringify(c):"",uid_listed:1==a?JSON.stringify(d):""}).then(function(c){switch(c.Status){case 1:for(var g in c=c.Values,b.empty(),c){var a=c[g];for(var d in a.tokens){var e=a.username,f=parseInt(a.tokens[d].sent_today);$("<li>",{onclick:f>0?"alertify.error('* \u7565\u904E\u5BC4\u9001 #"+e+"')":"send_push(false,$(this))",title:e,"data-username":a.username,"data-nickname":a.nickname,"data-access_token":a.tokens[d].access_token,"data-device":5,"data-sent_today":f}).appendTo(b)}}b.slideDown("fast",function(){$("html, body").scrollTop(b.get(0).offsetTop-50)});break;case 2:b.show(),msg("<i class='far fa-exclamation-triangle'></i> \u6709\u8CC7\u6599\u6F0F\u586B\uFF0C\u6216\u672A\u9078\u64C7\u4EFB\u4F55\u88DD\u7F6E")}}).fail(function(a){msg("<i class='far fa-exclamation-triangle'></i> \u767C\u751F\u7570\u5E38\uFF1A<br>"+JSON.stringify(a))})}function send_push(c,b){if(c=c||!1,!(b=null==b?$(".recipients li[data-sent_today='0']:first"):b).length)return!1;var e=b.get(0).dataset,d=$(".push_data"),a={body:(d.find("[data-body]").val()||"").trim(),image:(d.find("[data-image]").val()||"").trim(),stickerid:parseInt(d.find("[data-stickerid]").val())||"",stickerid2:parseInt(d.find("[data-stickerid2]").val())||"",access_token:(e.access_token||"").trim(),username:(e.username||"").trim(),nickname:(e.nickname||"").trim()};if(a.body.length<4)return msg("<i class='far fa-exclamation-triangle'></i> \u6C92\u6709\u586B\u5BEB\u63A8\u64AD\u8A0A\u606F"),!1;a.body=a.body.replace(/\{{username}}/g,a.username).replace(/\{{nickname}}/g,a.nickname),c?send_push_exec(a,c,b):(alertify.set({labels:{ok:"\u53D6\u6D88",cancel:"<i class='fas fa-inbox-out'></i> \u767C\u9001"},buttonReverse:!1}),alertify.confirm("<i class='far fa-comment-lines'></i> \u5373\u5C07\u63A8\u64AD\u4E88\uFF1A"+a.nickname+" ("+a.username+")",function(d){d||send_push_exec(a,c,b)}))}function send_push_exec(a,b,c){hj_update__push({action:"send_push",push:JSON.stringify(a)}).then(function(d){switch(d.Values,d.Status){case 1:console.log(JSON.stringify(d));break;case 3:alertify.error('<i class="fas fa-exclamation-triangle"></i> \u7565\u904E\u91CD\u8907\u5BC4\u767C\uFF1A'+a.username);break;case 4:alertify.error("<i class='far fa-comment-alt-times'></i> token \u904E\u671F\u5EE2\u6B62");break;default:msg("<i class='far fa-exclamation-triangle'></i> \u63A8\u64AD\u5931\u6557<br>\uFF1A"+JSON.stringify(d))}if(b){var e=c.nextAll("[data-bulk='"+c.attr("data-bulk")+"']").eq(0);e.length>0?send_push(b,e):$(".recipients li[data-sent_today='0']").length||msg("<i class='far fa-comments-alt'></i> \u6279\u6B21\u63A8\u64AD\u5B8C\u6210","\u597D\u8036",function(){$("html, body").scrollTop(0)})}c.remove(),$("<ol>",{title:a.nickname,onclick:"$(this).fadeOut('fast')","data-username":a.username,"data-success":+(1==d.Status),html:$("<li>",{"data-device":5,text:a.username}).add($("<li>",{text:a.body}))}).prependTo($(".result")).fadeIn()}).fail(function(a){msg("<i class='far fa-exclamation-triangle'></i> \u767C\u751F\u7570\u5E38\uFF1A<br>"+JSON.stringify(a))})}function send_push_bulk(){var b=$(".recipients li[data-sent_today='0']"),a=b.length;a>0?(alertify.set({labels:{ok:"\u53D6\u6D88",cancel:"<i class='fas fa-inbox-out'></i> \u78BA\u5B9A\u7FA4\u767C"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-comments-alt'></i> \u5373\u5C07\u63A8\u64AD\u81F3 "+a+"\u90E8\u7528\u6236\u88DD\u7F6E",function(a){a||(send_push(!0,b.odd().attr({"data-bulk":"odd"}).eq(0)),send_push(!0,b.even().attr({"data-bulk":"even"}).eq(0)))})):msg("<i class='far fa-exclamation-triangle'></i> \u6C92\u6709\u53EF\u767C\u9001\u7684\u88DD\u7F6E\uFF0C\u8ACB\u5148\u884C\u67E5\u8A62")}function filter_finished(b){var a=$(".recipients");b?a.addClass("unfinished"):a.removeClass("unfinished")}function empty_recipients(){$(".recipients").slideUp("fast",function(){$(this).empty().show()})}function filter_all(a){var b=$(".user_data [data-uid_interval]");b.filter(":eq(0)").val(1).attr({max:a}),b.filter(":eq(1)").val(a).attr({max:a})}function uid_toggle(a,b){$(".user_data tr").attr("data-off","").filter(".uid_"+a).removeAttr("data-off"),alertify.success("<i class='fas fa-filter'></i> "+b+"\u6A21\u5F0F")}$(function(){window.onbeforeunload=function(){return!1},$(document).scroll(function(){var a=$(".notify .page_up");$(this).scrollTop()>200?a.stop().fadeIn("slow"):a.stop().fadeOut("slow")}),getUrlPara("order_id")&&$("select[data-template]").val("unpaid_order").change()})