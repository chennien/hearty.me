"use strict";function bd_loading(t){let e=$("body");!1===t?e.removeClass("loading"):e.addClass("loading").delay(5e3).queue(function(){$(this).removeClass("loading").dequeue()})}function bd_update(t){return $.ajax({url:location.origin+"/bd/update.php",type:"post",crossDomain:!0,dataType:"json",data:t,async:!0,xhrFields:{withCredentials:!0}})}function bd_pack(t){return({30:"30日",90:"3個月",180:"6個月",365:"一年期"})[t]||t+"日"}function get_vouchers(){bd_update({action:"get_vouchers"}).then(function(t){1===t.Status?($(".vouchers tbody[data-empty] tr").remove(),list_vouchers(t.Values),getUrlPara("demo")&&($(".vouchers").find("[data-voucher],[data-email]").css({filter:"blur(4px)"}),msg('<i class="fas fa-eye-slash"></i> 已啟用 DEMO模式，隱藏既有列表中的個資'))):msg()}).fail(function(){msg()})}function list_vouchers(t){let e=$(".vouchers tbody").hide();t.forEach(function(t){let a=$("[data-sample] tr").clone().removeAttr("data-sample"),i=t.duration;if(a.find("[data-dur]").attr("data-dur",i).text(bd_pack(i)),a.find("[data-voucher]").attr({title:t.voucher}),a.find("[data-exp]").attr({"data-exp":t.expiration[0],title:t.expiration[1]}),"email"in t&&a.find("[data-email]").attr({title:t.email,"data-emails_sent":t.emails_sent}),"remark"in t&&a.find("[data-remark]").attr({title:t.remark}),"redemption"in t){let n=parseInt(t.expired)>0,l=parseInt(t.redemption)>0;a.find("[data-status]").attr({"data-status":l?2:+!n,title:l?"已兌換":n?"逾期":"有效"})}a.prependTo(e)}),e.fadeIn()}function count_vouchers(t){t=t||3,bd_loading(!0),bd_update({action:"count_vouchers",month_num:t}).then(function(e){if(1===e.Status){let a=$("<table>",{html:$("<thead>",{html:$("<tr>").append($("<td>",{title:"月份"}),$("<td>",{title:bd_pack(30)}),$("<td>",{title:bd_pack(90)}),$("<td>",{title:bd_pack(180)}),$("<td>",{title:bd_pack(365)}))})}),i=$("<tbody>"),n=new Date;for(let l=t;l>=0;l--){let o=new Date(n.getFullYear(),n.getMonth()-l,1),c=o.getFullYear().toString(),r=("0"+(o.getMonth()+1).toString()).slice(-2),s=parseInt(c+r),d=e.Values[s]||[];i.append($("<tr>").append($("<td>",{title:c+"/"+r}),$("<td>",{title:numberWithCommas(d[30]||0)}),$("<td>",{title:numberWithCommas(d[90]||0)}),$("<td>",{title:numberWithCommas(d[180]||0)}),$("<td>",{title:numberWithCommas(d[365]||0)})))}a.append(i),msg('<h3><i class="fal fa-chart-bar"></i> 我近期取得的序號張數<h3>'+a.get(0).outerHTML),bd_loading(!1)}else msg(),bd_loading(!1)}).fail(function(){msg(),bd_loading(!1)})}function voucher_remark(t){if(!t)return;let e=t.siblings("[data-voucher]").attr("title")||"",a=$("<i>").html(t.attr("title")||"").text();alertify.set({labels:{ok:'<i class="fas fa-plus"></i> 貼上',cancel:"取消"},buttonReverse:!1}),alertify.prompt('<i class="fal fa-edit"></i> 備註一下：',function(a,i){a&&bd_update({action:"voucher_remark",voucher:e,remark:i=$("<i>").html(i||"").text()}).then(function(e){1==e.Status&&t.attr({title:i})}).fail(function(){msg()})},a),alertify_input_custom({minlength:1,maxlength:85,placeholder:"eg. 領取者姓名、檔期名稱、其他資訊"},{"letter-spacing":"1px"})}function create_vouchers(){let t=$(".create"),e=Math.min(t.find("input").val()||1,20),a=Math.min(t.find("select").val()||30,365);bd_update({action:"create_vouchers",dur:a,num:e}).then(function(i){1===i.Status?(list_vouchers(i.Values),t.fadeOut(),alertify.success('<i class="fas fa-gift-card"></i> 取得 '+e+"張 "+bd_pack(a)+"序號")):msg()}).fail(function(){msg()})}function hide_voucher(t){let e=t.siblings("[data-voucher]").attr("title")||"",a=1==t.siblings("[data-status]").attr("data-status");if((t.siblings("[data-dur]").attr("data-dur")||30)>30){msg('<i class="fal fa-ban"></i> 付費型序號一經取得即等同售出，將無法退回或刪除。<br>如有疑問，請聯繫業務夥伴');return}alertify.set({labels:{ok:"否",cancel:'<i class="fas fa-trash-alt"></i> 刪掉它'},buttonReverse:!1}),alertify.confirm('<i class="fal fa-exclamation-circle"></i> '+(a?"此序號尚未被兌換，確認不需要":"刪除換過的")+"「"+e+"」嗎？",function(a){a||bd_update({action:"hide_voucher",voucher:e}).then(function(a){1===a.Status?(alertify.error('<i class="fas fa-trash-alt"></i> 刪除了 '+e),t.parent().slideUp("slow",function(){$(this).remove()})):msg()}).fail(function(){msg()})})}function check_eml(t,e){return new Promise(function(a){bd_loading(!0),$.ajax({url:"//api.usercheck.com/email/"+t,type:"GET",async:!0,cache:!0,crossDomain:!0,dataType:"json",timeout:2e3}).then(function(i){bd_loading(!1),429==(i.status||0)?console.warn("usercheck.com | Rate limit exceeded"):400==(i.status||0)?(msg('<i class="fal fa-times"></i> Email 格式不符：'+t),collect_eml(e,t),a(!1)):!1==(i.mx||"")?(msg('<i class="fal fa-times"></i> Email 有誤：'+t),collect_eml(e,t),a(!1)):!0==(i.disposable||"")&&(msg('<i class="fal fa-ban"></i> 不允許使用臨時信箱：'+t),collect_eml(e,""),a(!1)),a(!0)}).catch(function(){bd_loading(!1),a(!0)})})}function collect_eml(t,e){if(!t)return;let a=t.siblings("[data-voucher]").attr("title")||"",i=t.attr("title")||"",n=t.attr("data-emails_sent")||0,l=t.siblings("[data-exp]").attr("data-exp");e=(e||i).toLowerCase(),n<0?msg('<i class="fal fa-ban"></i> '+e+" 已退訂通知信，別再寄給他惹"):0==n?(alertify.set({labels:{ok:'<i class="fas fa-chevron-right"></i> 下一步，設定 Email',cancel:"否"},buttonReverse:!1}),alertify.prompt('<i class="fal fa-envelope"></i> 收件人 Email：<br><small><i class="far fa-shield-alt"></i> 基於個資保護，於此登錄之民眾 Email，將加以保密，<br>僅由貴店的您用於本次通知，不會也無法移作其他用途</small>',function(e,n){e&&check_eml(n=(n||"").trim(),t).then(function(e){e&&(i==n?eml_composer(!0,a,n,l):n.length>5?(eml_composer(!0,a,n,l),bd_loading(!0),bd_update({action:"voucher_eml",voucher:a,email:n}).then(function(e){switch(e.Status){case 1:t.attr({title:n}),bd_loading(!1);case 3:msg('<i class="fal fa-times"></i> Email 有誤或格式不符：'+n),collect_eml(t,n);break;case 4:msg('<i class="fal fa-ban"></i> '+n+" 已退訂通知信，別再寄給他惹"),collect_eml(t,"");break;default:msg()}eml_composer(!1),bd_loading(!1)}).fail(function(){msg(),eml_composer(!1),bd_loading(!1)})):(alertify_input_shake(),collect_eml(""),bd_loading(!1)))})},e),alertify_input_custom({type:"email",min:5,max:64,placeholder:"someone@gmail.com"},{"letter-spacing":"1px"})):eml_composer(!0,a,e,l)}function eml_composer(t,e,a,i){let n=$(".eml"),l=n.find(".variables"),o=$("#Smallchat");if(t){n.removeAttr("data-hidden").fadeTo("fast",1).find("input[type='email']").val(a),l.find("[data-voucher-email]").attr("data-voucher-email",a),l.find("[data-voucher-timer]").attr("data-voucher-timer",i);let c="https://hearty.gift/"+e+"/"+a;l.find("[data-voucher]").attr({href:c,"data-voucher":e,rel:"noopener"}),l.find("[data-voucher-link]").attr({href:c,"data-voucher-link":c,rel:"noopener"}),hj_tinymce_init(),o.fadeOut()}else n.fadeOut(),o.fadeIn();$("body").css({overflow:t?"hidden":"auto"})}function send_voucher_eml(){let t=hj_template_field("voucher"),e=hj_template_field("voucher-email"),a=$("[data-emails_sent][title='"+e+"']"),i=parseInt(a.attr("data-emails_sent"))||0;if(e.length<5||0>e.indexOf("@")){msg('<i class="fal fa-info-circle"></i> Email 格式不正確');return}if(i>4){msg('<i class="fal fa-exclamation-triangle"></i> 超出發信上限 (5封/單一收件人)，請聯絡溫度團隊');return}alertify.set({labels:{ok:"確認寄出",cancel:"取消"},buttonReverse:!1}),alertify.confirm('<i class="fal fa-eye-slash"></i> 即將發送序號通知信到「'+e+"」",function(n){if(n){bd_loading(!0);let l=$("<i>",{html:tinymce.activeEditor.getContent({format:"raw"})||""});l.find("[data-voucher]").text(l.find("[data-voucher]").attr("data-voucher")).removeAttr("data-voucher"),l.find("[data-voucher-email]").text(l.find("[data-voucher-email]").attr("data-voucher-email")).removeAttr("data-voucher-email"),l.find("[data-voucher-link]").text(l.find("[data-voucher-link]").attr("data-voucher-link")).removeAttr("data-voucher-link"),l.append($("<hr>").add($("<span>",{text:"您參加了品牌活動，才會收到此封通知("+e+")。如不想再收到，請 ",style:"font-size:x-small"})).add($("<a>",{target:"_blank",href:"https://hearty.gift/u/"+e+"/"+t,text:"[取消訂閱 Unsubscribe :( ]",rel:"noopener",style:"text-decoration:none;font-size:x-small"})).add($("<img>",{src:"https://www.google-analytics.com/collect?v=1&t=event&tid=UA-26998803-8&cid=b0ed2542-fa8f-4054-82c2-924e6b97cf7d&ec=voucher_email&ea=open&dt=voucher_email&cn=voucher_email&cm="+e+"&cs=voucher_email",width:1,height:1}))).find("a[href*='https://']").each(function(){$(this).attr({href:$(this).attr("href").replace(/https:\/\/(?!c.heartymail)/gi,"https://c.heartymail.com/voucher/"+e+"/"+t+"/")})});let o=l.html(),c=$("textarea[name='subject']").val().trim();bd_update({action:"send_voucher_eml",voucher:t,email:e,cc_me:+$("input[name='cc_me']").prop("checked"),subject:c,body:o}).then(function(t){switch(t.Status){case 1:msg('<i class="fas fa-check-circle"></i> 通知信已寄至：'+e+"<br><br><img src='//i.hearty.app/w/hearty.me/bd/images/cute_envelope.gif' style='filter:hue-rotate(145deg)saturate(.9)'>"),tinymce.activeEditor.windowManager.close(),eml_composer(!1),a.attr({"data-emails_sent":i+1}),gform_post("1FAIpQLScJfg6TYfg_8NwI5d8yGP6H2Az29K9LA3osLnUcKj9YwUJb6Q",{emailAddress:e,"entry.768310548":getcookie("hearty_u"),"entry.2003480077":getcookie("hearty_id"),"entry.1845355844":c,"entry.2038456161":o,"entry.1240071619":today(8),"entry.390259802":check_browser()+", "+check_OS()});break;case 3:msg('<i class="fal fa-info-circle"></i> Email 有誤，或格式不正確');break;default:msg('<i class="fal fa-info-circle"></i> 抱歉，似乎遇到一些問題：'+JSON.stringify(t.Values))}bd_loading(!1)}).fail(function(){msg(),bd_loading(!1)})}}),tinymce.activeEditor.execCommand("mcePreview")}function sender_info(){alertify.set({labels:{ok:"好的",cancel:'<i class="fas fa-edit"></i> 前往修改'},buttonReverse:!1}),alertify.confirm('<i class="fal fa-mailbox"></i> Email 前綴 = 溫度 ID；顯示名稱 = 溫度暱稱',function(t){t||hj_href("account")})}function get_link(t){if(!t)return;let e=t.siblings("[data-voucher]").attr("title")||"",a=t.siblings("[data-email]").attr("title")||null,i="https://hearty.gift/"+e+(null==a?"":"/"+a);alertify.set({labels:{ok:'下載 QRcode <i class="fas fa-qrcode"></i>',cancel:'<i class="fas fa-copy"></i> 複製連結'},buttonReverse:!0}),alertify.prompt('<i class="fal fa-link"></i> 專屬兌換連結<br><br><a class="qrcode"></a>',function(t){t?$("#alertify .qrcode").get(0).click():(hj_copy($("#alertify .alertify-text")),is_touch_device()&&"share"in navigator&&navigator.share({url:i}).catch(function(t){}))},i),alertify_input_custom({type:"url",placeholder:i,onclick:"hj_copy($(this))"},{cursor:"copy"}),hj_copy_text(i),get_qrcode($("#alertify .qrcode"),i,e)}function hj_tinymce_init(){window.tinymce?hj_tinymce_template():(hj_getScript("//cdn.jsdelivr.net/combine/npm/tinymce@5.10.9/tinymce.min.min.js,npm/tinymce@5.10.9/jquery.tinymce.min.min.js").then(function(){let t=$("textarea[data-editor]");t.val(linkify(t.val())).tinymce({base_url:"https://cdn.jsdelivr.net/npm/tinymce@5.10.9",placeholder:"Email 信件內文",content_css:"https://cdn.jsdelivr.net/gh/chennien/hearty.me@5/public/plugins/vouchers.tinymce.min.css",content_css_cors:!0,statusbar:!1,branding:!1,relative_urls:!1,remove_script_host:!1,height:300,menubar:!1,image_caption:!0,save_enablewhendirty:!1,plugins:"autolink preview directionality code visualblocks visualchars fullscreen image link codesample table charmap toc advlist imagetools textpattern noneditable charmap emoticons table paste save",toolbar:"reset-to-default save code preview fullscreen | image table link | undo redo | bold underline alignjustify aligncenter alignright | forecolor backcolor formatselect removeformatk | emoticons | fontsizeselect",toolbar_drawer:"sliding",link_list:[{title:"溫度日記",value:"https://go.hearty.me/hj"}],image_list:[{title:"溫度日記 信頭圖片",value:"https://i.hearty.app/i/mailheader.png?o=1"},{title:"溫度日記 Logo PNG",value:"https://i.hearty.app/i/logo.png?o=1"},{title:"溫度日記 Logo JPG",value:"https://i.hearty.app/i/logo.jpg?o=1"},{title:"溫度日記 Sheara",value:"https://i.hearty.app/i/illustrations/sheara.jpg?o=1"}],color_map:["ffffff","潔白","ffd1a4","膚色","ffdcdc","淡粉","ffbdbd","淺粉","f16d6e","深紅","d78b7b","卡其","d28064","卡其","b4b4b4","淺灰","444444","深灰","000000","純黑"],contextmenu:"link",language:"zh_TW",language_url:"//cdn.jsdelivr.net/npm/tinymce-all-in-one@4.9.5/langs/zh_TW.min.js",default_link_target:"_blank",link_default_protocol:"https",paste_retain_style_properties:"all",paste_word_valid_elements:"*[*]",paste_convert_word_fake_lists:!1,paste_webkit_styles:"all",paste_merge_formats:!0,paste_data_images:!0,automatic_uploads:!0,images_upload_url:"../api/mail.img.php",images_upload_credentials:!0,save_onsavecallback:hj_tinymce_template_save,setup:function(t){t.on("init",function(){hj_tinymce_template(),bd_update({action:"get_uploaded_images"}).then(function(e){1==e.Status&&(t.settings.image_list=t.settings.image_list.concat(e.Values))})}),t.ui.registry.addButton("reset-to-default",{icon:"restore-draft",tooltip:"重置為預設格式",onAction:function(){hj_tinymce_template_reset()}})}})}),window.onbeforeunload=function(){return!1})}function hj_tinymce_template(){bd_update({action:"voucher_eml_template"}).then(function(t){if(1==t.Status){let e=t.Values;e.subject.length||e.template.length?hj_tinymce_template_rendering(e.subject,e.template):hj_tinymce_template_reset(!0)}})}function hj_tinymce_template_rendering(t,e){let a=hj_template_field("voucher"),i=hj_template_field("voucher-email"),n="https://hearty.gift/"+a+"/"+i,l=hj_template_field("voucher-timer"),o=$("<i>",{html:e});$("textarea[name='subject']").val(t),o.find("[data-voucher]").attr({href:n,"data-voucher":a}),o.find("[data-voucher-link]").attr({href:n,"data-voucher-link":n}),o.find("[data-voucher-email]").attr({"data-voucher-email":i}),o.find("[data-voucher-timer]").replaceWith(hj_timer_dom_convert(l)),o.find("[data-nickname]").text($("header .user").attr("title")||""),o.find("[data-date]").text(today().replace(/-/g,"/")),tinymce.activeEditor.setContent(o.html(),{format:"raw"})}function hj_timer_dom_convert(t){return(t=parseInt(t)||0)<Math.floor(new Date().getTime()/1e3)&&(t=0),$("<div>",{title:"期限倒數","data-voucher-timer":t,html:$("<img>",{src:"https://i.hearty.app/t/"+new Date(1e3*t).toISOString(),"data-voucher-timer":t,alt:"期限倒數",width:310,height:"auto",onerror:"this.style.display='none'"}).css({"border-radius":"5px"})}).css({height:"70px","text-align":"center",overflow:"hidden"})}function hj_tinymce_template_reset(t){t?$.ajax({url:"email.template.html?v="+today(8),dataType:"text",success:function(t){hj_tinymce_template_rendering("你的溫度日記 VIP 兌換序號已送達 \uD83D\uDC8C",t)}}):(alertify.set({labels:{ok:"取消",cancel:'<i class="fas fa-truck-plow"></i> 清掉它'},buttonReverse:!1}),alertify.confirm('<i class="fal fa-history"></i> 要清除內容，並回到預設格式嗎？',function(t){t||hj_tinymce_template_reset(!0)}))}function hj_tinymce_template_save(){let t=tinymce.activeEditor.getContent({format:"raw"})||"";bd_update({action:"voucher_email_template",subject:$("textarea[name='subject']").val(),template:t}).then(function(t){1==t.Status&&alertify.success('<i class="fal fa-save"></i> 已存為預設範本')})}function hj_template_field(t){return $(".eml [data-"+t+"]").attr("data-"+t)}function hj_tinymce_variable(t){tinymce.activeEditor.insertContent(" "+t.prop({contenteditable:!1}).prop("outerHTML")+" ",""),alertify.success('<i class="fal fa-plus"></i> 插入 '+t.attr("title"))}function linkify(t){return(t||"").replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a target="_blank" href="$&">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a target="_blank" href="https://$2">$2</a>')}function bd_export(){let t=$(".vouchers table").clone();t.find("th[title],td[title]").each(function(){$(this).text($(this).attr("title")||"")}),t.find("[data-link]").remove(),exportTableToCSV(t,($("header .user").attr("title")||"溫度日記序號")+"_"+today().replace(/-/g,"")+".csv"),alertify.success('<i class="fas fa-file-excel"></i> CSV檔匯出中')}function exportTableToCSV(t,e){let a=t.find("tr:has(th)"),i=t.find("tr:has(td)"),n='"\r\n"',l='"';l+=c(a.map(r)),l+=n;let o="data:application/csv;charset=utf-8,"+encodeURIComponent(l+=c(i.map(r))+'"');function c(t){return t.get().join("\0").split("\0").join(n).split("\v").join('","')}function r(t,e){let a=$(e),i=a.find("td");return i.length||(i=a.find("th")),i.map(s).get().join("\v")}function s(t,e){return $(e).text().replace('"','""')}$("<a>",{href:o,download:e}).get(0).click()}function bd_page(){let t=$("body"),e="https://hearty.gift/g/"+(t.attr("data-bd")||"")+"/"+encodeURIComponent(t.attr("data-name")||"");alertify.set({labels:{ok:' <i class="fas fa-eye"></i> 立即查看',cancel:'<i class="fas fa-copy"></i> 複製連結'},buttonReverse:!1}),alertify.prompt('<i class="fal fa-browser"></i> VIP 30日免費體驗型序號索取連結<br><small><i class="fal fa-info-circle"></i> 僅限用於消費者/會員/員工/粉絲限定活動，勿公開於網路上</small><br><br><a class="qrcode"></a><br><small><i class="fal fa-qrcode"></i> 點擊 QRcode可另存為圖片</small>',function(t){t?(hj_copy_text(e),window.open(e,"_blank")):(hj_copy($("#alertify .alertify-text")),is_touch_device()&&"share"in navigator&&navigator.share({url:e}).catch(function(t){}))},e),alertify_input_custom({type:"url",placeholder:e,onclick:"hj_copy($(this))"},{cursor:"copy"}),get_qrcode($("#alertify .qrcode"),e)}function bd_mark(){let t="hearty.me/bd/images/reseller_mark.png",e=$("body"),a=e.attr("data-user")||"",i=e.attr("data-name")||"",n=["溫度日記授權經銷商"+(i?" "+i:""),'<h3><i class="fal fa-badge-check"></i> 授權經銷商標章</h3>'],l=[$("<a>",{href:"https://hearty.me/bd?utm_source="+a,target:"_blank",title:n[0],html:$("<img>",{width:"300px",height:"300px",src:"https://"+t,alt:n[0]})}).get(0).outerHTML,$("<a>",{href:"//"+t,title:n[0],download:n[0]+".png",html:$("<img>",{src:"//i0.wp.com/"+t+"?w=250&strip=all",width:"250px",height:"250px",alt:n[0]})}).get(0)];alertify.set({labels:{ok:'<i class="fas fa-copy"></i> 複製 HTML程式碼',cancel:'<i class="fas fa-arrow-alt-to-bottom"></i> 下載圖片'},buttonReverse:!1}),alertify.confirm(n[1]+l[1].outerHTML+'<br><small><i class="fal fa-info-circle"></i> 請展示於網站明顯處，供消費者識別</small>',function(t){t?(l[0]="<!-- Reseller Mark, Hearty Journal -->\n"+l[0],msg(n[1]+$("<textarea>",{title:n[0],text:l[0],rows:6,onclick:"hj_copy($(this))"}).get(0).outerHTML,'<i class="fas fa-copy"></i> 複製 HTML程式碼',function(){hj_copy_text(l[0])})):l[1].click()})}function bd_contract(){bd_update({action:"bd_contract"}).then(function(t){(t.Values||"").length>0&&hj_preview(!0,"//drive.google.com/file/d/"+t.Values+"/preview")})}function hj_preview(t,e){let a=$("body"),i=$(".hj_preview"),n=i.find("iframe");t?(n.attr({src:e||n.attr("data-url")||"//docs.google.com/document/d/e/2PACX-1vRmTICp7EIOPI_Lis2JTsVtb5tqoz3wulkTZzh2OUJKrzn_97RSpFmK9NtjXFnW4c5fBK374akpK0f8/pub?embedded=true"}).addClass("loading"),i.fadeIn(),a.css({"overflow-y":"hidden","touch-action":"none"})):(i.fadeOut(),a.css({"overflow-y":"auto","touch-action":"auto"}),n.attr({src:""}))}function bd_tutorial(){if("introJs"in window){let t=$(".vouchers");introJs().setOptions({showBullets:!1,prevLabel:"上一步",nextLabel:"繼續",doneLabel:"朕知道了",steps:[{element:t.find("[data-create]").get(0),intro:"\uD83D\uDC49　點「取號」，獲得序號",position:"left"},{element:t.find("table").get(0),intro:"\uD83C\uDF81　序號會列於表中",position:"top"},{element:t.find("table th:nth-child(6)").get(0),intro:"✉️　可自動寄發序號 Email",position:"top"},{element:$("#Smallchat iframe").get(0),intro:"\uD83D\uDCAC　如有問題，隨時聯繫我們",position:"top"}]}).start().oncomplete(function(){hj_preview(!0)}).onexit(function(){hj_preview(!0)}),setcookie("hearty_bd_tutorial",1,1)}else hj_getScript_npm("intro.js@3.2.1/intro.min.js",bd_tutorial)}function redeem_tutorial(t){let e=$(".redeem_tutorial"),a={1:"一、手動輸入序號",2:"二、點選兌換連結"};if(t){if(e.length>0)e.fadeIn();else{let i=["//i.hearty.app/b/videos/voucher_redeem",check_OS("iOS")?"#t=0.001":""];$("<section>",{class:"redeem_tutorial",html:Object.keys(a).map(function(t){return $("<div>",{title:a[t],html:$("<video>",{controls:"",controlsList:"nodownload noplaybackrate",muted:"",preload:"",disablePictureInPicture:"",html:$("<source>",{src:i[0]+t+".webm"+i[1],type:"video/webm"}).add($("<source>",{src:i[0]+t+".mp4"+i[1],type:"video/mp4"}))}).on("play",function(){this.requestFullscreen&&this.requestFullscreen()}).on("click",function(t){t.stopPropagation()})})})}).on("click",function(){redeem_tutorial(!1)}).appendTo("body")}}else e.fadeOut()}$(function(){$(document).on("click",".vouchers [data-copy]",function(){hj_copy_text(this.title)}).on("click",".vouchers td[data-link]",function(){get_link($(this))}).on("click",".vouchers td[data-email]",function(){collect_eml($(this))}).on("click",".vouchers td[data-remark]",function(){voucher_remark($(this))}).on("click",".vouchers td[data-hide]",function(){hide_voucher($(this))}),$(".user").on("click",function(){hj_href("account")}),$("header [data-menu]").on("click",function(){nav_toggle($(".menu"),!0)}),$(".eml").on("click",function(){confirm("ℹ️ 要離開編輯視窗嗎？")&&eml_composer(!1)}).children("div").on("click",function(t){t.stopPropagation()}).find("input[type='email']").on("click",function(){hj_copy($(this))}),$(".eml .variables").on("click",function(t){t.preventDefault()}).find("a").on("click",function(){$(this).is("[data-voucher-timer]")?hj_tinymce_variable(hj_timer_dom_convert($(this).attr("data-voucher-timer")).add($("<br>"))):hj_tinymce_variable($(this))}),$(".eml [data-send]").on("click",send_voucher_eml),$(".eml [data-sender]").on("click",sender_info).find("address").on("click",function(){hj_copy_text(this.innerText)});let t=$(".create");t.on("click",function(){$(this).fadeOut("fast")}).find("div > div").on("click",function(t){t.stopPropagation()}).find("input").on("input",function(){let t=$(this).val();t<1?$(this).val(1):t>20&&$(this).val(20)}),t.find("[data-active]").on("click",create_vouchers),t.find("[data-info]").on("click",function(){msg('<i class="fal fa-info-circle"></i> 可選方案依合約而定，<br>原<u>數位兌換卡合作商家</u>可申請升級為<u>經銷商</u>，詳洽業務夥伴')}),1==$("[data-level='0']").length&&t.find("optgroup").eq(1).prop("disabled",!0),$("[data-page]").on("click",bd_page),$("[data-stats]").on("click",function(){count_vouchers(3)}),$("[data-export]").on("click",bd_export),$("[data-create]").on("click",function(){$(".create").removeAttr("data-hidden").fadeIn().fadeTo("fast",1)}),$(".contract").on("click",bd_contract),$(".help_btn").on("click",function(){getcookie("hearty_bd_tutorial")?hj_preview(!0):bd_tutorial()}),$(".hj_preview").on("click",function(){hj_preview(!1)}).find("iframe").on("load",function(){$(this).removeClass("loading")}),$("[data-mark]").on("click",bd_mark),$("[data-redeem]").on("click",function(){redeem_tutorial(!0)}),$("[data-kit]").on("click",function(){window.open("//bit.ly/3WH7SKy","_blank")}),$("[data-shortcut]").on("click",function(){hj_getFile("d.hearty.app/win/BD.exe","溫度日記經銷系統.exe")}),$("[data-tm]").on("click",function(){hj_preview(!0,"//mozilla.github.io/pdf.js/web/viewer.html?file=//cdn.jsdelivr.net/gh/chennien/d.hearty.app@0/docs/trademarks.pdf"),check_OS("Windows")&&hj_getFile("d.hearty.app/win/trademarks.exe","溫度日記商標.exe")}),$("[data-comingsoon]").on("click",function(){msg('<i class="fal fa-box-full"></i> 功能即將推出，好了再讓你知道')}),get_vouchers(),setInterval(get_vouchers,3e5),$(".toast_signin_reminder").delay(5e3).queue(function(){$(this).fadeOut().dequeue()}),hj_localize_cn()});