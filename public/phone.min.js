"use strict";function phone_no_prefill(){var e=getUrlPara("cc")||"",i=$("#country-code");!e&&"fetch"in window?fetch(location.origin+"/cdn-cgi/trace",{method:"GET",mode:"cors"}).then(function(e){return e.text()}).then(function(e){fetch("//api.hearty.app/ipinfo/"+e.replace(/(\r\n|\n|\r)/gm,"").split("ip=")[1].split("ts=")[0],{method:"GET",mode:"cors",headers:{Accept:"application/json"}}).then(function(e){return e.json()}).then(function(e){e=parseInt(e.location.calling_code)||886,i.val(e).find("[value="+e+"]").attr("selected","selected")})}):i.val(e).find("[value="+e+"]").attr("selected","selected"),$("#phone-no").val(getUrlPara("no")||"")}function phone_firebase_init(){window.firebase.auth().onAuthStateChanged(function(e){if(e){var i=$("#country-code").val()||886,a=e.phoneNumber.replace("+"+i,"");hj_update({action:"phone_verification_firebase",cc:i,no:a,token:e.uid}).then(function(t){switch(t.Status){case 1:case 3:hj_update({action:"gform_post",uri:"1FAIpQLSfW2spId3fWb_h31S4jXhv33Vjal-bHGGIAqtXETGhiqjFB0w",data:$.param({"entry.1182370364":"[hj_user_id]","entry.847068538":"[hj_username]",emailAddress:"[hj_email]","entry.1353731030":i,"entry.352107652":a,"entry.1205631750":e.uid,"entry.1460125899":(new Date).toISOString().split("T")[0],"entry.1757674378":navigator.userAgent||""})}),window.phone_firebase_result=null,firebase.auth().signOut().then(phone_firebase_verified).catch(function(e){msg(),location.reload(!0)});break;case 2:msg('<i class="far fa-exclamation-triangle"></i> '+_h("pv-signin-0"),'<i class="fas fa-door-open"></i> '+_h("pv-signin-1"),function(){hj_href("?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+"#signin")});break;default:msg()}}).fail(msg),$("#phone-verify-firebase").hide()}}),window.recaptchaVerifier=new firebase.auth.RecaptchaVerifier("phone-firebase",{size:"invisible",callback:phone_firebase}),window.recaptchaVerifier.render().then(function(e){window.recaptchaWidgetId=e}).catch(phone_not_loaded)}function phone_firebase(){var e=$("#country-code").val()||886,i=$("#phone-no"),a=i.val()||"",t=window.recaptchaVerifier;if(a.length<3)return msg('<i class="far fa-exclamation-triangle"></i> '+_h("pv-format-0"),_h("pv-ok"),function(){shake(i.parent()),i.focus()}),resetReCaptcha(),!1;firebase.auth().signInWithPhoneNumber("+"+e+a,t).then(function(e){window.phone_firebase_result=e,phone_firebase_verify("",!0)}).catch(function(e){switch(e.code){case"auth/invalid-phone-number":msg('<i class="far fa-times"></i> '+_h("pv-format-1"),_h("pv-ok"),function(){shake(i),i.focus()});break;case"auth/too-many-requests":msg('<i class="far fa-exclamation-circle"></i> '+_h("pv-format-2")+"<br>"+e.message);break;default:msg('<i class="far fa-exclamation-circle"></i> '+e.code+"<br>"+e.message)}resetReCaptcha()})}function phone_firebase_verify(e,i){var a=$("#phone-verify-firebase");if(!window.phone_firebase_result)return a.prop("disabled",!0).show(),!1;alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("pv-verify1-0"),cancel:_h("pv-no")},buttonReverse:!1}),alertify.prompt('<i class="far fa-mobile"></i> '+_h("pv-verify1-1")+(i?_h("pv-verify1-2"):""),function(e,i){if(e){if((i=i||"").length<6)return msg('<i class="far fa-exclamation-circle"></i> '+_h("pv-code-2"),_h("pv-code-1"),function(){phone_firebase_verify()}),!1;phone_firebase_result.confirm(i).then(function(e){e.user;msg('<i class="fas fa-check-circle"></i> '+_h("pv-verify1-3",{$no:$("#phone-no").val()}),_h("pv-ok"))}).catch(function(e){switch(e.code){case"auth/invalid-verification-code":msg('<i class="far fa-times"></i> '+_h("pv-code-3"),_h("pv-code-1"),function(){phone_firebase_verify()});break;case"auth/code-expired":msg('<i class="far fa-times"></i> '+_h("pv-code-4")+"<br>"+e.message),window.phone_firebase_result=null,a.hide();break;default:msg('<i class="far fa-exclamation-circle"></i> '+e.code+"<br>"+e.message)}})}},(e||"").toString()),alertify_input_custom({type:"tel",placeholder:_h("pv-code-0"),minlength:1,maxlength:6,onkeyup:"if(this.value.length==6)$('.alertify-button-ok').click()"},{"letter-spacing":"3px"}),a.removeAttr("disabled").show();var t=$("#phone-firebase");t.finish().prop("disabled",!0).text(t.attr("data-wait")).delay(3e4).queue(function(){$(this).removeAttr("disabled").text($(this).attr("data-text")).dequeue()}),is_touch_device()&&$("[data-unreceived]").delay(3e4).queue(function(){$(this).show().dequeue()})}function phone_not_loaded(){msg(hj_lang_zhcn()?'<i class="fal fa-signal-slash"></i> Âú®‰∏≠ÂõΩÔºåË∞∑Ê≠åÂõΩÈôÖÁü≠‰ø°È™åËØÅÂäüËÉΩË¢´ÁâÜ‰∫Ü':'<i class="fal fa-exclamation-triangle"></i> '+_h("pv-fail")," Œ£„ÉΩ(Ôæü–î Ôæü; )Ôæâ ")}function resetReCaptcha(){"undefined"!=typeof grecaptcha&&void 0!==window.recaptchaWidgetId&&grecaptcha.reset(window.recaptchaWidgetId)}function phone_firebase_verified(){/8(1|86)|66/.test($("#country-code").val())?(alertify.set({labels:{ok:_h("pv-no"),cancel:'<i class="fas fa-hand-point-right"></i> '+_h("pv-ok")},buttonReverse:!0}),alertify.confirm('<i class="fab fa-line"></i> '+_h("pv-line"),function(e){hj_href("account"+(e?"":"?line=1"))})):hj_href("account")}function phone_manual_verify(e){alertify.set({labels:{ok:_h("pv-no"),cancel:'<i class="fas fa-comment-alt-dots"></i> '+_h("pv-verify2-2")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-question-circle"></i> '+_h("pv-verify2-0")+"<br>"+_h("pv-verify2-1"),function(i){i||(location.href="sms:+886902290532"+(check_OS("iOS")?"&":"?")+"body=%5B%E6%89%8B%E6%A9%9F%E8%AA%8D%E8%AD%89%5D%20%E6%BA%AB%E5%BA%A6%20ID%EF%BC%9A"+(e||"")+" ",setTimeout(function(){msg('<i class="fal fa-info-circle"></i> '+_h("pv-verify2-3"),_h("pv-ok"),function(){hj_href("account")})},7e3),fb_event_push(!1,"Contact"))})}function phone_1922(){is_touch_device()?location.href="sms:+8861922"+(check_OS("iOS")?"&":"?")+"body=%E5%A0%B4%E6%89%80%E4%BB%A3%E7%A2%BC%EF%BC%9A2594%208453%204159%20830%0a%E6%BA%AB%E5%BA%A6%E6%97%A5%E8%A8%98%EF%BC%8C%E7%99%82%E7%99%92%E7%B3%BB%E5%BF%83%E6%83%85%E6%97%A5%E8%A8%98%20App%20www.hearty.me%20":msg('<h3 class="fas fa-qrcode"> ÊâãÊ©üÊéÉÊèè QRcodeÔºö</h3><img src="//i.hearty.app/ycyxWiF.png" style="max-height:50vh">')}Sentry.init({dsn:"https://a6cb9b2263814097b85a2170900e6d62@sentry.io/183684"}),Bugsnag.start({apiKey:"5c55b919bc2a4ed35ffa675c9341251c",appType:"client"}),$(function(){window.firebase?phone_firebase_init():phone_not_loaded(),phone_no_prefill(),$("[data-unreceived]").on("click",function(){phone_manual_verify(this.dataset.username)}),$("[data-goback]").on("click",function(){hj_href("account")}),document.title=_h("pv-title")+" | üíù Ê∫´Â∫¶Êó•Ë®ò Hearty Journal"});