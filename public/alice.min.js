function nav_toggle_goodnight(e){var t=$(".goodnight");t.length>0&&(e=t.width()*(e||0),check_browser("Safari")?t.animate({scrollLeft:e},450):t.scrollLeft(e),t.children("div").scrollTop(0))}function alice_opinions_toggle(e){var t=$(".alice_inner [data-quote]"),n=$(".alice_inner [data-opinions]"),i=n.find("ul");e||i.is(":hidden")?(n.removeAttr("data-off"),i.slideDown(),t.attr("data-blur","")):i.fadeOut("fast",function(){n.attr("data-off",""),t.removeAttr("data-blur")})}function alice_greeting_query(e){hj_update({action:"alice_greeting",greeting_date:e||""}).then(function(e){switch(e.Status){case 1:e=e.Values;var t=$(".goodnight"),n=t.find("[data-opinions] ul");if(t.find("[data-quote]").attr({title:e.greeting}).find("img").attr({src:"//i0.wp.com/hearty.me/uploads/images/alice/"+e.greeting_image}).fadeTo("fast",1),n.attr("title",e.greeting_title),t.find(".comment").attr("data-greeting_id",e.greeting_id),e.comments.length>0){var i=[];e.comments.forEach(function(t){i.push(alice_greeting_create(e,t))}),n.find(".opinions").slice(1).remove(),n.find(".opinions:first").after(i)}}})}function alice_greeting_create(e,t){var n=t.profile_image||"default.jpg";return $("<li>",{class:"opinions"}).html($("<div>",{class:"avatar",title:t.nickname,style:"background-image: url('//i0.wp.com/hearty.me/uploads/images/users/"+n+"'), url('//cdn.statically.io/img/hearty.me/uploads/images/users/"+n+"')",onclick:"open_url('//hearty.me/"+t.username+")"}).add($("<div>",{class:"opinion",title:t.comment,"data-user":t.nickname,"data-vip":$.inArray(t.username,["nien","jianny"])<0?0:1}).text(t.comment).append($("<a>",{onclick:"alice_comment_toggle(this.dataset, $(this).parent());","data-greeting_id":e.greeting_id,"data-comment_id":t.comment_id,"data-comment_own":t.comment_own}))))}function alice_greeting_comment(e){var t=$(".goodnight [data-opinions]"),n=t.find(".comment input"),i=n.val()||"";i.length>0?hj_update({action:"alice_greeting_comment",greeting_id:e,comment:n.val()}).then(function(a){switch(a.Status){case 1:n.val(""),a=a.Values,t.find(".comment").before(alice_greeting_create({greeting_id:e},{username:a.username,nickname:a.nickname,profile_image:a.profile_image,comment_id:a.comment_id,comment_own:1,comment:i})),t.scrollTop(t.find("ul").height()),hj_mixpanel("Comment",{greeting_id:e}),ga_event_push("Comment",{event_category:"Posts",event_label:"Comment"});break;case 2:alice_signin_required()}}):shake(n)}function alice_comment_android_keyboard_fix(){var e=$(".alice_inner [data-opinions] .comment");check_hjapp("Android")&&e.length>0&&e.children("input").focus(function(){e.addClass("android_keyboard_fix")}).blur(function(){e.removeClass("android_keyboard_fix")})}function alice_comment_toggle(e,t){var n=Number(e.greeting_id),i=Number(e.comment_id);"1"==e.comment_own?(alertify.set({labels:{ok:"否",cancel:"刪除"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-trash-alt'></i> 確認刪除留言嗎？",function(n){n||hj_update({action:"alice_greeting_comment_delete",comment_id:i}).then(function(n){switch(n.Status){case 1:t.parent().slideUp(400,function(){$(this).remove()}),hj_mixpanel("Comment Removed",{greeting_id:e.greeting_id,comment_id:e.comment_id}),ga_event_push("Comment Removed",{event_category:"Posts",event_label:"Comment Removed"});break;case 2:alice_signin_required()}})})):(alertify.set({labels:{ok:"否",cancel:"檢舉"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-flag-alt'></i> 檢舉這篇留言嗎？",function(a){if(!a){var o=new Date;hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.355700800":n,"entry.1270264487":i,"entry.1592095357":t.text(),"entry.1259076046":[o.getFullYear(),("0"+o.getMonth()).slice(-2),("0"+o.getDate()).slice(-2)].join("-"),"entry.124585191":check_browser()+", "+check_OS()})}).then(function(n){switch(n.Status){case 1:t.parent().css({opacity:.5}),msg("📝 已檢舉這篇留言"),hj_mixpanel("Comment Reported",{greeting_id:e.greeting_id,comment_id:e.comment_id}),ga_event_push("Comment Reported",{event_category:"Posts",event_label:"Comment Reported"})}})}}))}function alice_signin_required(){hj_update({action:"account_status"}).then(function(e){1===e.Status&&window.location.reload(!0)}),alice_signin_ask()}function alice_signin_ask(e){var t="//hearty.me/?r="+window.location.href.split("?")[0].replace(window.location.origin,"")+"#signin";e?window.top.location.href=t:(alertify.set({labels:{ok:"立即登入",cancel:"否"}}),alertify.confirm("<i class='fal fa-user-lock'></i> 登入以使用完整功能",function(e){e&&(window.top.location.href=t)}))}