"use strict";var btn_alias="home";function directory_scrolltop(e){var t=$(".directory");if(!e)return t.scrollTop();check_browser("Safari")?t.stop().animate({scrollTop:0},"slow"):t.stop().scrollTop(0)}function hj_alice_history_init(){"function"==typeof history.pushState&&(hj_alice_history_push(),window.addEventListener("popstate",function(){var e=$(".goodnight").scrollLeft();$(".goodnight .profile").is(":visible")?(profile_popup(),hj_alice_history_push()):0==$(".alice_inner [data-opinions][data-off]").length?(alice_opinions_toggle(),hj_alice_history_push()):directory_scrolltop()>50?(nav_toggle_goodnight(+(0==e)),hj_alice_history_push()):(directory_scrolltop(!0),hj_href("d")),null!=$("nav.menu").data("mmenu")&&$("nav.menu").data("mmenu").close()},!1))}function hj_alice_history_push(){history.pushState(null,document.title,location.href)}function nav_toggle_goodnight(e){var t=$(".goodnight");if(e=e||0,t.length>0){var a=t.width()*e;check_browser("Safari")?t.animate({scrollLeft:a},450):t.scrollLeft(a)}}function alice_opinions_toggle(e){var t=$(".alice_inner [data-quote]"),a=$(".alice_inner [data-opinions]"),i=a.find("ul");e||i.is(":hidden")?(a.removeAttr("data-off"),t.attr("data-blur",""),check_OS("Android")?i.fadeIn("fast"):i.slideDown("fast")):i.fadeOut("fast",function(){a.attr("data-off",""),t.removeAttr("data-blur")})}function alice_greeting_query(e){hj_update({action:"alice_greeting",greeting_id:e||""}).then(function(t){switch(t.Status){case 0:msg("<i class='fal fa-comment-exclamation'></i> æ‹è¬ï¼Œæ‰¾ä¸åˆ°é€™ç¯‡è²¼æ–‡å”·");break;case 1:t=t.Values,e=t.greeting_id;var a=$(".goodnight"),i=a.find("[data-opinions] ul");a.find("[data-quote]").attr({title:t.greeting}).find("img").attr({src:"//i0.wp.com/hearty.me/uploads/images/alice/"+t.greeting_image}).fadeTo("fast",1),document.title=t.greeting+" | ğŸ’ æº«åº¦æ—¥è¨˜ Hearty Journal",i.attr("title","è¦ªæ„›çš„ï¼Œ"+t.greeting_title).find(".opinions").slice(1).remove(),a.find(".comment").attr("data-greeting_id",e),t.comments.length>0&&i.find(".opinions:first").after(t.comments.map(function(e){return alice_greeting_comments(t,e)})),$(".directory_inner [data-greeting_id]").removeAttr("data-active").filter("[data-greeting_id='"+e+"']").attr("data-active","");var n=$(".profile [data-penpal_add]");31==e?(n.show(),hj_update({action:"signup_days"}).then(function(e){var t=parseInt(e.Values.signup_days||0);1==e.Status&&t<6&&(msg("<i class='far fa-user-check'></i> å—¨ï¼Œä»Šå¤©æ˜¯è¨»å†Šçš„ç¬¬ "+numberWithCommas(t+1)+"å¤©<br>ç­‰è¨»å†Šæ»¿ 7å¤©ã€é¤Šæˆè¦å¾‹æ—¥è¨˜ç¿’æ…£ï¼Œå†ä¾†äº¤ç­†å‹å§","ç¹¼çºŒåŠ æ²¹ <i class='fas fa-fist-raised'></i>",function(){alice_greeting_query()}),hj_mixpanel("Penpal_not_allowed"),ga_event_push("Penpal_not_allowed"))})):n.hide(),$("body").width()>=768&&alice_opinions_toggle(!0),"function"==typeof history.replaceState&&history.replaceState({},t.greeting_title,"/home?p="+e)}})}function alice_greeting_comments(e,t){var a=t.profile_image||"default.jpg";return $("<li>",{class:"opinions"}).html($("<div>",{class:"avatar",title:t.nickname,onclick:"profile_popup('"+t.username+"', '"+t.nickname+"', '"+a+"', '"+t.gender+"');","data-vip":t.is_vip}).css({"background-image":"url('//i0.wp.com/hearty.me/uploads/images/users/"+a+"'), url('//hearty.me/uploads/images/users/"+a+"')"}).add($("<div>",{class:"opinion",title:t.comment,"data-user":t.nickname}).text(htmlDecode(t.comment)).append($("<a>",{onclick:"alice_comment_toggle(this.dataset, $(this).parent());","data-greeting_id":e.greeting_id,"data-comment_id":t.comment_id,"data-comment_own":t.comment_own}))))}function alice_greeting_comment(e){var t=$(".goodnight [data-opinions]"),a=t.find(".comment input"),i=a.val()||"";if(t.find("[data-comment_own='1']").length>1)msg("<i class='fal fa-comment-lines'></i> ç‚ºé¿å…æ´—ç‰ˆï¼Œæ¯äººåƒ…èƒ½æ–¼ä¸€ç¯‡è²¼æ–‡ä¸­ç•™è¨€ 2å‰‡ã€‚æ‚¨å¯åˆªé™¤æˆ–ä¿®æ”¹ä¹‹å‰çš„å›è¦†"),shake(a);else if(i.length>3){if(a.val(""),banned_words(i))return hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.355700800":e,"entry.1270264487":"å·²å°é–","entry.1592095357":i.trim(),"entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}),msg("<i class='fal fa-exclamation-triangle'></i> ç•™è¨€å…§å®¹ä¸ç¬¦è¦å®šï¼Œé•è¦å°‡è‡´å¸³è™Ÿåœæ¬Šï¼Œè«‹éµå®ˆ <a target='_blank' href='//faq.hearty.me/tutorial/public_diaries'>[æŠ•ç¨¿è¦ç¯„]</a>"),!1;hj_update({action:"alice_greeting_comment",greeting_id:e,comment:i}).then(function(n){switch(n.Status){case 1:n=n.Values,t.scrollTop(0).find(".opinions:first").after(alice_greeting_comments({greeting_id:e},{username:n.username,nickname:n.nickname,profile_image:n.profile_image,gender:n.gender,comment_id:n.comment_id,comment_own:1,comment:i})),"share"in navigator&&(alertify.set({labels:{ok:"<i class='fas fa-share-alt'></i> å¥½ï¼Œåˆ†äº«çµ¦ä»–",cancel:"å¦"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-check-circle'></i> ç•™è¨€å®Œæˆï¼Œåˆ†äº«é€™ç¯‡çµ¦æœ€å¥½çš„æœ‹å‹å—ï¼Ÿ",function(e){if(e){var t=location.href.replace(location.host,"hearty.app");t=(t.indexOf("?")>0?"&":"?")+"st=Alice èªªæ™šå®‰",navigator.share({title:document.title,url:t}).then(()=>{console.log("Link shared")}).catch(e=>{console.log("Error ",e)})}})),hj_mixpanel("Comment",{greeting_id:e}),ga_event_push("Comment",{event_category:"Posts",event_label:"Comment"}),fb_event_push(!0,"Comment");break;case 2:a.val(i),alice_signin_required()}}).fail(function(){a.val(i),shake(a)})}else msg("<i class='fal fa-comment-lines'></i> å°æé†’ï¼šç•™è¨€è‡³å°‘ 4å€‹å­—ï¼Œå…§å®¹éœ€èˆ‡ç‰ˆä¸Šä¸»é¡Œç›¸é—œ"),shake(a)}function alice_comment_toggle(e,t){var a=Number(e.greeting_id),i=Number(e.comment_id);"1"==e.comment_own?(alertify.set({labels:{ok:"å¦",cancel:"<i class='fas fa-pencil'></i> ç·¨è¼¯"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-edit'></i> ä¿®æ”¹é€™å‰‡ç•™è¨€å—ï¼Ÿ",function(a){a||hj_update({action:"alice_greeting_comment_delete",comment_id:i}).then(function(a){switch(a.Status){case 1:var i=$(".comment input");i.val((t.text()+" "+(i.val()||"")).trim()).focus(),t.parent().slideUp(400,function(){$(this).remove()}),hj_vibrate(80),hj_mixpanel("Comment Removed",{greeting_id:e.greeting_id,comment_id:e.comment_id}),ga_event_push("Comment Removed",{event_category:"Posts",event_label:"Comment Removed"}),fb_event_push(!0,"Comment Removed");break;case 2:alice_signin_required()}})})):(alertify.set({labels:{ok:"å¦",cancel:"<i class='fas fa-check-circle'></i> é€å‡º"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-flag-alt'></i> æª¢èˆ‰é€™ç¯‡ç•™è¨€å—ï¼Ÿ",function(n){n||hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.355700800":a,"entry.1270264487":i,"entry.1592095357":(t.text()||"").trim(),"entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}).then(function(a){switch(a.Status){case 1:t.parent().css({opacity:.5}),msg("ğŸ“ å·²æª¢èˆ‰é€™ç¯‡ç•™è¨€ï¼Œå°‡ç”±æº«åº¦å°ç·¨é€²ä¸€æ­¥å¯©æ ¸"),hj_mixpanel("Comment Reported",{greeting_id:e.greeting_id,comment_id:e.comment_id}),ga_event_push("Comment Reported",{event_category:"Posts",event_label:"Comment Reported"}),fb_event_push(!0,"Comment Reported")}})}))}function alice_signin_required(){hj_update({action:"account_status"}).then(function(e){1===e.Status&&location.reload(!0)}),alice_signin_ask()}function alice_signin_ask(e){var t="?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+"#signin";e?hj_href(t):(alertify.set({labels:{ok:"<i class='fas fa-door-open'></i> ç«‹å³ç™»å…¥",cancel:"å¦"}}),alertify.confirm("<i class='fal fa-user-lock'></i> ç™»å…¥ä»¥ç•™è¨€",function(e){e&&hj_href(t)}))}function profile_popup(e,t,a,i){var n=$(".goodnight .profile");null==e?n.fadeOut("fast"):(n.find(".avatar").css("background-image","url('//i0.wp.com/hearty.me/uploads/images/users/"+a+"')"),n.find("[data-u]").attr({title:e}),n.find("[data-n]").attr({title:t,"data-gender":i}),n.find("[data-link]").attr({"data-username":e,"data-nickname":t}),n.find("[data-penpal_add]").attr({"data-username":e}),n.fadeIn("fast"))}function penpal_waitlist(){try{check_hjapp("Android")?penpal_waitlist_redirect():($(".mask").show(),hj_fcm_init(penpal_waitlist_redirect))}catch(e){penpal_waitlist_redirect()}}function penpal_waitlist_redirect(){$(".mask").hide(),alice_greeting_query(31),alice_opinions_toggle()}function penpal_add(e){alertify.set({labels:{ok:"<i class='fas fa-paw-claws'></i> å‰å¾€äº¤æ›æ—¥è¨˜",cancel:"å¦"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-user-edit'></i> å°‡ã€Œ<b>"+e+"</b>ã€åŠ ç‚ºç­†å‹å—ï¼Ÿ<br><i class='fal fa-info-circle'></i> ç‚ºä¿éšœäº¤æµå“è³ªï¼Œè‡³å¤šåƒ…èƒ½åŠ å…¥ 2ä½ç­†å‹",function(t){t&&hj_href("d?penpal_add="+e)})}function account_prefilling(){var e=getUrlPara("u");e&&!getcookie("hearty_account")&&setcookie("hearty_account",e,90)}function banned_words(e){return/http|www.|å¹¹ä½ |å¤–(é€èŒ¶|ç´„)|(ç´„|æ­£)å¦¹|line|åŠ è³´|å¾®ä¿¡|(æ€§|åš|æ„›)æ„›|(æ‰“|ç´„)(ç‚®|ç ²)|(å…¨|åŠ|ç„¡)å¥—|å£(äº¤|çˆ†)|(æ€§|æ´|è‚›)äº¤|ä¸€å¤œæƒ…|å¥³å„ª|(å«|æ‰¾)å°å§|(æ˜¥|å£¯é™½)è—¥|æŒä¹…æ¶²|æ—©æ´©|é™½ç—¿/.test((e||"").toLowerCase())}!function(e){e(document).ready(function(){post_font(),alice_greeting_query(getUrlPara("p")),img_cdn_fallback(),hj_localize_cn(),hj_alice_history_init(),account_prefilling();var t={top:e(".directory .nav_btn[data-top]"),left:e(".directory .nav_btn[data-left]")};t.top.hide(),e(".directory").scroll(function(){e(this).scrollTop()>200?t.left.stop().fadeOut("fast",function(){t.top.stop().fadeIn()}):t.top.stop().fadeOut("slow",function(){t.left.stop().fadeIn()})}),e(".mh-head .left").on("click",function(){nav_toggle(e(".menu"),!0)}),e(".profile").on("click",function(){profile_popup()}).find("ul").on("click",function(e){e.stopPropagation()}).find("[data-link]").on("click",function(){window.open(location.origin+"/"+this.dataset.username,"_blank"),profile_popup()}),e(".profile .avatar").on("click",function(){e(".profile [data-link]").click()}),e(".profile [data-penpal_add]").on("click",function(){penpal_add(this.dataset.username)})})}(jQuery),leave_InAppBrowser(),window.addEventListener("resize",()=>{nav_toggle_goodnight(0)},{passive:!0});