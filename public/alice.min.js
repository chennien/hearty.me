"use strict";var btn_alias="home";function user_verify(a){return a&&msg('<i class="far fa-info-circle"></i> '+_h("A-verify-0"),'<i class="fas fa-address-card"></i> '+_h("A-verify-1"),function(){hj_href("account")}),parseInt($("body").attr("data-verified"))>1}function directory_scrolltop(b){var a=$(".directory");if(!b)return a.scrollTop();check_browser("Safari")?a.stop().animate({scrollTop:0},"slow"):a.stop().scrollTop(0)}function hj_alice_history_init(){"function"==typeof history.pushState&&(hj_alice_history_push(),window.addEventListener("popstate",function(){var a=$(".goodnight").scrollLeft();$(".goodnight .profile").is(":visible")?(profile_popup(),hj_alice_history_push()):0==$(".alice_inner [data-opinions][data-off]").length?(alice_opinions_toggle(),hj_alice_history_push()):directory_scrolltop()>50?(nav_toggle_goodnight(+(0==a)),hj_alice_history_push()):(directory_scrolltop(!0),hj_href("d")),null!=$("nav.menu").data("mmenu")&&$("nav.menu").data("mmenu").close()},!1))}function hj_alice_history_push(){history.pushState(null,document.title,location.href)}function nav_toggle_goodnight(b){var a=$(".goodnight");if(b=b||0,a.length>0){var c=a.width()*b;check_browser("Safari")?a.animate({scrollLeft:c},450):a.scrollLeft(c)}}function alice_opinions_toggle(c){var d=$(".alice_inner [data-quote]"),b=$(".alice_inner [data-opinions]"),a=b.find("ul");c||a.is(":hidden")?(b.removeAttr("data-off"),d.attr("data-blur",""),check_OS("Android")?a.fadeIn("fast"):a.slideDown("fast")):a.fadeOut("fast",function(){b.attr("data-off",""),d.removeAttr("data-blur")})}function alice_greeting_query(a){hj_update({action:"alice_greeting",greeting_id:a||""}).then(function(b){switch(b.Status){case 0:alice_greeting_query(),msg('<i class="fal fa-comment-exclamation"></i> '+_h("A-no_post"));break;case 1:a=(b=b.Values).greeting_id;var c=$(".goodnight"),d=c.find("[data-opinions] ul");c.find("[data-quote]").attr({title:b.greeting}).find("img").attr({src:"//i.hearty.app/a/"+b.greeting_image+(webp_support()?"":"?o=1")}).fadeTo("fast",1),document.title=b.greeting+" :: "+_h("A-title")+" | \u{1F49D} Hearty Journal \u6EAB\u5EA6\u65E5\u8A18",d.attr({title:"\u89AA\u611B\u7684\uFF0C"+b.greeting_title,"data-url":b.greeting_url||""}).find(".opinions").slice(1).remove(),c.find(".comment").attr("data-greeting_id",a),b.comments.length>0&&d.find(".opinions:first").after(b.comments.map(function(a){return alice_greeting_comments(b,a)})),$(".directory_inner [data-greeting_id]").removeAttr("data-active").filter("[data-greeting_id='"+a+"']").attr("data-active","");var e=$(".profile [data-penpal_add],.profile [data-link]");31==a?(e.show(),hj_update({action:"signup_days"}).then(function(b){var a=parseInt(b.Values.signup_days||0);1==b.Status&&a<6&&(msg('<i class="far fa-user-check"></i> '+_h("A-penpal_guest-0",{$day:numberWithCommas(++a),$th:nth(a)}),_h("A-penpal_guest-1")+' <i class="fas fa-fist-raised"></i>',function(){alice_greeting_query()}),hj_mixpanel("Penpal_not_allowed"),ga_event_push("Penpal_not_allowed"))})):e.hide(),$("body").width()>=768&&alice_opinions_toggle(!0),"function"==typeof history.replaceState&&history.replaceState({},b.greeting_title,"/home?g="+a)}})}function alice_greeting_comments(b,a){return a.profile_image=webp_profile_image(a.profile_image),$("<li>",{class:"opinions",html:$("<div>",{class:"avatar",title:a.nickname,onclick:"profile_popup('"+a.username+"','"+a.nickname+"','"+a.profile_image+"','"+a.gender+"')","data-vip":a.is_vip}).css({"background-image":"url("+a.profile_image+")"}).add($("<div>",{class:"opinion",title:a.comment,"data-user":a.nickname}).text(htmlDecode(a.comment)).append($("<a>",{onclick:"alice_comment_toggle(this.dataset,$(this).parent())","data-greeting_id":b.greeting_id,"data-comment_id":a.comment_id,"data-comment_own":a.comment_own})))})}function alice_greeting_comment(c){var d=$(".goodnight [data-opinions]"),b=d.find(".comment textarea"),a=(b.val()||"").trim().replace(/[\r\n]{2,}/g,"\n");if(d.find("[data-comment_own='1']").length>1)msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-0")),shake(b);else if(a.length>200)msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-1",{$chars:a.length})),shake(b);else if(a.length>2){if(b.val("").css({height:"auto"}),banned_words(a))return report_abuse("\u5DF2\u62D2\u767B",c,"",a),msg('<i class="fal fa-exclamation-triangle"></i> '+_h("A-comment_ban-0")+" <a target='_blank' href='//faq.hearty.me/tutorial/public_diaries'>["+_h("A-comment_ban-1")+"]</a>"),!1;hj_update({action:"alice_greeting_comment",greeting_id:c,comment:a}).then(function(e){switch(e.Status){case 1:e=e.Values,d.scrollTop(0).find(".opinions:first").after(alice_greeting_comments({greeting_id:c},{username:e.username,nickname:e.nickname,profile_image:e.profile_image,gender:e.gender,comment_id:e.comment_id,comment_own:1,comment:a})),hj_mixpanel("Comment",{greeting_id:c}),ga_event_push("Comment",{event_category:"Posts",event_label:"Comment"}),fb_event_push(!0,"Comment");break;case 2:b.val(a),alice_signin_required()}}).fail(function(){b.val(a),shake(b)})}else msg('<i class="fal fa-comment-lines"></i> '+_h("A-comment_limit-2")),shake(b)}function hj_share_page(){var a=$(".alice_inner [data-opinions] ul").attr("data-url")||"";a?a="https://hj.rs/"+a:(a=location.href.replace(location.host,"hearty.app"),a+=(a.indexOf("?")>0?"&":"?")+"st=Alice%20%E8%AA%AA%E6%99%9A%E5%AE%89"),/iOS|Android/i.test(check_hjapp())?location.assign("//hearty.me/wv?s="+encodeURIComponent(a.replace(/(^\w+:|^)\/\//,""))):is_touch_device()&&"share"in navigator?navigator.share({title:document.title,url:a}).catch(function(a){}):(alertify.set({labels:{ok:_h("A-url-2")+' <i class="fas fa-qrcode"></i>',cancel:'<i class="fas fa-copy"></i> '+_h("A-url-0")},buttonReverse:!0}),alertify.prompt('<i class="fal fa-link"></i> '+_h("A-url-1")+'<br><br><a class="qrcode"></a>',function(a){a?$("#alertify .qrcode").get(0).click():hj_copy($("#alertify .alertify-text"))},a),alertify_input_custom({type:"url",inputmode:"none",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy"}),hj_copy_text(a),get_qrcode($("#alertify .qrcode"),a))}function alice_comment_toggle(a,b){var c=Number(a.greeting_id),d=Number(a.comment_id);"1"==a.comment_own?(alertify.set({labels:{ok:_h("A-no"),cancel:'<i class="fas fa-pencil"></i> '+_h("A-comment_edit-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-edit"></i> '+_h("A-comment_edit-0"),function(c){c||hj_update({action:"alice_greeting_comment_delete",comment_id:d}).then(function(d){switch(d.Status){case 1:var c=$(".comment input");c.val((b.text()+" "+(c.val()||"")).trim()).focus(),b.parent().slideUp(400,function(){$(this).remove()}),hj_vibrate(30),hj_mixpanel("Comment Removed",{greeting_id:a.greeting_id,comment_id:a.comment_id}),ga_event_push("Comment Removed",{event_category:"Posts",event_label:"Comment Removed"}),fb_event_push(!0,"Comment Removed");break;case 2:alice_signin_required()}})})):account_status().then(function(e){1==e.Status?(alertify.set({labels:{ok:_h("A-no"),cancel:'<i class="fas fa-check-circle"></i> '+_h("A-report_ask-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-flag-alt"></i> '+_h("A-report_ask-0"),function(e){e||report_abuse("\u906D\u6AA2\u8209",c,d,b.text()).then(function(c){1===c.Status&&(b.parent().css({opacity:.5}),msg("\u{1F4DD} "+_h("A-report_ask-2")),hj_mixpanel("Comment Reported",{greeting_id:a.greeting_id,comment_id:a.comment_id}),ga_event_push("Comment Reported",{event_category:"Posts",event_label:"Comment Reported"}),fb_event_push(!0,"Comment Reported"))})})):msg('<i class="fal fa-door-open"></i>'+_h("A-signin-2"))})}function report_abuse(a,b,c,d){return hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.527303026":"\u8AAA\u665A\u5B89\u7559\u8A00 ("+(a||"")+")","entry.355700800":b||"","entry.1270264487":c||"","entry.1592095357":(d||"").trim(),"entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})})}function alice_signin_required(){hj_update({action:"account_status"}).then(function(a){1===a.Status&&location.reload(!0)}),alice_signin_ask()}function alice_signin_ask(a){var b="?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+"#signin";a?hj_href(b):(alertify.set({labels:{ok:'<i class="fas fa-door-open"></i>'+_h("A-signin-0"),cancel:_h("A-no")}}),alertify.confirm('<i class="fal fa-user-lock"></i> '+_h("A-signin-1"),function(a){a&&hj_href(b)}))}function profile_popup(b,c,d,e){var a=$(".goodnight .profile");null==b?a.fadeOut("fast"):(a.find(".avatar").css({"background-image":"url("+d+")"}),a.find("[data-n]").attr({title:c,"data-gender":e}),a.find("[data-link]").attr({"data-username":b,"data-nickname":c}),a.find("[data-penpal_add]").attr({"data-username":b}),a.fadeIn("fast"))}function penpal_waitlist(){if(user_verify())try{check_hjapp("Android")?penpal_waitlist_redirect():($(".mask").show(),hj_fcm_init(penpal_waitlist_redirect))}catch(a){penpal_waitlist_redirect()}else user_verify(!0)}function penpal_waitlist_redirect(){$(".mask").hide(),alice_greeting_query(31),alice_opinions_toggle()}function penpal_add(a){alertify.set({labels:{ok:'<i class="fas fa-paw-claws"></i> '+_h("A-penpal_add-2"),cancel:_h("A-no")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-user-edit"></i> '+_h("A-penpal_add-0",{$id:a})+'<br><i class="fal fa-info-circle"></i> '+_h("A-penpal_add-1"),function(b){b&&hj_href("d?penpal_add="+a)})}function account_prefilling(){var a=getUrlPara("a");a&&!getcookie("hearty_account")&&setcookie("hearty_account",a,90)}function banned_words(a){return/http|www.|幹你|外(送茶|約)|(約|正)妹|line|加賴|微信|(性|做|愛)愛|(打|約)(炮|砲)|(全|半|無)套|口(交|爆)|(性|援|肛)交|一夜情|女優|(叫|找)小姐|(春|壯陽)藥|持久液|早洩|陽痿|\s+(fuck|shit|bitch|asshole|dick)/gi.test(a||"")}!function($){$(document).ready(function(){post_font(),alice_greeting_query(getUrlPara("g")),hj_localize_cn(),hj_alice_history_init(),account_prefilling();var b={top:$(".directory .nav_btn[data-top]"),left:$(".directory .nav_btn[data-left]")};b.top.hide(),$(".directory").scroll(function(){$(this).scrollTop()>200?b.left.stop().fadeOut("fast",function(){b.top.stop().fadeIn()}):b.top.stop().fadeOut("slow",function(){b.left.stop().fadeIn()})}),$(".mh-head .left").on("click",function(){nav_toggle($(".menu"),!0)}),$(".alice").find(".tabs,[data-opinions] ul").on("click",function(a){a.stopPropagation()});var a=$(".profile");a.on("click",function(){profile_popup()}).find(".avatar").on("click",function(){a.find("[data-link]:visible").click()}),a.find(".profile_btns").on("click",function(a){a.stopPropagation()}).find("[data-link]").on("click",function(){open_url(location.origin+"/"+this.dataset.username+"?feed=1")}),a.find("[data-penpal_add]").on("click",function(){penpal_add(this.dataset.username)});var c=$(".alice_inner [data-opinions] textarea").autogrow();user_verify()||c.on("click",function(){user_verify(!0)}).attr({readonly:""})})}(jQuery),leave_InAppBrowser(),window.addEventListener("resize",function(){nav_toggle_goodnight(0)},{passive:!0})