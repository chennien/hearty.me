"use strict";var timer,hj_editor_loaded=!0;function URL_handling(){getUrlPara("first")?hj_firstrun():getUrlPara("preview")?$(".mh-head,.btn_feedback").hide():getUrlPara("purchased")||getUrlPara("iap")?hj_after_purchase():getUrlPara("img")&&post_create().then(function(){post_picture(!0)});var e=getUrlPara("link");switch(e&&(location.href="//"+e+(e.indexOf("wv?o=")>0?"":(e.indexOf("?")>0?"&":"?")+"wvtab=1")),Number(getUrlPara("plans"))){case 1:hj_upgrade_toggle(!0);break;case 2:pricing(!0);break;case 3:pricing(!0),ga_evt_push("remove_from_cart"),fb_evt_push("RemoveFromCart")}var t=getUrlPara("penpal_add");t&&(post_penpal_add(t),popup_toggle(!0,"share"));var a=getUrlPara("f");if(a&&(hj_feedback_toggle(!0),parseInt(a)>1&&hj_feedback_form(!0)),"push"==getUrlPara("utm_source")&&$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog[data-mobile]"),!0),get_gift_stickers_init(),!check_hjapp())try{var i=new URL(location.href);["purchased","iap","preview","plans","f"].forEach(function(e){getUrlPara(e)&&i.searchParams.delete(e)}),"function"==typeof history.replaceState&&history.replaceState({},document.title,i.pathname+i.search)}catch(n){}}function hj_firstrun(){$(".tutorial").length>0&&(popup_toggle(!0,"tutorial"),hj_tutorial("init"))}function hj_tutorial(e){var t=$(".tutorial_slider");if(!t.length)return!1;switch(e){case"init":(t=t.not(".slick-initialized")).find("img").filter("[data-"+($("body").width()>1024?"mobile":"desktop")+"]").remove(),t.slick({infinite:!1,arrows:!is_touch_device(),dots:!0,draggable:!0,swipe:!0,touchMove:!0,adaptiveHeight:!0,speed:200,centerPadding:"0px",dotsClass:"dots",prevArrow:'<div class="tutorial_arrow fal fa-chevron-left"></div>',nextArrow:'<div class="tutorial_arrow fal fa-chevron-right" onclick="hj_tutorial(\'forward\')"></div>'}).on("edge",function(){hj_tutorial("finish")}).on("wheel",function(e){e.preventDefault(),$(this).slick("slick"+(e.originalEvent.deltaY<0?"Next":"Prev"))}),t.find("img").on("click",function(){hj_tutorial("next")}),$(".popup-underlayer").attr({onclick:"hj_tutorial('finish')"});break;case"next":hj_tutorial("forward"),t.slick("slickNext");break;case"forward":t.slick("slickCurrentSlide")+1==t.find("img").length&&hj_tutorial("finish");break;case"finish":whats_your_name(),popup_toggle(!1,"tutorial"),t.slick("unslick").add(".tutorial").remove()}}function whats_your_name(e){e=e||"",alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-ok-0"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-smile-wink"></i> '+_h("e-name-1"),function(e,t){e?(t=(t||"").trim()).length>0?(hj_update({action:"profile_update",field:"nickname",data:t}),$(".hj_user .name").attr("data-text",t),alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-name-4"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.confirm('<i class="far fa-flower"></i> '+_h("e-name-2",{$name:t})+"<br>"+_h("e-name-3"),function(e){e&&hj_fcm_init(),free_trial_activate()})):(whats_your_name(),alertify_input_shake()):free_trial_activate()},(e||"").toString()),alertify_input_custom({placeholder:_h("e-name-0"),autocomplete:"on",maxlength:20},{"letter-spacing":"4px"})}function get_gift_stickers_init(){"User_Reactive"==getUrlPara("utm_campaign")?window.hj_login?get_gift_stickers():(popup_toggle(!0,"notice_gift"),get_gift_stickers_stats("gift_notice")):getUrlPara("gift")&&get_gift_stickers()}function get_gift_stickers(){if(window.hj_login)msg('<i class="far fa-gift-card"></i> '+_h("e-get_stickers-0")+' <i class="far fa-grin-wink"></i>',_h("e-get_stickers-1"),function(){nav_toggle($(".stickerbook"),!0),get_gift_stickers_stats("toggle_stickerbook")});else{get_gift_stickers_stats("signin_redirect");var e=getcookie("hearty_account")||getUrlPara("a")||"";hj_href("?r=/"+(hj_writer||"")+"？gift=1"+(e=e?"&account="+e:"")+"#signin")}}function get_gift_stickers_stats(e){gform_post("1FAIpQLSd2vEj_DmNKt2_6K_X99NJZh4JtEzQ7eu49mXwpmnOelaZmFw",{"entry.355700800":getUrlPara("utm_medium")||"","entry.1270264487":e||"","entry.783049182":getcookie("hearty_id"),"entry.866865386":getcookie("hearty_account")||getUrlPara("a")||"[hj_username]","entry.1497216280":getcookie("hearty_em"),"entry.124585191":check_browser()+", "+check_OS(),"entry.1259076046":today(8)})}function network_watch(){window.addEventListener("online",function(){network_status(["offline"],!1)},{passive:!0}),window.addEventListener("offline",function(){network_status(["offline"],!0)},{passive:!0}),"connection"in navigator&&(navigator.connection.addEventListener("change",network_watch_speed),network_watch_speed())}function network_watch_speed(){network_status(["slow"],/2g/.test(navigator.connection.effectiveType))}function battery_watch(){if("battery"in navigator)battery_watch_handle(navigator.battery);else if("getBattery"in navigator)try{navigator.getBattery().then(battery_watch_handle)}catch(e){}}function battery_watch_handle(e){battery_watch_level(e),e.onlevelchange=function(){battery_watch_level(e)}}function battery_watch_level(e){var t=parseFloat((100*e.level).toFixed(2));return t<20&&($(".warning-underlayer[data-issue='battery'] > div").attr("data-battery",t),network_status(["battery"],!0)),t}function hj_idle(){var e=$(".editor_toolbelt"),t=$(".screenlock"),a=!is_touch_device()&&current_post().editable;function i(){hj__cache({set:!0,bucket:"hearty_idle",data:0}),a&&e.slideDown("normal")}$(document).on("mousemove keypress",i),$("#editor_editable").on("keydown",i),i(),setInterval(function(){var i=Number(hj__cache({bucket:"hearty_idle"}));switch(hj__cache({set:!0,bucket:"hearty_idle",data:++i}),!0){case 4==i&&autosave_the_change():break;case 8==i&&a&&e.is(":visible"):e.slideUp("slow");break;case 60==i&&screenlock("status")&&t.is(":hidden"):screenlock(!0)}},1e3)}function hj_editor_history_init(){"function"==typeof history.pushState&&(history.pushState(null,document.title,location.href),window.addEventListener("popstate",function(){var e=hj_editor_history("load");if(null!=e){var t=$("#editor_editable");switch(!0){case/^\d+$/.test(e):post_query(e,!0);break;case e.indexOf("editable_blur")>0:t.blur();case e.indexOf("popup_toggle")>0:(e=e.split("]",2).slice(-1)[0]).length>0&&popup_toggle(!1,e);case e.indexOf("editable_focus")>0:t.get(0).focus({preventScroll:!1})}}else $("nav:visible").length||open_book(!1),history.pushState(null,document.title,location.href);$("nav").each(function(){null!=$(this).data("mmenu")&&$(this).data("mmenu").close()})},!1))}function hj_editor_history(e,t){if("function"==typeof history.pushState){var a="hearty_editor_history",i=JSON.parse(hj__cache({bucket:a}))||[];switch(e){case"load":t=i.pop();break;case"add":history.pushState(null,document.title,location.href),i.push(t);break;case"detach":i=i.filter(e=>e!==t)}return hj__cache({set:!0,bucket:a,data:JSON.stringify(i)}),t}}function editor_enable(e){e=e||current_post().editable||!1;var t=$(".bk-page #editor_editable"),a=t.data("editor_loaded")||!1,i=$(".frame").find(".fa-video-plus,.fa-camera-alt").add(".hj_rmenu li[data-editing]");e?(a||(editable__initialize(),hj_idle(),screenlock("initialize",pincode||""),hj_getScript_gh({path:"public/jquery.uploadfile.min.js"},image_uploader_initialize),t.data({editor_loaded:!0}),$(".editor_toolbelt .kit.save").on("mouseover",save_btn)),sticker__list(),editor_focus_zoomin(),i.add($(".image-zoom:not([data-gallery_id='0']) .img_btns")).slideDown()):(sticker__list(!1),i.add($(".image-zoom .img_btns")).slideUp()),t.prop("contenteditable",e),toolbelt_toggle(e),window.hj_username?hj_username!=hj_writer?toast_signin(_h("e-welcome-1")):0>(document.referrer||"https://hearty.me").indexOf("hearty.me")&&toast_signin(_h("e-welcome-0",{$name:hj_username})):toast_signin()}function toast_signin(e){$(".toast_signin_reminder").attr({title:e||_h("e-welcome-2")}).fadeIn("fast").delay(5e3).queue(function(){$(this).remove().dequeue()})}function vip_init(){var e=hj_membership()[0];if(e){var t=$(".popup.feedback input[name='ver']");t.filter("[data-ver='vip']").prop({checked:!0,disabled:!1}),t.filter("[data-ver='free']").prop({checked:!1,disabled:!0}),$(".mm-panel [data-vip='0']").remove()}return e}function vip_fn(e){var t=current_post();if(t.vip)switch(e){case"picture":t.editable&&post_picture();break;case"video":t.editable&&hj_video("update");break;case"catalog_search":catalog_search();break;case"post_attr":t.editable&&popup_toggle(!0,"post_attr");break;case"screenshot":hj_screenshot()}else hj_upgrade_toggle(!0);return t.vip}function hj_rmenu_init(e){var t=$(".hj_rmenu");!is_touch_device()&&t.length>0&&(e.get(0).addEventListener("contextmenu",function(t){hj_rmenu_toggle(t,!0,e)},{passive:!1}),t.get(0).addEventListener("mouseleave",function(t){hj_rmenu_toggle(t,!1,e)},{passive:!0}))}function hj_rmenu_toggle(e,t,a){var i=$(".hj_rmenu");t?(e.preventDefault(),i.css({top:Math.min(e.clientY,a.height()-i.height()-30)+"px",left:Math.min(e.clientX,a.width()-i.width()-30)+"px"}).show()):i.fadeOut("slow")}function datepicker_init(){$("<link>",{rel:"stylesheet",href:hj_jsdelivr()+"public/jquery.ui.datepicker.custom.min.css"}).appendTo("head"),/zh/i.test(hj_lang())?hj_getScript_gh({path:"public/safari.datepicker.tw.min.js"},datepicker_load):datepicker_load()}function datepicker_load(){var e=$(".post_attr #post_created"),t=new Date().getFullYear();return e.attr({type:"text"}).datepicker({changeYear:!0,changeMonth:!0,yearRange:t-20+":"+t,yearSuffix:_h("e-year"),dateFormat:"yy-mm-dd",showAnim:"slideDown",minDate:e.attr("min")||"",maxDate:e.attr("max")||""}).on("click",function(){$(this).datepicker("show")})}function editor_include_once(){var e=$("#editor_editable");new MutationObserver(function(e){e.forEach(saved)}).observe(e.get(0),{characterData:!0,subtree:!0}),e.get(0).addEventListener("paste",saved,{passive:!0}),autosaver_30s(),document.addEventListener("visibilitychange",function(){document.hidden&&autosave_the_change()},{passive:!0}),check_OS("iOS")&&current_post().editable&&window.addEventListener("pagehide",post_revise,!1),(check_OS("iOS")||check_browser("Safari"))&&datepicker_init(),vip_init(),catalog_init();var t=$(".mh-head .left");t.find(".fa-home-alt").on("click",function(){nav_toggle($(".menu"),!0),open_book(!1)}),t.find(".btn_catalog").on("click",function(){open_book(!0),nav_toggle($(".catalog"),!0)}),$(document).on("click",".bk-page figure",function(){var e=parseInt($(this).attr("data-gallery_id"))||0;e>0&&($(".image-zoom").attr({"data-gallery_id":e}).find("img").attr({src:"//hearty.me/i/"+e+"?r="+($(this).data("rotated")||0),"data-r":""}).show(),post_picture_filter($(this).data("cssgram")||0,$(this).add(".image-zoom div")),$(".bk-page .pictures.slick-initialized").slick("slickPause"))}),$(".bk-page .pictures").on("click",function(){popup_toggle(!0,"image-zoom"),$(".image-zoom img").fadeIn()}),$(".image-zoom").on("click",function(){$(this).fadeOut(),bk_blur(!1)}).find("img").on("click",function(e){var t=$(".bk-page .pictures.slick-initialized");t.length>0&&(t.slick("slickNext").find(".slick-active").click(),$(this).fadeTo("fast",.2,function(){$(this).fadeTo("normal",1)}),e.stopPropagation())});var a=$(".image-zoom .img_btns");if(a.find("[data-rotate]").on("click",post_picture_rotate),a.find("[data-cssgram]").on("click",post_picture_cssgram),a.find("[data-remove]").on("click",post_picture_remove),a.find("[data-download]").on("click",function(){post_picture_download($(this).find("a"))}),$(".screenlock input").on("focus",function(){$(this).val("")}).on("keyup",function(){screenlock("next",[$(this),this.value])}),check_hjapp()&&$(".kit.fa-expand-wide").remove(),getcookie("hearty_rated")&&$(".notifications li[data-notification_id='6']").remove(),/zh/i.test(hj_lang())||$(".privacy_selector [data-publish]").remove(),check_OS("Android")&&"wakeLock"in navigator)try{navigator.wakeLock.request("screen")}catch(i){}}function editor_editable_scroll_to_bottom(e,t){if(is_touch_device()&&13==e.keyCode){var a=$(".bk-page"),i=window.getSelection().getRangeAt(0),n=document.createRange(),r=Number(a.find("#editor_editable").height());n.selectNodeContents(t),n.setStart(i.endContainer,i.endOffset),n.cloneContents().textContent.toString().length<2&&(check_OS("iOS")?$("body").scrollTop(r-(window.screen.availHeight>=812?333:258)):a.scrollTop(r))}}function hj_fontresize(e,t){(t=t||$(".bk-page").find("#subject,#editor_editable")).css("font-size",parseInt(t.css("font-size")||16)+e)}function toolbelt_toggle(e){var t=$(".btn_stickerbook"),a=$(".editor_toolbelt");e?(t.show(),a.removeClass("off")):(t.hide(),a.addClass("off"))}function toolbelt_btn_clicked(e){null!=e&&e.fadeTo("fast",.3,function(){$(this).delay(1e3).fadeTo("normal",1)})}function sticker__draggable_handle(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img"),n=$("#editor").width(),r=$(".bk-page").scrollTop()||0,s=$("#editor").get(0).offsetTop,o=a.position().top+r-s,l=a.get(0).offsetLeft,c=n-(l+i.width())-30;return c>0&&i.length>0&&(c=Math.max(0,Math.ceil(c+i.width()-i.get(0).getBoundingClientRect().width))),{pos:{top:o,left:l,right:c,align_right:l+a.width()/2>Math.floor(n/2)?1:0},overflow:{top:o>0,left:l>0,right:c>0}}}function sticker__editor_hotkeys(e,t,a){$(document).off("keydown"),e&&$(document).on("keydown",function(e){e.preventDefault();var i=$(".bundle .asset[data-asset_id='"+a+"']"),n={top:parseInt(i.css("top"))||0,left:parseInt(i.css("left"))||0},r=Object.assign({},n);switch(e.keyCode){case 13:case 27:case 32:sticker__paste({bundle_id:t,asset_id:a},!0);case 37:r.left-=15;break;case 38:r.top-=15;break;case 39:r.left+=15;break;case 40:r.top+=15;break;case 8:case 46:sticker__remove({bundle_id:t,asset_id:a})}var s=sticker__draggable_handle(t,a);s.overflow.left?s.overflow.right?s.overflow.top?sticker__update(t,a,"position",s.pos):r.top=n.top+15:r.left=n.left-15:r.left=5,i.animate(r,25);var o=parseInt(i.get(0).offsetTop-2*$(".bk-page").height()/5);o<$(".bk-page").height()+100&&$(".bk-page").animate({scrollTop:o},60)})}function scheduled_maintenance(e,t){var a=timestamping();e?2==(t=t||[]).length&&a>t[0]&&a<t[1]&&network_status(["maintenance"],!0):(t=new Date(1e3*(t||3600*Math.ceil(a/3600))).toLocaleString(hj_lang(),{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Taipei"}),msg("\uD83D\uDEA7 "+_h("e-maintenance-0")+t+"<br>"+_h("e-maintenance-1")),network_status(["maintenance"],!1),ga_evt_push("Maintenance Notice",{event_category:"Maintenance",event_label:t=t.split(" ")[0]}))}function network_status(e,t){var a=$(".warning-underlayer[data-issue]");e.length>0&&e.forEach(function(e){t?a.filter("[data-issue='"+e+"']").fadeTo("fast",1).attr("data-clickable",1).delay(8e3).queue(function(){$(this).attr("data-clickable",0).fadeTo("normal",0).dequeue()}):a.filter("[data-issue='"+e+"']").finish().fadeTo("fast",0).attr("data-clickable",0)}),t&&beep()}function flip_book(){$(".bk-flip").click()}function book__initialize(e){var t,a;(a=(t=$(".bk-list .bk-book")).length,{init:function e(){t.each(function(){var e=$(this),i=t.not(e),n=e.parent(),r=$(".bk-read"),s=$(".bk-flip");r.on("click",function(){var t=$(this);i.data({opened:!1}).removeClass("bk-viewinside").parent().css("z-index",0).find(".bk-read").removeClass("bk-active"),i.hasClass("bk-filp")||i.addClass("bk-default"),e.data("opened")?(t.removeClass("bk-active"),e.data({opened:!1,flip:!1}).removeClass("bk-viewinside").addClass("bk-default")):(t.addClass("bk-active"),e.data({opened:!0,flip:!1}).removeClass("bk-filp bk-default").addClass("bk-viewinside"),n.css("z-index",a))}),s.on("click",function(){r.removeClass("bk-active"),e.data("flip")?e.data({opened:!1,flip:!1}).removeClass("bk-filp").addClass("bk-default"):e.data({opened:!1,flip:!0}).removeClass("bk-viewinside bk-default").addClass("bk-filp")})})}}).init(),$(".mask_loading").delay(600).queue(function(){$(this).finish().fadeOut("fast",function(){$(".bk-viewinside").length||$(".bk-list .bk-book").addClass("bk-rotate").delay(1200).queue(function(){e&&open_book(!0),$(this).removeClass("bk-rotate").dequeue(),window.$d0.resolve()})})}),$(".bk-list .bk-cover,.bk-left").on("click",function(){open_book(!0),$(".bk-page,.bk-cover-back .catalog").scrollTop(0)}),$(".bk-list .bk-back").on("click",flip_book),$(".bk-underlayer").on("click",function(){$(".bk-page .sticker_editing").length>0?sticker__paste():$(".bk-viewinside").length>0?open_book(!1):flip_book()}),$(".stickerbook .stickerlist .stickerdir").scroll(function(){$(this).scrollTop()>200?$(".stickerbook .fa-chevron-square-up").fadeIn():$(".stickerbook .fa-chevron-square-up").fadeOut(),$(".item[data-sticker='0']:visible").length>0&&$(this).data({scrolled:$(this).scrollTop()})}),$(".bk-list .bk-page,.bk-cover-back .catalog").delay(800).queue(function(){$(this).scrollTop(0).dequeue()}),check_browser("Edge")&&$(".bk-cover-back .catalog").scrollTop($(".bk-cover-back .catalog").get(0).scrollHeight)}function editable__initialize(){is_touch_device()&&$(".bk-page").get(0).addEventListener("touchmove",function(e){if(e.cancelable)return!0},{passive:!0}),cssFeatureSupported("-webkit-user-modify","read-write-plaintext-only")||$("#editor_editable").on("keydown",function(e){if(13==e.keyCode)return document.execCommand("insertHTML",!1,"<br> "),!1})}function period__initialize(){var e=$(".periods");e.data("loaded")||hj_getScript_gh({path:"public/periods.min.js"},function(){e.slideDown("slow").data({loaded:!0})})}function createCaretPlacer(e){var t=$(".bk-page #editor_editable").get(0);if(t.focus({preventScroll:!1}),null!=window.getSelection&&null!=document.createRange){var a=document.createRange();a.selectNodeContents(t),a.collapse(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}else if(null!=document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t),n.collapse(e),n.select()}}function catalog_init(){$(document).on("click",".catalog .diaries li",function(){null!=this.dataset.active?nav_toggle($(".catalog"),!1):post_query(this.dataset.post_id)||$(this).remove()})}function catalog_search_toggle(e){switch(e){case!0:vip_fn("catalog_search");break;case!1:catalog_toggle(),catalog_search_toggle("toggle");break;case"toggle":var t=$(".catalog"),a=t.find(".btn_search");t.find(".diaries").slideUp("fast",function(){$(this).html($("<div>",{class:"catalog_loading"})).slideDown("slow")}),t.find(".btn_bookmarks").attr("data-queried",0),a.attr("data-queried",+!parseInt(a.attr("data-queried"))),1025>$("body").width()&&nav_toggle($(".catalog"),!0)}}function catalog_search(e){e=e||"",alertify.set({labels:{ok:"\uD83D\uDD0D "+_h("e-search-2"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fad fa-search"></i> '+_h("e-search-0"),function(e,t){e?((t=(t||"").trim()).length>0?(catalog_query(t,{page:1}),catalog_search_toggle("toggle"),$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog"),!0)):catalog_toggle(),fb_evt_push("Search")):catalog_toggle()},e),alertify_input_custom({type:"search",inputmode:"search",placeholder:_h("e-search-1"),autocomplete:"on",maxlength:30},{"letter-spacing":"2px"})}function bookmark_query(e,t){if(1==t.attr("data-queried")){catalog_toggle(),t.attr("data-queried",0);return}hj_update({action:"bookmark_query",page:e||0}).then(function(e){if(1===e.Status){var t=e.Values.catalog.map(function(e,t){return e.title=e.title||_h("e-bookmark-3"),e.title_decoded=htmlDecode(e.title),{post_id:e.post_id,title:e.title_decoded,privacy:e.privacy,editable:e.editable,outbound_count:e.outbound_count,page:Math.ceil((t+1)/10)}});catalog_listing(t),catalog_toggle("bookmarks");var a=e.Values.catalog.length;$(".catalog .pagination").attr("data-stats",_h("e-bookmark-"+(a>1?1:0),{$no:a})),catalog_pagination(a)}else update_failed()})}function catalog_query(e,t){"resolved"==window.$d2.state()&&(window.$d2=$.Deferred()),e=e||"";var a="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),i=[];i.length?window.$d2.resolve():hj_update({action:"catalog_query",writer:hj_writer,page:0,keyword:e}).then(function(t){if(1===t.Status){i=t.Values.catalog.map(function(e,t){return e.title=e.title||_h("e-catalog-2"),e.title_decoded=htmlDecode(e.title),{post_id:e.post_id,title:e.title_decoded,privacy:e.privacy,editable:e.editable,outbound_count:e.outbound_count,page:Math.ceil((t+1)/10)}}),hj__cache({set:!0,bucket:a,data:JSON.stringify(i)}),window.$d2.resolve();var n=t.Values.catalog.length;$(".catalog .pagination").attr("data-stats",_h("e-catalog-"+(n>1?1:0),{$no:n})),catalog_pagination(e?0:n)}else update_failed(),window.$d2.reject()}).fail(function(e){hj_update_failed({fn:"catalog_query",flag:1,err:e}),window.$d2.reject()}),$.when(window.$d2).done(function(){catalog_listing(i,t),e.length>0&&catalog_toggle("search");var a=[$(".bk-cover-back .fa-chevron-square-up"),$(".catalog[data-mobile] .fa-chevron-square-up")];$(".catalog[data-desktop]").get(0).scrollHeight>$(".bk-cover-back>div").height()&&$(".catalog[data-desktop]").scroll(function(){$(this).scrollTop()>10?a[0].fadeIn():a[0].fadeOut()}),$(".catalog[data-mobile]>div>div").scroll(function(){$(this).scrollTop()>10?a[1].fadeIn():a[1].fadeOut()}),window.$d2=$.Deferred()}).fail(function(e){hj_update_failed({fn:"catalog_query",flag:2,err:e}),window.$d2=$.Deferred()})}function catalog_listing(e,t){$(".catalog .diaries").html(e.map(function(e){return $("<li>",{title:"\uD83D\uDCDD "+e.title,"data-post_id":e.post_id,"data-pg":e.page,"data-privacy":e.privacy,"data-editable":e.editable,"data-outbound_count":e.outbound_count,text:e.title})})),null!=t&&catalog_page(t)}function catalog_pagination(e){var t=Math.ceil((e||0)/10),a=[];for(let i=1;i<=t;i++)a.push($("<option>",{value:i,text:i}));$(".pagination select").html(a).prop("disabled",a.length<2)}function catalog_lookup(e){var t=catalog_cached(),a=[];if(!t)return catalog_query(null,{page:1}),!1;if(t.length>0){if(t.forEach(function(e,t){a[e.post_id]=t}),e>0)return e in a?t[a[e]]:null;if(0===e)return t[0];if(-1===e)return t[t.length-1]}return null}function catalog_page(e){if(null==e)return!1;var t=Number(e.page)||1,a=e.post_id||0,i=$(".catalog"),n=i.find(".diaries"),r=i.find(".pagination");if(n.children("li[data-active]").removeAttr("data-active"),a>0){var s=catalog_lookup(a);if(null==s)return catalog_page({page:1}),!1;if(!s)return!1;t=s.page,n.children("li[data-post_id='"+a+"']").attr("data-active","")}else null!=e.btn&&e.btn.filter(".fal").toggleClass("fal fas").delay(450).queue(function(){$(this).toggleClass("fas fal").dequeue()});n.attr("data-pg",t),r.find("select").val(t);var o=r.children(".fa-caret-circle-left"),l=r.children(".fa-caret-circle-right");t>1?o.attr({onclick:"$(this).removeAttr('onclick');catalog_page({page:"+(t-1)+",btn:$(this)})"}).removeClass("disabled"):o.addClass("disabled"),n.children("li[data-pg='"+(t+1)+"']").length>0?l.attr({onclick:"$(this).removeAttr('onclick');catalog_page({page:"+(t+1)+",btn:$(this)})"}).removeClass("disabled"):l.addClass("disabled")}function catalog_cached(){var e="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),t=hj__cache({bucket:e});return null==t?null:JSON.parse(t)||{}}function catalog_toggle(e){var t=$(".catalog"),a=t.find(".diaries"),i=t.find(".pagination"),n=t.find(".tabs .btn_diary"),r={search:t.find(".btn_search"),bookmarks:t.find(".btn_bookmarks"),arr:i.find(".fa-caret-circle-left,.fa-caret-circle-right")},s=0;switch(e){case"my":switch(catalog_page({page:1}),s=a.find("[data-editable='1']").length/2){case 0:s=_h("e-catalog-3");break;case 1:s=_h("e-catalog-0");break;default:s=_h("e-catalog-1",{$no:s})}i.attr("data-stats",s),a.attr("data-pg",e);break;case"shared":switch(s=a.find("[data-editable='0']").length/2){case 0:s=_h("e-catalog-4");break;case 1:s=_h("e-catalog-0");break;default:s=_h("e-catalog-1",{$no:s})}i.attr("data-stats",s),a.attr("data-pg",e);break;case"search":switch(s=a.find("[data-editable='1']").length/2){case 0:s=_h("e-search-3");break;case 1:s=_h("e-catalog-0");break;default:s=_h("e-catalog-1",{$no:s})}i.attr("data-stats",s),a.attr("data-pg",e);break;case"bookmarks":a.attr("data-pg",1);break;default:catalog_query(null,{page:1}),a.attr("data-pg",1)}switch(n.removeAttr("data-active"),e){case"search":r.bookmarks.attr("data-queried",0);break;case"bookmarks":r.bookmarks.attr("data-queried",1),r.search.attr("data-queried",0);break;case"my":n.filter("[data-primary]").attr("data-active","");break;case"shared":n.filter("[data-shared]").attr("data-active","")}switch(e){case"my":case"shared":case"search":catalog_pagination(0),r.arr.addClass("disabled");break;default:r.arr.removeClass("disabled")}}function stickers__initialize(){stickers__detach();var e=Number(current_post().post_id);e>0&&hj_update({action:"sticker_query",post_id:e}).then(function(e){switch(e.Status){case 1:var t=e.Values;sticker__save_local(t),t.forEach(function(e){sticker__createDOM(e.id,e)});break;case 2:signin_required();break;default:hj_update_failed({fn:"stickers__initialize",flag:0})}}).fail(function(e){hj_update_failed({fn:"stickers__initialize",flag:1,err:e})})}function sticker__initialize(e,t,a){var i=$(".bundle .asset[data-asset_id='"+t+"']"),n=i.children(".sticker_img"),r=sticker__new_blank("asset",e,a);"angle"in a?n.css({transform:"rotate("+a.angle.deg+"deg)"}):a.angle=r.angle,"size"in a?n.css({width:a.size.width,height:a.size.height}):a.size=r.size,"position"in a?i.css({top:a.position.top,left:a.position.left}):a.position=r.position,current_post().editable?sticker__editor_initialize(e,t,a):sticker__paste({bundle_id:e,asset_id:t})}function sticker__editor_initialize(e,t,a){var i=is_touch_device(),n=$(".bundle .asset[data-asset_id='"+t+"']"),r=n.children(".sticker_img");n.draggable({start:function(e,t){i?r.addClass("dragging"):r.addClass("grabbing"),r.hasClass("dragthis")&&r.removeClass("dragthis")},stop:function(a,n){a.stopPropagation();var s=sticker__draggable_handle(e,t);sticker__update(e,t,"position",s.pos),i?r.removeClass("dragging"):r.removeClass("grabbing")},snap:!0,containment:"#editor",scroll:!1,cursor:"move",grid:[5,5],cancel:".ui-rotatable-handle"});var s=a.angle.deg,o=s/57.296,l={angle:o,rotationCenterOffset:{top:0,left:0},start:function(e){r.data("rotate-mode",1)},rotate:function(a,i){0===r.data("rotate-mode")&&(a.stopPropagation(),o=i.angle.current,sticker__update(e,t,"angle",{deg:s=i.angle.degrees,rad:o}),sticker__rotation_margin_fixes(e,t))},stop:function(a,i){o=i.angle.current,sticker__update(e,t,"angle",{deg:s=i.angle.degrees,rad:o}),r.data("rotate-mode",0),sticker__rotation_margin_fixes(e,t)},rotationCenterOffset:{top:0,left:0},wheelRotate:!0};r.rotatable(l).data("rotate-mode",0),r.find(".ui-rotatable-handle").remove();var c=$("<div>",{class:"ui-rotatable-handle",title:_h("e-sticker-1")});if(!i){var d=c.clone(),u=c.clone(),p=c.clone();d.addClass("ui-rotatable-handle-ne"),u.addClass("ui-rotatable-handle-nw"),p.addClass("ui-rotatable-handle-sw"),r.append(d,u,p)}if(c.addClass("ui-rotatable-handle-se segrip"),r.append(c),r.find("div[class*='ui-rotatable-handle-']").bind("mousedown",function(e){r.rotatable("instance").startRotate(e)}),!i){var f=r.width()/r.height();r.resizable({resize:function(e,t){n.css({"min-width":t.size.width})},stop:function(a,i){sticker__update(e,t,"size",{width:i.size.width,height:Math.round(i.size.height)}),$(this).height(i.size.width/f).css({top:0,left:0})},containment:"#editor",aspectRatio:!0,grid:5,minWidth:80,minHeight:80,maxWidth:.85*$("#editor_editable").width(),maxHeight:640,handles:i?{}:{n:".ngrip",e:".egrip",s:".sgrip"}})}if(i){$(".ui-resizable-n,.ui-resizable-e,.ui-resizable-s").remove(),r.get(0).addEventListener("touchmove",function(a){if("touches"in a){var i={x:0,y:0,sum:0},n=hj__cache({bucket:"hearty_sticker_finger_gap"})||null,s=0,o=r.width(),l=r.height(),c={max:.85*$("#editor_editable").width(),min:80},d=1;if(r.data("aspect_ratio"))var u=r.data("aspect_ratio");else{var u=o/l;r.data({aspect_ratio:u})}if(a.touches.length>1){i.x=Math.abs(a.touches[1].pageX-a.touches[0].pageX),i.y=Math.abs(a.touches[1].pageY-a.touches[0].pageY),i.sum=Math.floor(Math.sqrt(Math.floor(i.x**2+i.y**2))),null!==n&&(s=i.sum-n),s=isNaN(s)?0:s,hj__cache({set:!0,bucket:"hearty_sticker_finger_gap",data:i.sum}),d=s/o*.4,o+=o*d,l=o/u,o<c.min?(l*=c.min/o,o=c.min):o>c.max&&(l*=c.max/o,o=c.max);var p=Math.floor(.45*Math.min(o=Math.round(1e3*o)/1e3,l=Math.round(1e3*l)/1e3));r.width(o).height(l).css({"font-size":p>100?100:p}),sticker__update(e,t,"size",{width:o,height:l}),Math.abs(s)>0&&r.hasClass("rotating")&&r.removeClass("rotating"),r.addClass("resizing"),r.hasClass("dragthis")&&r.removeClass("dragthis")}}},{passive:!0}),r.get(0).addEventListener("touchend",function(e){hj__cache({set:!0,bucket:"hearty_sticker_finger_gap"}),r.removeClass("resizing")},{passive:!0}),interact(".asset[data-asset_id='"+t+"']").on("hold",function(a){$(".asset[data-asset_id='"+t+"'] .sticker_editing").length||(sticker__cut({bundle_id:e,asset_id:t}),hj_vibrate(30))});var s=parseFloat(a.angle.deg),o=s/57.296;interact(".asset[data-asset_id='"+t+"'] .sticker_img").gesturable({onmove:function(a){s+=a.da,r.css({"-webkit-transform":"rotate("+s+"deg)",transform:"rotate("+s+"deg)"}),s>360?s-=360:s<0&&(s+=360),o=s/57.296,sticker__update(e,t,"angle",{deg:s,rad:o}),sticker__rotation_margin_fixes(e,t),Math.abs(a.da)>.5&&r.removeClass("resizing").addClass("rotating"),hj_log("* 更新貼紙角度 "+t+"："+parseFloat(s).toFixed(2)+" \xb0")}}).on({gestureend:function(e){r.removeClass("rotating")}}),r.css({"-webkit-transform":"rotate("+s+"deg)",transform:"rotate("+s+"deg)"})}sticker__paste({bundle_id:e,asset_id:t}),hj_log("\uD83C\uDFEE 初始化貼紙："+e+"（"+t+"）")}function stickers__detach(){sticker__save_local([]),$("#editor .bundle").remove()}function sticker__oncreate(e,t){current_post().post_id,Number(t)>0?(nav_toggle($(".stickerbook"),!1),hj_upgrade_toggle(!0)):(sticker__create(e),ga_evt_push("Sticker Create",{event_category:"Posts",event_label:"Sticker Create"}))}function sticker__create(e,t){if(!current_post().editable)return!1;var a,i=sticker__lookup("page"),n="page"in i[1]?i[1].page:{},r="bundles"in i[1]?i[1].bundles:[],s=null==t,o=sticker__uniqID(),l={width:160,height:160},c=Math.min(l.width/e.width,l.height/e.height);if(e.width=Math.ceil(e.width*c),e.height=Math.ceil(e.height*c),e.align_right=1,s){t=sticker__uniqID(),a=sticker__new_blank("bundle",t,e);var d=r.map(function(e,t){return r[t].position.sum});d.push(0);var u=Math.max.apply(null,d);a.position.top=u,n[t]=a;var p=$(".bk-page").scrollTop()||0,f={width:$("#editor").width()||0,height:$(".bk-page").height()||0},h=$("#editor").get(0).offsetTop;p<h&&(p=h,$(".bk-page").animate({scrollTop:p},100));var g={move:{top:p+(is_touch_device()?h:0)-.4*f.height-u},def:{top:p-h+.5*f.height-e.height+50,left:e.align_right?f.width-e.width||0:.1*f.width||0}},b={top:Math.ceil(g.move.top),left:Math.round(g.move.left)}}else{var b=null;a=n[t]}if(n[t].assets[o]=a.assets[o]=sticker__new_blank("asset",t,e),sticker__save_local(r=Object.keys(n).map(function(e){return n[e]})),sticker__createDOM(t,a,b),s){a.position=a.assets[o].position={top:Math.floor(g.def.top),left:Math.round(g.def.left),right:0,align_right:1},n[t].assets[o]=a.assets[o],sticker__update(t,o,"position",a.assets[o].position);var k=a.assets[o];hj_update({action:"sticker_create",post_id:current_post().post_id,data:{bundle_id:t,asset_id:o,bundle_top:a.position.top,bundle_left:a.position.left,bundle_right:a.position.right,bundle_align_right:a.position.align_right,item_num:k.item_num,asset_width:k.size.width,asset_height:k.size.height}}).then(function(e){switch(e.Status){case 0:update_failed();case 2:signin_required();case 3:msg(_h("e-sticker-4"),'<i class="fas fa-star"></i> '+_h("e-sticker-5"),function(){hj_upgrade_toggle(!0)})}})}sticker__cut({bundle_id:t,asset_id:o}),open_book(!0),hj_log("➕ 新增貼紙："+t+"（"+o+"）")}function sticker__createDOM(e,t,a){var i,n,r,s;for(let o in n=$("<div>",{class:"bundle","data-bundle_id":e,html:$("<div>",{class:"bundle_innerbox"}),onContextMenu:"return false;"}).data("bundle-id",e).insertBefore("#editor_editable"),t.assets)s=t.assets[o],i=$(".hj-sample .asset").clone().attr({title:s.item_name,"data-editing":!0,"data-bundle_id":e,"data-asset_id":o}).data("asset-id",o).fadeTo("slow",.35),n.children(".bundle_innerbox").append(i),(r=$(".asset[data-asset_id='"+o+"'] .sticker_img")).width(s.size.width).height(s.size.height).addClass("dragthis").css({"background-image":"url('//i.hearty.app/b/images/stickers/"+s.set_alias+"/"+s.item_num+".png?o=1')"}),is_touch_device()&&r.children(".detach").get(0).addEventListener("touchmove",function(e){e.stopPropagation()},{passive:!0}),null==a?i.fadeTo("slow",1):setTimeout(function(){i.animate(a,150).fadeTo("slow",1)},0),sticker__initialize(e,o,t.assets[o])}function sticker__rotation_margin_fixes(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img");if(!(i.length<1)){var n=Math.floor(.9*i.get(0).getBoundingClientRect().width),r=Math.floor(.9*i.get(0).getBoundingClientRect().height);if(hj_log("貼紙尺寸："+n+" x "+r),!n||!r)return!1;sticker__update(e,t,"size",{width:n,height:r},!0),a.css({"min-width":n,"max-height":r})}}function sticker__new_blank(e,t,a){var i={};return i.position={top:isNaN(a.top)?0:a.top,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right,topmargin:0,align_right:isNaN(a.align_right)?0:a.align_right},i.size={width:a.width,height:a.height},"asset"==e?(i.item_num=isNaN(a.num)?0:a.num,i.item_name=a.name,i.set_num=isNaN(a.set_num)?0:a.set_num,i.set_alias=a.set_alias,i.angle={deg:0,rad:0}):"bundle"==e&&(i.id=t||sticker__uniqID(),i.assets={},i.position.sum=0),i}function sticker__exec(e,t,a){var i=!1;if(null==a){var n=sticker__lookup("page");if(!n[0])return!1;n[1].page;var a=n[1].bundles}switch(e){case"add":var r=a.length;if(r)for(let s=0;s<r;s++)if(i){if(a[s].position.sum>a[s].position.top){var o=a[s].position.sum-a[s].position.top;for(let l=s;l<r;l++)a[l].position.top+=o}}else(a[s].position.top>t.position.top||s+1===r)&&(a[s].position.topmargin=s>0?a[s].position.top-a[s-1].position.sum:a[s].position.top,a[s].position.sum=a[s].position.top+a[s].size.height,a.splice(s,0,t),i=!0);else a.push(t);return sticker__save_local(a),sticker__createDOM(t.id,t),sticker__place(sticker__calc(sticker__order(a)));case"remove":for(let c=0;c<a.length;c++)a[c].id==t.id?(a.splice(c,1),i=!0):i&&a[c].position.align_right==a[c-1].position.align_right&&(a[c].position.topmargin+=a[c-1].position.topmargin+a[c-1].size.height,i=!1);return sticker__save_local(a),$(".bundle[data-bundle_id='"+t.id+"']").fadeOut(200,function(){$(this).remove()}),sticker__place(a)}}function sticker__order(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page;var e=t[1].bundles}return e.length>1&&e.sort(function(e,t){return e.position.top-t.position.top}),e.forEach(function(e){$(".bundle[data-bundle_id='"+e.id+"']").detach().insertBefore("#editor_editable")}),e}function sticker__calc(e,t,a){if(null==e){var i=sticker__lookup("page");if(!i[0])return!1;i[1].page;var e=i[1].bundles}switch(t){case"add":e=sticker__exec("add",a,e);break;case"remove":e=sticker__exec("remove",a,e)}var n=["left","right"],r={alignment:"",top:0,sum:{left:0,right:0}};return e.forEach(function(t,a){var i=t.position.align_right,s=i;if(i=n[i],s=n[s^=1],t.position.top=Math.max(t.position.top,0),a>0&&i!==r.alignment?t.position.topmargin=t.position.top-r.top:(t.position.top=Math.max(t.position.top,r.sum[i]+1),t.position.topmargin=t.position.top-r.sum[i]),t.position.topmargin=Math.max(t.position.topmargin,0),r.sum[i]=t.position.sum=t.position.top+t.size.height,a>0&&i==r.alignment)for(let o in r.sum)r.sum[o]=t.position.sum;for(let l in t.assets)t.assets[l].position.top=t.position.top,t.assets[l].position.topmargin=t.position.topmargin,t.assets[l].position.align_right=t.position.align_right;e[a]=t,r.alignment=i,r.top=t.position.top,0===a&&sticker__top_edge(t),hj_log("\uD83D\uDCC4 調整貼紙位置 "+t.id+"："+JSON.stringify(t.position))}),sticker__save_local(e),e}function sticker__top_edge(e){return!1}function sticker__place(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page;var e=t[1].bundles}var a=$(".hj-styles");return e.forEach(function(e){if(a.children("style[data-bundle_id='"+e.id+"']").length){var t=e.position.align_right?'.bundle.bundle_right[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}":'.bundle.bundle_left[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}";a.children("style[data-bundle_id='"+e.id+"']").text(t)}else a.append($("<style>",{"data-bundle_id":e.id}))}),$("#editor .complement").remove(),$("#editor .bundle").each(function(e){var t=$(this).attr("class").split(" "),a=$("#editor .bundle").length>e+1?$(this).nextAll("#editor .bundle").eq(0).attr("class").split(" "):[];t.indexOf("bundle_left")>=0&&a.indexOf("bundle_left")>=0?$(this).after($("<div>",{class:"complement complement_right"})):t.indexOf("bundle_right")>=0&&a.indexOf("bundle_right")>=0&&$(this).after($("<div>",{class:"complement complement_left"}))}),e}function sticker__lookup(e,t,a){var i=hj__cache({bucket:"hearty_sticker_cache__"+current_post().post_id}),n=[null!==n,JSON.parse(i)||[]],r=[!1,{}];if(n[0]){var s,o={},l=n[1];l.forEach(function(e){o[e.id]=e}),r[1].page=l.length>0?o:{},r[1].bundles=l.length>0?l:[],"page"==e?(r[0]=!0,r[1].status=4):t in o?(s=r[1].bundle=o[t],"asset"==e&&a in s.assets?(r[0]=!0,r[1].status=3,r[1].asset=s.assets[a]):(r[0]="bundle"==e,r[1].status=2)):(r[0]=!1,r[1].status=1)}else r[0]=!1,r[1].status=0;return r}function sticker__update(e,t,a,i,n){var r,s,o=sticker__lookup("asset",e,t);if("angle"==a)i.deg=Math.abs(i.deg)>=360?Math.abs(i.deg).toFixed(0)-360:i.deg.toFixed(0),i.rad=Math.abs(i.rad)>=2*Math.PI?(Math.abs(i.rad)-2*Math.PI).toFixed(5):i.rad.toFixed(5);else for(let l in i)i[l]=Math.max(Math.floor(i[l]),0);if(!o[0]||!(a in o[1].asset))return!1;r=o[1].page,n||(r[e].assets[t][a]=i),["position","size"].indexOf(a)>=0&&(r[e][a]=i),sticker__save_local(s=Object.keys(r).map(function(e){return r[e]})),hj_log("\uD83D\uDCBE 暫存貼紙 "+e+"（"+t+"）的 "+a+" 為："+JSON.stringify(i))}function sticker__cut(e){if(!current_post().editable||$(".bk-page .sticker_editing").length>0)return!1;var t,a=e.bundle_id,i=e.asset_id,n=$(".bundle[data-bundle_id='"+a+"']"),r=n.find(".asset[data-asset_id='"+i+"']"),s=r.children(".sticker_img"),o=$(".editor_toolbelt"),l=sticker__lookup("asset",a,i),c=is_touch_device();if(!l[0]||!("position"in l[1].asset))return n.remove(),!1;t=l[1].asset.position,n.children(".bundle_innerbox").css({top:t.top,left:t.left});var d=t.align_right?-1*(t.right+Math.floor(1.05*s.get(0).getBoundingClientRect().width)):t.left;return r.animate({left:d},0),r.draggable("enable"),s.rotatable("enable").children(".ui-resizable-handle,.ui-rotatable-handle").fadeIn(),c?interact(".asset[data-asset_id='"+i+"'] .sticker_img").gesturable({enabled:!0}):(s.resizable("enable"),sticker__editor_hotkeys(!0,a,i)),$("#editor_editable").addClass("readonly").prop({contenteditable:!1}).disableSelection(),n.children(".bundle_innerbox").width(0).css({"margin-left":"-1px","margin-right":"-1px"}),s.addClass("sticker_editing").removeClass("sticker_static"),$("#editor .bundle .sticker_static").fadeTo("fast",.5),r.attr("data-editing",!0),$(".editor_toolbelt #paste,#editor").attr({onclick:"sticker__paste("+JSON.stringify({bundle_id:a,asset_id:i})+",true);saved(false)"}),s.children(".detach").fadeIn(),o.find(".kits").hide(),o.find(".sticker span").fadeIn(),$(".mh-head .btn_stickerbook,.stickerbook .stickerlist").hide(),nav_toggle($(".stickerbook"),!1),c&&($(".bk-page").find("header,.frame").hide(),$(".bk-page").css({"border-top":"none"}).get(0).scroll({top:Math.floor(t.top-1*$(".bk-page").height()/4),behavior:"instant"})),hj_log("✂️ 剪下貼紙："+a+"（"+i+"）"),!0}function sticker__paste(e,t){var a,i=$(".bk-page .sticker_editing");if(!i.length)return!1;var n=null!=e&&"bundle_id"in e?e.bundle_id:i.attr("data-bundle-id"),r=null!=e&&"asset_id"in e?e.asset_id:i.attr("data-asset-id"),s=$(".bundle[data-bundle_id='"+n+"']"),o=s.find(".asset[data-asset_id='"+r+"']"),i=o.children(".sticker_img"),l=$(".hj-styles"),c=sticker__calc(sticker__order()),d=sticker__lookup("asset",n,r),u=is_touch_device();if(d[0]&&"position"in d[1].asset&&((a=d[1].asset.position).align_right?(s.addClass("bundle_right").removeClass("bundle_left"),s.children(".bundle_innerbox").addClass("alignment_right").removeClass("alignment_left"),l.children("style[data-bundle_id='"+n+"']").length||l.append($("<style>",{"data-bundle_id":n})),l.children("style[data-bundle_id='"+n+"']").text(".bundle[data-bundle_id='"+n+"'].bundle_right::before{height:"+a.topmargin+"px}"),s.children(".bundle_innerbox").css({"margin-left":0,"margin-right":a.right+"px"})):(s.addClass("bundle_left").removeClass("bundle_right"),s.children(".bundle_innerbox").addClass("alignment_left").removeClass("alignment_right"),l.children("style[data-bundle_id='"+n+"']").length||l.append($("<style>",{"data-bundle_id":n})),l.children("style[data-bundle_id='"+n+"']").text(".bundle[data-bundle_id='"+n+"'].bundle_left::before{height:"+a.topmargin+"px}"),s.children(".bundle_innerbox").css({"margin-left":a.left+"px","margin-right":0})),cssFeatureSupported("width","min-content")?s.children(".bundle_innerbox").width("min-content").height("min-content"):cssFeatureSupported("width","min-intrinsic")?s.children(".bundle_innerbox").width("min-intrinsic").height("min-intrinsic"):s.children(".bundle_innerbox").width("auto").height("auto")),sticker__place(c),$("#editor .bundle .sticker_static").fadeTo("fast",1),i.children(".detach").fadeOut(),$(".editor_toolbelt .sticker a").hide(),$(".editor_toolbelt .kits").fadeIn(),u){$(".bk-page").find("header,.frame").show();var p=$("#editor").get(0).offsetTop,f=$(".bk-page").scrollTop()||0,h=$(".bk-page");t&&h.scrollTop(f+p),h.css({"border-top":"1em solid transparent"})}return sticker__rotation_margin_fixes(n,r),o.attr("data-editing",!1).css({top:0,left:0}),i.children(".ui-resizable-handle,.ui-rotatable-handle").hide(),current_post().editable&&(o.draggable("disable"),i.rotatable("disable"),u?interact(".bundle .asset[data-asset_id='"+r+"'] .sticker_img").gesturable({enabled:!1}):(i.resizable("disable"),sticker__editor_hotkeys(!1,n,r)),$("#editor_editable").prop({contenteditable:!0}),$(".mh-head .btn_stickerbook,.stickerbook .stickerlist").show()),$("#editor").removeAttr("onclick"),$("#editor_editable").removeClass("readonly").enableSelection(),i.addClass("sticker_static").removeClass("sticker_editing"),hj_log("\uD83D\uDCCB 黏貼貼紙："+n+"（"+r+"）"),!0}function sticker__remove(e){var t=current_post().post_id,a=e.bundle_id,i=e.asset_id;sticker__paste({bundle_id:a,asset_id:i})&&(sticker__exec("remove",{id:a}),sticker__top_edge(),hj_vibrate(30),$("#editor .bundle").length<2&&nav_toggle($(".stickerbook"),!0),createCaretPlacer(!1),hj_update({action:"sticker_remove",bundle_id:a,asset_id:i,post_id:t}).then(function(e){switch(e.Status){case 0:update_failed();case 2:signin_required()}})),ga_evt_push("Sticker Remove",{event_category:"Posts",event_label:"Sticker Remove"}),hj_log("\uD83D\uDDD1️ 刪除貼紙："+a+"（"+i+"）")}function sticker__save_remote(){var e=sticker__lookup("bundles"),t="bundles"in e[1]?e[1].bundles:[];if(!t.length)return!1;hj_update({action:"sticker_save",post_id:current_post().post_id,bundles:JSON.stringify(t)}).then(function(e){switch(e.Status){case 0:case 3:update_failed();break;case 2:signin_required()}})}function sticker__save_local(e){var t=current_post().post_id;hj__cache({set:!0,bucket:"hearty_sticker_cache__"+t,data:JSON.stringify(e)})}function sticker__uniqID(){return new Date().getTime().toString(16)+performance.now().toString(36).slice(-2)}function hj__cache(e){var t="set"in e,a=("local"in e?"local":"session")+"Storage",i=$("body");if(a in window){if(!t)return window.eval(a).getItem(e.bucket)||i.data(e.bucket)||null;try{window.eval(a).setItem(e.bucket,e.data)}catch(n){i.data(e.bucket,e.data)}}else{if(!t)return i.data(e.bucket)||null;i.data(e.bucket,e.data)}}function hj_log(e){window.console&&window.hj_test&&console.log(e)}function post_privacy(e,t){autosave_the_change(),e=Number(e);var a=current_post().post_id,i=$(".bk-page #editor_editable");return $(".share .sharable_url"),!(verify_required("email",_h("e-verify_required-3"))||verify_required("phone",_h("e-verify_required-3")))&&(review_words(i.text())&&9==e?($(".privacy_selector [data-publish]").remove(),msg('<i class="fal fa-info-circle"></i> '+_h("e-privacy-2")+"<br>"+(t?_h("e-privacy-4"):_h("e-privacy-3"))+"<br>"+_h("e-privacy-5")+" \uD83E\uDD7A"),gform_post("1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",{"entry.783049182":getcookie("hearty_u"),"entry.866865386":getcookie("hearty_id"),emailAddress:getcookie("hearty_em"),"entry.527303026":(t?"投稿":"公開")+"日記 (已拒登)","entry.355700800":a,"entry.1592095357":(i.text()||"").trim(),"entry.1259076046":today(8),"entry.124585191":check_browser()+", "+check_OS()}),!1):hj_update({action:"post_privacy",post_id:a,privacy:e}).then(function(n){switch(n.Status){case 1:var r=i.data("current_post");return r.privacy=e,i.data({current_post:r}),post_privacy_toggle(e,t),$(".catalog .diaries li[data-post_id='"+a+"']").attr("data-privacy",e),e?alertify.success('<i class="far fa-lock-open"></i> '+_h("e-privacy-0")):alertify.error('<i class="far fa-lock"></i> '+_h("e-privacy-1")),ga_evt_push("Privacy",{event_category:"Posts",event_label:e?"Public":"Private"}),!0;case 2:signin_required();break;default:hj_update_failed({fn:"post_privacy",flag:0})}}).fail(function(e){hj_update_failed({fn:"post_privacy",flag:1,err:e})}))}function post_privacy_toggle(e,t){var a=$(".share .sharable_url"),i=$(".share .penpals");t=(e=Number(e))?Number(t||0):0,e?(i.hide(),a.slideDown(),post_sharable_url()):(a.add($(".share .qrcode")).hide(),i.slideDown());var n=$(".privacy_selector li"),r=n.filter("[data-publish]");n.removeAttr("data-selected"),n.filter("[data-privacy='"+e+"']").attr("data-selected",""),t?r.attr("data-selected",""):r.removeAttr("data-selected")}function post_sharable_url(){var e=$(".share .qrcode"),t=$(".share .sharable_url"),a=t.find("input"),i=a.val()||"";0>i.indexOf("hj.rs")?url_shortener(location.href,!0,$(".bk-page #subject").text()||"").then(function(t){t&&(hj_update({action:"post_sharable_url",post_id:current_post().post_id,shortened_url:t}),t="https://hj.rs/"+t,a.val(t),get_qrcode(e,t))}):get_qrcode(e,i),t.slideDown()}function hj_native_share(){var e=$(".share .sharable_url input").val()||location.href.replace(location.host,"hearty.app");if(e.indexOf("hearty.app")>0&&(e+=(e.indexOf("?")>0?"&":"?")+"st="+encodeURIComponent($(".bk-page #subject").text()||"")),/iOS|Android/i.test(check_hjapp()))location.assign("//hearty.me/wv?s="+encodeURIComponent(e.replace(/(^\w+:|^)\/\//,"")));else{if(!(is_touch_device()&&"share"in navigator))return!1;navigator.share({title:document.title,text:$("meta[name='description']").attr("content"),url:e}).catch(function(e){})}}function post_publish(){var e=Number(current_post().privacy),t=$(".bk-page #subject").text(),a=current_post().post_id,i=$(".bk-page #editor_editable").text().replace(/^\s+|\s+$/g,"")||"",n=!$(".privacy_selector li[data-publish]").is("[data-selected]"),r="";if(verify_required("email",_h("e-verify_required-4")))return!1;if(n){if(i.length<90){msg('<i class="fal fa-pen"></i> '+_h("e-publish-0"),_h("e-publish-1"));return}r=e?_h("e-publish-2",{$title:t}):_h("e-publish-3"),r+='<br><small><i class="fal fa-info-circle"></i> '+_h("e-publish-8")+"</small>",alertify.set({labels:{ok:'<i class="fas fa-inbox-out"></i> '+_h("e-publish-4"),cancel:_h("e-no-1")},buttonReverse:!1})}else r=_h("e-publish-9",{$title:t}),alertify.set({labels:{ok:'<i class="fas fa-inbox-in"></i> '+_h("e-publish-10"),cancel:_h("e-no-1")},buttonReverse:!1});alertify.confirm('<i class="fal fa-file-alt"></i> '+r,function(r){r&&(hj_loading(),hj_update({action:"post_publish",post_id:a,published:+n}).then(function(r){switch(r.Status){case 1:(e||post_privacy(9,n))&&(n?(post_privacy_toggle(9,!0),alertify.set({labels:{ok:'<i class="fas fa-eye"></i> '+_h("e-publish-6"),cancel:'<i class="fas fa-reply"></i> '+_h("e-publish-7")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-paperclip"></i> '+_h("e-publish-5",{$title:t}),function(e){e&&hj_href("feed?p=1&post="+a)}),gform_post("1FAIpQLSejAwJP2dSgdhGz79S9Q_JzqthM4JrAXhFB3dfKNCCfSJGi_A",{"entry.783049182":getcookie("hearty_u"),"entry.866865386":getcookie("hearty_id"),"entry.1497216280":getcookie("hearty_em"),emailAddress:getcookie("hearty_em"),"entry.355700800":a,"entry.1270264487":i,"entry.1259076046":today(8),"entry.124585191":check_browser()+", "+check_OS()}),ga_evt_push("Post Published",{event_category:"Posts",event_label:"Post Published"})):(post_privacy_toggle(9,!1),alertify.error('<i class="far fa-eye-slash"></i> '+_h("e-publish-11"))));break;case 2:signin_required();break;case 3:msg('<i class="fal fa-clone"></i> '+_h("e-publish-12")),$(".privacy_selector [data-publish]").remove();break;default:msg()}hj_loading(!1)}).fail(function(e){hj_update_failed({fn:"post_publish",flag:1,err:e})}))})}function post_penpal_listing(e){var t=$(".share .penpals"),a=t.find("select"),i=a.children("option");if(null==e)return hj_update({action:"post_penpal_listing"}).then(function(e){if(1==e.Status){var i=e.Values.penpals;a.html(i.map(function(e){return post_penpal_option(e)})),hj_membership()[1]>4&&i.length>0&&t.find(".penpal_delete").fadeTo("fast",1)}});i.length?(i.prop({selected:!1}),e.forEach(function(e){i.filter("[data-user_id='"+e+"']").prop({selected:!0})}),a.data({penpals:JSON.stringify(a.val()||[])})):post_penpal_listing().then(function(){$(".share .penpals option").length>0&&e.length>0&&post_penpal_listing(e)})}function post_penpal_option(e){var t=$("<option>",{value:e.penpal_id,title:e.nickname,"data-user_id":e.user_id,"data-username":e.username,text:e.nickname});return 1==e.blocked&&t.attr({disabled:"disabled"}),is_touch_device()||t.on("mousedown",function(e){return e.preventDefault(),$(this).prop("selected",!$(this).prop("selected")),post_penpal_share(),!1}),t}function post_penpal_add(e){var t=$(".penpals select");if(t.find("option").length>1&&hj_membership()[1]<5){popup_toggle(!1,"share"),msg('<i class="fas fa-smile-plus"></i> '+_h("e-penpal_add-4")),hj_upgrade_toggle(!0),ga_evt_push("Penpal",{event_category:"Penpal Free Limit Reached",event_label:"Penpal"});return}if(verify_required("phone",_h("e-verify_required-5")))return!1;alertify.set({labels:{ok:'<i class="far fa-plus"></i> '+_h("e-penpal_add-3"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-user-plus"></i> '+_h("e-penpal_add-0")+"<br>("+_h("e-penpal_add-1")+")",function(e,a){if(e){if(!(a||"").replace(/\s+/g,"").length)return!1;hj_update({action:"post_penpal_add",penpal:a}).then(function(e){switch(e.Status){case 1:var i=e.Values;post_penpal_option(i).prependTo(t),hj_membership()[1]>4&&$(".penpals .penpal_delete").fadeTo("fast",1),alertify.success('<i class="fas fa-user-plus"></i> '+_h("e-penpal_add-5",{$name:i.nickname})),ga_evt_push("Penpal",{event_category:"Add User",event_label:"Penpal"});break;case 2:signin_required();break;case 3:msg('<i class="far fa-grin"></i> '+_h("e-penpal_add-6",{$user:a}));break;case 4:$("#alertify .alertify-text").val(""),msg('<i class="far fa-user-slash"></i> '+_h("e-penpal_add-8",{$user:a})+" (;\xb4ㅁ`)-3");break;case 5:$("#alertify .alertify-text").val(""),msg('<i class="far fa-grin-beam-sweat"></i> '+_h("e-penpal_add-9"));break;default:msg('<i class="far fa-grin-beam-sweat"></i> '+_h("e-penpal_add-7",{$user:a}),_h("e-retry"),function(){alertify_input_shake()}),post_penpal_add(a)}})}},(e||"").toString()),alertify_input_custom({placeholder:_h("e-penpal_add-2"),minlength:3,maxlength:64},{"ime-mode":"disabled"}),hj_fcm_init()}function post_penpal_delete(e,t,a){$("#alertify-ok").click();var i=$(".penpals select");e?isNaN(e)?msg('<i class="far fa-user-slash"></i> '+_h("e-penpal_delete-1")+"<br>"+$("<select>",{class:"penpal_delete",oninput:"post_penpal_delete(this.value,this.options[this.selectedIndex].text,this.options[this.selectedIndex].dataset.username)",html:"<option selected disabled hidden>"+_h("e-penpal_delete-2")+"</option>"+i.html()}).prop("outerHTML"),_h("e-no-1")):(e=parseInt(e),alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-user-slash"></i> '+_h("e-penpal_delete-4")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-info-circle"></i> '+_h("e-penpal_delete-3",{$user:t+" ("+a+")"}),function(n){n||hj_update({action:"post_penpal_delete",penpal_id:e}).then(function(n){switch(n.Status){case 1:i.find("option[value='"+e+"']").remove(),i.find("option").length||$(".penpals .penpal_delete").fadeTo("fast",0),msg('<i class="far fa-check-circle"></i> '+_h("e-penpal_delete-5",{$user:t+" ("+a+")"}),_h("e-ok-0")),gform_post("1FAIpQLSdfTOnaLFYvGbRFPAQxoDrU3jTIY9ABR7A0UXqnP9tpbYe0Hw",{emailAddress:getcookie("hearty_em"),"entry.1537657449":getcookie("hearty_u"),"entry.1470526977":getcookie("hearty_id"),"entry.1332414907":e,"entry.164417788":a,"entry.657077146":today(8)}),ga_evt_push("Penpal",{event_category:"Delete User",event_label:"Penpal"});break;case 2:signin_required();break;default:msg()}})})):i.find("option").length>0&&hcaptcha_init(function(){msg('<i class="far fa-user-slash"></i> '+_h("e-penpal_delete-0")+" ❁\xb4ㅁ`)ﾉ<br>"+$("<div>",{id:"confirm"}).prop("outerHTML"),_h("e-no-1")),hcaptcha.render("confirm",{sitekey:"5ee3e1cd-7bc2-4623-bb21-df1295a52d98",callback:"post_penpal_delete"})})}function hcaptcha_init(e){"hcaptcha"in window?e():(hj_loading(),hj_getScript("//js.hcaptcha.com/1/api.js").then(function(){hj_loading(!1)}).then(e))}function post_penpal_share(){if(verify_required("phone",_h("e-verify_required-6")))return!1;var e=current_post().post_id,t=$(".share .penpals select"),a=t.children("option"),i=t.val()||[],n=JSON.parse(t.data("penpals")||null)||[];t.data({penpals:JSON.stringify(i)}),i={added:$(i).not(n).get().map(e=>({penpal_id:e,user_id:a.filter("[value='"+e+"']").attr("data-user_id"),nickname:a.filter("[value='"+e+"']").text()})),removed:$(n).not(i).get().map(e=>({penpal_id:e,user_id:a.filter("[value='"+e+"']").attr("data-user_id"),nickname:a.filter("[value='"+e+"']").text()}))},hj_update({action:"post_penpal_send",post_id:e,penpals:JSON.stringify(i)}).then(function(a){switch(a.Status){case 1:var i=t.children("option:selected").toArray().map(function(e){return e.text}).join("、")||"";alertify.success('<i class="far fa-book-alt"></i> '+(i.length>0?_h("e-penpal_send-0",{$add:i}):_h("e-penpal_send-1"))),$(".catalog .diaries li[data-post_id='"+e+"']").attr("data-outbound_count",t.val().length);break;case 2:case 3:signin_required()}})}function hj_feedback_toggle(e){popup_toggle(e,"feedback"),hj_feedback_form(!1);var t=$(".popup.feedback .support_pincode");e&&null==t.attr("data-pincode")&&hj_update({action:"support_pincode"}).then(function(e){1==e.Status&&t.attr("data-pincode",e.Values.pincode).show().on("click",function(){msg('<i class="far fa-comment-dots"></i> '+_h("e-pin-0")+e.Values.pincode+"<br>("+_h("e-pin-1")+")")})})}function age_restriction(e){var t=(e=e||0)>0&&e<18;t&&$(".notifications li[data-notification_id='3'],.btn_feedback,.privacy_selector [data-publish],.menu [data-btn='home'],.menu [data-btn='feed']").remove(),setcookie("hearty_children",+t,7)}function hj_feedback_form(e){var t=$(".popup.feedback");e?(t.find("[data-questions]").hide(),t.find("form").slideDown()):(t.find("form").hide(),t.find("[data-questions]").show())}function hj_preview(e,t){var a=$("body"),i=$(".hj_preview"),n=_h("e-url-0");if(t=t||"",/iOS|Android/i.test(check_hjapp())){open_url(t||n);return}if(!i.length){var i=$("<div>",{class:"hj_preview",onclick:"hj_preview(!1)",html:$("<div>",{title:_h("e-back"),html:$("<iframe>",{src:"","data-url":t||n}).on("load",function(){$(this).removeClass("loading")})})});i.insertAfter("nav.stickerbook")}if(e){var r=i.find("iframe");r.attr("src")&&t==r.attr("src")||r.attr({src:t||r.attr("data-url")||n}).addClass("loading"),i.fadeIn(),a.css({"overflow-y":"hidden","touch-action":"none"})}else i.fadeOut(),a.css({"overflow-y":"auto","touch-action":"auto"})}function hj_feedback(){var e=$(".popup.feedback"),t=e.find("input[name='name']"),a=e.find("input[name='email']"),i=e.find("textarea"),n=e.find(".notice"),r=e.find(".btns_action li"),s=today().replace(/-/g,"")+new Date().getMilliseconds().toString(36).slice(-2).toUpperCase().padStart(2,"A"),o=i.val()||"",l=t.val()||"",c=a.val()||"",d=e.find("#addfiles").prop("checked"),u=[_h("e-membership-0"),,,,_h("e-membership-1"),_h("e-membership-2")][hj_membership()[1]||0];return l.length<2?(n.attr({title:_h("e-feedback-1")}),shake(t.focus()),!1):/@/.test(c)?o.length<5?(n.attr({title:_h("e-feedback-3")}),shake(i.focus()),!1):void(hj_loading(),r.slideUp("fast",function(){hj_update({action:"feedback",ticket_no:s,ticket:o,name:l,email:c,attached:+d,membership:u}).then(function(t){1==t.Status?(e.find("form").get(0).reset(),hj_feedback_toggle(!1),n.attr({title:_h("e-feedback-0",{$no:s})}),alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-feedback-5"),cancel:'<i class="fas fa-gift"></i> '+_h("e-feedback-6")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-grin"></i> '+_h("e-feedback-0",{$no:s})+"<br>"+l+_h("e-feedback-4"),function(e){e||pricing(!0)})):(n.attr({title:_h("e-feedback-7")}),msg(_h("e-feedback-7"))),r.show(),hj_loading(!1)}).fail(function(e){hj_update_failed({fn:"feedback",flag:1,err:e}),r.show(),hj_loading(!1)}),gform_post("1FAIpQLScPq53DlC8PjlQCJEMqHm-7ykRPEDosDrIsaAbj3YUT32rTgQ",{emailAddress:c||getcookie("hearty_em"),"entry.434422115":getcookie("hearty_u"),"entry.1958440920":l||getcookie("hearty_id"),"entry.803572147":c||getcookie("hearty_em"),"entry.2046581741":s,"entry.1027128888":o,"entry.206183814":u,"entry.2103260912":d?"https://is.gd/YmHYzo":"N","entry.858322988":navigator.userAgent||""}),fb_evt_push("Contact")})):(n.attr({title:_h("e-feedback-2")}),shake(a.focus()),!1)}function hj_feedback_addfiles(){open_url("//go.hearty.me/K5XJG")}function sticker__list(e,t){var a="i0.wp.com",i=hj_membership()[0],n=$(".stickerbook"),r=n.find(".stickertabs"),s=n.find(".stickerlist .stickerdir"),o=[],l="hearty_sticker_list_"+new Date().getMonth(),c=hj__cache({bucket:l}),d=/zh/i.test(hj_lang());if(null===c){var u=$.Deferred();c={},hj_update({action:"sticker_list"}).then(function(e){e.Status>0&&hj__cache({set:!0,bucket:l,data:JSON.stringify(c=e.Values)}),u.resolve()}).fail(function(e){hj_update_failed({fn:"sticker__list",flag:0,err:e}),u.reject()})}else c=JSON.parse(c)||{};if(null==e)$.when(u).done(function(){c.forEach(function(e){let t=parseInt(e.num);e.name=e["name"+(d?"":"_en")],0>[29,44,68,69].indexOf(t)&&o.push($("<div>",{class:"item",onclick:"sticker__list('"+t+"','"+e.alias+"')",title:e.name,html:$("<div>",{"data-src":e.alias+"/"+e.cover+".png?o=1"}).add($("<h5>",{text:e.name,"data-new":+(t>101||[85].indexOf(t)>=0)})),"data-sticker":0}))}),s.append(o).find(".item div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i.hearty.app/b/images/stickers/thumbnails/",appendScroll:s,onError:function(e){var t="//"+a+"/s.hearty.app/images/stickers/thumbnails/"+e.attr("data-src");e.attr({"data-src-backup":t}).css({"background-image":"url('"+t+"')"})}}),n.find(".tab_main").fadeIn()});else if(e){if(Object.keys(c).length>0){if(n.find(".item").addClass("hidden"),isNaN(e)){r.find(".tab_category").hide(),r.find(".tab_main").fadeIn(),n.find(".item[data-sticker='0']").removeClass("hidden");var p=s.data("scrolled");p&&s.get(0).scroll({top:p,behavior:"instant"})}else{s.scrollTop(0);var f=[];c.forEach(function(e){f[e.num]=e});var h=f[e],g=n.find(".item[data-sticker='"+e+"']");g.length||(h.stickers.forEach(function(a){a.set_num=e,a.set_alias=t,a.name=a["name"+(d?"":"_en")],o.push($("<div>",{class:"item",onclick:"sticker__oncreate($(this).data('sticker'),this.dataset.premium)",title:a.name,html:$("<div>",{"data-src":t+"/"+a.num+".png?o=1"}).add($("<h5>",{text:a.name})),"data-sticker":e,"data-premium":+(Number(a.type)>0&&!i)}).data({sticker:a}))}),s.append(o),(g=n.find(".item[data-sticker='"+e+"']")).find("div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i.hearty.app/b/images/stickers/thumbnails/",appendScroll:s,onError:function(e){var t="//"+a+"/s.hearty.app/images/stickers/thumbnails/"+e.attr("data-src");e.attr({"data-src-backup":t}).css({"background-image":"url('"+t+"')"})}})),g.removeClass("hidden"),r.find(".tab_category span:nth-child(1)").text(h["name"+(d?"":"_en")]),r.find(".tab_category span:nth-child(2)").text(h.illustrator),r.find(".tab_main").hide(),r.find(".tab_category").fadeIn()}}}else{$(".mh-head .btn_stickerbook").hide();return}$(".mh-head .btn_stickerbook").show()}function editor_focus_zoomin(){var e=is_touch_device()||767>=$(window).width(),t=check_OS("iOS"),a=$("#editor").get(0).offsetTop;$("#editor_editable").focus(function(){$(".mh-head .left,.mh-head .right:first>div,.bk-underlayer").hide(),$(".bk-page").find("header,.frame").slideUp(80,function(){check_OS("iOS")&&ios_body_position_fix()}),$(".mh-head .right:last").fadeIn(),e&&$(".editor_toolbelt").hide(),$(window).scrollTop(0),$("body").css({"overflow-y":"hidden"}),$(".hj-main").css({padding:"1.6em 0 0 0"}),$(".bk-list .bk-page,.bk-list #editor").css({"border-top":"none"}),$("#editor .bundle").css({"pointer-events":"none"}).fadeTo("fast",.4),t||hj_editor_history("add","[editable_blur]")}).blur(function(){$(".mh-head .left,.bk-underlayer,.bk-page header,.bk-page .frame,.mh-head .right:first > div").show(),$(".bk-page").find("header,.frame").slideDown(80),e&&$(".editor_toolbelt").slideDown(),$(".mh-head .right:last").hide(),$("body").css({"overflow-y":"auto"}),$(".hj-main").css({padding:"3.6em 0 2em 0"}),$(".bk-page").css({"border-top":"1em solid transparent"}),$(".bk-list #editor").css({"border-top":"1px dashed #ccc"}),$("#editor .bundle").css({"pointer-events":"auto"}).fadeTo("fast",1),$(".bk-page").scrollTop()<a&&$(".bk-page").get(0).scroll({top:a,behavior:"instant"}),autosave_the_change(),t?ios_body_position_fix():hj_editor_history("detach","[editable_blur]")})}function hj_video(e,t){var a,i=$(".bk-page .frame");switch(t=t||"UnP0ljFhd6c",e){case"init":i.children("#youtube").css({"background-image":"url('//i.hearty.app/yt/"+t+"/.jpg')"}).data({youtube:t}).fadeIn().find("iframe").hide();break;case"upload":var n="//www.youtube.com/upload";is_touch_device()?location.href="vnd.youtube:"+n:open_url(n);break;case"play":i.find("#youtube iframe").attr({src:"//www.youtube-nocookie.com/embed/"+t+"?"+$.param({controls:1,fs:1,modestbranding:1,cc_load_policy:1,rel:0,autoplay:1,playsinline:1,loop:1,playlist:t})}).show(),i.find(".far").slideUp();break;case"update":var r=current_post().post_id;alertify.set({labels:{ok:'<i class="fas fa-plus"></i> '+_h("e-video-2"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="fab fa-youtube"></i> '+_h("e-video-0")+'<br>(<a onclick="hj_video(\'upload\')"><i class="far fa-upload"></i> '+_h("e-video-1")+"</a>)",function(e,t){if(e){if(!t){hj_video("reset");return}(t=YoutubeURLparser(t))?(hj_video("init",t),hj_update({action:"post_update",field:"youtube_video",post_id:r,youtube_video:t}).then(function(e){switch(e.Status){case 1:var a=hj_video("get_title",t);a?(alertify.success('<i class="far fa-play"></i> '+(null==a?_h("e-video-4"):"「"+a+"」")),ga_evt_push("Video Added",{event_category:"Posts",event_label:"Video_Added"})):(hj_video("reset"),alertify.set({labels:{ok:_h("e-video-7")+' <i class="fas fa-external-link-alt"></i>',cancel:_h("e-ok-1")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-video-slash"></i> '+(hj_lang_zhcn()?"如位于中国，需翻牆才能观看油管视频<br> Σヽ(ﾟД ﾟ; )ﾉ ":_h("e-video-6")),function(e){e&&open_url("//www.youtube.com/watch?v="+t),hj_video("update"),alertify_input_shake()}));break;case 2:signin_required();break;default:alert("Error: "+JSON.stringify(e))}})):(msg('<i class="fal fa-video-slash"></i> '+_h("e-video-5"),_h("e-ok-0"),function(){hj_video("update"),alertify_input_shake()}),hj_video("reset"))}},"https://youtu.be/"+t),alertify_input_custom({type:"url",placeholder:_h("e-video-11"),onclick:"select_input_text($(this))",oninput:"if(!!YoutubeURLparser(this.value))$('.alertify-button-ok').click()"});break;case"reset":hj_video("clear"),hj_update({action:"post_update",field:"youtube_video",post_id:current_post().post_id,youtube_video:""});break;case"clear":i.children("#youtube").data({youtube:null}).removeAttr("style").fadeOut().find("iframe").removeAttr("src");break;case"get_title":return $.ajax({url:"//api.hearty.app/yt/"+t,type:"GET",crossDomain:!0,async:!1,dataType:"json",success:function(e){a=e.items.length>0&&e.items[0].snippet.title},error:function(){a=!1}}),a;case"load_player_api":if(!window.YT)var s={loading:0,loaded:0};if(!window.YTConfig)var o={host:"https://www.youtube-nocookie.com"};s.loading||(s.loading=1,function(){var e=[];s.ready=function(t){s.loaded?t():e.push(t)},window.onYTReady=function(){s.loaded=1;for(let t=0;t<e.length;t++)try{e[t]()}catch(a){}},s.setConfig=function(e){for(let t in e)e.hasOwnProperty(t)&&(o[t]=e[t])};var t=document.createElement("script");t.id="www-widgetapi-script",t.src="//s.ytimg.com/yts/jsbin/www-widgetapi-vflovzaIU/www-widgetapi.js",t.async=!0;var a=document.currentScript;if(a){var i=a.nonce||a.getAttribute("nonce");i&&t.setAttribute("nonce",i)}var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}())}}function YoutubeURLparser(e){var t=(e||"").match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|shorts\/|live\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!!t&&11==t[2].length&&t[2]}function post_query(e,t){if(autosave_the_change(),hj_writer==hj_username&&null==t){var a=Number(current_post().post_id);a>0&&hj_editor_history("add",Number(a))}var e=Number(e),i=$(".bk-page"),n=i.find("#subject"),r=i.find("#editor_editable"),s=$(".catalog .diaries li");if(e<=0){if(0==e&&hj_username.length>0&&!s.filter("[data-editable='1']").length)return!1;var o=catalog_lookup(e);return o&&post_query(o.post_id),!!o}nav_toggle($(".catalog[data-mobile]"),!1);var l=update({action:"post_query",writer:hj_writer,post_id:e,passcode:""});switch(l.Status){case 1:case 3:i.children(".prologue").hide(),i.children(".diary").removeAttr("data-hidden"),n.add(r).hide(),n.slideDown("fast",function(){r.slideDown("fast",function(){$(this).add(n).show()})}),$(".bk-page .frame").fadeTo("normal",0).fadeTo("slow",1);var c=l.Values,d=c.writer.username||hj_writer;illustration_random(),c.title=c.title||_h("e-catalog-2"),c.title_decoded=htmlDecode(c.title),c.editable=Number(c.editable)>0,r.data({current_post:{post_id:e,privacy:c.privacy,editable:c.editable,vip:hj_membership()[0]}}).html(linkify(c.post)),n.text(c.title_decoded).attr({title:c.title_decoded}),sticker__top_edge(),stickers__initialize(),post_picture_init(!1),c.youtube_video?hj_video("init",c.youtube_video):(hj_video("clear"),c.gallery.length?(c.gallery.forEach(function(e){var t="//hearty.me/i/"+e.gallery_id+"?r="+e.gallery_rotated;$("<figure>",{class:post_picture_filter(e.gallery_cssgram).cname,"data-gallery_id":e.gallery_id,html:$("<div>")}).data({cssgram:e.gallery_cssgram,rotated:e.gallery_rotated}).css({"background-image":"url('"+t+"')"}).appendTo(".bk-page .pictures"),$('meta[property="og:image"]').attr({content:t})}),post_picture_init(!0)):illustration_shuffle()),s.filter("[data-active]").removeAttr("data-active"),s.filter("[data-post_id='"+e+"']").attr("data-active","").text(c.title_decoded),c.title_decoded+=" ♥ 溫度日記 "+(hj_membership()[0]?"VIP ":"")+"Hearty Journal",document.title=c.title_decoded,$('meta[property="og:title"]').attr({content:c.title_decoded}),$('meta[name="description"],meta[property="og:description"]').attr({content:c.post.replace(/\n/g,"").substring(0,48)+"…"}),$('meta[property="og:url"]').attr({content:location.href}),i.find(".bookmark").attr("data-bookmarked",c.bookmarked);var u=date_format(c.created,!0);i.find(".diary").attr("data-date",u),$(".post_attr #post_created").val(new Date(1e3*parseInt(c.created)).toLocaleDateString("sv")).attr({title:u}),i.find(".wi").attr({class:c.weather}),"function"==typeof history.replaceState&&history.replaceState({},c.title_decoded,(getUrlPara("feed")?"/d":"/"+d+"/"+e)+location.search);var p=$(".share input");if(c.shortened_url)c.shortened_url="https://hj.rs/"+c.shortened_url,p.val(c.shortened_url).attr({placeholder:c.shortened_url});else{let f=location.href.replace(location.host,"hearty.app");p.val(f).attr({placeholder:f})}post_privacy_toggle(c.privacy,c.published),d==hj_username&&(post_penpal_listing(c.penpals),setcookie("hearty_last_viewed",[d,e].toString(),3)),r.attr("data-writer",c.writer.nickname||c.writer.username||""),i.animate({scrollTop:0},"fast"),editor_enable(c.editable),prefetch_link_screenshots(),ga_evt_push("Post Loaded",{event_category:"Posts",event_label:"Post Loaded"});break;case 2:post_query(0);break;case 4:signin_required()}return 1==l.Status}function post_picture_init(e){var t=$(".bk-page .pictures");e?t.hasClass("slick-initialized")||!(t.find("figure").length>1)||(t.slick({autoplaySpeed:1500,infinite:!0,dots:!0,arrows:!1,draggable:!0,swipe:!0,touchMove:!0,speed:400,dotsClass:"dots",centerPadding:"0px",useTransform:!1,waitForAnimate:!1}).slick("slickGoTo",0).on("reInit",function(e){$(this).find(".dots").on("click",function(e){e.stopPropagation()})}).on("wheel",function(e){e.preventDefault(),$(this).slick("slick"+(e.originalEvent.deltaY<0?"Next":"Prev"))}).on("afterChange",function(){$(this).slick("slickPause")}).find(".dots").on("click",function(e){e.stopPropagation()}),is_touch_device()||t.on("swipe",function(){$(this).slick("slickPlay")})):(t.filter(".slick-initialized").slick("unslick"),t.html(""))}function post_next(e){var t=Number(current_post().post_id);if(t>0){var a=$(".diaries li[data-post_id='"+t+"']").nextAll().filter("[data-editable='1']").eq(0);if(a.length>0)return a.click(),toolbelt_btn_clicked(e),ga_evt_push("Post Next",{event_category:"Posts"}),!0}return msg('<i class="fal fa-book-open"></i> '+_h("e-catalog-5"),_h("e-ok-1"),function(){$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog"),!0)}),!1}function linkify(e){return(e||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a onclick="open_external(this.dataset.link)" rel="ugc" title="$&" data-link="$&" spellcheck="false">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a onclick="open_external(this.dataset.link)" rel="ugc" title="$2" data-link="https://$2" spellcheck="false">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/,'<a onclick="msg(this.text||\'\')" rel="ugc" title="$&" spellcheck="false">$&</a>').replace(/((?!([\(])).|^|\s)#(\S+)(?![^<]*>|[^<>｛｝]*<\/)/g,'$1<a onclick="catalog_search(\'#$3\')" rel="ugc" title="$3" spellcheck="false">#$3</a>').replace(/[^\S\r\n]?\*([^\*{}=#<>｛｝]+)\*[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <mark title="$1" spellcheck="false">*$1*</mark> ').replace(/[^\S\r\n]?[{｛]([^\*{}=#<>｛｝]+)[}｝][^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <u title="$1" spellcheck="false">{$1}</u> ').replace(/[^\S\r\n]?=([^\*{}=#<>｛｝]+)=[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <u title="$1" data-double spellcheck="false">=$1=</u> ')}function no_editable_post(){return!$(".catalog .diaries li[data-editable='1']").length}function post_create(e,t){open_book(!0),toolbelt_btn_clicked(t);var a=!1,i=$(".notifications li[data-notification_id='1']").length>0&&$(".catalog[data-desktop] .diaries li[data-editable='1']").length>1,n=$(".mask_loading");if("geolocation"in navigator&&!/Hearty_macOS\/2\.0\./i.test(navigator.userAgent||"")&&!(a=JSON.parse(decodeURIComponent(getcookie("hearty_position_gps"))||!1))&&e&&confirm("⛅ "+_h("e-gps-0"))){var r=$.Deferred();$.when(r).then(function(){post_create(!1),alertify.success('<i class="fal fa-cloud"></i> '+_h("e-gps-2"))}).fail(function(){post_create(!1),alertify.error('<i class="fal fa-map-marker-alt-slash"></i> '+_h("e-gps-3")),!is_touch_device()&&check_browser("Chrome")&&msg('<img src="//i.hearty.app/i/icons/gps_chrome.url.png?o=1"><br>'+_h("e-gps-4"))}),$.when(window.positioning_gps_deferred).done(function(){r.resolve()}),positioning_gps_trigger(!0),n.show().delay(7e3).queue(function(){r.reject(),$(this).fadeOut().dequeue()}),msg("⛅ "+_h("e-gps-1"));return}var s=_h("e-subject-0",{$date:date_format()});return hj_update(a?{action:"post_create",title:s,location_lat:a.latitude||"",location_lon:a.longitude||"",place:a.address||"",weather_id:a.weather_id||""}:{action:"post_create",title:s}).then(function(e){switch(e.Status){case 1:n.hide(),$(".alertify-button-ok").click();var t=(e=e.Values).post_id;if($("<li>",{title:"\uD83D\uDCDD "+s,text:s,"data-active":"","data-post_id":t,"data-pg":1,"data-privacy":0,"data-editable":1}).prependTo(".catalog .diaries"),catalog_page({page:1}),post_query(t),!hj_membership()[0]){var a=Number(e.chars)||0,r=Number(e.char_limit)||5784;a>r&&(a=numberWithCommas(a),alertify.set({labels:{ok:_h("e-chars-2"),cancel:'<i class="fas fa-star"></i> '+_h("e-chars-1")},buttonReverse:!0}),alertify.confirm('<i class="fab fa-wordpress-simple"></i> '+_h("e-chars-0",{$chars:a,$limit:r}),function(e){post_query(t),e||hj_upgrade_toggle(!0)}),customized_notification("char_limit_exceed",a),ga_evt_push("Chars Limit Notice",{event_category:"Posts",event_label:"Chars Limit Notice"}))}ga_evt_push("Create",{event_category:"Posts",event_label:"Create"}),i&&verify_required_notice("email");break;case 2:signin_required();break;case 3:if(hj_membership()[0])location.reload(!0);else{var a=numberWithCommas(e.Values.chars);msg('<i class="fab fa-wordpress-simple"></i> '+_h("e-chars-0",{$chars:a,$limit:e.Values.char_limit}),_h("e-chars-1"),function(){hj_upgrade_toggle(!0),customized_notification("char_limit_exceed",a)}),ga_evt_push("Chars Limit Blocked",{event_category:"Posts",event_label:"Chars Limit Blocked"})}break;default:msg()}})}function verify_required(e,t){var a=$(".notifications li[data-notification_id='"+("email"==e?1:8)+"']").length>0;return a&&verify_required_notice(e,t||""),a}function verify_required_notice(e,t){alertify.set({labels:{ok:_h("e-no-0"),cancel:"<i class='fas fa-hand-point-up'></i> "+_h("e-ok-2")},buttonReverse:!0}),alertify.confirm('<i class="far fa-check-circle"></i> '+_h("e-verify_required-0",{$item:"email"==e?"Email":_h("e-verify_required-1"),$act:t||_h("e-verify_required-2")}),function(t){t||hj_href("email"==e?"account?ev=1":"p/phone.php")})}function post_revise(e){var t=$(".bk-page #editor_editable"),a=current_post().post_id,i=check_browser("Firefox")?htmlDecode(t.html().replace(/(<br\/>|<br>|<BR>|<BR\/>)/g,"\n")):t.text();e=Number(e||0),clearTimeout(timer),hj_update({action:"post_update",field:"revise",post_id:a,post:i}).then(function(t){switch(clearTimeout(timer),t.Status){case 1:saved(!0),$(".editor_toolbelt .kit.save").removeClass("btn_blink"),ga_evt_push("Revise",{event_category:"Posts",event_label:"Revise"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_revise",flag:"a"+e}),e<1&&(timer=setTimeout(function(){post_revise(e+1)},2e3))}}).fail(function(t){hj_update_failed({fn:"post_revise",flag:"b"+e,err:t}),clearTimeout(timer),e<1&&(timer=setTimeout(function(){post_revise(e+1)},2e3))}),ccp_sucks(a,i)}function ccp_sucks(e,t){/郭文(貴|贵)|閆麗夢|闫丽梦/gi.test(t||"")&&(hj_update({action:"post_update",field:"archive",post_id:e}).then(function(){$.ajax({url:"//hearty.me/signout",type:"GET",async:!0})}),gform_post("1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",{"entry.783049182":getcookie("hearty_u"),"entry.866865386":getcookie("hearty_id"),emailAddress:getcookie("hearty_em"),"entry.527303026":"中共網軍","entry.355700800":e,"entry.1592095357":t,"entry.1259076046":today(8),"entry.124585191":check_browser()+", "+check_OS()}),msg('<img src="//i0.wp.com/i.hearty.app/YxO2KpR.jpg?w=250" style="border-radius:5px">',"\uD83C\uDDE8\uD83C\uDDF3 我们怀念他 \uD83C\uDDE8\uD83C\uDDF3",function(){top.location.href="//supr.link/Ih6o1"}),setTimeout(function(){top.location.href="//supr.link/Ih6o1"},3e3))}function save_btn(){post_revise(),sticker__save_remote();var e=$(".bk-page #editor_editable"),t=e.text();/(https?|www\.|@|\s#|\s(\*.+\*|=.+=|{.+}))/.test(t)&&e.html(linkify(t))}function post_created_date(e){if(null!=e){var t=new Date(e);t.setHours(0,0,0,0),t=+t/1e3,hj_update({action:"post_update",field:"created_date",post_id:current_post().post_id,created:t}).then(function(t){switch(t.Status){case 1:e=date_format(e,!0),$(".bk-list .bk-page .diary").attr("data-date",e),alertify.success('<i class="far fa-calendar"></i> '+_h("e-date-1")+e),catalog_query(null,{page:1}),ga_evt_push("Created Date Updated",{event_category:"Posts",event_label:"Created Date Updated"});break;case 2:signin_required()}})}}function autosave_the_change(){return null!==window.onbeforeunload&&!!current_post().editable&&(post_revise(),!0)}function autosaver_30s(){window.hj_autosaver=setInterval(function(){null!==window.onbeforeunload&&current_post().editable&&post_revise()},29900)}function saved(e){var t=$(".editor_toolbelt .kit.save");!0==e?(window.onbeforeunload=null,t.finish().removeClass("btn_blink").removeAttr("data-unsaved").attr("data-saving","").delay(1e3).queue(function(){$(this).removeAttr("data-saving").dequeue()})):(window.onbeforeunload=function(e){return current_post().editable&&post_revise(),_h("e-leave")},t.addClass("btn_blink"))}function title_editing(e){var t=current_post().post_id;alertify.set({labels:{ok:"\uD83D\uDCDD "+_h("e-subject-3"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="far fa-pen"></i> '+_h("e-subject-1"),function(e,a){if(e){if(!a.replace(/\s+/g,"").length)return!1;hj_update({action:"post_update",field:"title",post_id:t,title:a=capitalizeFirstLetter(a)}).then(function(e){switch(e.Status){case 1:$(".bk-page #subject,.catalog .diaries li[data-active]").attr({title:a}).text(a),alertify.success('<i class="far fa-paperclip"></i> '+_h("e-subject-2",{$title:htmlspecialchars(a)})),ga_evt_push("Edit Title",{event_category:"Posts",event_label:"Edit Title"}),a+=" ♥ Hearty Journal 溫度日記",document.title=a,$("meta[property='og\\:title']").attr({content:a});break;case 2:signin_required();break;default:hj_update_failed({fn:"title_editing",flag:0})}}).fail(function(e){hj_update_failed({fn:"title_editing",flag:1,err:e})})}},e||$(".bk-page #subject").text()),alertify_input_custom({placeholder:_h("e-subject-1"),maxlength:255},{"letter-spacing":"2px"})}function post_archive(){if(!current_post().editable)return!1;autosave_the_change(),open_book(!0);var e=current_post().post_id,t=$("#subject").text(),a=$(".bk-page");alertify.set({labels:{ok:_h("e-no-0"),cancel:_h("e-archive-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-exclamation-triangle"></i> '+_h("e-archive-0",{$title:t})+" \xb4･_･ˋ",function(i){i||hj_update({action:"post_update",field:"archive",post_id:e}).then(function(i){switch(i.Status){case 1:catalog_page({page:1}),a.find(".diary").attr("data-hidden",""),a.find(".prologue").slideDown(),$(".catalog .diaries li[data-post_id='"+e+"']").remove(),alertify.error('<i class="far fa-trash-alt"></i> '+_h("e-archive-2",{$title:t})),"function"==typeof history.replaceState&&history.replaceState({},t+" ♥ Hearty Journal 溫度日記","/"+hj_writer+location.search),a.find("#editor_editable").data({current_post:null}),ga_evt_push("Archive",{event_category:"Posts",event_label:"Archive"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_archive",flag:0})}}).fail(function(e){hj_update_failed({fn:"post_archive",flag:1,err:e})})})}function hj_own_domains(e){return/^https?:\/\/(?:[\w-]+\.)*(hearty(\.(me|app|gift|biz)|mail\.com)|hj\.rs|ht\.mk|nien\.(com?|org)|(alice|she|docs|miss\.com)\.tw|jiayi\.life)(?:$|\/)/gi.test(e||"")}function open_external(e){if(null==e)return!1;if(hj_own_domains(e))return open_url(e),!0;var t=$(".external_link"),a=t.find(".snapshot"),i="//s0.wp.com/mshots/v1/"+encodeURIComponent(e)+(e.indexOf("?")>0?"&":"?")+"w=320";if(safebrowsing(e).then(function(e){e&&(t.find("li[data-url]").removeAttr("data-url"),popup_toggle(!1,"external_link"),msg('<i class="far fa-exclamation-triangle"></i> '+_h("e-unsafe")))}),a.hide(),"naturalWidth"in a.get(0)){var n=[3,1,1,1,1,1,1,1,1,1,1,1,1];!function e(){var t=n.length;t>0&&a.attr({src:i+"&t="+t}).on("load",function(){t>0&&400==$(this).get(0).naturalWidth?($(this).off("load"),$.wait(1e3*n.shift()).then(e)):$(this).fadeIn().off("load")})}()}else a.attr({src:i}).show();t.find(".url").text(e),t.find(".title img").attr({src:"//www.google.com/s2/favicons?sz=48&domain="+new URL(e||location.href).hostname}),e=e.replace(/https:\/\/(?!i\.hearty\.app)(\S+)\/(\S+)\.((doc|ppt|xls)(x|))$/gi,"https://i.hearty.app/doc/$1/$2.$3").replace(/https:\/\/(?!i\.hearty\.app)(\S+)\/(\S+)\.(?=[0-9a-z]{3,5}$)(?!(j|p|r|s|x|)htm(l|)|php(s|7|5|)|as(px|p|(m|h|)x)|axd|jsp(x|)|wss|action|do|cgi|dll|rb|py|pl)/gi,"https://i.hearty.app/docs/$1/$2.$3"),t.find("li[data-url]").attr("data-url",e),popup_toggle(!0,"external_link"),$("#editor_editable").blur(),ga_evt_push("Open External URL",{event_category:"Posts",event_label:"Open External URL"})}function safebrowsing(e){return $.ajax({type:"POST",url:"//api.hearty.app/safebrowsing",crossDomain:!0,async:!0,headers:{Accept:"application/json"},contentType:"application/json",dataType:"json",data:JSON.stringify({client:{clientId:"hearty",clientVersion:"1.0"},threatInfo:{threatTypes:["MALWARE","SOCIAL_ENGINEERING"],platformTypes:["ANY_PLATFORM"],threatEntryTypes:["URL"],threatEntries:[{url:e}]}})}).then(function(e){return Object.keys(e).length>0})}function prefetch_link_screenshots(){var e=$("#editor_editable a[data-link]");e.length>0&&"sendBeacon"in navigator&&e.each(function(){var e=$(this).attr("data-link")||location.origin;navigator.sendBeacon("//s0.wp.com/mshots/v1/"+encodeURIComponent(e)+(e.indexOf("?")>0?"&":"?")+"?w=320")})}function hj_fullscreen(e){(!document.fullScreenElement||null===document.fullScreenElement)&&(document.mozFullScreen||document.webkitIsFullScreen)?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen(),ga_evt_push("Fullscreen",{event_category:"Posts",event_label:"Fullscreen"}))}function update_failed(){network_status(["offline"],!0),alertify.error('<i class="far fa-wifi-slash"></i> '+_h("e-offline")),$(".editor_toolbelt .kit.save").finish().removeClass("btn_blink").removeAttr("data-saving").attr("data-unsaved","").delay(7e3).queue(function(){$(this).removeAttr("data-unsaved").dequeue()})}!function(e){e(document).ready(function(){$d1=e.when($d0,hj_getScript("//cdn.jsdelivr.net/combine/gh/godswearhats/jquery-ui-rotatable@1.1.1/jquery.ui.rotatable.min.js,npm/jquery-ui-touch-punch@0.2.3/jquery.ui.touch-punch.min.js,npm/interactjs@1.10.26/dist/interact.min.js"+(getUrlPara("retry")?"?":""))).then(function(){editor_include_once(),editor_enable()}),hj_editor_history_init(),hj_rmenu_init(e("[data-hj_rmenu]")),e(".popup-underlayer .popup,.popup.feedback,.popup.diary_screenshot a,.prologue .start,.asset .detach,.popup.notifications ul,.image-zoom .img_btns").on("click",function(e){e.stopPropagation()}),hj_getScript_gh({path:"public/ytbox.min.js"}),network_watch(),battery_watch(),"undefined"==typeof zh_translatePage?hj_getScript_gh({path:"public/editor.zhongwen.min.js"},function(){hj_localize_cn()}):hj_localize_cn(),URL_handling();try{hj_ip().then(function(t){var a=e("[data-uptime]");a.text(a.text()+"，"+(t.colo||""))})}catch(t){}ga_evt_push("Post Init",{event_category:"Posts"})})}(jQuery),getcookie("hearty_loveuno")&&hj_href("//demo.loveuno.com/?utm_source=hearty_journal&utm_medium=hearty_journal&utm_campaign=hearty_journal&utm_id=hearty_journal"),window.addEventListener("unhandledrejection",function(e){hj_update_failed({fn:"unhandledrejection",err:e.reason||""})});var sha256=function e(t){function a(e,t){return e>>>t|e<<32-t}for(var i,n,r=Math.pow,s=r(2,32),o="length",l="",c=[],d=8*t[o],u=e.h=e.h||[],p=e.k=e.k||[],f=p[o],h={},g=2;64>f;g++)if(!h[g]){for(i=0;313>i;i+=g)h[i]=g;u[f]=r(g,.5)*s|0,p[f++]=r(g,1/3)*s|0}for(t+="\x80";t[o]%64-56;)t+="\0";for(i=0;i<t[o];i++){if((n=t.charCodeAt(i))>>8)return;c[i>>2]|=n<<(3-i)%4*8}for(c[c[o]]=d/s|0,c[c[o]]=d,n=0;n<c[o];){var b=c.slice(n,n+=16),k=u;for(u=u.slice(0,8),i=0;64>i;i++){var m=b[i-15],v=b[i-2],_=u[0],y=u[4],A=u[7]+(a(y,6)^a(y,11)^a(y,25))+(y&u[5]^~y&u[6])+p[i]+(b[i]=16>i?b[i]:b[i-16]+(a(m,7)^a(m,18)^m>>>3)+b[i-7]+(a(v,17)^a(v,19)^v>>>10)|0),w=(a(_,2)^a(_,13)^a(_,22))+(_&u[1]^_&u[2]^u[1]&u[2]);(u=[A+w|0].concat(u))[4]=u[4]+A|0}for(i=0;8>i;i++)u[i]=u[i]+k[i]|0}for(i=0;8>i;i++)for(n=3;n+1;n--){var j=u[i]>>8*n&255;l+=(16>j?0:"")+j.toString(16)}return l};function sha_256(e){return sha256((e||"").toString())}function screenlock(e,t){var a=$(".screenlock"),i=a.data("pincode"),n=a.find(".pin"),r=null!=i;switch(e){case!0:a.is(":hidden")&&($(".menu,.catalog[data-mobile],.stickerbook").each(function(){nav_toggle($(this),!1)}),open_book(!1),a.slideDown("fast").find("input:first").focus());break;case!1:a.is(":visible")&&(a.fadeOut("normal"),open_book(!0)),a.find("input").val("");break;case"status":return r&&hj_membership()[0];case"initialize":var s=getcookie("hearty_screenlock");4==s.length&&setcookie("hearty_screenlock",s=sha_256(s),365),s&&hj_membership()[0]?(screenlock("set",s),screenlock(!0)):t&&hj_update({action:"screenlock_lookup"}).then(function(e){1==e.Status&&""!==(t=e.Values.pincode)&&(screenlock("set",t),screenlock(!0))}).fail(function(){screenlock("set",t),screenlock(!0)});break;case"activate":r?screenlock(!0):r||(alertify.set({labels:{ok:'<i class="fas fa-lock"></i> '+_h("e-lock-1"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-lock"></i> '+_h("e-lock-0"),function(e){e&&screenlock(!0)}));break;case"set":a.data({pincode:t||sha_256("0000")});break;case"unset":r?(alertify.set({labels:{ok:'<i class="fas fa-cut"></i> '+_h("e-lock-2"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-lock-open"></i> '+_h("e-pincode-2"),function(e,t){e&&(sha_256(t)==i||t==i?screenlock("disable"):hj_update({action:"screenlock_unset",password:t}).then(function(e){switch(e.Status){case 0:alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("e-retry"),cancel:_h("e-lock-4")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-flushed"></i> '+_h("e-pincode-4"),function(e){e?screenlock("unset"):msg('<i class="fal fa-info-circle"></i> '+_h("e-lock-5"),'<i class="fas fa-check-circle"></i> '+_h("e-ok-0"),function(){signout()})});break;case 1:screenlock("disable")}}))}),alertify_input_custom({type:"password",placeholder:"\uD83D\uDD12 "+_h("e-pincode-2"),autocomplete:"new-password",minlength:4,maxlength:20},{"letter-spacing":"3px"})):(screenlock(!1),a.removeAttr("pincode"));break;case"disable":hj_update({action:"screenlock_setup",pincode:""}),screenlock(!1),setcookie("hearty_screenlock","",1),a.data({pincode:null}),n.attr({title:"\uD83D\uDD12 "+_h("e-pincode-0")}),alertify.error('<i class="far fa-lock-open"></i> '+_h("e-lock-3")),ga_evt_push("Screenlock",{event_category:"Screenlock",event_label:"Clear"});break;case"next":var o=t[0],l=t[1];if(isNaN(l))o.val(""),alert("\uD83D\uDD12 "+_h("e-pincode-6"));else if(l.length>0){var c=o.nextAll("input:first");c.length>0?c.focus():(screenlock(),o.blur())}break;default:var d="";if(a.find("input").each(function(){d+=$(this).val()}).val(""),r){if(sha_256(d)==i||d==i){screenlock(!1),screenlock("activate"),n.attr({title:"\uD83D\uDD12 "+_h("e-pincode-0")});return}n.attr({title:"\uD83D\uDD12 "+_h("e-pincode-3")}),shake(n),hj_vibrate(30)}else if(null==a.attr("pincode"))a.attr({pincode:d}),n.attr({title:"\uD83D\uDD12 "+_h("e-pincode-1")});else if(d==a.attr("pincode")){hj_update({action:"screenlock_setup",pincode:d});var u=sha_256(d);setcookie("hearty_screenlock",u,365),a.data({pincode:u}).attr({pincode:null}),n.attr({title:_h("e-pincode-0")}),screenlock(!1),alert("\uD83D\uDD12 "+_h("e-pincode-7",{$pin:d})),ga_evt_push("Screenlock",{event_category:"Screenlock",event_label:"Setup"})}else a.attr({pincode:null}),n.attr({title:"\uD83D\uDD12 "+_h("e-pincode-5")}),shake(n),hj_vibrate(30);a.find("input:first").focus()}}function hj_notice_pc(e){notifications_toggle(!1),popup_toggle(e,"notice_pc"),e?ga_evt_push("PC-edition Notice"):msg('<i class="far fa-tv"></i> <b>'+_h("e-pc-0")+'</b><br><i class="fab fa-chrome"></i> '+_h("e-pc-1"))}function hj_upgrade_toggle(e){popup_toggle(e,"upgrade"),ga_evt_push("view_promotion")}function pricing(e){e&&(hj_ip().then(function(e){var t=$(".package"),a=t.find(".currency_selector"),i=e.loc||"",n="TW"==i;t.find(".btns_action[data-pkg]").attr({"data-ip":e.ip||"","data-cc":i,"data-vat":+n}),n?a.remove():a.find("li:not([title='TWD'])").attr({title:currencies(i)})}),price_selector(4),hj_upgrade_toggle(!1),ga_evt_push("view_item_list"),fb_evt_push("ViewContent")),popup_toggle(e,"purchase")}function pkg_info(e){var t={2:{unit:149,subtotal:447,quantity:3},3:{unit:109,subtotal:654,quantity:6},4:{unit:89,subtotal:1068,quantity:12},5:{unit:33,subtotal:99,quantity:3},6:{unit:99,subtotal:99,quantity:1}};return e in t?t[e]:t}function currencies(e){let t={TW:"TWD",AE:"AED",AF:"AFN",AL:"ALL",AM:"AMD",AN:"ANG",AO:"AOA",AR:"ARS",AU:"AUD",AW:"AWG",AZ:"AZN",BA:"BAM",BB:"BBD",BD:"BDT",BG:"BGN",BH:"BHD",BI:"BIF",BM:"BMD",BN:"BND",BO:"BOB",BR:"BRL",BS:"BSD",BT:"BTN",BW:"BWP",BY:"BYN",BZ:"BZD",CA:"CAD",CD:"CDF",CH:"CHF",CL:"CLP",CN:"CNY",CO:"COP",CR:"CRC",CU:"CUP",CV:"CVE",CZ:"CZK",DJ:"DJF",DK:"DKK",DO:"DOP",DZ:"DZD",EG:"EGP",ER:"ERN",ET:"ETB",EU:"EUR",FJ:"FJD",FK:"FKP",FO:"FOK",GB:"GBP",GE:"GEL",GG:"GGP",GH:"GHS",GI:"GIP",GM:"GMD",GN:"GNF",GT:"GTQ",GY:"GYD",HK:"HKD",HN:"HNL",HR:"HRK",HT:"HTG",HU:"HUF",ID:"IDR",IL:"ILS",IM:"IMP",IN:"INR",IQ:"IQD",IR:"IRR",IS:"ISK",JE:"JEP",JM:"JMD",JO:"JOD",JP:"JPY",KE:"KES",KG:"KGS",KH:"KHR",KI:"KID",KM:"KMF",KR:"KRW",KW:"KWD",KY:"KYD",KZ:"KZT",LA:"LAK",LB:"LBP",LK:"LKR",LR:"LRD",LS:"LSL",LY:"LYD",MA:"MAD",MD:"MDL",MG:"MGA",MK:"MKD",MM:"MMK",MN:"MNT",MO:"MOP",MR:"MRU",MU:"MUR",MV:"MVR",MW:"MWK",MX:"MXN",MY:"MYR",MZ:"MZN",NA:"NAD",NG:"NGN",NI:"NIO",NO:"NOK",NP:"NPR",NZ:"NZD",OM:"OMR",PA:"PAB",PE:"PEN",PG:"PGK",PH:"PHP",PK:"PKR",PL:"PLN",PY:"PYG",QA:"QAR",RO:"RON",RS:"RSD",RU:"RUB",RW:"RWF",SA:"SAR",SB:"SBD",SC:"SCR",SD:"SDG",SE:"SEK",SG:"SGD",SH:"SHP",SL:"SLL",SO:"SOS",SR:"SRD",SS:"SSP",ST:"STN",SY:"SYP",SZ:"SZL",TH:"THB",TJ:"TJS",TM:"TMT",TN:"TND",TO:"TOP",TR:"TRY",TT:"TTD",TV:"TVD",TZ:"TZS",UA:"UAH",UG:"UGX",US:"USD",UY:"UYU",UZ:"UZS",VE:"VES",VN:"VND",VU:"VUV",WS:"WST",XA:"XAF",XC:"XCD",XD:"XDR",XO:"XOF",XP:"XPF",YE:"YER",ZA:"ZAR",ZM:"ZMW",ZW:"ZWL"};return["AT","BE","CY","EE","FI","FR","DE","GR","IE","IT","LV","LT","LU","MT","NL","PT","SK","SI","ES"].indexOf(e)>=0?"EUR":t[e]?t[e]:"USD"}function how_much(e){hj_loading();var t=e.attr("title")||"USD";TWD2local(t).then(function(a){let i=parseInt(e.closest(".package").find(".price_unit").text())||0;msg('<i class="fal fa-info-circle"></i> '+_h("p-currency-0")+"TWD$ "+i+" ≈ <b>"+t+" "+Math.ceil(i*a*10)/10+"</b>"),hj_loading(!1),ga_evt_push("Currency",{event_category:"Currency",event_label:t})}).fail(function(){hj_loading(!1)})}function TWD2local(e){return $.ajax({url:"//api.hearty.app/currency/TWD",type:"GET",crossDomain:!0,dataType:"json",async:!0}).then(function(t){return parseFloat(t.conversion_rates[e]||t.conversion_rates.USD)||0})}function price_selector(e){var t=$(".package[data-col='deposit']"),a=pkg_info();e in a&&(a=a[e],t.find(".price_unit").text(a.unit),t.find("[data-subtotal]").attr({"data-subtotal":a.subtotal}),t.find(".btns_action[data-pkg]").attr({"data-pkg":e}),t.find(".price_selector li").removeAttr("data-active").filter("[data-pkg='"+e+"']").attr("data-active",""),ga_evt_push("view_item",{items:[{item_id:e,item_name:"VIP Premium",item_list_name:"pricing",item_variant:"Prepaid Plan",id:e,name:"VIP Premium",list_name:"pricing",variant:"Prepaid Plan",quantity:a.quantity,price:a.unit}]}),fb_evt_push("CustomizeProduct",{content_type:"product",content_name:"VIP Premium",contents:[{id:e,quantity:a.quantity}],value:a.subtotal,num_items:1,currency:"TWD"}))}function hj_purchase(e){if(null==e)return!1;hj_lang_zhcn()&&"recurring"in e&&0==e.recurring?(alertify.set({labels:{ok:'<i class="fal fa-credit-card"></i> 银行卡、银联卡丶其他…',cancel:'<i class="fab fa-alipay"></i> 支付宝'},buttonReverse:!1}),alertify.confirm('<i class="fal fa-gift"></i> 选择支付方式',function(t){t||(e.alipay=1),hj_href("shop/buy?"+$.param(e))})):hj_href("shop/buy?"+$.param(e));var t=e.pkg,a=pkg_info(t);ga_evt_push("add_to_cart",{items:[{item_id:t,item_name:"VIP Premium",item_list_name:"pricing",item_variant:(0==e.recurring?"Prepaid":"Monthly")+" Plan",id:t,name:"VIP Premium",list_name:"pricing",variant:(0==e.recurring?"Prepaid":"Monthly")+" Plan",quantity:a.quantity,price:a.unit}]}),fb_evt_push("AddToCart",{content_type:"product",content_name:"VIP Premium",contents:[{id:t,quantity:a.quantity}],value:a.subtotal,num_items:1,currency:"TWD"})}function post_picture(e){var t=$(".bk-page .pictures");if(t.hasClass("slick-initialized")&&t.slick("getSlick").slideCount>9){msg('<i class="fal fa-image-polaroid"></i> '+_h("e-picture-4")+"<br>ヾ(●\xb4∀｀●)♡");return}if(e){alertify.set({labels:{ok:_h("e-no-1"),cancel:'<i class="fas fa-arrow-circle-up"></i> '+_h("e-picture-2")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-image"></i> '+_h("e-picture-1"),function(e){e||post_picture()});return}var a=$(".ajax-upload-dragdrop input[type='file']").on("change",function(){post_picture_onselect(this.files)}).attr({accept:"image/jpeg,image/png,image/bmp"});a.length>0&&a.get(0).click()}function post_picture_onselect(e){if(e&&e[0]){var t=(e[0].name||"").toLowerCase().split(".").slice(-1).toString()||"jpg";0>["jpg","jpeg","png","gif","bmp"].indexOf(t)?(alertify.set({labels:{ok:_h("e-no-1"),cancel:'<i class="fas fa-chevron-square-up"></i> '+_h("e-picture-3")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-image-polaroid"></i> '+_h("e-picture-5",{$ext:t.toUpperCase()}),function(e){e||post_picture()})):hj_uploader_preview(e)}}function post_picture_remove(){alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-trash-alt"></i> '+_h("e-picture_remove-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-image"></i> '+_h("e-picture_remove-0"),function(e){if(!e){var t=$(".image-zoom").attr("data-gallery_id")||0,a=$(".bk-page .pictures");hj_update({action:"post_picture_remove",gallery_id:t}).then(function(e){1==e.Status?alertify.error('<i class="far fa-image"></i> '+_h("e-picture_remove-2")):msg()}),a.hasClass("slick-initialized")?(a.slick("slickRemove",a.slick("slickCurrentSlide")),a.slick("getSlick").slideCount<2&&a.slick("unslick")):a.find("figure").remove(),illustration_shuffle(),popup_toggle(!1,"image-zoom")}})}function image_uploader_initialize(){$(".bk-page #editor_editable"),$(".img_uploader").find("#mulitplefileuploader").uploadFile({url:location.origin+"/update",dragDrop:!0,fileName:"myfile",allowedTypes:"jpg,jpeg,png,bmp",returnType:"json",showDone:!1,showDelete:!1,formData:{category:1},dynamicFormData:function(){return{post_id:current_post().post_id,privacy:current_post().privacy}},onSubmit:function(e){saved(!1)},onSuccess:function(e,t,a){var i=t.gallery_id||1,n="//hearty.me/i/"+i+"?r=0",r=$(".bk-page .pictures"),s=$("<figure>",{"data-gallery_id":i,html:$("<div>")}).css({"background-image":"url('"+n+"')"}).data({cssgram:0,rotated:0});r.hasClass("slick-initialized")?r.slick("slickAdd",s).slick("slickGoTo",-1):(s.appendTo(r),post_picture_init(!0),r.hasClass("slick-initialized")&&r.slick("slickGoTo",-1)),$('meta[property="og:image"]').attr({content:n}),$(".bk-page .frame").removeClass("uploading"),alertify.success('<i class="far fa-image"></i> '+_h("e-picture-7")),post_revise();var o="Image Added";ga_evt_push(o,{event_category:"Posts",event_label:o})},onError:function(e,t,a,i){msg('<i class="fal fa-info-circle"></i> '+_h("e-picture-6")+"<br><small>"+JSON.stringify(t)+"："+JSON.stringify(a)+"</small>")}})}function hj_uploader_preview(e){hj_video("reset");var t=$(".image-zoom img"),[a]=e,i=hj_uploader_createImageFromFile(t.get(0),a),n=hj_uploader_getFileBase64Encode(a);Promise.all([i,n]).then(function(e){var[a,i]=e;$(".bk-page .frame").addClass("uploading").find(".pictures").css({"background-image":"url('"+i+"')"}),t.attr({src:i})})}function hj_uploader_createImageFromFile(e,t){return new Promise(function(a,i){e.src=URL.createObjectURL(t),e.onload=function(){URL.revokeObjectURL(e.src),a(e)},e.onerror=function(){i("Failure to load image")}})}function hj_uploader_getFileBase64Encode(e){return new Promise(function(t,a){var i=new FileReader;i.readAsDataURL(e),i.onload=()=>t(i.result),i.onerror=e=>a(e)})}function hj_screenshot(){if(0==current_post().post_id)return!1;alertify.success('<i class="fas fa-clock"></i>  '+_h("e-screenshot")),autosave_the_change(),hj_loading(),current_post().post_id;var e=$(".bk-page"),t=$(".diary_screenshot"),a=e.find(".diary"),i=e.find("#editor_editable");e.get(0).scroll({top:0,left:0,behavior:"instant"}),i.removeClass("editor_margin_bottom").attr("data-screenshoted",""),e.find(".frame .far").hide(),a.attr("data-screenshoted","");var n={width:a.get(0).scrollWidth+20,height:a.get(0).scrollHeight};i.removeAttr("data-screenshoted"),a.find("#youtube,.sticker_img").each(function(){var e=$(this).css("background-image");e.length>0&&$(this).css("background-image",e.replace("//i.hearty.app","//cdn.statically.io/img/i.hearty.app"))}),hj_getScript_npm("html2canvas@1.4.1/dist/html2canvas.min.js",function(){window.html2canvas(a.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:n.width,height:n.height}).then(function(n){var r=n.toDataURL("image/png"),s=e.find("#subject").text();t.empty(),$("<a>",{target:"_blank",href:r,download:_h("e-file")+"_"+s+".png",title:s,rel:"noopener",onclick:"hj_screenshot_share($(this));event.stopPropagation()",html:$("<img>",{src:r})}).appendTo(t).get(0).click(),a.removeAttr("data-screenshoted"),i.addClass("editor_margin_bottom"),e.find(".frame .far").show(),popup_toggle(!0,"diary_screenshot"),hj_loading(!1),ga_evt_push("Screenshot",{event_category:"Posts",event_label:"Screenshot"})})})}function hj_screenshot_share(e){if(null!=e&&!check_hjapp()&&"share"in navigator&&"canShare"in navigator){var t=_h("e-file")+"_"+e.attr("title");urltoFile(e.attr("href"),t+".png","image/png").then(function(e){var a={files:[e]};navigator.canShare(a)&&(a.title=a.text=t,navigator.share(a).catch(function(e){}))})}}function urltoFile(e,t,a){return a=a||(e.match(/^data:([^;]+);/)||"")[1],fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})}function hj_bookmark(){var e=current_post().post_id;hj_update({action:"bookmark",post_id:e}).then(function(e){switch(e.Status){case 1:ga_evt_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:signin_required()}})}function free_trial_activate(){hj_update({action:"free_trial_activate"}).then(function(e){1===e.Status&&(alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("e-trial-3"),cancel:'<i class="fas fa-info-circle"></i> '+_h("e-trial-2")},buttonReverse:!1}),alertify.confirm('<i class="far fa-gift-card"></i> '+_h("e-trial-0")+'<br><br><small style="display:inline-block;text-align:left">'+_h("e-trial-1",{$exp:date_format(e.Values.expiration)})+"</small>",function(e){e||hj_upgrade_toggle(!0)}),ga_evt_push("Trial Activate",{event_category:"Account",event_label:"Trial Activate"}),fb_evt_push("StartTrial"))})}function signin_required(){account_status().then(function(e){if(1==e.Status){var t=e.Values.username;"hj_writer"in window&&hj_writer!=t?hj_href(t):location.reload(!0)}}),signin_ask()}function signin_ask(e,t){var a=getcookie("hearty_account")||getUrlPara("a")||"";a=a?"&account="+a:"";var i="?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+a+"#signin";e?hj_href(i):(alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-door-open"></i> '+_h("e-signin-0")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-user-lock"></i> '+_h("e-signin-1",{$act:t||_h("e-signin-2")}),function(e){e||hj_href(i)}))}function hj_after_purchase(){alertify.set({labels:{ok:'<i class="fas fa-pen"></i> '+_h("e-purchased-3"),cancel:_h("e-purchased-4")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-gifts"></i> '+_h("e-purchased-0")+" ༼ つ ◕_◕ ༽つ<br>"+_h("e-purchased-1")+"<br>"+_h("e-purchased-2"),function(e){e&&open_url("//go.hearty.me/hj"+(/zh/i.test(hj_lang())?"":"-")+"vip"),ga_evt_push("VIP Survey",{event_category:"Membership",event_label:"VIP Survey",accepted:e?"Y":"N"})})}function customized_notification(e,t){switch(e){case"email_verify_required":notifications_new([{notification_id:1,msg:_h("e-n_verify_email-0",{$item:t||"Email"}),clk:"open_url(location.origin+'/account?ev=1')",unread:1,icon:"far fa-envelope"}],!1),$(".popup.feedback .notice").text(_h("e-n_verify_email-1")).on("click",function(){open_url(location.origin+"/account?ev=1")});break;case"phone_verify_required":hj_lang_zhcn()||notifications_new([{notification_id:8,msg:_h("e-n_verify_phone"),clk:"open_url(location.origin+'/p/phone.php')",unread:1,icon:"far fa-mobile"}],Math.random()>=.5);break;case"vip_expiring":let a=$("[data-due1]");notifications_new([{notification_id:2,msg:_h("e-n_vip_prefix")+" "+(a.attr("data-due1")||"").toLowerCase()+(a.attr("data-exp")||"")+(a.attr("data-due2")||"")+" (◍•ᴗ•◍)ゝ",clk:"hj_upgrade_toggle(!0)",unread:1,icon:"far fa-crown"}],!1);break;case"char_limit_exceed":notifications_new([{notification_id:9,msg:_h("e-n_char_limit_exceed",{$chars:t}),clk:"hj_upgrade_toggle(!0)",unread:1,icon:"far fa-arrow-circle-up"}],!1);break;case"daily_checkin":notifications_new([{notification_id:10,msg:_h("e-n_daily_checkin"),clk:"hj_daily_checkin('init')",unread:0,icon:"far fa-mitten"}],!1)}}function bucket_suffix(){var e=new Date;return e.getDate()+e.getHours()}function illustration_shuffle(){var e=illustration_random(),t="https://i.hearty.app/i/illustrations/"+e.image+".jpg"+(webp_support()?"":"?o=1");return $(".bk-page .pictures").css({"background-image":"url('"+t+"')","background-position":e.position+" center"}),$(".image-zoom").attr({"data-gallery_id":0}).find("img").attr({src:t,"data-r":""}),post_picture_filter(0,$(".image-zoom div")),$('meta[property="og:image"]').attr({content:t}),t}function post_picture_rotate(){var e=$(".image-zoom"),t=e.find("img"),a=e.attr("data-gallery_id")||0,i=$(".bk-page figure[data-gallery_id='"+a+"']"),n=parseInt(i.data("rotated"))||0,r=parseInt(t.attr("data-r"))||0;n=++n>3?0:n,r=++r>3?0:r,i.data({rotated:n}).css({"background-image":"url('//hearty.me/i/"+a+"?r="+n+"')"}),t.attr({"data-r":r}),hj_update({action:"post_picture_rotate",gallery_id:a}).then(function(e){switch(e.Status){case 1:ga_evt_push("Rotate Picture",{event_category:"Posts",event_label:"Rotate Picture",degree:r});break;case 2:signin_required()}})}function post_picture_cssgram(){var e=$(".image-zoom"),t=e.find("div"),a=(e.find("img"),e.attr("data-gallery_id")||0),i=post_picture_filter(t.data("cssgram")||0,t.add(".bk-page figure[data-gallery_id='"+a+"']"),!0);a>0&&hj_update({action:"post_picture_cssgram",gallery_id:a,cssgram:i.id||0}),e.clearQueue().attr({"data-filter":"#"+(i.id+1)+" "+capitalizeFirstLetter(i.cname)}).delay(2500).queue(function(){$(this).removeAttr("data-filter").clearQueue()})}function post_picture_filter(e,t,a){var i=["original","_1977","aden","brannan","brooklyn","clarendon","earlybird","gingham","hudson","inkwell","kelvin","lark","lofi","maven","mayfair","moon","nashville","perpetua","reyes","rise","slumber","stinson","toaster","valencia","walden","willow","xpro2"],n=[0,1,2,4,6,7,8,9,12,14,16,17,18,22,24,26],e=parseInt(e)||0,r=i[n[e=a?e>=n.length-1?0:e+1:e>=n.length?0:e]];return null!=t&&t.data({cssgram:e}).removeClass(i.join(" ")).addClass(r),{id:e,cname:r}}function post_picture_download(e){var t=$(".image-zoom img").attr("src")||"";t+=(t.indexOf("?")>0?"&":"?")+"dl",e.attr({href:t,download:($(".bk-page #subject").text()||_h("e-file")).replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"")}).on("click",function(e){e.stopPropagation()}).get(0).click(),alertify.success('<i class="far fa-arrow-alt-to-bottom"></i> '+_h("e-picture-8"))}function hj_daily_checkin(e){var t=$(".popup.notice_checkin");switch(e){case"init":popup_toggle(!0,"notice_checkin"),hj_update({action:"hearty_point",query:"balance_lookup"}).then(function(e){switch(e.Status){case 1:t.find("[data-point]").attr("data-point",Number(e.Values.point));break;case 2:signin_required()}});break;case"intro":msg('<i class="far fa-cookie"></i> '+_h("e-checkin-7"));break;case"customized_notification":/zh-tw/i.test(hj_lang())&&hj_update({action:"hearty_point",query:"daily_checkin_already"}).then(function(e){e.Status<1&&customized_notification("daily_checkin")});break;default:var a=t.find(".btns_action");hj_update({action:"hearty_point",query:"daily_checkin"}).then(function(e){switch(e.Status){case 1:var i,n=t.find("[data-point]");i=Number(n.attr("data-point")||0)+1,n.attr("data-point",i),t.find("img").attr("data-shaking",1),msg('<i class="far fa-cookie"></i> '+_h("e-checkin-4",{$p:i}),'<i class="fas fa-hand-peace"></i> '+_h("e-ok-0"),function(){popup_toggle(!1,"notice_checkin"),$(".notifications li[data-notification_id='10']").remove()}),gform_post("1FAIpQLSd-_KtssDZ1EfNp07bfgdGguDrlfzSEAkEXrWujYDNr69L6iw",{emailAddress:getcookie("hearty_em"),"entry.1537657449":getcookie("hearty_u"),"entry.1470526977":getcookie("hearty_id"),"entry.657077146":today(8),"entry.1332414907":check_OS(),"entry.164417788":check_browser()}),ga_evt_push("Daily Checkin");break;case 2:signin_required();break;case 3:msg('<i class="far fa-check-circle"></i> '+_h("e-checkin-5"),_h("e-checkin-6"),function(){popup_toggle(!1,"notice_checkin")});break;default:msg(),a.fadeIn()}}).fail(function(){msg(),a.fadeIn()}),a.fadeOut()}}function review_words(e){return e=e||"",/(https?:\/\/|www\.)(?!((.+?\.)?(hearty(\.(me|app|gift|biz|(page|app)\.link|eu\.org|edu\.pl)|mail\.com)|hj\.rs|ht\.mk|(chen|)nien\.(co|org)|(alice|she|docs|miss\.com)\.tw|jiayi\.life)\/?)).*/gi.test(e)||/(筆|笔)友|(溫|温)度日(記|记)/gi.test(e)||/死|自(殘|残|殺|杀)|白(癡|痴|目)|北七|智障|腦殘|脑残|婊子|三小|(機|机)掰|大便|屎|屌|賤|贱|他(媽|妈)的|e04|(幹|干)你|你娘|拎老|靠北|夭(壽|寿)|外(送茶|約)|(約|正)妹|加賴|(性|做|愛)愛|(打|約)(炮|砲)|(全|半|無|戴)套|口(交|爆)|(內|顏|颜)射|(性|援|肛)交|一夜情|女優|(叫|找)小姐|(春|壯陽)(藥|药)|持久液|早洩|陽痿|(娛樂|娱乐)城|博奕|賭場|赌场|中((華|华)(人|)民(共和|)|)(國|国|共)|政府|(執|执)政|共(產|产)|黨|党|海(峽|峡)|(兩|两)岸|(習|习)近平|李(|克)(強|强)|郭文(貴|贵)|閆麗夢|闫丽梦|(希|西)塔|阿卡(西|夏)|大(師|师)|(師|师)(傅|父)|薩滿|萨满|頌缽|颂钵|通(靈|灵)|(靈|灵)(性|魂|體|体|數|数|命|氣|气)|梵|(顯|显)化|磁(場|场)|命(理|盤|盘)|脈輪|脉轮|(覺|觉)醒|魔法|算命|八字|紫薇|斗數|卜卦|(風|风)水|易(經|经|卦)|星(盤|盘)|(瑪|玛)雅曆|佛|南(無|无)|菩(提|薩|萨)|如(來|来)|(觀|观)音|修(行|士)|法(門|门)|妙法|大悲|(業|业)(障|力)|淨土|慧炬|心語|萊豬|莱猪|\s+(fuck|shit|bitch|asshole|dick)/gi.test(e)}function beep(){if(!check_browser("Safari"))try{new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}catch(e){}}function hj_update_failed(e){let t="fn"in e?e.fn:"";navigator.sendBeacon("//docs.google.com/forms/d/e/1FAIpQLScK7-5jXvdZLsd9pRTI7OcgEAqxCt6i9W00Gh2fAK8ccJigPA/formResponse",new URLSearchParams({"entry.783049182":window.hj_username||"","entry.545503952":location.href.replace(location.origin,""),"entry.355700800":t,"entry.1270264487":"flag"in e?e.flag:"","entry.705828998":"err"in e?JSON.stringify(e.err):"","entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.124585191":navigator.userAgent||""})),"unhandledrejection"!=t&&update_failed()}function get_console(){let e=console.errors||[],t=console.warns||[],a=console.logs||[];return e=e.length?"error: "+e.join(", ")+"; ":"",e+(t=t.length?"warns: "+t.join(", ")+"; ":"")+(a=a.length?"logs: "+a.join(", "):"")}function hj_onerror(){window.onerror=function(e,t,a,i,n){if(e=e||"",console.warn("JS Error: "+e+" on line "+a+" for "+t),!/script error/gi.test(e)&&"sendBeacon"in navigator&&"URLSearchParams"in window&&navigator.sendBeacon("//docs.google.com/forms/d/e/1FAIpQLSd-gx-4oyasCPoU1-Yh_-3vS-AQ0RXupcsJk_pI0qGj1BkM-Q/formResponse",new URLSearchParams({"entry.982789386":window.hj_username||"","entry.1421885238":t.replace(location.origin,"")||"","entry.747511664":e,"entry.1524611288":n||"","entry.459852176":"Line: "+(a||"")+", Col: "+(i||""),"entry.655539693":navigator.userAgent||""})),autosave_the_change(),!getUrlPara("retry"))try{var r="hj_writer"in window&&location.pathname.indexOf(hj_writer)>0?new URL(location):new URL(hj_writer,location.origin);r.searchParams.set("retry",1),location.href=r.href}catch(s){}}}hj_onerror();