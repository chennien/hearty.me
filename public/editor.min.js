"use strict";var timer,hj_editor_loaded=!0;function URL_handling(){getUrlPara("first")?hj_firstrun():getUrlPara("preview")?$(".mh-head,.btn_feedback").hide():getUrlPara("purchased")||getUrlPara("iap")?hj_after_purchase():getUrlPara("img")&&post_create().then(function(){post_picture(!0)});var a=getUrlPara("link");switch(a&&(location.href="//"+a+(a.indexOf("wv?o=")>0?"":(a.indexOf("?")>0?"&":"?")+"wvtab=1")),Number(getUrlPara("plans"))){case 1:hj_upgrade_toggle(!0);break;case 2:pricing(!0);break;case 3:pricing(!0),ga_event_push("remove_from_cart"),fb_event_push(!0,"RemoveFromCart")}var b=getUrlPara("penpal_add");b&&(post_penpal_add(b),popup_toggle(!0,"share"));var c=getUrlPara("f");if(c&&(hj_feedback_toggle(!0),parseInt(c)>1&&hj_feedback_form(!0)),"push"==getUrlPara("utm_source")&&$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog[data-mobile]"),!0),get_gift_stickers_init(),!check_hjapp())try{var d=new URL(location.href);["purchased","iap","preview","plans","f"].forEach(function(a){getUrlPara(a)&&d.searchParams.delete(a)}),"function"==typeof history.replaceState&&history.replaceState({},document.title,d.pathname+d.search)}catch(e){}}function hj_firstrun(){$(".tutorial").length>0&&(popup_toggle(!0,"tutorial"),hj_tutorial("init"))}function hj_tutorial(b){var a=$(".tutorial_slider");if(!a.length)return!1;switch(b){case"init":(a=a.not(".slick-initialized")).find("img").filter("[data-"+($("body").width()>1024?"mobile":"desktop")+"]").remove(),a.slick({infinite:!1,arrows:!is_touch_device(),dots:!0,draggable:!0,swipe:!0,touchMove:!0,adaptiveHeight:!0,speed:200,centerPadding:"0px",dotsClass:"dots",prevArrow:'<div class="tutorial_arrow fal fa-chevron-left"></div>',nextArrow:'<div class="tutorial_arrow fal fa-chevron-right" onclick="hj_tutorial(\'forward\')"></div>'}).on("edge",function(){hj_tutorial("finish")}).on("wheel",function(a){a.preventDefault(),$(this).slick("slick"+(a.originalEvent.deltaY<0?"Next":"Prev"))}),a.find("img").on("click",function(){hj_tutorial("next")}),$(".popup-underlayer").attr({onclick:"hj_tutorial('finish')"});break;case"next":hj_tutorial("forward"),a.slick("slickNext");break;case"forward":a.slick("slickCurrentSlide")+1==a.find("img").length&&hj_tutorial("finish");break;case"finish":whats_your_name(),popup_toggle(!1,"tutorial"),a.slick("unslick").add(".tutorial").remove()}}function whats_your_name(a){a=a||"",alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-ok-0"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-smile-wink"></i> '+_h("e-name-1"),function(b,a){b?(a=(a||"").trim()).length>0?(hj_update({action:"profile_update",field:"nickname",data:a}),$(".hj_user .name").attr("data-text",a),alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-name-4"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.confirm('<i class="far fa-flower"></i> '+_h("e-name-2",{$name:a})+"<br>"+_h("e-name-3"),function(a){a&&hj_fcm_init(),free_trial_activate()})):(whats_your_name(),alertify_input_shake()):free_trial_activate()},(a||"").toString()),alertify_input_custom({placeholder:_h("e-name-0"),autocomplete:"on",maxlength:20},{"letter-spacing":"4px"})}function get_gift_stickers_init(){"User_Reactive"==getUrlPara("utm_campaign")?window.hj_login?get_gift_stickers():(popup_toggle(!0,"notice_gift"),get_gift_stickers_stats("gift_notice")):getUrlPara("gift")&&get_gift_stickers()}function get_gift_stickers(){if(window.hj_login)msg('<i class="far fa-gift-card"></i> '+_h("e-get_stickers-0")+' <i class="far fa-grin-wink"></i>',_h("e-get_stickers-1"),function(){nav_toggle($(".stickerbook"),!0),get_gift_stickers_stats("toggle_stickerbook")});else{get_gift_stickers_stats("signin_redirect");var a=getcookie("hearty_account")||getUrlPara("a")||"";hj_href("?r=/"+(hj_writer||"")+"\uFF1Fgift=1"+(a=a?"&account="+a:"")+"#signin")}}function get_gift_stickers_stats(a){hj_update({action:"gform_post",uri:"1FAIpQLSd2vEj_DmNKt2_6K_X99NJZh4JtEzQ7eu49mXwpmnOelaZmFw",data:$.param({"entry.355700800":getUrlPara("utm_medium")||"","entry.1270264487":a||"","entry.783049182":"[hj_user_id]","entry.866865386":getcookie("hearty_account")||getUrlPara("a")||"[hj_username]","entry.1497216280":"[hj_email]","entry.124585191":check_browser()+", "+check_OS(),"entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0]})})}function network_watch(){window.addEventListener("online",function(){network_status(["offline"],!1)},{passive:!0}),window.addEventListener("offline",function(){network_status(["offline"],!0)},{passive:!0}),"connection"in navigator&&(navigator.connection.addEventListener("change",network_watch_speed),network_watch_speed())}function network_watch_speed(){network_status(["slow"],/2g/.test(navigator.connection.effectiveType))}function battery_watch(){if("battery"in navigator)battery_watch_handle(navigator.battery);else if("getBattery"in navigator)try{navigator.getBattery().then(battery_watch_handle)}catch(a){}}function battery_watch_handle(a){battery_watch_level(a),a.onlevelchange=function(){battery_watch_level(a)}}function battery_watch_level(b){var a=parseFloat((100*b.level).toFixed(2));return a<20&&($(".warning-underlayer[data-issue='battery'] > div").attr("data-battery",a),network_status(["battery"],!0)),a}function hj_idle(){var b=$(".editor_toolbelt"),c=$(".screenlock"),d=!is_touch_device()&&current_post().editable;function a(){hj__cache({set:!0,bucket:"hearty_idle",data:0}),d&&b.slideDown("normal")}$(document).on("mousemove keypress",a),$("#editor_editable").on("keydown",a),a(),setInterval(function(){var a=Number(hj__cache({bucket:"hearty_idle"}));switch(hj__cache({set:!0,bucket:"hearty_idle",data:++a}),!0){case 4==a&&autosave_the_change():break;case 8==a&&d&&b.is(":visible"):b.slideUp("slow");break;case 60==a&&screenlock("status")&&c.is(":hidden"):screenlock(!0)}},1e3)}function hj_editor_history_init(){"function"==typeof history.pushState&&(history.pushState(null,document.title,location.href),window.addEventListener("popstate",function(){var a=hj_editor_history("load");if(null!=a){var b=$("#editor_editable");switch(!0){case/^\d+$/.test(a):post_query(a,!0);break;case a.indexOf("editable_blur")>0:b.blur();case a.indexOf("popup_toggle")>0:popup_toggle(!1,a=a.split("]",2).slice(-1)[0]);case a.indexOf("editable_focus")>0:b.get(0).focus({preventScroll:!1})}}else $("nav:visible").length||open_book(!1),history.pushState(null,document.title,location.href);$("nav").each(function(){null!=$(this).data("mmenu")&&$(this).data("mmenu").close()})},!1))}function hj_editor_history(d,b){if("function"==typeof history.pushState){var c="hearty_editor_history",a=JSON.parse(hj__cache({bucket:c}))||[];switch(d){case"load":b=a.pop();break;case"add":history.pushState(null,document.title,location.href),a.push(b);break;case"detach":a=a.filter(a=>a!==b)}return hj__cache({set:!0,bucket:c,data:JSON.stringify(a)}),b}}function editor_enable(a){a=a||current_post().editable||!1;var b=$(".bk-page #editor_editable"),d=b.data("editor_loaded")||!1,c=$(".frame").find(".fa-video-plus,.fa-camera-alt").add(".hj_rmenu li[data-editing]");a?(d||(editable__initialize(),hj_idle(),screenlock("initialize",pincode||""),hj_getScript_gh({path:"public/jquery.uploadfile.min.js"},image_uploader_initialize),b.data({editor_loaded:!0}),$(".editor_toolbelt .kit.save").on("mouseover",save_btn)),sticker__list(),editor_focus_zoomin(),c.add($(".image-zoom:not([data-gallery_id='0']) .img_btns")).slideDown()):(sticker__list(!1),c.add($(".image-zoom .img_btns")).slideUp()),b.prop("contenteditable",a),toolbelt_toggle(a),window.hj_username?hj_username!=hj_writer?toast_signin(_h("e-welcome-1")):0>(document.referrer||"https://hearty.me").indexOf("hearty.me")&&toast_signin(_h("e-welcome-0",{$name:hj_username})):toast_signin()}function toast_signin(a){$(".toast_signin_reminder").attr({title:a||_h("e-welcome-2")}).fadeIn("fast").delay(7e3).queue(function(){$(this).fadeOut().dequeue()})}function vip_init(){var a=hj_membership()[0];if(a){var b=$(".popup.feedback input[name='ver']");b.filter("[data-ver='vip']").prop({checked:!0,disabled:!1}),b.filter("[data-ver='free']").prop({checked:!1,disabled:!0}),$(".mm-panel [data-vip='0']").remove()}return a}function vip_fn(b){var a=current_post();if(a.vip)switch(b){case"picture":a.editable&&post_picture();break;case"video":a.editable&&hj_video("update");break;case"catalog_search":catalog_search();break;case"post_attr":a.editable&&popup_toggle(!0,"post_attr");break;case"screenshot":hj_screenshot();break;case"screenlock":screenlock("activate")}else"screenlock"===b&&screenlock("unset"),hj_upgrade_toggle(!0);return a.vip}function hj_rmenu_init(b){var a=$(".hj_rmenu");!is_touch_device()&&a.length>0&&(b.get(0).addEventListener("contextmenu",function(a){hj_rmenu_toggle(a,!0,b)},{passive:!1}),a.get(0).addEventListener("mouseleave",function(a){hj_rmenu_toggle(a,!1,b)},{passive:!0}))}function hj_rmenu_toggle(b,d,c){var a=$(".hj_rmenu");d?(b.preventDefault(),a.css({top:Math.min(b.clientY,c.height()-a.height()-30)+"px",left:Math.min(b.clientX,c.width()-a.width()-30)+"px"}).show()):a.fadeOut("slow")}function datepicker_init(){$("<link>",{rel:"stylesheet",href:hj_jsdelivr()+"public/jquery.ui.datepicker.custom.min.css"}).appendTo("head"),/zh/i.test(hj_lang())?hj_getScript_gh({path:"public/safari.datepicker.tw.min.js"},datepicker_load):datepicker_load()}function datepicker_load(){var a=$(".post_attr #post_created"),b=new Date().getFullYear();return a.attr({type:"text"}).datepicker({changeYear:!0,changeMonth:!0,yearRange:b-20+":"+b,yearSuffix:_h("e-year"),dateFormat:"yy-mm-dd",showAnim:"slideDown",minDate:a.attr("min")||"",maxDate:a.attr("max")||""}).on("click",function(){$(this).datepicker("show")})}function editor_include_once(){var b=$("#editor_editable");new MutationObserver(function(a){a.forEach(saved)}).observe(b.get(0),{characterData:!0,subtree:!0}),b.get(0).addEventListener("paste",saved,{passive:!0}),autosaver_30s(),document.addEventListener("visibilitychange",function(){document.hidden&&autosave_the_change()},{passive:!0}),check_OS("iOS")&&current_post().editable&&window.addEventListener("pagehide",post_revise,!1),(check_OS("iOS")||check_browser("Safari"))&&datepicker_init(),vip_init(),catalog_init();var c=$(".mh-head .left");c.find(".fa-home-alt").on("click",function(){nav_toggle($(".menu"),!0),open_book(!1)}),c.find(".btn_catalog").on("click",function(){open_book(!0),nav_toggle($(".catalog"),!0)}),$(document).on("click",".bk-page figure",function(){var a=parseInt($(this).attr("data-gallery_id"))||0;a>0&&($(".image-zoom").attr({"data-gallery_id":a}).find("img").attr({src:"//hearty.me/i/"+a+"?r="+($(this).data("rotated")||0),"data-r":""}).show(),post_picture_filter($(this).data("cssgram")||0,$(this).add(".image-zoom div")),$(".bk-page .pictures.slick-initialized").slick("slickPause"))}),$(".bk-page .pictures").on("click",function(){popup_toggle(!0,"image-zoom"),$(".image-zoom img").fadeIn()}),$(".image-zoom").on("click",function(){$(this).fadeOut(),bk_blur(!1)}).find("img").on("click",function(b){var a=$(".bk-page .pictures.slick-initialized");a.length>0&&(a.slick("slickNext").find(".slick-active").click(),$(this).fadeTo("fast",.2,function(){$(this).fadeTo("normal",1)}),b.stopPropagation())});var a=$(".image-zoom .img_btns");if(a.find("[data-rotate]").on("click",post_picture_rotate),a.find("[data-cssgram]").on("click",post_picture_cssgram),a.find("[data-remove]").on("click",post_picture_remove),a.find("[data-download]").on("click",function(){post_picture_download($(this).find("a"))}),$(".screenlock input").on("focus",function(){$(this).val("")}).on("keyup",function(){screenlock("next",[$(this),this.value])}),check_hjapp()&&$(".kit.fa-expand-wide").remove(),getcookie("hearty_rated")&&$(".notifications li[data-notification_id='6']").remove(),/zh/i.test(hj_lang())||$(".privacy_selector [data-publish]").remove(),check_OS("Android")&&"wakeLock"in navigator)try{navigator.wakeLock.request("screen")}catch(d){}}function editor_editable_scroll_to_bottom(e,f){if(is_touch_device()&&13==e.keyCode){var b=$(".bk-page"),c=window.getSelection().getRangeAt(0),a=document.createRange(),d=Number(b.find("#editor_editable").height());a.selectNodeContents(f),a.setStart(c.endContainer,c.endOffset),a.cloneContents().textContent.toString().length<2&&(check_OS("iOS")?$("body").scrollTop(d-(window.screen.availHeight>=812?333:258)):b.scrollTop(d))}}function hj_fontresize(b,a){(a=a||$(".bk-page").find("#subject,#editor_editable")).css("font-size",parseInt(a.css("font-size")||16)+b)}function toolbelt_toggle(c){var a=$(".btn_stickerbook"),b=$(".editor_toolbelt");c?(a.show(),b.removeClass("off")):(a.hide(),b.addClass("off"))}function toolbelt_btn_clicked(a){null!=a&&a.fadeTo("fast",.3,function(){$(this).delay(1e3).fadeTo("normal",1)})}function sticker__draggable_handle(k,g){var b=$(".bundle .asset[data-asset_id='"+g+"']"),c=b.children(".sticker_img"),e=$("#editor").width(),h=$(".bk-list .bk-page").scrollTop()||0,i=$("#editor").get(0).offsetTop,f=b.position().top+h-i,d=b.get(0).offsetLeft,a=e-(d+c.width())-30;a>0&&c.length>0&&(a=Math.max(0,Math.ceil(a+c.width()-c.get(0).getBoundingClientRect().width)));var j={top:f,left:d,right:a,align_right:d+b.width()/2>Math.floor(e/2)?1:0};return{pos:j,overflow:{top:f>0,left:d>0,right:a>0}}}function sticker__editor_hotkeys(a,b,c){$(document).off("keydown"),a&&$(document).on("keydown",function(g){g.preventDefault();var d=$(".bundle .asset[data-asset_id='"+c+"']"),f={top:parseInt(d.css("top"))||0,left:parseInt(d.css("left"))||0},a=Object.assign({},f);switch(g.keyCode){case 13:case 27:case 32:sticker__paste({bundle_id:b,asset_id:c},!0);case 37:a.left-=15;break;case 38:a.top-=15;break;case 39:a.left+=15;break;case 40:a.top+=15;break;case 8:case 46:sticker__remove({bundle_id:b,asset_id:c})}var e=sticker__draggable_handle(b,c);e.overflow.left?e.overflow.right?e.overflow.top?sticker__update(b,c,"position",e.pos):a.top=f.top+15:a.left=f.left-15:a.left=5,d.animate(a,25);var h=parseInt(d.get(0).offsetTop-2*$(".bk-list .bk-page").height()/5);h<$(".bk-list .bk-page").height()+100&&$(".bk-list .bk-page").animate({scrollTop:h},60)})}function scheduled_maintenance(c,a){var b=timestamping();c?2==(a=a||[]).length&&b>a[0]&&b<a[1]&&network_status(["maintenance"],!0):(a=new Date(1e3*(a||3600*Math.ceil(b/3600))).toLocaleString(hj_lang(),{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Taipei"}),msg("\u{1F6A7} "+_h("e-maintenance-0")+a+"<br>"+_h("e-maintenance-1")),network_status(["maintenance"],!1),hj_mixpanel("Maintenance Notice",{maintenance_date:a=a.split(" ")[0]}),ga_event_push("Maintenance Notice",{event_category:"Maintenance",event_label:a}))}function network_status(a,b){var c=$(".warning-underlayer[data-issue]");a.length>0&&a.forEach(function(a){b?c.filter("[data-issue='"+a+"']").fadeTo("fast",1).attr("data-clickable",1).delay(8e3).queue(function(){$(this).attr("data-clickable",0).fadeTo("normal",0).dequeue()}):c.filter("[data-issue='"+a+"']").finish().fadeTo("fast",0).attr("data-clickable",0)}),b&&beep()}function flip_book(){$(".bk-flip").click()}function book__initialize(c){var a,b;(b=(a=$(".bk-list .bk-book")).length,{init:function(){a.each(function(){var c=$(this),f=a.not(c),g=c.parent(),d=$(".bk-read"),e=$(".bk-flip");d.on("click",function(){var a=$(this);f.data({opened:!1}).removeClass("bk-viewinside").parent().css("z-index",0).find(".bk-read").removeClass("bk-active"),f.hasClass("bk-filp")||f.addClass("bk-default"),c.data("opened")?(a.removeClass("bk-active"),c.data({opened:!1,flip:!1}).removeClass("bk-viewinside").addClass("bk-default")):(a.addClass("bk-active"),c.data({opened:!0,flip:!1}).removeClass("bk-filp bk-default").addClass("bk-viewinside"),g.css("z-index",b))}),e.on("click",function(){d.removeClass("bk-active"),c.data("flip")?c.data({opened:!1,flip:!1}).removeClass("bk-filp").addClass("bk-default"):c.data({opened:!1,flip:!0}).removeClass("bk-viewinside bk-default").addClass("bk-filp")})})}}).init(),$(".mask_loading").delay(600).queue(function(){$(this).finish().fadeOut("fast",function(){$(".bk-viewinside").length||$(".bk-list .bk-book").addClass("bk-rotate").delay(1200).queue(function(){c&&open_book(!0),$(this).removeClass("bk-rotate").dequeue(),window.$d0.resolve()})})}),$(".bk-list .bk-cover,.bk-left").on("click",function(){open_book(!0),$(".bk-page,.bk-cover-back .catalog").scrollTop(0)}),$(".bk-list .bk-back").on("click",flip_book),$(".bk-underlayer").on("click",function(){$(".bk-page .sticker_editing").length>0?sticker__paste():$(".bk-viewinside").length>0?open_book(!1):flip_book()}),$(".stickerbook .stickerlist .stickerdir").scroll(function(){$(this).scrollTop()>200?$(".stickerbook .fa-chevron-square-up").fadeIn():$(".stickerbook .fa-chevron-square-up").fadeOut(),$(".item[data-sticker='0']:visible").length>0&&$(this).data({scrolled:$(this).scrollTop()})}),$(".bk-list .bk-page,.bk-cover-back .catalog").delay(800).queue(function(){$(this).scrollTop(0).dequeue()}),check_browser("Edge")&&$(".bk-cover-back .catalog").scrollTop($(".bk-cover-back .catalog").get(0).scrollHeight)}function editable__initialize(){is_touch_device()&&$(".bk-list .bk-page").get(0).addEventListener("touchmove",function(a){if(a.cancelable)return!0},{passive:!0}),cssFeatureSupported("-webkit-user-modify","read-write-plaintext-only")||$("#editor_editable").on("keydown",function(a){if(13==a.keyCode)return document.execCommand("insertHTML",!1,"<br> "),!1})}function period__initialize(){var a=$(".periods");a.data("loaded")||hj_getScript_gh({path:"public/periods.min.js"},function(){a.slideDown("slow").data({loaded:!0})})}function createCaretPlacer(d){var a=$(".bk-page #editor_editable").get(0);if(a.focus({preventScroll:!1}),null!=window.getSelection&&null!=document.createRange){var b=document.createRange();b.selectNodeContents(a),b.collapse(d);var e=window.getSelection();e.removeAllRanges(),e.addRange(b)}else if(null!=document.body.createTextRange){var c=document.body.createTextRange();c.moveToElementText(a),c.collapse(d),c.select()}}function catalog_init(){$(document).on("click",".catalog .diaries li",function(){null!=this.dataset.active?nav_toggle($(".catalog"),!1):post_query(this.dataset.post_id)||$(this).remove()})}function catalog_search_toggle(c){switch(c){case!0:vip_fn("catalog_search");break;case!1:catalog_toggle(),catalog_search_toggle("toggle");break;case"toggle":var a=$(".catalog"),b=a.find(".btn_search");a.find(".diaries").slideUp("fast",function(){$(this).html($("<div>",{class:"catalog_loading"})).slideDown("slow")}),a.find(".btn_bookmarks").attr("data-queried",0),b.attr("data-queried",+!parseInt(b.attr("data-queried"))),1025>$("body").width()&&nav_toggle($(".catalog"),!0)}}function catalog_search(a){a=a||"",alertify.set({labels:{ok:"\u{1F50D} "+_h("e-search-2"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fad fa-search"></i> '+_h("e-search-0"),function(b,a){b?((a=(a||"").trim()).length>0?(catalog_query(a,{page:1}),catalog_search_toggle("toggle"),$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog"),!0)):catalog_toggle(),fb_event_push(!1,"Search")):catalog_toggle()},a),alertify_input_custom({type:"search",inputmode:"search",placeholder:_h("e-search-1"),autocomplete:"on",maxlength:30},{"letter-spacing":"2px"})}function bookmark_query(b,a){if(1==a.attr("data-queried")){catalog_toggle(),a.attr("data-queried",0);return}hj_update({action:"bookmark_query",page:b||0}).then(function(a){if(1===a.Status){var c=a.Values.catalog.map(function(a,b){return a.title=a.title||_h("e-bookmark-3"),a.title_decoded=htmlDecode(a.title),{post_id:a.post_id,title:a.title_decoded,privacy:a.privacy,editable:a.editable,outbound_count:a.outbound_count,page:Math.ceil((b+1)/10)}});catalog_listing(c),catalog_toggle("bookmarks");var b=a.Values.catalog.length;$(".catalog .pagination").attr("data-stats",_h("e-bookmark-"+(b>1?1:0),{$no:b}))}else update_failed()})}function catalog_query(a,c){"resolved"==window.$d2.state()&&(window.$d2=$.Deferred()),a=a||"";var d="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),b=[];b.length?window.$d2.resolve():hj_update({action:"catalog_query",writer:hj_writer,page:0,keyword:a}).then(function(a){if(1===a.Status){b=a.Values.catalog.map(function(a,b){return a.title=a.title||_h("e-catalog-2"),a.title_decoded=htmlDecode(a.title),{post_id:a.post_id,title:a.title_decoded,privacy:a.privacy,editable:a.editable,outbound_count:a.outbound_count,page:Math.ceil((b+1)/10)}}),hj__cache({set:!0,bucket:d,data:JSON.stringify(b)}),window.$d2.resolve();var c=a.Values.catalog.length;$(".catalog .pagination").attr("data-stats",_h("e-catalog-"+(c>1?1:0),{$no:c}))}else update_failed(),window.$d2.reject()}).fail(function(a){hj_update_failed({fn:"catalog_query",flag:1,err:a}),window.$d2.reject()}),$.when(window.$d2).done(function(){catalog_listing(b,c),a.length>0&&catalog_toggle("search");var d=[$(".bk-cover-back .fa-chevron-square-up"),$(".catalog[data-mobile] .fa-chevron-square-up")];$(".catalog[data-desktop]").get(0).scrollHeight>$(".bk-cover-back>div").height()&&$(".catalog[data-desktop]").scroll(function(){$(this).scrollTop()>10?d[0].fadeIn():d[0].fadeOut()}),$(".catalog[data-mobile]>div>div").scroll(function(){$(this).scrollTop()>10?d[1].fadeIn():d[1].fadeOut()}),window.$d2=$.Deferred()}).fail(function(a){hj_update_failed({fn:"catalog_query",flag:2,err:a}),window.$d2=$.Deferred()})}function catalog_listing(b,a){$(".catalog .diaries").html(b.map(function(a){return $("<li>",{title:"\u{1F4DD} "+a.title,"data-post_id":a.post_id,"data-pg":a.page,"data-privacy":a.privacy,"data-editable":a.editable,"data-outbound_count":a.outbound_count,text:a.title})})),null!=a&&catalog_page(a)}function catalog_lookup(b){var a=catalog_cached(),c=[];if(!a)return catalog_query(null,{page:1}),!1;if(a.length>0){if(a.forEach(function(a,b){c[a.post_id]=b}),b>0)return b in c?a[c[b]]:null;if(0===b)return a[0];if(-1===b)return a[a.length-1]}return null}function catalog_page(b){if(null==b)return!1;var a=Number(b.page)||1,d=b.post_id||0,f=$(".catalog"),c=f.find(".diaries"),g=f.find(".pagination");if(c.children("li[data-active]").removeAttr("data-active"),d>0){var e=catalog_lookup(d);if(null==e)return catalog_page({page:1}),!1;if(!e)return!1;a=e.page,c.children("li[data-post_id='"+d+"']").attr("data-active","")}else null!=b.btn&&b.btn.filter(".fal").toggleClass("fal fas").delay(450).queue(function(){$(this).toggleClass("fas fal").dequeue()});c.attr("data-pg",a);var h=g.children(".fa-caret-circle-left"),i=g.children(".fa-caret-circle-right");a>1?h.attr({onclick:"$(this).removeAttr('onclick');catalog_page({page:"+(a-1)+",btn:$(this)})"}).removeClass("disabled"):h.addClass("disabled"),c.children("li[data-pg='"+(a+1)+"']").length>0?i.attr({onclick:"$(this).removeAttr('onclick');catalog_page({page:"+(a+1)+",btn:$(this)})"}).removeClass("disabled"):i.addClass("disabled")}function catalog_cached(){var b="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),a=hj__cache({bucket:b});return null==a?null:JSON.parse(a)||{}}function catalog_toggle(c){var d=$(".catalog"),b=d.find(".diaries"),f=d.find(".pagination"),g=d.find(".tabs .btn_diary"),e={search:d.find(".btn_search"),bookmarks:d.find(".btn_bookmarks"),arr:f.find(".fa-caret-circle-left,.fa-caret-circle-right")},a=0;switch(c){case"my":switch(catalog_page({page:1}),a=b.find("[data-editable='1']").length/2){case 0:a=_h("e-catalog-3");break;case 1:a=_h("e-catalog-0");break;default:a=_h("e-catalog-1",{$no:a})}f.attr("data-stats",a),b.attr("data-pg",c);break;case"shared":switch(a=b.find("[data-editable='0']").length/2){case 0:a=_h("e-catalog-4");break;case 1:a=_h("e-catalog-0");break;default:a=_h("e-catalog-1",{$no:a})}f.attr("data-stats",a),b.attr("data-pg",c);break;case"search":switch(a=b.find("[data-editable='1']").length/2){case 0:a=_h("e-search-3");break;case 1:a=_h("e-catalog-0");break;default:a=_h("e-catalog-1",{$no:a})}f.attr("data-stats",a),b.attr("data-pg",c);break;case"bookmarks":b.attr("data-pg",1);break;default:catalog_query(null,{page:1}),b.attr("data-pg",1)}switch(g.removeAttr("data-active"),c){case"search":e.bookmarks.attr("data-queried",0);break;case"bookmarks":e.bookmarks.attr("data-queried",1),e.search.attr("data-queried",0);break;case"my":g.filter("[data-primary]").attr("data-active","");break;case"shared":g.filter("[data-shared]").attr("data-active","")}switch(c){case"my":case"shared":case"search":e.arr.addClass("disabled");break;default:e.arr.removeClass("disabled")}}function stickers__initialize(){stickers__detach();var a=Number(current_post().post_id);a>0&&hj_update({action:"sticker_query",post_id:a}).then(function(a){switch(a.Status){case 1:var b=a.Values;sticker__save_local(b),b.forEach(function(a){sticker__createDOM(a.id,a)});break;case 2:signin_required();break;default:hj_update_failed({fn:"stickers__initialize",flag:0})}}).fail(function(a){hj_update_failed({fn:"stickers__initialize",flag:1,err:a})})}function sticker__initialize(b,c,a){var e=$(".bundle .asset[data-asset_id='"+c+"']"),f=e.children(".sticker_img"),d=sticker__new_blank("asset",b,a);"angle"in a?f.css({transform:"rotate("+a.angle.deg+"deg)"}):a.angle=d.angle,"size"in a?f.css({width:a.size.width,height:a.size.height}):a.size=d.size,"position"in a?e.css({top:a.position.top,left:a.position.left}):a.position=d.position,current_post().editable?sticker__editor_initialize(b,c,a):sticker__paste({bundle_id:b,asset_id:c})}function sticker__editor_initialize(f,b,g){var e=is_touch_device(),h=$(".bundle .asset[data-asset_id='"+b+"']"),a=h.children(".sticker_img");h.draggable({start:function(b,c){e?a.addClass("dragging"):a.addClass("grabbing"),a.hasClass("dragthis")&&a.removeClass("dragthis")},stop:function(c,g){c.stopPropagation();var d=sticker__draggable_handle(f,b);sticker__update(f,b,"position",d.pos),e?a.removeClass("dragging"):a.removeClass("grabbing")},snap:!0,containment:"#editor",scroll:!1,cursor:"move",grid:[5,5],cancel:".ui-rotatable-handle"});var c=g.angle.deg,i=c/57.296;a.rotatable({angle:i,rotationCenterOffset:{top:0,left:0},start:function(b){a.data("rotate-mode",1)},rotate:function(e,d){0===a.data("rotate-mode")&&(e.stopPropagation(),i=d.angle.current,c=d.angle.degrees,sticker__update(f,b,"angle",{deg:c,rad:i}),sticker__rotation_margin_fixes(f,b))},stop:function(e,d){i=d.angle.current,c=d.angle.degrees,sticker__update(f,b,"angle",{deg:c,rad:i}),a.data("rotate-mode",0),sticker__rotation_margin_fixes(f,b)},rotationCenterOffset:{top:0,left:0},wheelRotate:!0}).data("rotate-mode",0),a.find(".ui-rotatable-handle").remove();var d=$("<div>",{class:"ui-rotatable-handle",title:_h("e-sticker-1")});if(!e){var j=d.clone(),k=d.clone(),l=d.clone();j.addClass("ui-rotatable-handle-ne"),k.addClass("ui-rotatable-handle-nw"),l.addClass("ui-rotatable-handle-sw"),a.append(j,k,l)}if(d.addClass("ui-rotatable-handle-se segrip"),a.append(d),a.find("div[class*='ui-rotatable-handle-']").bind("mousedown",function(b){a.rotatable("instance").startRotate(b)}),!e){var n=a.width()/a.height(),m=e?{}:{n:".ngrip",e:".egrip",s:".sgrip"};a.resizable({resize:function(b,a){h.css({"min-width":a.size.width})},stop:function(c,a){sticker__update(f,b,"size",{width:a.size.width,height:Math.round(a.size.height)}),$(this).height(a.size.width/n).css({top:0,left:0})},containment:"#editor",aspectRatio:!0,grid:5,minWidth:80,minHeight:80,maxWidth:.85*$("#editor_editable").width(),maxHeight:640,handles:m})}if(e){$(".ui-resizable-n,.ui-resizable-e,.ui-resizable-s").remove(),a.get(0).addEventListener("touchmove",function(g){if("touches"in g){var e={x:0,y:0,sum:0},k=hj__cache({bucket:"hearty_sticker_finger_gap"})||null,h=0,c=a.width(),d=a.height(),i={max:.85*$("#editor_editable").width(),min:80},l=1;if(a.data("aspect_ratio"))var j=a.data("aspect_ratio");else{var j=c/d;a.data({aspect_ratio:j})}if(g.touches.length>1){e.x=Math.abs(g.touches[1].pageX-g.touches[0].pageX),e.y=Math.abs(g.touches[1].pageY-g.touches[0].pageY),e.sum=Math.floor(Math.sqrt(Math.floor(e.x**2+e.y**2))),null!==k&&(h=e.sum-k),h=isNaN(h)?0:h,hj__cache({set:!0,bucket:"hearty_sticker_finger_gap",data:e.sum}),l=h/c*.4,c+=c*l,d=c/j,c<i.min?(d*=i.min/c,c=i.min):c>i.max&&(d*=i.max/c,c=i.max),c=Math.round(1e3*c)/1e3,d=Math.round(1e3*d)/1e3;var m=Math.floor(.45*Math.min(c,d));a.width(c).height(d).css({"font-size":m>100?100:m}),sticker__update(f,b,"size",{width:c,height:d}),Math.abs(h)>0&&a.hasClass("rotating")&&a.removeClass("rotating"),a.addClass("resizing"),a.hasClass("dragthis")&&a.removeClass("dragthis")}}},{passive:!0}),a.get(0).addEventListener("touchend",function(b){hj__cache({set:!0,bucket:"hearty_sticker_finger_gap"}),a.removeClass("resizing")},{passive:!0}),interact(".asset[data-asset_id='"+b+"']").on("hold",function(a){$(".asset[data-asset_id='"+b+"'] .sticker_editing").length||(sticker__cut({bundle_id:f,asset_id:b}),hj_vibrate(30))});var c=parseFloat(g.angle.deg),i=c/57.296;interact(".asset[data-asset_id='"+b+"'] .sticker_img").gesturable({onmove:function(d){c+=d.da,a.css({"-webkit-transform":"rotate("+c+"deg)",transform:"rotate("+c+"deg)"}),c>360?c-=360:c<0&&(c+=360),i=c/57.296,sticker__update(f,b,"angle",{deg:c,rad:i}),sticker__rotation_margin_fixes(f,b),Math.abs(d.da)>.5&&a.removeClass("resizing").addClass("rotating"),hj_log("* \u66F4\u65B0\u8CBC\u7D19\u89D2\u5EA6 "+b+"\uFF1A"+parseFloat(c).toFixed(2)+" \xb0")}}).on({gestureend:function(b){a.removeClass("rotating")}}),a.css({"-webkit-transform":"rotate("+c+"deg)",transform:"rotate("+c+"deg)"})}sticker__paste({bundle_id:f,asset_id:b}),hj_log("\u{1F3EE} \u521D\u59CB\u5316\u8CBC\u7D19\uFF1A"+f+"\uFF08"+b+"\uFF09")}function stickers__detach(){sticker__save_local([]),$("#editor .bundle").remove()}function sticker__oncreate(a,b){var c=current_post().post_id;Number(b)>0?(nav_toggle($(".stickerbook"),!1),hj_upgrade_toggle(!0)):(sticker__create(a),hj_mixpanel("Sticker Created",{post_id:c,sticker_set_num:a.set_num,sticker_set_alias:a.set_alias,sticker_num:a.num,sticker_name:a.name}),ga_event_push("Sticker Create",{event_category:"Posts",event_label:"Sticker Create"}))}function sticker__create(c,b){if(!current_post().editable)return!1;var a,g=sticker__lookup("page"),e="page"in g[1]?g[1].page:{},k="bundles"in g[1]?g[1].bundles:[],m=null==b,d=sticker__uniqID(),n={width:160,height:160},o=Math.min(n.width/c.width,n.height/c.height);if(c.width=Math.ceil(c.width*o),c.height=Math.ceil(c.height*o),c.align_right=1,m){b=sticker__uniqID(),a=sticker__new_blank("bundle",b,c);var p=k.map(function(b,a){return k[a].position.sum});p.push(0);var q=Math.max.apply(null,p);a.position.top=q,e[b]=a;var f=$(".bk-list .bk-page").scrollTop()||0,h={width:$("#editor").width()||0,height:$(".bk-list .bk-page").height()||0},i=$("#editor").get(0).offsetTop;f<i&&(f=i,$(".bk-list .bk-page").animate({scrollTop:f},100));var j={move:{top:f+(is_touch_device()?i:0)-.4*h.height-q},def:{top:f-i+.5*h.height-c.height+50,left:c.align_right?h.width-c.width||0:.1*h.width||0}},r={top:Math.ceil(j.move.top),left:Math.round(j.move.left)}}else{var r=null;a=e[b]}if(e[b].assets[d]=a.assets[d]=sticker__new_blank("asset",b,c),k=Object.keys(e).map(function(a){return e[a]}),sticker__save_local(k),sticker__createDOM(b,a,r),m){a.position=a.assets[d].position={top:Math.floor(j.def.top),left:Math.round(j.def.left),right:0,align_right:1},e[b].assets[d]=a.assets[d],sticker__update(b,d,"position",a.assets[d].position);var l=a.assets[d];hj_update({action:"sticker_create",post_id:current_post().post_id,data:{bundle_id:b,asset_id:d,bundle_top:a.position.top,bundle_left:a.position.left,bundle_right:a.position.right,bundle_align_right:a.position.align_right,item_num:l.item_num,asset_width:l.size.width,asset_height:l.size.height}}).then(function(a){switch(a.Status){case 0:update_failed();case 2:signin_required();case 3:msg(_h("e-sticker-4"),'<i class="fas fa-star"></i> '+_h("e-sticker-5"),function(){hj_upgrade_toggle(!0)})}})}sticker__cut({bundle_id:b,asset_id:d}),open_book(!0),hj_log("\u2795 \u65B0\u589E\u8CBC\u7D19\uFF1A"+b+"\uFF08"+d+"\uFF09")}function sticker__createDOM(c,d,h){var e,f,g,a;for(let b in f=$("<div>",{class:"bundle","data-bundle_id":c,html:$("<div>",{class:"bundle_innerbox"}),onContextMenu:"return false;"}).data("bundle-id",c).insertBefore("#editor_editable"),d.assets)a=d.assets[b],e=$(".hj-sample .asset").clone().attr({title:a.item_name,"data-editing":!0,"data-bundle_id":c,"data-asset_id":b}).data("asset-id",b).fadeTo("slow",.35),f.children(".bundle_innerbox").append(e),(g=$(".asset[data-asset_id='"+b+"'] .sticker_img")).width(a.size.width).height(a.size.height).addClass("dragthis").css({"background-image":"url('//i.hearty.app/b/images/stickers/"+a.set_alias+"/"+a.item_num+".png?o=1')"}),is_touch_device()&&g.children(".detach").get(0).addEventListener("touchmove",function(a){a.stopPropagation()},{passive:!0}),null==h?e.fadeTo("slow",1):setTimeout(function(){e.animate(h,150).fadeTo("slow",1)},0),sticker__initialize(c,b,d.assets[b])}function sticker__rotation_margin_fixes(f,d){var e=$(".bundle .asset[data-asset_id='"+d+"']"),c=e.children(".sticker_img");if(!(c.length<1)){var a=Math.floor(.9*c.get(0).getBoundingClientRect().width),b=Math.floor(.9*c.get(0).getBoundingClientRect().height);if(hj_log("\u8CBC\u7D19\u5C3A\u5BF8\uFF1A"+a+" x "+b),!a||!b)return!1;sticker__update(f,d,"size",{width:a,height:b},!0),e.css({"min-width":a,"max-height":b})}}function sticker__new_blank(c,d,a){var b={};return b.position={top:isNaN(a.top)?0:a.top,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right,topmargin:0,align_right:isNaN(a.align_right)?0:a.align_right},b.size={width:a.width,height:a.height},"asset"==c?(b.item_num=isNaN(a.num)?0:a.num,b.item_name=a.name,b.set_num=isNaN(a.set_num)?0:a.set_num,b.set_alias=a.set_alias,b.angle={deg:0,rad:0}):"bundle"==c&&(b.id=d||sticker__uniqID(),b.assets={},b.position.sum=0),b}function sticker__exec(i,d,a){var e=!1;if(null==a){var g=sticker__lookup("page");if(!g[0])return!1;g[1].page;var a=g[1].bundles}switch(i){case"add":var f=a.length;if(f)for(let b=0;b<f;b++)if(e){if(a[b].position.sum>a[b].position.top){var j=a[b].position.sum-a[b].position.top;for(let h=b;h<f;h++)a[h].position.top+=j}}else(a[b].position.top>d.position.top||b+1===f)&&(a[b].position.topmargin=b>0?a[b].position.top-a[b-1].position.sum:a[b].position.top,a[b].position.sum=a[b].position.top+a[b].size.height,a.splice(b,0,d),e=!0);else a.push(d);return sticker__save_local(a),sticker__createDOM(d.id,d),sticker__place(sticker__calc(sticker__order(a)));case"remove":for(let c=0;c<a.length;c++)a[c].id==d.id?(a.splice(c,1),e=!0):e&&a[c].position.align_right==a[c-1].position.align_right&&(a[c].position.topmargin+=a[c-1].position.topmargin+a[c-1].size.height,e=!1);return sticker__save_local(a),$(".bundle[data-bundle_id='"+d.id+"']").fadeOut(200,function(){$(this).remove()}),sticker__place(a)}}function sticker__order(a){if(null==a){var b=sticker__lookup("page");if(!b[0])return!1;b[1].page;var a=b[1].bundles}return a.length>1&&a.sort(function(a,b){return a.position.top-b.position.top}),a.forEach(function(a){$(".bundle[data-bundle_id='"+a.id+"']").detach().insertBefore("#editor_editable")}),a}function sticker__calc(a,d,c){if(null==a){var b=sticker__lookup("page");if(!b[0])return!1;b[1].page;var a=b[1].bundles}switch(d){case"add":a=sticker__exec("add",c,a);break;case"remove":a=sticker__exec("remove",c,a)}var e=["left","right"],f={alignment:"",top:0,sum:{left:0,right:0}};return a.forEach(function(b,d){var c=b.position.align_right,h=c;if(c=e[c],h=e[h^=1],b.position.top=Math.max(b.position.top,0),d>0&&c!==f.alignment?b.position.topmargin=b.position.top-f.top:(b.position.top=Math.max(b.position.top,f.sum[c]+1),b.position.topmargin=b.position.top-f.sum[c]),b.position.topmargin=Math.max(b.position.topmargin,0),f.sum[c]=b.position.sum=b.position.top+b.size.height,d>0&&c==f.alignment)for(let i in f.sum)f.sum[i]=b.position.sum;for(let g in b.assets)b.assets[g].position.top=b.position.top,b.assets[g].position.topmargin=b.position.topmargin,b.assets[g].position.align_right=b.position.align_right;a[d]=b,f.alignment=c,f.top=b.position.top,0===d&&sticker__top_edge(b),hj_log("\u{1F4C4} \u8ABF\u6574\u8CBC\u7D19\u4F4D\u7F6E "+b.id+"\uFF1A"+JSON.stringify(b.position))}),sticker__save_local(a),a}function sticker__top_edge(a){return!1}function sticker__place(a){if(null==a){var b=sticker__lookup("page");if(!b[0])return!1;b[1].page;var a=b[1].bundles}var c=$(".hj-styles");return a.forEach(function(a){if(c.children("style[data-bundle_id='"+a.id+"']").length){var b=a.position.align_right?'.bundle.bundle_right[data-bundle_id="'+a.id+'"]::before{height:'+a.position.topmargin+"px}":'.bundle.bundle_left[data-bundle_id="'+a.id+'"]::before{height:'+a.position.topmargin+"px}";c.children("style[data-bundle_id='"+a.id+"']").text(b)}else c.append($("<style>",{"data-bundle_id":a.id}))}),$("#editor .complement").remove(),$("#editor .bundle").each(function(c){var a=$(this).attr("class").split(" "),b=$("#editor .bundle").length>c+1?$(this).nextAll("#editor .bundle").eq(0).attr("class").split(" "):[];a.indexOf("bundle_left")>=0&&b.indexOf("bundle_left")>=0?$(this).after($("<div>",{class:"complement complement_right"})):a.indexOf("bundle_right")>=0&&b.indexOf("bundle_right")>=0&&$(this).after($("<div>",{class:"complement complement_left"}))}),a}function sticker__lookup(c,g,h){var i=hj__cache({bucket:"hearty_sticker_cache__"+current_post().post_id}),d=[null!==d,JSON.parse(i)||[]],a=[!1,{}];if(d[0]){var e,f={},b=d[1];b.forEach(function(a){f[a.id]=a}),a[1].page=b.length>0?f:{},a[1].bundles=b.length>0?b:[],"page"==c?(a[0]=!0,a[1].status=4):g in f?(e=a[1].bundle=f[g],"asset"==c&&h in e.assets?(a[0]=!0,a[1].status=3,a[1].asset=e.assets[h]):(a[0]="bundle"==c,a[1].status=2)):(a[0]=!1,a[1].status=1)}else a[0]=!1,a[1].status=0;return a}function sticker__update(c,e,b,a,h){var d,f=sticker__lookup("asset",c,e);if("angle"==b)a.deg=Math.abs(a.deg)>=360?Math.abs(a.deg).toFixed(0)-360:a.deg.toFixed(0),a.rad=Math.abs(a.rad)>=2*Math.PI?(Math.abs(a.rad)-2*Math.PI).toFixed(5):a.rad.toFixed(5);else for(let g in a)a[g]=Math.max(Math.floor(a[g]),0);if(!f[0]||!(b in f[1].asset))return!1;d=f[1].page,h||(d[c].assets[e][b]=a),["position","size"].indexOf(b)>=0&&(d[c][b]=a),sticker__save_local(Object.keys(d).map(function(a){return d[a]})),hj_log("\u{1F4BE} \u66AB\u5B58\u8CBC\u7D19 "+c+"\uFF08"+e+"\uFF09\u7684 "+b+" \u70BA\uFF1A"+JSON.stringify(a))}function sticker__cut(h){if(!current_post().editable||$(".bk-page .sticker_editing").length>0)return!1;var a,c=h.bundle_id,b=h.asset_id,e=$(".bundle[data-bundle_id='"+c+"']"),f=e.find(".asset[data-asset_id='"+b+"']"),d=f.children(".sticker_img"),i=$(".editor_toolbelt"),g=sticker__lookup("asset",c,b),j=is_touch_device();if(!g[0]||!("position"in g[1].asset))return e.remove(),!1;a=g[1].asset.position,e.children(".bundle_innerbox").css({top:a.top,left:a.left});var k=a.align_right?-1*(a.right+Math.floor(1.05*d.get(0).getBoundingClientRect().width)):a.left;return f.animate({left:k},0),f.draggable("enable"),d.rotatable("enable").children(".ui-resizable-handle,.ui-rotatable-handle").fadeIn(),j?interact(".asset[data-asset_id='"+b+"'] .sticker_img").gesturable({enabled:!0}):(d.resizable("enable"),sticker__editor_hotkeys(!0,c,b)),$("#editor_editable").addClass("readonly").prop({contenteditable:!1}).disableSelection(),e.children(".bundle_innerbox").width(0).css({"margin-left":"-1px","margin-right":"-1px"}),d.addClass("sticker_editing").removeClass("sticker_static"),$("#editor .bundle .sticker_static").fadeTo("fast",.5),f.attr("data-editing",!0),$(".editor_toolbelt #paste,#editor").attr({onclick:"sticker__paste("+JSON.stringify({bundle_id:c,asset_id:b})+",true);saved(false)"}),d.children(".detach").fadeIn(),i.find(".kits").hide(),i.find(".sticker span").fadeIn(),$(".mh-head .btn_stickerbook,.stickerbook .stickerlist").hide(),nav_toggle($(".stickerbook"),!1),j&&($(".bk-page").find("header,.frame").hide(),$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(Math.floor(a.top-1*$(".bk-list .bk-page").height()/4)).css({"border-top":"none"})),hj_log("\u2702\uFE0F \u526A\u4E0B\u8CBC\u7D19\uFF1A"+c+"\uFF08"+b+"\uFF09"),!0}function sticker__paste(d,l){var g,c=$(".bk-page .sticker_editing");if(!c.length)return!1;var a=null!=d&&"bundle_id"in d?d.bundle_id:c.attr("data-bundle-id"),e=null!=d&&"asset_id"in d?d.asset_id:c.attr("data-asset-id"),b=$(".bundle[data-bundle_id='"+a+"']"),h=b.find(".asset[data-asset_id='"+e+"']"),c=h.children(".sticker_img"),f=$(".hj-styles"),m=sticker__calc(sticker__order()),i=sticker__lookup("asset",a,e),j=is_touch_device();if(i[0]&&"position"in i[1].asset&&((g=i[1].asset.position).align_right?(b.addClass("bundle_right").removeClass("bundle_left"),b.children(".bundle_innerbox").addClass("alignment_right").removeClass("alignment_left"),f.children("style[data-bundle_id='"+a+"']").length||f.append($("<style>",{"data-bundle_id":a})),f.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_right::before{height:"+g.topmargin+"px}"),b.children(".bundle_innerbox").css({"margin-left":0,"margin-right":g.right+"px"})):(b.addClass("bundle_left").removeClass("bundle_right"),b.children(".bundle_innerbox").addClass("alignment_left").removeClass("alignment_right"),f.children("style[data-bundle_id='"+a+"']").length||f.append($("<style>",{"data-bundle_id":a})),f.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_left::before{height:"+g.topmargin+"px}"),b.children(".bundle_innerbox").css({"margin-left":g.left+"px","margin-right":0})),cssFeatureSupported("width","min-content")?b.children(".bundle_innerbox").width("min-content").height("min-content"):cssFeatureSupported("width","min-intrinsic")?b.children(".bundle_innerbox").width("min-intrinsic").height("min-intrinsic"):b.children(".bundle_innerbox").width("auto").height("auto")),sticker__place(m),$("#editor .bundle .sticker_static").fadeTo("fast",1),c.children(".detach").fadeOut(),$(".editor_toolbelt .sticker a").hide(),$(".editor_toolbelt .kits").fadeIn(),j){$(".bk-page").find("header,.frame").show();var n=$("#editor").get(0).offsetTop,o=$(".bk-list .bk-page").scrollTop()||0,k=$(".bk-list .bk-page");l&&k.scrollTop(o+n),k.addClass("scroll-smoothly").css({"border-top":"1em solid transparent"})}return sticker__rotation_margin_fixes(a,e),h.attr("data-editing",!1).css({top:0,left:0}),c.children(".ui-resizable-handle,.ui-rotatable-handle").hide(),current_post().editable&&(h.draggable("disable"),c.rotatable("disable"),j?interact(".bundle .asset[data-asset_id='"+e+"'] .sticker_img").gesturable({enabled:!1}):(c.resizable("disable"),sticker__editor_hotkeys(!1,a,e)),$("#editor_editable").prop({contenteditable:!0}),$(".mh-head .btn_stickerbook,.stickerbook .stickerlist").show()),$("#editor").removeAttr("onclick"),$("#editor_editable").removeClass("readonly").enableSelection(),c.addClass("sticker_static").removeClass("sticker_editing"),hj_log("\u{1F4CB} \u9ECF\u8CBC\u8CBC\u7D19\uFF1A"+a+"\uFF08"+e+"\uFF09"),!0}function sticker__remove(c){var d=current_post().post_id,a=c.bundle_id,b=c.asset_id;sticker__paste({bundle_id:a,asset_id:b})&&(sticker__exec("remove",{id:a}),sticker__top_edge(),hj_vibrate(30),$("#editor .bundle").length<2&&nav_toggle($(".stickerbook"),!0),createCaretPlacer(!1),hj_update({action:"sticker_remove",bundle_id:a,asset_id:b,post_id:d}).then(function(a){switch(a.Status){case 0:update_failed();case 2:signin_required()}})),hj_mixpanel("Sticker Removed",{post_id:d}),ga_event_push("Sticker Remove",{event_category:"Posts",event_label:"Sticker Remove"}),hj_log("\u{1F5D1}\uFE0F \u522A\u9664\u8CBC\u7D19\uFF1A"+a+"\uFF08"+b+"\uFF09")}function sticker__save_remote(){var a=sticker__lookup("bundles"),b="bundles"in a[1]?a[1].bundles:[];if(!b.length)return!1;hj_update({action:"sticker_save",post_id:current_post().post_id,bundles:JSON.stringify(b)}).then(function(a){switch(a.Status){case 0:case 3:update_failed();break;case 2:signin_required()}})}function sticker__save_local(a){var b=current_post().post_id;hj__cache({set:!0,bucket:"hearty_sticker_cache__"+b,data:JSON.stringify(a)})}function sticker__uniqID(){return new Date().getTime().toString(16)+performance.now().toString(36).slice(-2)}function hj__cache(a){var d="set"in a,c=("local"in a?"local":"session")+"Storage",b=$("body");if(c in window){if(!d)return window.eval(c).getItem(a.bucket)||b.data(a.bucket)||null;try{window.eval(c).setItem(a.bucket,a.data)}catch(e){b.data(a.bucket,a.data)}}else{if(!d)return b.data(a.bucket)||null;b.data(a.bucket,a.data)}}function hj_log(a){window.console&&window.hj_test&&console.log(a)}function post_privacy(a,b){autosave_the_change(),a=Number(a);var c=current_post().post_id,d=$(".bk-page #editor_editable");if($(".share .sharable_url"),verify_required("email",_h("e-verify_required-3"))||verify_required("phone",_h("e-verify_required-3")))return!1;if(banned_words(d.text())&&9==a){var e=hj_membership()[1]>4;if(hj_update({action:"gform_post",uri:"1FAIpQLSdPi8fPhBq6KN1ok8h6fK8h5At0SO0qANuNlDCNk6VDoVjjuA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]",emailAddress:"[hj_email]","entry.527303026":(b?"\u6295\u7A3F":"\u516C\u958B")+"\u65E5\u8A18 (\u5DF2"+(e?"\u520A":"\u62D2")+"\u767B)","entry.355700800":c,"entry.1592095357":(d.text()||"").trim(),"entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}),$(".privacy_selector [data-publish]").remove(),!e)return msg('<i class="fal fa-info-circle"></i> '+_h("e-privacy-2")+"<br>"+(b?_h("e-privacy-4"):_h("e-privacy-3"))),!1}else if(9==a&&!confirm(_h("e-privacy-5")))return!1;return hj_update({action:"post_privacy",post_id:c,privacy:a}).then(function(e){switch(e.Status){case 1:var b=d.data("current_post");return b.privacy=a,d.data({current_post:b}),post_privacy_toggle(a),$(".catalog .diaries li[data-post_id='"+c+"']").attr("data-privacy",a),a?alertify.success('<i class="far fa-lock-open"></i> '+_h("e-privacy-0")):alertify.error('<i class="far fa-lock"></i> '+_h("e-privacy-1")),hj_mixpanel("Post Privacy",{post_id:c,privacy:a}),ga_event_push("Privacy",{event_category:"Posts",event_label:a?"Public":"Private"}),!0;case 2:signin_required();break;default:hj_update_failed({fn:"post_privacy",flag:0})}}).fail(function(a){hj_update_failed({fn:"post_privacy",flag:1,err:a})})}function post_privacy_toggle(a,b){var d=$(".share .sharable_url"),e=$(".share .penpals");b=(a=Number(a))?Number(b||0):0,a?(e.hide(),d.slideDown(),post_sharable_url()):(d.add($(".share .qrcode")).hide(),e.slideDown());var c=$(".privacy_selector li"),f=c.filter("[data-publish]");c.removeAttr("data-selected"),c.filter("[data-privacy='"+a+"']").attr("data-selected",""),b?f.attr("data-selected",""):f.removeAttr("data-selected")}function post_sharable_url(){var c=$(".share .qrcode"),a=$(".share .sharable_url"),d=a.find("input"),b=d.val()||"";0>b.indexOf("hj.rs")?url_shortener(location.href,!0,$(".bk-page #subject").text()||"").then(function(a){a&&(hj_update({action:"post_sharable_url",post_id:current_post().post_id,shortened_url:a}),a="https://hj.rs/"+a,d.val(a),get_qrcode(c,a))}):get_qrcode(c,b),a.slideDown()}function hj_native_share(){var a=$(".share .sharable_url input").val()||location.href.replace(location.host,"hearty.app");if(a.indexOf("hearty.app")>0&&(a+=(a.indexOf("?")>0?"&":"?")+"st="+encodeURIComponent($(".bk-page #subject").text()||"")),/iOS|Android/i.test(check_hjapp()))location.assign("//hearty.me/wv?s="+encodeURIComponent(a.replace(/(^\w+:|^)\/\//,"")));else{if(!(is_touch_device()&&"share"in navigator))return!1;navigator.share({title:document.title,text:$("meta[name='description']").attr("content"),url:a}).catch(function(a){})}}function post_publish(){var c=Number(current_post().privacy),b=$(".bk-page #subject").text(),f=current_post().post_id,d=$(".bk-page #editor_editable").text().replace(/^\s+|\s+$/g,"")||"",e=!$(".privacy_selector li[data-publish]").is("[data-selected]"),a="";if(verify_required("email",_h("e-verify_required-4")))return!1;if(e){if(d.length<90){msg('<i class="fal fa-pen"></i> '+_h("e-publish-0"),_h("e-publish-1"));return}a=c?_h("e-publish-2",{$title:b}):_h("e-publish-3"),a+='<br><small><i class="fal fa-info-circle"></i> '+_h("e-publish-8")+"</small>",alertify.set({labels:{ok:'<i class="fas fa-inbox-out"></i> '+_h("e-publish-4"),cancel:_h("e-no-1")},buttonReverse:!1})}else a=_h("e-publish-9",{$title:b}),alertify.set({labels:{ok:'<i class="fas fa-inbox-in"></i> '+_h("e-publish-10"),cancel:_h("e-no-1")},buttonReverse:!1});alertify.confirm('<i class="fal fa-file-alt"></i> '+a,function(a){if(a){if(!c&&!post_privacy(9,e))return!1;hj_loading(),hj_update({action:"post_publish",post_id:f,published:+e}).then(function(a){switch(a.Status){case 1:e?(alertify.set({labels:{ok:'<i class="fas fa-eye"></i> '+_h("e-publish-6"),cancel:'<i class="fas fa-reply"></i> '+_h("e-publish-7")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-paperclip"></i> '+_h("e-publish-5",{$title:b}),function(a){a&&hj_href("feed?p=1&post="+f)}),hj_update({action:"gform_post",uri:"1FAIpQLSejAwJP2dSgdhGz79S9Q_JzqthM4JrAXhFB3dfKNCCfSJGi_A",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]","entry.1497216280":"[hj_email]",emailAddress:"[hj_email]","entry.355700800":f,"entry.1270264487":d,"entry.1259076046":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}).then(function(){post_privacy_toggle(9,!0)}),hj_mixpanel("Post Published"),ga_event_push("Post Published",{event_category:"Posts",event_label:"Post Published"})):(post_privacy_toggle(9,!1),alertify.error('<i class="far fa-eye-slash"></i> '+_h("e-publish-11")));break;case 2:signin_required();break;case 3:msg('<i class="fal fa-clone"></i> '+_h("e-publish-12")),$(".privacy_selector [data-publish]").remove();break;default:msg()}hj_loading(!1)}).fail(function(a){hj_update_failed({fn:"post_publish",flag:1,err:a})})}})}function post_penpal_listing(b){var a=$(".share .penpals select"),c=a.children("option");if(null==b)return hj_update({action:"post_penpal_listing"}).then(function(b){if(1==b.Status){var c=b.Values.penpals.map(function(a){return post_penpal_option(a)});a.html(c)}});c.length?(c.prop({selected:!1}),b.forEach(function(a){c.filter("[data-user_id='"+a+"']").prop({selected:!0})}),a.data({penpals:JSON.stringify(a.val()||[])})):post_penpal_listing().then(function(){$(".share .penpals option").length>0&&b.length>0&&post_penpal_listing(b)})}function post_penpal_option(a){var b=$("<option>",{value:a.penpal_id,title:a.nickname,"data-user_id":a.user_id,"data-username":a.username,text:a.nickname});return 1==a.blocked&&b.attr({disabled:"disabled"}),is_touch_device()||b.on("mousedown",function(a){return a.preventDefault(),$(this).prop("selected",!$(this).prop("selected")),post_penpal_share(),!1}),b}function post_penpal_add(a){if($(".share .penpals option").length>2&&hj_membership()[1]<5){popup_toggle(!1,"share"),msg('<i class="fas fa-smile-plus"></i> '+_h("e-penpal_add-4")),hj_upgrade_toggle(!0),hj_mixpanel("Penpal Free Limit Reached"),ga_event_push("Penpal",{event_category:"Penpal Free Limit Reached",event_label:"Penpal"});return}if(verify_required("phone",_h("e-verify_required-5")))return!1;alertify.set({labels:{ok:'<i class="fas fa-plus"></i> '+_h("e-penpal_add-3"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-user-plus"></i> '+_h("e-penpal_add-0")+"<br>("+_h("e-penpal_add-1")+")",function(b,a){if(b){if(!(a||"").replace(/\s+/g,"").length)return!1;hj_update({action:"post_penpal_add",penpal:a}).then(function(b){switch(b.Status){case 1:var c=b.Values;post_penpal_option(c).prependTo(".share .penpals select"),alertify.success('<i class="fas fa-user-plus"></i> '+_h("e-penpal_add-5",{$name:c.nickname})),hj_mixpanel("Penpal Add"),ga_event_push("Penpal",{event_category:"Add User",event_label:"Penpal"});break;case 2:signin_required();break;case 3:msg('<i class="far fa-grin"></i> '+_h("e-penpal_add-6",{$user:a}));break;case 4:$("#alertify .alertify-text").val(""),msg('<i class="far fa-grin-beam-sweat"></i> '+_h("e-penpal_add-8"));break;default:msg('<i class="far fa-grin-beam-sweat"></i> '+_h("e-penpal_add-7",{$user:a}),_h("e-retry"),function(){alertify_input_shake()}),post_penpal_add(a)}})}},(a||"").toString()),alertify_input_custom({placeholder:_h("e-penpal_add-2"),minlength:3,maxlength:64},{"ime-mode":"disabled"}),hj_fcm_init()}function post_penpal_share(){if(verify_required("phone",_h("e-verify_required-6")))return!1;var d=current_post().post_id,b=$(".share .penpals select"),e=b.children("option"),a=b.val()||[],c=JSON.parse(b.data("penpals")||null)||[];b.data({penpals:JSON.stringify(a)}),a={added:$(a).not(c).get().map(a=>({penpal_id:a,user_id:e.filter("[value='"+a+"']").attr("data-user_id"),nickname:e.filter("[value='"+a+"']").text()})),removed:$(c).not(a).get().map(a=>({penpal_id:a,user_id:e.filter("[value='"+a+"']").attr("data-user_id"),nickname:e.filter("[value='"+a+"']").text()}))},hj_update({action:"post_penpal_send",post_id:d,penpals:JSON.stringify(a)}).then(function(c){switch(c.Status){case 1:var a=$("select option:selected").toArray().map(function(a){return a.text}).join("\u3001")||"";alertify.success('<i class="far fa-book-alt"></i> '+(a.length>0?_h("e-penpal_send-0",{$add:a}):_h("e-penpal_send-1"))),$(".catalog .diaries li[data-post_id='"+d+"']").attr("data-outbound_count",b.val().length);break;case 2:case 3:signin_required()}})}function hj_feedback_toggle(a){popup_toggle(a,"feedback"),hj_feedback_form(!1);var b=$(".popup.feedback .support_pincode");a&&null==b.attr("data-pincode")&&hj_update({action:"support_pincode"}).then(function(a){1==a.Status&&b.attr("data-pincode",a.Values.pincode).show().on("click",function(){msg('<i class="far fa-comment-dots"></i> '+_h("e-pin-0")+a.Values.pincode+"<br>("+_h("e-pin-1")+")")})})}function age_restriction(a){var b=(a=a||0)>0&&a<18;b&&$(".notifications li[data-notification_id='3'],.btn_feedback,.privacy_selector [data-publish],.menu [data-btn='home'],.menu [data-btn='feed']").remove(),setcookie("hearty_children",+b,7)}function hj_feedback_form(b){var a=$(".popup.feedback");b?(a.find("[data-questions]").hide(),a.find("form").slideDown()):(a.find("form").hide(),a.find("[data-questions]").show())}function hj_preview(f,a){var e=$("body"),b=$(".hj_preview"),d=_h("e-url-0");if(a=a||"",/iOS|Android/i.test(check_hjapp())){open_url(a||d);return}if(!b.length){var b=$("<div>",{class:"hj_preview",onclick:"hj_preview(!1)",html:$("<div>",{title:_h("e-back"),html:$("<iframe>",{src:"","data-url":a||d}).on("load",function(){$(this).removeClass("loading")})})});b.insertAfter("nav.stickerbook")}if(f){var c=b.find("iframe");c.attr("src")&&a==c.attr("src")||c.attr({src:a||c.attr("data-url")||d}).addClass("loading"),b.fadeIn(),e.css({"overflow-y":"hidden","touch-action":"none"})}else b.fadeOut(),e.css({"overflow-y":"auto","touch-action":"auto"})}function hj_feedback(){var a=$(".popup.feedback"),c=a.find("input[name='name']"),d=a.find("input[name='email']"),e=a.find("textarea"),b=a.find(".notice"),f=a.find(".btns_action li"),j=new Date().toLocaleDateString("sv").replace(/-/g,"")+new Date().getMilliseconds().toString(36).slice(-2).toUpperCase().padStart(2,"A"),g=e.val()||"",h=c.val()||"",i=d.val()||"",k=a.find("#addfiles").prop("checked"),l=[_h("e-membership-0"),,,,_h("e-membership-1"),_h("e-membership-2")][hj_membership()[1]||0];return h.length<2?(b.attr({title:_h("e-feedback-1")}),shake(c.focus()),!1):/@/.test(i)?g.length<5?(b.attr({title:_h("e-feedback-3")}),shake(e.focus()),!1):void(hj_loading(),f.slideUp("fast",function(){hj_update({action:"feedback",ticket_no:j,ticket:g,name:h,email:i,attached:+k,membership:l}).then(function(c){1==c.Status?(a.find("form").get(0).reset(),hj_feedback_toggle(!1),b.attr({title:_h("e-feedback-0",{$no:j})}),alertify.set({labels:{ok:'<i class="fas fa-check-circle"></i> '+_h("e-feedback-5"),cancel:'<i class="fas fa-gift"></i> '+_h("e-feedback-6")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-grin"></i> '+_h("e-feedback-0",{$no:j})+"<br>"+h+_h("e-feedback-4"),function(a){a||pricing(!0)})):(b.attr({title:_h("e-feedback-7")}),msg(_h("e-feedback-7"))),f.show(),hj_loading(!1)}).fail(function(a){hj_update_failed({fn:"feedback",flag:1,err:a}),f.show(),hj_loading(!1)}),hj_update({action:"gform_post",uri:"1FAIpQLScPq53DlC8PjlQCJEMqHm-7ykRPEDosDrIsaAbj3YUT32rTgQ",data:$.param({emailAddress:i||"[hj_email]","entry.434422115":"[hj_user_id]","entry.1958440920":h||"[hj_username]","entry.803572147":i||"[hj_email]","entry.2046581741":j,"entry.1027128888":g,"entry.206183814":l,"entry.2103260912":k?"https://is.gd/YmHYzo":"N","entry.858322988":navigator.userAgent||""})}),fb_event_push(!1,"Contact")})):(b.attr({title:_h("e-feedback-2")}),shake(d.focus()),!1)}function hj_feedback_addfiles(){open_url("//go.hearty.me/K5XJG")}function sticker__list(a,n){var o="i0.wp.com",p=hj_membership()[0],b=$(".stickerbook"),c=b.find(".stickertabs"),e=b.find(".stickerlist .stickerdir"),i=[],j="hearty_sticker_list_"+new Date().getMonth(),d=hj__cache({bucket:j}),k=/zh/i.test(hj_lang());if(null===d){var l=$.Deferred();d={},hj_update({action:"sticker_list"}).then(function(a){a.Status>0&&(d=a.Values,hj__cache({set:!0,bucket:j,data:JSON.stringify(d)})),l.resolve()}).fail(function(a){hj_update_failed({fn:"sticker__list",flag:0,err:a}),l.reject()})}else d=JSON.parse(d)||{};if(null==a)$.when(l).done(function(){d.forEach(function(a){let b=parseInt(a.num);a.name=a["name"+(k?"":"_en")],0>[29,44,68].indexOf(b)&&i.push($("<div>",{class:"item",onclick:"sticker__list('"+b+"','"+a.alias+"')",title:a.name,html:$("<div>",{"data-src":a.alias+"/"+a.cover+".png?o=1"}).add($("<h5>",{text:a.name,"data-new":+(parseInt(a.num)>98)})),"data-sticker":0}))}),e.append(i).find(".item div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i.hearty.app/b/images/stickers/thumbnails/",appendScroll:e,onError:function(a){var b="//"+o+"/s.hearty.app/images/stickers/thumbnails/"+a.attr("data-src");a.attr({"data-src-backup":b}).css({"background-image":"url('"+b+"')"})}}),b.find(".tab_main").fadeIn()});else if(a){if(Object.keys(d).length>0){if(b.find(".item").addClass("hidden"),isNaN(a)){c.find(".tab_category").hide(),c.find(".tab_main").fadeIn(),b.find(".item[data-sticker='0']").removeClass("hidden");var h=e.data("scrolled");h&&e.scrollTop(h)}else{e.scrollTop(0);var m=[];d.forEach(function(a){m[a.num]=a});var f=m[a],g=b.find(".item[data-sticker='"+a+"']");g.length||(f.stickers.forEach(function(b){b.set_num=a,b.set_alias=n,b.name=b["name"+(k?"":"_en")],i.push($("<div>",{class:"item",onclick:"sticker__oncreate($(this).data('sticker'),this.dataset.premium)",title:b.name,html:$("<div>",{"data-src":n+"/"+b.num+".png?o=1"}).add($("<h5>",{text:b.name})),"data-sticker":a,"data-premium":+(Number(b.type)>0&&!p)}).data({sticker:b}))}),e.append(i),(g=b.find(".item[data-sticker='"+a+"']")).find("div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i.hearty.app/b/images/stickers/thumbnails/",appendScroll:e,onError:function(a){var b="//"+o+"/s.hearty.app/images/stickers/thumbnails/"+a.attr("data-src");a.attr({"data-src-backup":b}).css({"background-image":"url('"+b+"')"})}})),g.removeClass("hidden"),c.find(".tab_category span:nth-child(1)").text(f["name"+(k?"":"_en")]),c.find(".tab_category span:nth-child(2)").text(f.illustrator),c.find(".tab_main").hide(),c.find(".tab_category").fadeIn()}}}else{$(".mh-head .btn_stickerbook").hide();return}$(".mh-head .btn_stickerbook").show()}function editor_focus_zoomin(){var a=is_touch_device()||767>=$(window).width(),b=check_OS("iOS"),c=$("#editor").get(0).offsetTop;$("#editor_editable").focus(function(){$(".mh-head .left,.mh-head .right:first>div,.bk-underlayer").hide(),$(".bk-page").find("header,.frame").slideUp(80,function(){check_OS("iOS")&&ios_body_position_fix()}),$(".mh-head .right:last").fadeIn(),a&&$(".editor_toolbelt").hide(),$(window).scrollTop(0),$("body").css({"overflow-y":"hidden"}),$(".hj-main").css({padding:"1.6em 0 0 0"}),$(".bk-list .bk-page,.bk-list #editor").css({"border-top":"none"}),$("#editor .bundle").css({"pointer-events":"none"}).fadeTo("fast",.4),b||hj_editor_history("add","[editable_blur]")}).blur(function(){$(".mh-head .left,.bk-underlayer,.bk-page header,.bk-page .frame,.mh-head .right:first > div").show(),$(".bk-page").find("header,.frame").slideDown(80),a&&$(".editor_toolbelt").slideDown(),$(".mh-head .right:last").hide(),$("body").css({"overflow-y":"auto"}),$(".hj-main").css({padding:"3.6em 0 2em 0"}),$(".bk-list .bk-page").css({"border-top":"1em solid transparent"}),$(".bk-list #editor").css({"border-top":"1px dashed #ccc"}),$("#editor .bundle").css({"pointer-events":"auto"}).fadeTo("fast",1),$(".bk-list .bk-page").scrollTop()<c&&$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(c).addClass("scroll-smoothly"),autosave_the_change(),b?ios_body_position_fix():hj_editor_history("detach","[editable_blur]")})}function hj_video(e,a){var f,b=$(".bk-page .frame");switch(a=a||"UnP0ljFhd6c",e){case"init":b.children("#youtube").css({"background-image":"url('//i.hearty.app/yt/"+a+"/.jpg')"}).data({youtube:a}).fadeIn().find("iframe").hide();break;case"upload":var c="//www.youtube.com/upload";is_touch_device()?location.href="vnd.youtube:"+c:open_url(c);break;case"play":b.find("#youtube iframe").attr({src:"//www.youtube-nocookie.com/embed/"+a+"?"+$.param({controls:1,fs:1,modestbranding:1,cc_load_policy:1,rel:0,autoplay:1,playsinline:1,loop:1,playlist:a})}).show(),b.find(".far").slideUp();break;case"update":var g=current_post().post_id;alertify.set({labels:{ok:'<i class="fas fa-plus"></i> '+_h("e-video-2"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="fab fa-youtube"></i> '+_h("e-video-0")+'<br>(<a onclick="hj_video(\'upload\')"><i class="far fa-upload"></i> '+_h("e-video-1")+"</a>)",function(b,a){if(b){if(!a){hj_video("reset");return}(a=YoutubeURLparser(a))?(hj_video("init",a),hj_update({action:"post_update",field:"youtube_video",post_id:g,youtube_video:a}).then(function(c){switch(c.Status){case 1:var b=hj_video("get_title",a);b?(alertify.success('<i class="far fa-play"></i> '+(null==b?_h("e-video-4"):"\u300C"+b+"\u300D")),hj_mixpanel("Video Added",{post_id:g,youtube:a}),ga_event_push("Video Added",{event_category:"Posts",event_label:"Video_Added"})):(hj_video("reset"),alertify.set({labels:{ok:_h("e-video-7")+' <i class="fas fa-external-link-alt"></i>',cancel:_h("e-ok-1")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-video-slash"></i> '+(hj_lang_zhcn()?"\u5982\u4F4D\u4E8E\u4E2D\u56FD\uFF0C\u9700\u7FFB\u7246\u624D\u80FD\u89C2\u770B\u6CB9\u7BA1\u89C6\u9891<br> \u03A3\u30FD(\uFF9F\u0414 \uFF9F; )\uFF89 ":_h("e-video-6")),function(b){b&&open_url("//www.youtube.com/watch?v="+a),hj_video("update"),alertify_input_shake()}));break;case 2:signin_required();break;default:alert("Error: "+JSON.stringify(c))}})):(msg('<i class="fal fa-video-slash"></i> '+_h("e-video-5"),_h("e-ok-0"),function(){hj_video("update"),alertify_input_shake()}),hj_video("reset"))}},"https://youtu.be/"+a),alertify_input_custom({type:"url",placeholder:_h("e-video-11"),onclick:"select_input_text($(this))",oninput:"if(!!YoutubeURLparser(this.value))$('.alertify-button-ok').click()"});break;case"reset":hj_video("clear"),hj_update({action:"post_update",field:"youtube_video",post_id:current_post().post_id,youtube_video:""});break;case"clear":b.children("#youtube").data({youtube:null}).removeAttr("style").fadeOut().find("iframe").removeAttr("src");break;case"get_title":return $.ajax({url:"//api.hearty.app/yt/"+a,type:"GET",crossDomain:!0,async:!1,dataType:"json",success:function(a){f=a.items.length>0&&a.items[0].snippet.title},error:function(){f=!1}}),f;case"load_player_api":if(!window.YT)var d={loading:0,loaded:0};if(!window.YTConfig)var h={host:"https://www.youtube-nocookie.com"};d.loading||(d.loading=1,function(){var f=[];d.ready=function(a){d.loaded?a():f.push(a)},window.onYTReady=function(){d.loaded=1;for(let a=0;a<f.length;a++)try{f[a]()}catch(b){}},d.setConfig=function(a){for(let b in a)a.hasOwnProperty(b)&&(h[b]=a[b])};var a=document.createElement("script");a.id="www-widgetapi-script",a.src="//s.ytimg.com/yts/jsbin/www-widgetapi-vflovzaIU/www-widgetapi.js",a.async=!0;var b=document.currentScript;if(b){var c=b.nonce||b.getAttribute("nonce");c&&a.setAttribute("nonce",c)}var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(a,e)}())}}function YoutubeURLparser(b){var a=(b||"").match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|shorts\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!!a&&11==a[2].length&&a[2]}function post_query(b,n){if(autosave_the_change(),hj_writer==hj_username&&null==n){var j=Number(current_post().post_id);j>0&&hj_editor_history("add",Number(j))}var b=Number(b),c=$(".bk-list .bk-page"),d=c.find("#subject"),e=c.find("#editor_editable"),f=$(".catalog .diaries li");if(b<=0){if(0==b&&hj_username.length>0&&!f.filter("[data-editable='1']").length)return!1;var g=catalog_lookup(b);return g&&post_query(g.post_id),!!g}nav_toggle($(".catalog[data-mobile]"),!1);var h=update({action:"post_query",writer:hj_writer,post_id:b,passcode:""});switch(h.Status){case 1:case 3:c.children(".prologue").hide(),c.children(".diary").removeAttr("data-hidden"),d.add(e).hide(),d.slideDown("fast",function(){e.slideDown("fast",function(){$(this).add(d).show()})}),$(".bk-page .frame").fadeTo("normal",0).fadeTo("slow",1);var a=h.Values,i=a.writer.username||hj_writer;illustration_random(),a.title=a.title||_h("e-catalog-2"),a.title_decoded=htmlDecode(a.title),a.editable=Number(a.editable)>0,e.data({current_post:{post_id:b,privacy:a.privacy,editable:a.editable,vip:hj_membership()[0]}}).html(linkify(a.post)),d.text(a.title_decoded).attr({title:a.title_decoded}),sticker__top_edge(),stickers__initialize(),post_picture_init(!1),a.youtube_video?hj_video("init",a.youtube_video):(hj_video("clear"),a.gallery.length?(a.gallery.forEach(function(a){var b="//hearty.me/i/"+a.gallery_id+"?r="+a.gallery_rotated;$("<figure>",{class:post_picture_filter(a.gallery_cssgram).cname,"data-gallery_id":a.gallery_id,html:$("<div>")}).data({cssgram:a.gallery_cssgram,rotated:a.gallery_rotated}).css({"background-image":"url('"+b+"')"}).appendTo(".bk-page .pictures"),$('meta[property="og:image"]').attr({content:b})}),post_picture_init(!0)):illustration_shuffle()),f.filter("[data-active]").removeAttr("data-active"),f.filter("[data-post_id='"+b+"']").attr("data-active","").text(a.title_decoded),a.title_decoded+=" \u2665 \u6EAB\u5EA6\u65E5\u8A18 "+(hj_membership()[0]?"VIP ":"")+"Hearty Journal",document.title=a.title_decoded,$('meta[property="og:title"]').attr({content:a.title_decoded}),$('meta[name="description"],meta[property="og:description"]').attr({content:a.post.replace(/\n/g,"").substring(0,48)+"\u2026"}),$('meta[property="og:url"]').attr({content:location.href}),c.find(".bookmark").attr("data-bookmarked",a.bookmarked);var k=date_format(a.created,!0);c.find(".diary").attr("data-date",k),$(".post_attr #post_created").val(new Date(1e3*parseInt(a.created)).toLocaleDateString("sv")).attr({title:k}),c.find(".wi").attr({class:a.weather}),"function"==typeof history.replaceState&&history.replaceState({},a.title_decoded,(getUrlPara("feed")?"/d":"/"+i+"/"+b)+location.search);var l=$(".share input");if(a.shortened_url)a.shortened_url="https://hj.rs/"+a.shortened_url,l.val(a.shortened_url).attr({placeholder:a.shortened_url});else{let m=location.href.replace(location.host,"hearty.app");l.val(m).attr({placeholder:m})}post_privacy_toggle(a.privacy,a.published),i==hj_username&&(post_penpal_listing(a.penpals),setcookie("hearty_last_viewed",[i,b].toString(),3)),e.attr("data-writer",a.writer.nickname||a.writer.username||""),c.animate({scrollTop:0},"fast"),editor_enable(a.editable),prefetch_link_screenshots(),hj_mixpanel("Post Loaded",{post_id:b}),ga_event_push("Post Loaded",{event_category:"Posts",event_label:"Post Loaded"});break;case 2:post_query(0);break;case 4:signin_required()}return 1==h.Status}function post_picture_init(b){var a=$(".bk-page .pictures");b?a.hasClass("slick-initialized")||!(a.find("figure").length>1)||(a.slick({autoplaySpeed:1500,infinite:!0,dots:!0,arrows:!1,draggable:!0,swipe:!0,touchMove:!0,speed:400,dotsClass:"dots",centerPadding:"0px",useTransform:!1,waitForAnimate:!1}).slick("slickGoTo",0).on("reInit",function(a){$(this).find(".dots").on("click",function(a){a.stopPropagation()})}).on("wheel",function(a){a.preventDefault(),$(this).slick("slick"+(a.originalEvent.deltaY<0?"Next":"Prev"))}).on("afterChange",function(){$(this).slick("slickPause")}).find(".dots").on("click",function(a){a.stopPropagation()}),is_touch_device()||a.on("swipe",function(){$(this).slick("slickPlay")})):(a.filter(".slick-initialized").slick("unslick"),a.html(""))}function post_next(c){var a=Number(current_post().post_id);if(a>0){var b=$(".diaries li[data-post_id='"+a+"']").nextAll().filter("[data-editable='1']").eq(0);if(b.length>0)return b.click(),toolbelt_btn_clicked(c),hj_mixpanel("Post Next"),ga_event_push("Post Next",{event_category:"Posts"}),!0}return msg('<i class="fal fa-book-open"></i> '+_h("e-catalog-5"),_h("e-ok-1"),function(){$(".btn_catalog").is(":visible")&&nav_toggle($(".catalog"),!0)}),!1}function linkify(a){return(a||"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a onclick="open_external(this.dataset.link)" rel="ugc" title="$&" data-link="$&" spellcheck="false">$&</a>').replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a onclick="open_external(this.dataset.link)" rel="ugc" title="$2" data-link="https://$2" spellcheck="false">$2</a>').replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/,'<a onclick="msg(this.text||\'\')" rel="ugc" title="$&" spellcheck="false">$&</a>').replace(/((?!([\(])).|^|\s)#(\S+)(?![^<]*>|[^<>]*<\/)/g,'$1<a onclick="catalog_search(\'#$3\')" rel="ugc" title="$3" spellcheck="false">#$3</a>').replace(/[^\S\r\n]?\*([^\*{}=#<>]+)\*[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <mark title="$1" spellcheck="false">*$1*</mark> ').replace(/[^\S\r\n]?[{|]([^\*{}=#<>]+)[}|][^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <u title="$1" spellcheck="false">{$1}</u> ').replace(/[^\S\r\n]?=([^\*{}=#<>]+)=[^\S\r\n]?(?![^<]*>|[^<>]*<\/)/g,' <u title="$1" data-double spellcheck="false">=$1=</u> ')}function no_editable_post(){return!$(".catalog .diaries li[data-editable='1']").length}function post_create(c,d){open_book(!0),toolbelt_btn_clicked(d);var a=!1,g=$(".notifications li[data-notification_id='1']").length>0&&$(".catalog[data-desktop] .diaries li[data-editable='1']").length>1,e=$(".mask_loading");if("geolocation"in navigator&&!/Hearty_macOS\/2\.0\./i.test(navigator.userAgent||"")&& !(a=JSON.parse(decodeURIComponent(getcookie("hearty_position_gps"))||!1))&&c&&confirm("\u26C5 "+_h("e-gps-0"))){var f=$.Deferred();$.when(f).then(function(){post_create(!1),alertify.success('<i class="fal fa-cloud"></i> '+_h("e-gps-2"))}).fail(function(){post_create(!1),alertify.error('<i class="fal fa-map-marker-alt-slash"></i> '+_h("e-gps-3")),!is_touch_device()&&check_browser("Chrome")&&msg('<img src="//i.hearty.app/i/icons/gps_chrome.url.png?o=1"><br>'+_h("e-gps-4"))}),$.when(window.positioning_gps_deferred).done(function(){f.resolve()}),positioning_gps_trigger(!0),e.show().delay(7e3).queue(function(){f.reject(),$(this).fadeOut().dequeue()}),msg("\u26C5 "+_h("e-gps-1"));return}var b=_h("e-subject-0",{$date:date_format()});return hj_update(a?{action:"post_create",title:b,location_lat:a.latitude||"",location_lon:a.longitude||"",place:a.address||"",weather_id:a.weather_id||""}:{action:"post_create",title:b}).then(function(a){switch(a.Status){case 1:e.hide(),$(".alertify-button-ok").click();var d=(a=a.Values).post_id;if($("<li>",{title:"\u{1F4DD} "+b,text:b,"data-active":"","data-post_id":d,"data-pg":1,"data-privacy":0,"data-editable":1}).prependTo(".catalog .diaries"),catalog_page({page:1}),post_query(d),!hj_membership()[0]){var c=Number(a.chars)||0,f=Number(a.char_limit)||5782;c>f&&(c=numberWithCommas(c),alertify.set({labels:{ok:_h("e-chars-2"),cancel:'<i class="fas fa-star"></i> '+_h("e-chars-1")},buttonReverse:!0}),alertify.confirm('<i class="fab fa-wordpress-simple"></i> '+_h("e-chars-0",{$chars:c,$limit:f}),function(a){post_query(d),a||hj_upgrade_toggle(!0)}),customized_notification("char_limit_exceed",c),hj_mixpanel("Chars Limit Notice",{post_id:d}),ga_event_push("Chars Limit Notice",{event_category:"Posts",event_label:"Chars Limit Notice"}))}hj_mixpanel("Post Created",{post_id:d}),ga_event_push("Create",{event_category:"Posts",event_label:"Create"}),g&&verify_required_notice("email");break;case 2:signin_required();break;case 3:if(hj_membership()[0])location.reload(!0);else{var c=numberWithCommas(a.Values.chars);msg('<i class="fab fa-wordpress-simple"></i> '+_h("e-chars-0",{$chars:c,$limit:a.Values.char_limit}),_h("e-chars-1"),function(){hj_upgrade_toggle(!0),customized_notification("char_limit_exceed",c)}),hj_mixpanel("Chars Limit Blocked"),ga_event_push("Chars Limit Blocked",{event_category:"Posts",event_label:"Chars Limit Blocked"})}break;default:msg()}})}function verify_required(a,c){var b=$(".notifications li[data-notification_id='"+("email"==a?1:8)+"']").length>0;return b&&verify_required_notice(a,c||""),b}function verify_required_notice(a,b){alertify.set({labels:{ok:_h("e-no-0"),cancel:"<i class='fas fa-hand-point-up'></i> "+_h("e-ok-2")},buttonReverse:!0}),alertify.confirm('<i class="far fa-check-circle"></i> '+_h("e-verify_required-0",{$item:"email"==a?"Email":_h("e-verify_required-1"),$act:b||_h("e-verify_required-2")}),function(b){b||hj_href("email"==a?"account?ev=1":"p/phone.php")})}function post_revise(a){var b=$(".bk-page #editor_editable"),c=current_post().post_id,d=check_browser("Firefox")?htmlDecode(b.html().replace(/(<br\/>|<br>|<BR>|<BR\/>)/g,"\n")):b.text();a=Number(a||0),clearTimeout(timer),hj_update({action:"post_update",field:"revise",post_id:c,post:d}).then(function(b){switch(clearTimeout(timer),b.Status){case 1:saved(!0),$(".editor_toolbelt .kit.save").removeClass("btn_blink"),hj_mixpanel("Post Revised",{post_id:c}),ga_event_push("Revise",{event_category:"Posts",event_label:"Revise"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_revise",flag:"a"+a}),a<1&&(timer=setTimeout(function(){post_revise(a+1)},2e3))}}).fail(function(b){hj_update_failed({fn:"post_revise",flag:"b"+a,err:b}),clearTimeout(timer),a<1&&(timer=setTimeout(function(){post_revise(a+1)},2e3))})}function save_btn(){post_revise(),sticker__save_remote();var a=$(".bk-page #editor_editable"),b=a.text();/(https?|www\.|@|\s#|\s(\*.+\*|=.+=|{.+}))/.test(b)&&a.html(linkify(b))}function post_created_date(b){if(null!=b){var a=new Date(b);a.setHours(0,0,0,0),a=+a/1e3,hj_update({action:"post_update",field:"created_date",post_id:current_post().post_id,created:a}).then(function(a){switch(a.Status){case 1:b=date_format(b,!0),$(".bk-list .bk-page .diary").attr("data-date",b),alertify.success('<i class="far fa-calendar"></i> '+_h("e-date-1")+b),catalog_query(null,{page:1}),hj_mixpanel("Created Date Updated",{post_id:post_id}),ga_event_push("Created Date Updated",{event_category:"Posts",event_label:"Created Date Updated"});break;case 2:signin_required()}})}}function autosave_the_change(){return null!==window.onbeforeunload&&!!current_post().editable&&(post_revise(),!0)}function autosaver_30s(){window.hj_autosaver=setInterval(function(){null!==window.onbeforeunload&&current_post().editable&&post_revise()},29900)}function saved(b){var a=$(".editor_toolbelt .kit.save");!0==b?(window.onbeforeunload=null,a.finish().removeClass("btn_blink").removeAttr("data-unsaved").attr("data-saving","").delay(1e3).queue(function(){$(this).removeAttr("data-saving").dequeue()})):(window.onbeforeunload=function(a){return current_post().editable&&post_revise(),_h("e-leave")},a.addClass("btn_blink"))}function title_editing(a){var b=current_post().post_id;alertify.set({labels:{ok:"\u{1F4DD} "+_h("e-subject-3"),cancel:_h("e-no-1")},buttonReverse:!1}),alertify.prompt('<i class="far fa-pen"></i> '+_h("e-subject-1"),function(c,a){if(c){if(!a.replace(/\s+/g,"").length)return!1;hj_update({action:"post_update",field:"title",post_id:b,title:a=capitalizeFirstLetter(a)}).then(function(c){switch(c.Status){case 1:$(".bk-page #subject,.catalog .diaries li[data-active]").attr({title:a}).text(a),alertify.success('<i class="far fa-paperclip"></i> '+_h("e-subject-2",{$title:htmlspecialchars(a)})),hj_mixpanel("Title Edited",{post_id:b,post_title:a}),ga_event_push("Edit Title",{event_category:"Posts",event_label:"Edit Title"}),a+=" \u2665 \u6EAB\u5EA6\u65E5\u8A18 Hearty Journal",document.title=a,$("meta[property='og\\:title']").attr({content:a});break;case 2:signin_required();break;default:hj_update_failed({fn:"title_editing",flag:0})}}).fail(function(a){hj_update_failed({fn:"title_editing",flag:1,err:a})})}},a||$(".bk-page #subject").text()),alertify_input_custom({placeholder:_h("e-subject-1"),maxlength:255},{"letter-spacing":"2px"})}function post_archive(){if(!current_post().editable)return!1;autosave_the_change(),open_book(!0);var b=current_post().post_id,a=$("#subject").text(),c=$(".bk-list .bk-page");alertify.set({labels:{ok:_h("e-no-0"),cancel:_h("e-archive-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-exclamation-triangle"></i> '+_h("e-archive-0",{$title:a}),function(d){d||hj_update({action:"post_update",field:"archive",post_id:b}).then(function(d){switch(d.Status){case 1:catalog_page({page:1}),c.find(".diary").attr("data-hidden",""),c.find(".prologue").slideDown(),$(".catalog .diaries li[data-post_id='"+b+"']").remove(),alertify.error('<i class="far fa-trash-alt"></i> '+_h("e-archive-2",{$title:a})),"function"==typeof history.replaceState&&history.replaceState({},a+" \u2665 \u6EAB\u5EA6\u65E5\u8A18 Hearty Journal","/"+hj_writer+location.search),c.find("#editor_editable").data({current_post:null}),hj_mixpanel("Post Archived",{post_id:b}),ga_event_push("Archive",{event_category:"Posts",event_label:"Archive"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_archive",flag:0})}}).fail(function(a){hj_update_failed({fn:"post_archive",flag:1,err:a})})})}function hj_own_domains(a){return/(https?:\/\/(.+?\.)?(hearty(\.(me|app|gift|tw|(page|app)\.link|eu\.org|edu\.pl)|(corp|mail)\.com)|hj\.rs|ht\.mk|(chen|)nien\.(co|org)|(alice|she|mia|docs|miss\.com)\.tw|jiayi\.life)(\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\(\)\*\+,;\=]*)?)/gi.test(a||"")}function open_external(a){if(null==a)return!1;if(hj_own_domains(a))return open_url(a),!0;var b=$(".external_link"),c=b.find(".snapshot"),d="//s0.wp.com/mshots/v1/"+encodeURIComponent(a)+(a.indexOf("?")>0?"&":"?")+"w=320";if(safebrowsing(a).then(function(a){a&&(b.find("li[data-url]").removeAttr("data-url"),popup_toggle(!1,"external_link"),msg('<i class="far fa-exclamation-triangle"></i> '+_h("e-unsafe")))}),c.hide(),"naturalWidth"in c.get(0)){var e=[3,1,1,1,1,1,1,1,1,1,1,1,1];!function b(){var a=e.length;a>0&&c.attr({src:d+"&t="+a}).on("load",function(){a>0&&400==$(this).get(0).naturalWidth?($(this).off("load"),$.wait(1e3*e.shift()).then(b)):$(this).fadeIn().off("load")})}()}else c.attr({src:d}).show();b.find(".url").text(a),b.find(".title img").attr({src:"//www.google.com/s2/favicons?sz=48&domain="+new URL(a||location.href).hostname}),a=a.replace(/https:\/\/(?!i\.hearty\.app)(\S+)\/(\S+)\.((doc|ppt|xls)(x|))$/gi,"https://i.hearty.app/doc/$1/$2.$3").replace(/https:\/\/(?!i\.hearty\.app)(\S+)\/(\S+)\.(?=[0-9a-z]{3,5}$)(?!(j|p|r|s|x|)htm(l|)|php(s|7|5|)|as(px|p|(m|h|)x)|axd|jsp(x|)|wss|action|do|cgi|dll|rb|py|pl)/gi,"https://i.hearty.app/docs/$1/$2.$3"),b.find("li[data-url]").attr("data-url",a),popup_toggle(!0,"external_link"),$("#editor_editable").blur(),hj_mixpanel("Open External URL",{url:a}),ga_event_push("Open External URL",{event_category:"Posts",event_label:"Open External URL"})}function safebrowsing(a){return $.ajax({type:"POST",url:"//api.hearty.app/safebrowsing",crossDomain:!0,async:!0,headers:{Accept:"application/json"},contentType:"application/json",dataType:"json",data:JSON.stringify({client:{clientId:"hearty",clientVersion:"1.0"},threatInfo:{threatTypes:["MALWARE","SOCIAL_ENGINEERING"],platformTypes:["ANY_PLATFORM"],threatEntryTypes:["URL"],threatEntries:[{url:a}]}})}).then(function(a){return Object.keys(a).length>0})}function prefetch_link_screenshots(){var a=$("#editor_editable a[data-link]");a.length>0&&"sendBeacon"in navigator&&a.each(function(){var a=$(this).attr("data-link")||location.origin;navigator.sendBeacon("//s0.wp.com/mshots/v1/"+encodeURIComponent(a)+(a.indexOf("?")>0?"&":"?")+"?w=320")})}function hj_fullscreen(a){(!document.fullScreenElement||null===document.fullScreenElement)&&(document.mozFullScreen||document.webkitIsFullScreen)?document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():(a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.msRequestFullscreen?a.msRequestFullscreen():a.webkitRequestFullscreen&&a.webkitRequestFullScreen(),hj_mixpanel("Fullscreen"),ga_event_push("Fullscreen",{event_category:"Posts",event_label:"Fullscreen"}))}function update_failed(){network_status(["offline"],!0),alertify.error('<i class="far fa-wifi-slash"></i> '+_h("e-offline")),$(".editor_toolbelt .kit.save").finish().removeClass("btn_blink").removeAttr("data-saving").attr("data-unsaved","").delay(7e3).queue(function(){$(this).removeAttr("data-unsaved").dequeue()})}function screenlock(k,e){var a=$(".screenlock"),g=a.data("pincode"),b=a.find(".pin"),d=null!=g;switch(k){case!0:a.is(":hidden")&&($(".menu,.catalog[data-mobile],.stickerbook").each(function(){nav_toggle($(this),!1)}),open_book(!1),a.slideDown("fast").find("input:first").focus());break;case!1:a.is(":visible")&&(a.fadeOut("normal"),open_book(!0)),a.find("input").val("");break;case"status":return d&&hj_membership()[0];case"initialize":var h=getcookie("hearty_screenlock");h&&hj_membership()[0]?(screenlock("set",h),screenlock(!0)):e&&hj_update({action:"screenlock_lookup"}).then(function(a){1==a.Status&&""!==(e=a.Values.pincode)&&(screenlock("set",e),screenlock(!0))}).fail(function(){screenlock("set",e),screenlock(!0)});break;case"activate":d?screenlock(!0):d||(alertify.set({labels:{ok:'<i class="fas fa-lock"></i> '+_h("e-lock-1"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-lock"></i> '+_h("e-lock-0"),function(a){a&&screenlock(!0)}));break;case"set":a.data({pincode:e||"0000"});break;case"unset":d?(alertify.set({labels:{ok:'<i class="fas fa-cut"></i> '+_h("e-lock-2"),cancel:_h("e-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-lock-open"></i> '+_h("e-pincode-2"),function(b,a){b&&(a==g?screenlock("disable"):hj_update({action:"screenlock_unset",password:a}).then(function(a){switch(a.Status){case 0:alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("e-retry"),cancel:_h("e-lock-4")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-flushed"></i> '+_h("e-pincode-4"),function(a){a?screenlock("unset"):msg('<i class="fal fa-info-circle"></i> '+_h("e-lock-5"),'<i class="fas fa-check-circle"></i> '+_h("e-ok-0"),function(){signout()})});break;case 1:screenlock("disable")}}))}),alertify_input_custom({type:"password",placeholder:"\u{1F512} "+_h("e-pincode-2"),autocomplete:"new-password",minlength:4,maxlength:20},{"letter-spacing":"3px"})):(screenlock(!1),a.removeAttr("pincode"));break;case"disable":hj_update({action:"screenlock_setup",pincode:""}),screenlock(!1),setcookie("hearty_screenlock","",1),a.data({pincode:null}),b.attr({title:"\u{1F512} "+_h("e-pincode-0")}),alertify.error('<i class="far fa-lock-open"></i> '+_h("e-lock-3")),hj_mixpanel("Screenlock Clear"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Clear"});break;case"next":var f=e[0],i=e[1];if(isNaN(i))f.val(""),alert("\u{1F512} "+_h("e-pincode-6"));else if(i.length>0){var j=f.nextAll("input:first");j.length>0?j.focus():(screenlock(),f.blur())}break;default:var c="";if(a.find("input").each(function(){c+=$(this).val()}).val(""),d){if(c==g){screenlock(!1),screenlock("activate"),b.attr({title:"\u{1F512} "+_h("e-pincode-0")});return}b.attr({title:"\u{1F512} "+_h("e-pincode-3")}),shake(b),hj_vibrate(30)}else null==a.attr("pincode")?(a.attr({pincode:c}),b.attr({title:"\u{1F512} "+_h("e-pincode-1")})):c==a.attr("pincode")?(hj_update({action:"screenlock_setup",pincode:c}),setcookie("hearty_screenlock",c,365),a.data({pincode:c}).attr({pincode:null}),b.attr({title:_h("e-pincode-0")}),screenlock(!1),alert("\u{1F512} "+_h("e-pincode-7",{$pin:c})),hj_mixpanel("Screenlock Setup"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Setup"})):(a.attr({pincode:null}),b.attr({title:"\u{1F512} "+_h("e-pincode-5")}),shake(b),hj_vibrate(30));a.find("input:first").focus()}}function hj_notice_pc(a){notifications_toggle(!1),popup_toggle(a,"notice_pc"),a?(hj_mixpanel("PC-edition Notice"),ga_event_push("PC-edition Notice")):msg('<i class="far fa-tv"></i> <b>'+_h("e-pc-0")+'</b><br><i class="fab fa-chrome"></i> '+_h("e-pc-1"))}function hj_upgrade_toggle(a){popup_toggle(a,"upgrade"),ga_event_push("view_promotion")}function pricing(a){a&&(hj_ip().then(function(b){var c=$(".package"),d=c.find(".currency_selector"),a=b.loc||"",e="TW"==a;c.find(".btns_action[data-pkg]").attr({"data-ip":b.ip||"","data-cc":a,"data-vat":+e}),e?d.remove():d.find("li:not([title='TWD'])").attr({title:currencies(a)})}),price_selector(4),hj_upgrade_toggle(!1),ga_event_push("view_item_list"),fb_event_push(!1,"ViewContent")),popup_toggle(a,"purchase")}function pkg_info(b){var a={2:{unit:149,subtotal:447,quantity:3},3:{unit:109,subtotal:654,quantity:6},4:{unit:89,subtotal:1068,quantity:12},5:{unit:33,subtotal:99,quantity:3},6:{unit:99,subtotal:99,quantity:1}};return b in a?a[b]:a}function currencies(a){let b={TW:"TWD",AE:"AED",AF:"AFN",AL:"ALL",AM:"AMD",AN:"ANG",AO:"AOA",AR:"ARS",AU:"AUD",AW:"AWG",AZ:"AZN",BA:"BAM",BB:"BBD",BD:"BDT",BG:"BGN",BH:"BHD",BI:"BIF",BM:"BMD",BN:"BND",BO:"BOB",BR:"BRL",BS:"BSD",BT:"BTN",BW:"BWP",BY:"BYN",BZ:"BZD",CA:"CAD",CD:"CDF",CH:"CHF",CL:"CLP",CN:"CNY",CO:"COP",CR:"CRC",CU:"CUP",CV:"CVE",CZ:"CZK",DJ:"DJF",DK:"DKK",DO:"DOP",DZ:"DZD",EG:"EGP",ER:"ERN",ET:"ETB",EU:"EUR",FJ:"FJD",FK:"FKP",FO:"FOK",GB:"GBP",GE:"GEL",GG:"GGP",GH:"GHS",GI:"GIP",GM:"GMD",GN:"GNF",GT:"GTQ",GY:"GYD",HK:"HKD",HN:"HNL",HR:"HRK",HT:"HTG",HU:"HUF",ID:"IDR",IL:"ILS",IM:"IMP",IN:"INR",IQ:"IQD",IR:"IRR",IS:"ISK",JE:"JEP",JM:"JMD",JO:"JOD",JP:"JPY",KE:"KES",KG:"KGS",KH:"KHR",KI:"KID",KM:"KMF",KR:"KRW",KW:"KWD",KY:"KYD",KZ:"KZT",LA:"LAK",LB:"LBP",LK:"LKR",LR:"LRD",LS:"LSL",LY:"LYD",MA:"MAD",MD:"MDL",MG:"MGA",MK:"MKD",MM:"MMK",MN:"MNT",MO:"MOP",MR:"MRU",MU:"MUR",MV:"MVR",MW:"MWK",MX:"MXN",MY:"MYR",MZ:"MZN",NA:"NAD",NG:"NGN",NI:"NIO",NO:"NOK",NP:"NPR",NZ:"NZD",OM:"OMR",PA:"PAB",PE:"PEN",PG:"PGK",PH:"PHP",PK:"PKR",PL:"PLN",PY:"PYG",QA:"QAR",RO:"RON",RS:"RSD",RU:"RUB",RW:"RWF",SA:"SAR",SB:"SBD",SC:"SCR",SD:"SDG",SE:"SEK",SG:"SGD",SH:"SHP",SL:"SLL",SO:"SOS",SR:"SRD",SS:"SSP",ST:"STN",SY:"SYP",SZ:"SZL",TH:"THB",TJ:"TJS",TM:"TMT",TN:"TND",TO:"TOP",TR:"TRY",TT:"TTD",TV:"TVD",TZ:"TZS",UA:"UAH",UG:"UGX",US:"USD",UY:"UYU",UZ:"UZS",VE:"VES",VN:"VND",VU:"VUV",WS:"WST",XA:"XAF",XC:"XCD",XD:"XDR",XO:"XOF",XP:"XPF",YE:"YER",ZA:"ZAR",ZM:"ZMW",ZW:"ZWL"};return["AT","BE","CY","EE","FI","FR","DE","GR","IE","IT","LV","LT","LU","MT","NL","PT","SK","SI","ES"].indexOf(a)>=0?"EUR":b[a]?b[a]:"USD"}function how_much(a){hj_loading();var b=a.attr("title")||"USD";TWD2local(b).then(function(d){let c=parseInt(a.closest(".package").find(".price_unit").text())||0;msg('<i class="fal fa-info-circle"></i> '+_h("p-currency-0")+"TWD$ "+c+" \u2248 <b>"+b+" "+Math.ceil(c*d*10)/10+"</b>"),hj_loading(!1),hj_mixpanel("Currency",{currency:b}),ga_event_push("Currency",{event_category:"Currency",event_label:b})}).fail(function(){hj_loading(!1)})}function TWD2local(a){return $.ajax({url:"//api.hearty.app/currency/TWD",type:"GET",crossDomain:!0,dataType:"json",async:!0}).then(function(b){return parseFloat(b.conversion_rates[a]||b.conversion_rates.USD)||0})}function price_selector(b){var c=$(".package[data-col='deposit']"),a=pkg_info();b in a&&(a=a[b],c.find(".price_unit").text(a.unit),c.find("[data-subtotal]").attr({"data-subtotal":a.subtotal}),c.find(".btns_action[data-pkg]").attr({"data-pkg":b}),c.find(".price_selector li").removeAttr("data-active").filter("[data-pkg='"+b+"']").attr("data-active",""),ga_event_push("view_item",{items:[{item_id:b,item_name:"VIP Premium",item_list_name:"pricing",item_variant:"Prepaid Plan",id:b,name:"VIP Premium",list_name:"pricing",variant:"Prepaid Plan",quantity:a.quantity,price:a.unit}]}),fb_event_push(!1,"CustomizeProduct",{content_type:"product",content_name:"VIP Premium",contents:[{id:b,quantity:a.quantity}],value:a.subtotal,num_items:1,currency:"TWD"}))}function hj_purchase(a){if(null==a)return!1;hj_lang_zhcn()&&"recurring"in a&&0==a.recurring?(alertify.set({labels:{ok:'<i class="fal fa-credit-card"></i> \u94F6\u884C\u5361\u3001\u94F6\u8054\u5361\u4E36\u5176\u4ED6\u2026", cancel: "<i class="fab fa-alipay"></i> \u652F\u4ED8\u5B9D'},buttonReverse:!1}),alertify.confirm('<i class="fal fa-gift"></i> \u9009\u62E9\u652F\u4ED8\u65B9\u5F0F',function(b){b||(a.alipay=1),hj_href("shop/buy?"+$.param(a))})):hj_href("shop/buy?"+$.param(a));var b=a.pkg,c=pkg_info(b);ga_event_push("add_to_cart",{items:[{item_id:b,item_name:"VIP Premium",item_list_name:"pricing",item_variant:(0==a.recurring?"Prepaid":"Monthly")+" Plan",id:b,name:"VIP Premium",list_name:"pricing",variant:(0==a.recurring?"Prepaid":"Monthly")+" Plan",quantity:c.quantity,price:c.unit}]}),fb_event_push(!1,"AddToCart",{content_type:"product",content_name:"VIP Premium",contents:[{id:b,quantity:c.quantity}],value:c.subtotal,num_items:1,currency:"TWD"})}function post_picture(c){var a=$(".bk-page .pictures");if(a.hasClass("slick-initialized")&&a.slick("getSlick").slideCount>7){msg('<i class="fal fa-image-polaroid"></i> '+_h("e-picture-4")+"<br>\u30FE(\u25CF\xb4\u2200\uFF40\u25CF)\u2661");return}if(c){alertify.set({labels:{ok:_h("e-no-1"),cancel:'<i class="fas fa-arrow-circle-up"></i> '+_h("e-picture-2")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-image"></i> '+_h("e-picture-1"),function(a){a||post_picture()});return}var b=$(".ajax-upload-dragdrop input[type='file']").on("change",function(){post_picture_onselect(this.files)}).attr({accept:"image/jpeg,image/png,image/bmp"});b.length>0&&b.get(0).click()}function post_picture_onselect(a){if(a&&a[0]){var b=(a[0].name||"").toLowerCase().split(".").slice(-1).toString()||"jpg";0>["jpg","jpeg","png","gif","bmp"].indexOf(b)?(alertify.set({labels:{ok:_h("e-no-1"),cancel:'<i class="fas fa-chevron-square-up"></i> '+_h("e-picture-3")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-image-polaroid"></i> '+_h("e-picture-5",{$ext:b.toUpperCase()}),function(a){a||post_picture()})):hj_uploader_preview(a)}}function post_picture_remove(){alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-trash-alt"></i> '+_h("e-picture_remove-1")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-image"></i> '+_h("e-picture_remove-1"),function(b){if(!b){var c=$(".image-zoom").attr("data-gallery_id")||0,a=$(".bk-page .pictures");hj_update({action:"post_picture_remove",gallery_id:c}).then(function(a){1==a.Status?alertify.error('<i class="far fa-image"></i> '+_h("e-picture_remove-2")):msg()}),a.hasClass("slick-initialized")?(a.slick("slickRemove",a.slick("slickCurrentSlide")),a.slick("getSlick").slideCount<2&&a.slick("unslick")):a.find("figure").remove(),illustration_shuffle(),popup_toggle(!1,"image-zoom")}})}function image_uploader_initialize(){$(".bk-page #editor_editable"),$(".img_uploader").find("#mulitplefileuploader").uploadFile({url:location.origin+"/update",dragDrop:!0,fileName:"myfile",allowedTypes:"jpg,jpeg,png,bmp",returnType:"json",showDone:!1,showDelete:!1,formData:{category:1},dynamicFormData:function(){return{post_id:current_post().post_id,privacy:current_post().privacy}},onSubmit:function(a){saved(!1)},onSuccess:function(g,f,h){var b=f.gallery_id||1,c="//hearty.me/i/"+b+"?r=0",a=$(".bk-page .pictures"),d=$("<figure>",{"data-gallery_id":b,html:$("<div>")}).css({"background-image":"url('"+c+"')"}).data({cssgram:0,rotated:0});a.hasClass("slick-initialized")?a.slick("slickAdd",d).slick("slickGoTo",-1):(d.appendTo(a),post_picture_init(!0),a.hasClass("slick-initialized")&&a.slick("slickGoTo",-1)),$('meta[property="og:image"]').attr({content:c}),$(".bk-page .frame").removeClass("uploading"),alertify.success('<i class="far fa-image"></i> '+_h("e-picture-7")),post_revise();var e="Image Added";hj_mixpanel(e,{post_id:current_post().post_id,privacy:current_post().privacy}),ga_event_push(e,{event_category:"Posts",event_label:"Image Added"})},onError:function(c,a,b,d){msg('<i class="fal fa-info-circle"></i> '+_h("e-picture-6")+"<br><small>"+JSON.stringify(a)+"\uFF1A"+JSON.stringify(b)+"</small>")}})}function hj_uploader_preview(b){hj_video("reset");var c=$(".image-zoom img"),[a]=b,d=hj_uploader_createImageFromFile(c.get(0),a),e=hj_uploader_getFileBase64Encode(a);Promise.all([d,e]).then(function(b){var[d,a]=b;$(".bk-page .frame").addClass("uploading").find(".pictures").css({"background-image":"url('"+a+"')"}),c.attr({src:a})})}function hj_uploader_createImageFromFile(a,b){return new Promise(function(c,d){a.src=URL.createObjectURL(b),a.onload=function(){URL.revokeObjectURL(a.src),c(a)},a.onerror=function(){d("Failure to load image")}})}function hj_uploader_getFileBase64Encode(a){return new Promise(function(c,d){var b=new FileReader;b.readAsDataURL(a),b.onload=()=>c(b.result),b.onerror=a=>d(a)})}function hj_screenshot(){if(0==current_post().post_id)return!1;alertify.success('<i class="fas fa-clock"></i>  '+_h("e-screenshot")),autosave_the_change(),hj_loading();var d=current_post().post_id,a=$(".bk-list .bk-page"),e=$(".diary_screenshot"),b=a.find(".diary"),c=a.find("#editor_editable");a.removeClass("scroll-smoothly").scrollTop(0).scrollLeft(0).addClass("scroll-smoothly"),c.removeClass("editor_margin_bottom").attr("data-screenshoted",""),a.find(".frame .far").hide(),b.attr("data-screenshoted","");var f={width:b.get(0).scrollWidth+20,height:b.get(0).scrollHeight};c.removeAttr("data-screenshoted"),b.find("#youtube,.sticker_img").each(function(){var a=$(this).css("background-image");a.length>0&&$(this).css("background-image",a.replace("//i.hearty.app","//cdn.statically.io/img/i.hearty.app"))}),hj_getScript_npm("html2canvas@1.4.1/dist/html2canvas.min.js",function(){window.html2canvas(b.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:f.width,height:f.height}).then(function(h){var f=h.toDataURL("image/png"),g=a.find("#subject").text();e.empty(),$("<a>",{target:"_blank",href:f,download:_h("e-file")+"_"+g+".png",title:g,rel:"noopener",onclick:"hj_screenshot_share($(this));event.stopPropagation()",html:$("<img>",{src:f})}).appendTo(e).get(0).click(),b.removeAttr("data-screenshoted"),c.addClass("editor_margin_bottom"),a.find(".frame .far").show(),popup_toggle(!0,"diary_screenshot"),hj_loading(!1),hj_mixpanel("Post Screenshoted",{post_id:d}),ga_event_push("Screenshot",{event_category:"Posts",event_label:"Screenshot"})})})}function hj_screenshot_share(a){if(null!=a&&!check_hjapp()&&"share"in navigator&&"canShare"in navigator){var b=_h("e-file")+"_"+a.attr("title");urltoFile(a.attr("href"),b+".png","image/png").then(function(c){var a={files:[c]};navigator.canShare(a)&&(a.title=a.text=b,navigator.share(a).catch(function(a){}))})}}function urltoFile(a,c,b){return b=b||(a.match(/^data:([^;]+);/)||"")[1],fetch(a).then(function(a){return a.arrayBuffer()}).then(function(a){return new File([a],c,{type:b})})}function hj_bookmark(){var a=current_post().post_id;hj_update({action:"bookmark",post_id:a}).then(function(b){switch(b.Status){case 1:hj_mixpanel("Post Bookmarked",{post_id:a}),ga_event_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:signin_required()}})}function free_trial_activate(){hj_update({action:"free_trial_activate"}).then(function(a){1===a.Status&&(alertify.set({labels:{ok:'<i class="fas fa-hand-point-right"></i> '+_h("e-trial-3"),cancel:'<i class="fas fa-info-circle"></i> '+_h("e-trial-2")},buttonReverse:!1}),alertify.confirm('<i class="far fa-gift-card"></i> '+_h("e-trial-0")+'<br><br><small style="display:inline-block;text-align:left">'+_h("e-trial-1",{$exp:date_format(a.Values.expiration)})+"</small>",function(a){a||hj_upgrade_toggle(!0)}),hj_mixpanel("Trial Activated"),ga_event_push("Trial Activate",{event_category:"Account",event_label:"Trial Activate"}),fb_event_push(!1,"StartTrial"))})}function signin_required(){account_status().then(function(a){if(1==a.Status){var b=a.Values.username;"hj_writer"in window&&hj_writer!=b?hj_href(b):location.reload(!0)}}),signin_ask()}function signin_ask(b,c){var a=getcookie("hearty_account")||getUrlPara("a")||"";a=a?"&account="+a:"";var d="?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+a+"#signin";b?hj_href(d):(alertify.set({labels:{ok:_h("e-no-0"),cancel:'<i class="fas fa-door-open"></i> '+_h("e-signin-0")},buttonReverse:!0}),alertify.confirm('<i class="fal fa-user-lock"></i> '+_h("e-signin-1",{$act:c||_h("e-signin-2")}),function(a){a||hj_href(d)}))}function hj_after_purchase(){alertify.set({labels:{ok:'<i class="fas fa-pen"></i> '+_h("e-purchased-3"),cancel:_h("e-purchased-4")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-gifts"></i> '+_h("e-purchased-0")+" \u0F3C \u3064 \u25D5_\u25D5 \u0F3D\u3064<br>"+_h("e-purchased-1")+"<br>"+_h("e-purchased-2"),function(a){a&&open_url("//go.hearty.me/hj"+(/zh/i.test(hj_lang())?"":"-")+"vip"),hj_mixpanel("VIP Survey",{accepted:a?"Y":"N"}),ga_event_push("VIP Survey",{event_category:"Membership",event_label:"VIP Survey",accepted:a?"Y":"N"})})}function customized_notification(c,b){switch(c){case"email_verify_required":notifications_new([{notification_id:1,msg:_h("e-n_verify_email-0",{$item:b||"Email"}),clk:"open_url(location.origin+'/account?ev=1')",unread:1,icon:"far fa-envelope"}],!1),$(".popup.feedback .notice").text(_h("e-n_verify_email-1")).on("click",function(){open_url(location.origin+"/account?ev=1")});break;case"phone_verify_required":hj_lang_zhcn()||notifications_new([{notification_id:8,msg:_h("e-n_verify_phone"),clk:"open_url(location.origin+'/p/phone.php')",unread:1,icon:"far fa-mobile"}],Math.random()>=.5);break;case"vip_expiring":let a=$("[data-due1]");notifications_new([{notification_id:2,msg:_h("e-n_vip_prefix")+" "+(a.attr("data-due1")||"").toLowerCase()+(a.attr("data-exp")||"")+(a.attr("data-due2")||"")+" (\u25CD\u2022\u1D17\u2022\u25CD)\u309D",clk:"hj_upgrade_toggle(!0)",unread:1,icon:"far fa-crown"}],!1);break;case"char_limit_exceed":notifications_new([{notification_id:9,msg:_h("e-n_char_limit_exceed",{$chars:b}),clk:"hj_upgrade_toggle(!0)",unread:1,icon:"far fa-arrow-circle-up"}],!1);break;case"daily_checkin":notifications_new([{notification_id:10,msg:_h("e-n_daily_checkin"),clk:"hj_daily_checkin('init')",unread:0,icon:"far fa-mitten"}],!1)}}function bucket_suffix(){var a=new Date;return a.getDate()+a.getHours()}function illustration_shuffle(){var b=illustration_random(),a="https://i.hearty.app/i/illustrations/"+b.image+".jpg"+(webp_support()?"":"?o=1");return $(".bk-page .pictures").css({"background-image":"url('"+a+"')","background-position":b.position+" center"}),$(".image-zoom").attr({"data-gallery_id":0}).find("img").attr({src:a,"data-r":""}),post_picture_filter(0,$(".image-zoom div")),$('meta[property="og:image"]').attr({content:a}),a}function post_picture_rotate(){var d=$(".image-zoom"),e=d.find("img"),c=d.attr("data-gallery_id")||0,f=$(".bk-page figure[data-gallery_id='"+c+"']"),a=parseInt(f.data("rotated"))||0,b=parseInt(e.attr("data-r"))||0;a=++a>3?0:a,b=++b>3?0:b,f.data({rotated:a}).css({"background-image":"url('//hearty.me/i/"+c+"?r="+a+"')"}),e.attr({"data-r":b}),hj_update({action:"post_picture_rotate",gallery_id:c}).then(function(a){switch(a.Status){case 1:hj_mixpanel("Rotate Picture",{degree:b}),ga_event_push("Rotate Picture",{event_category:"Posts",event_label:"Rotate Picture",degree:b});break;case 2:signin_required()}})}function post_picture_cssgram(){var a=$(".image-zoom"),d=a.find("div"),b=(a.find("img"),a.attr("data-gallery_id")||0),c=post_picture_filter(d.data("cssgram")||0,d.add(".bk-page figure[data-gallery_id='"+b+"']"),!0);b>0&&hj_update({action:"post_picture_cssgram",gallery_id:b,cssgram:c.id||0}),a.clearQueue().attr({"data-filter":"#"+(c.id+1)+" "+capitalizeFirstLetter(c.cname)}).delay(2500).queue(function(){$(this).removeAttr("data-filter").clearQueue()})}function post_picture_filter(a,c,f){var d=["original","_1977","aden","brannan","brooklyn","clarendon","earlybird","gingham","hudson","inkwell","kelvin","lark","lofi","maven","mayfair","moon","nashville","perpetua","reyes","rise","slumber","stinson","toaster","valencia","walden","willow","xpro2"],b=[0,1,2,4,6,7,8,9,12,14,16,17,18,22,24,26],a=parseInt(a)||0;a=f?a>=b.length-1?0:a+1:a>=b.length?0:a;var e=d[b[a]];return null!=c&&c.data({cssgram:a}).removeClass(d.join(" ")).addClass(e),{id:a,cname:e}}function post_picture_download(b){var a=$(".image-zoom img").attr("src")||"";a+=(a.indexOf("?")>0?"&":"?")+"dl",b.attr({href:a,download:($(".bk-page #subject").text()||_h("e-file")).replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,"")}).on("click",function(a){a.stopPropagation()}).get(0).click(),alertify.success('<i class="far fa-arrow-alt-to-bottom"></i> '+_h("e-picture-8"))}function hj_daily_checkin(a){var b=$(".popup.notice_checkin");switch(a){case"init":popup_toggle(!0,"notice_checkin"),hj_update({action:"hearty_point",query:"balance_lookup"}).then(function(a){switch(a.Status){case 1:b.find("[data-point]").attr("data-point",Number(a.Values.point));break;case 2:signin_required()}});break;case"intro":msg('<i class="far fa-cookie"></i> '+_h("e-checkin-7"));break;case"customized_notification":/zh-tw/i.test(hj_lang())&&hj_update({action:"hearty_point",query:"daily_checkin_already"}).then(function(a){a.Status<1&&customized_notification("daily_checkin")});break;default:var c=b.find(".btns_action");hj_update({action:"hearty_point",query:"daily_checkin"}).then(function(e){switch(e.Status){case 1:var a,d=b.find("[data-point]");a=Number(d.attr("data-point")||0)+1,d.attr("data-point",a),b.find("img").attr("data-shaking",1),msg('<i class="far fa-cookie"></i> '+_h("e-checkin-4",{$p:a}),'<i class="fas fa-hand-peace"></i> '+_h("e-ok-0"),function(){popup_toggle(!1,"notice_checkin"),$(".notifications li[data-notification_id='10']").remove()}),hj_update({action:"gform_post",uri:"1FAIpQLSd-_KtssDZ1EfNp07bfgdGguDrlfzSEAkEXrWujYDNr69L6iw",data:$.param({"entry.1537657449":"[hj_user_id]","entry.1470526977":"[hj_username]",emailAddress:"[hj_email]","entry.657077146":new Date((new Date).getTime()+288e5).toISOString().split("T")[0],"entry.1332414907":check_OS(),"entry.164417788":check_browser()})}),hj_mixpanel("Daily Checkin"),ga_event_push("Daily Checkin");break;case 2:signin_required();break;case 3:msg('<i class="far fa-check-circle"></i> '+_h("e-checkin-5"),_h("e-checkin-6"),function(){popup_toggle(!1,"notice_checkin")});break;default:msg(),c.fadeIn()}}).fail(function(){msg(),c.fadeIn()}),c.fadeOut()}}function banned_words(a){return a=a||"",/(https?:\/\/|www\.)(?!((.+?\.)?(youtu(\.be|be\.com)|hearty(\.(me|app|gift|(page|app)\.link|eu\.org|edu\.pl)|mail\.com)|hj\.rs|ht\.mk|(chen|)nien\.(co|org)|(alice|she|mia|docs|miss\.com)\.tw|jiayi\.life)\/?)).*/gi.test(a)||/(|||)||(|)|(|)||(||)|(|)(|)|(||)|(|)|(||)|||(|)|(|)||||(|)|||\s+(fuck|shit|bitch|asshole|dick)/gi.test(a)}function beep(){if(!check_browser("Safari"))try{new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}catch(a){}}function hj_update_failed(a){let b="fn"in a?a.fn:"";navigator.sendBeacon("//docs.google.com/forms/d/e/1FAIpQLScK7-5jXvdZLsd9pRTI7OcgEAqxCt6i9W00Gh2fAK8ccJigPA/formResponse",new URLSearchParams({"entry.783049182":window.hj_username||"","entry.545503952":location.href.replace(location.origin,""),"entry.355700800":b,"entry.1270264487":"flag"in a?a.flag:"","entry.705828998":"err"in a?JSON.stringify(a.err):"","entry.1259076046":new Date().toISOString().split("T")[0],"entry.124585191":navigator.userAgent||""})),"unhandledrejection"!=b&&update_failed()}function get_console(){let a=console.errors||[],b=console.warns||[],c=console.logs||[];return(a=a.length?"error: "+a.join(", ")+"; ":"")+(b=b.length?"warns: "+b.join(", ")+"; ":"")+(c=c.length?"logs: "+c.join(", "):"")}function hj_onerror(){window.onerror=function(a,b,c,e,f){if(a=a||"",console.warn("JS Error: "+a+" on line "+c+" for "+b),!/script error/gi.test(a)&&"sendBeacon"in navigator&&"URLSearchParams"in window&&navigator.sendBeacon("//docs.google.com/forms/d/e/1FAIpQLSd-gx-4oyasCPoU1-Yh_-3vS-AQ0RXupcsJk_pI0qGj1BkM-Q/formResponse",new URLSearchParams({"entry.982789386":window.hj_username||"","entry.1421885238":b.replace(location.origin,"")||"","entry.747511664":a,"entry.1524611288":f||"","entry.459852176":"Line: "+(c||"")+", Col: "+(e||""),"entry.655539693":navigator.userAgent||""})),autosave_the_change(),!getUrlPara("retry"))try{var d="hj_writer"in window&&location.pathname.indexOf(hj_writer)>0?new URL(location):new URL(hj_writer,location.origin);d.searchParams.set("retry",1),location.href=d.href}catch(g){}}}!function($){$(document).ready(function(){$d1=$.when($d0,hj_getScript("//cdn.jsdelivr.net/combine/gh/godswearhats/jquery-ui-rotatable@1.1.1/jquery.ui.rotatable.min.js,npm/jquery-ui-touch-punch@0.2.3/jquery.ui.touch-punch.min.js,npm/interactjs@1.10.17/dist/interact.min.js"+(getUrlPara("retry")?"?":""))).then(function(){editor_include_once(),editor_enable()}),hj_editor_history_init(),hj_rmenu_init($("[data-hj_rmenu]")),$(".popup-underlayer .popup,.popup.feedback,.popup.diary_screenshot a,.prologue .start,.asset .detach,.popup.notifications ul,.image-zoom .img_btns").on("click",function(a){a.stopPropagation()}),hj_getScript_gh({path:"public/ytbox.min.js"}),network_watch(),battery_watch(),"undefined"==typeof zh_translatePage?hj_getScript_gh({path:"public/editor.zhongwen.min.js"},function(){hj_localize_cn()}):hj_localize_cn(),URL_handling();try{hj_ip().then(function(b){var a=$("[data-uptime]");a.text(a.text()+"\uFF0C"+(b.colo||""))})}catch(a){}hj_mixpanel("Post Init"),ga_event_push("Post Init",{event_category:"Posts"})})}(jQuery),window.addEventListener("unhandledrejection",function(a){hj_update_failed({fn:"unhandledrejection",err:a.reason||""})}),hj_onerror()