"use strict";var hj_editor_loaded=!0;window.top.location.hostname!==window.self.location.hostname&&(window.top.location.href=window.self.location.href),function(e){e(document).ready(function(){d1=e.when(d0,hj_getScript("//cdn.jsdelivr.net/combine/gh/godswearhats/jquery-ui-rotatable@1.1.1/jquery.ui.rotatable.min.js,npm/jquery-ui-touch-punch@0.2.3/jquery.ui.touch-punch.min.js,npm/interactjs@1.3.4/dist/interact.min.js")).then(function(){stickers__initialize(),editor_include_once(),editor_enable()}),compatibility_handle(),catalog_query(),editor_versioning(!0,hj_version),hj_editor_history_init(),hj_rmenu_init(e("[data-hj_rmenu]")),e(".popup-underlayer .popup, .popup.feedback, .popup.diary_screenshot a, .prologue .start, .asset .detach").on("click",function(e){e.stopPropagation()}),getUrlPara("preview")&&e(".mh-head, .btn_feedback").hide(),hj_mixpanel("Post Loaded",{post_id:post_id}),ga_event_push("Post Loaded",{event_category:"Posts",event_label:"Post Loaded"})})}(jQuery);var l=window.location;function isSafari(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent||"")}function isiOS(){return/iPhone|iPad|iPod/i.test(navigator.userAgent||"")}function isAndroid(){return/Android/i.test(navigator.userAgent||"")}function hj_idle(){var e=$(".editor_toolbelt"),t=$(".screenlock"),a=!is_touch_device()&&current_post().editable;function i(){hj__cache({set:!0,bucket:"hearty_idle",data:0}),a&&e.slideDown("normal")}$(document).mousemove(i).keypress(i),$("#editor_editable").keydown(i),i(),window.setInterval(function(){var i=Number(hj__cache({bucket:"hearty_idle"}));switch(hj__cache({set:!0,bucket:"hearty_idle",data:++i}),!0){case i>3&&autosave_the_change():break;case i>7&&a&&e.is(":visible"):e.slideUp("slow");break;case i>119&&screenlock("status")&&t.is(":hidden"):screenlock(!0)}},1e3)}function hj_editor_history_init(){"function"==typeof history.pushState&&(history.pushState(null,document.title,location.href),window.addEventListener("popstate",function(e){var t=hj_editor_history("load");if(null!=t){var a=$("#editor_editable");switch(t){case"[editable_blur]":a.blur();break;default:post_query(t,!0)}}else open_book(!1),history.pushState(null,document.title,location.href)},!1))}function hj_editor_history(e,t){if("function"==typeof history.pushState){var a="hearty_editor_history",i=JSON.parse(hj__cache({bucket:a}))||[];switch(e){case"load":t=i.pop();break;case"add":history.pushState(null,document.title,location.href),i.push(t);break;case"detach":i=i.filter(e=>e!==t)}return hj__cache({set:!0,bucket:a,data:JSON.stringify(i)}),t}}function editor_versioning(e,t){var a="hearty_editor_version",i=new Date;if(i.setTime(i.getTime()+864e5),t=Number(t)||0,e)document.cookie=a+"="+t+"; expires="+i.toGMTString()+"; path=/";else{var r=Number(getcookie(a))||0,o=0;if(!r){var n=update({action:"versioning_diary"});1===n.Status&&"latest"in n.Values&&(o=Number(n.Values.latest)||0)}(t<r||t<o)&&(autosave_the_change(),document.cookie=a+"="+t+"; expires="+i.toGMTString()+"; path=/",hj_mixpanel("Force Update",{version:o}),ga_event_push("Force Update"),window.location.reload(!0))}}function editor_enable(e){e=e||current_post().editable||!1;var t=$(".bk-page #editor_editable"),a=t.data("editor_loaded")||!1,i=$(".picture").find(".fa-video-plus, .fa-camera-alt");e?(a||(editable__initialize(),hj_idle(),screenlock("initialize",pincode||""),hj_getScript("//cdn.jsdelivr.net/gh/chennien/hearty.me@a35cd014d5d58ea8feb318c60e7fa0486fbc90cf/public/jquery.uploadfile.min.js",image_uploader_initialize),t.data("editor_loaded",!0),i.slideDown(),$(".editor_toolbelt .kit.save").on("mouseover",autosave_the_change)),sticker__list(),mobile_editor_focus(),$(".hj_rmenu li[data-editing]").show()):(sticker__list(!1),i.slideUp(),$(".hj_rmenu li[data-editing]").hide()),t.prop("contenteditable",e),toolbelt_toggle(e)}function vip_fn(e){var t=current_post();if(t.vip)switch(e){case"picture":t.editable&&hj_picture();break;case"video":t.editable&&hj_video("update");break;case"post_attr":t.editable&&popup_toggle(!0,"post_attr");break;case"screenshot":hj_screenshot();break;case"screenlock":screenlock("activate")}else popup_toggle(!0,"upgrade");return t.vip}function hj_rmenu_init(e){var t=$(".hj_rmenu");!is_touch_device()&&t.length>0&&(e.get(0).addEventListener("contextmenu",function(t){hj_rmenu_toggle(t,!0,e)},{passive:!1}),t.get(0).addEventListener("mouseleave",function(t){hj_rmenu_toggle(t,!1,e)},{passive:!0}))}function hj_rmenu_toggle(e,t,a){var i=$(".hj_rmenu");t?(e.preventDefault(),i.css({top:Math.min(e.clientY,a.height()-i.height()-30)+"px",left:Math.min(e.clientX,a.width()-i.width()-30)+"px"}).show()):i.fadeOut("slow")}function load_datepicker(){$("<link>").attr({rel:"stylesheet",href:"//cdn.jsdelivr.net/gh/chennien/hearty.me@ae8b4f388ef3fed4a0c763eccbe14284872e350d/public/jquery.ui.datepicker.custom.min.css"}).add($("<link>").attr({rel:"stylesheet",href:"//hearty.me/styles/datepicker/jquery-ui.datepicker.custom.css"})).appendTo("head"),hj_getScript("//cdn.jsdelivr.net/gh/chennien/hearty.me@108ecd58ef914017887125255771a919805eb5f1/public/safari.datepicker.tw.min.js",function(){$(".post_attr #post_created").attr({type:"text",onclick:"$(this).datepicker('show')"}).datepicker({dateFormat:"yy-mm-dd",showAnim:"slideDown",minDate:$(this).attr("min")||"",maxDate:$(this).attr("max")||""})})}function editor_include_once(){new MutationObserver(function(e){e.forEach(saved)}).observe($("#editor_editable").get(0),{characterData:!0,subtree:!0});autosaver_30s(),document.addEventListener("visibilitychange",function(){document.hidden?autosave_the_change():editor_versioning(!1,hj_version)}),isiOS()&&current_post().editable&&window.addEventListener("pagehide",post_revise,!1),(isiOS()||isSafari())&&load_datepicker()}function editor_editable_scroll_to_bottom(e,t){if(is_touch_device()&&13==e.keyCode){var a=$(".bk-page"),i=window.getSelection().getRangeAt(0),r=document.createRange(),o=Number(a.find("#editor_editable").height());r.selectNodeContents(t),r.setStart(i.endContainer,i.endOffset),r.cloneContents().textContent.toString().length<2&&(isiOS()?$("body").scrollTop(o-(window.screen.availHeight>=812?333:258)):a.scrollTop(o))}}function toolbelt_toggle(e){var t=$(".btn_stickerbook"),a=$(".editor_toolbelt");e?(t.show(),a.removeClass("off")):(t.hide(),a.addClass("off"))}function page_gps_trigger(e){var t=$("#gps_trigger");switch(e){case"granted":t.removeAttr("onclick").css("background","#00c78c").text("已開啟");break;case"prompt":t.attr("onclick","page_gps_trigger('loading'); positioning_gps_trigger(!0);").css("background","#ffa500").text("點此開啟定位");break;case"denied":t.attr("onclick","window.open(positioning_gps_reset_support(), '_blank');").css("background","#c40000").text("需設定瀏覽器");break;case"loading":t.css("background","#555").text("請稍候")}}function sticker__draggable_handle(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img"),r=$("#editor").width(),o=$(".bk-list .bk-page").scrollTop()||0,n=$("#editor").get(0).offsetTop,s=a.position().top+o-n,l=a.get(0).offsetLeft,d=r-(l+i.width())-30;return d>0&&(d=Math.max(0,Math.ceil(d+i.width()-i.get(0).getBoundingClientRect().width))),{pos:{top:s,left:l,right:d,align_right:l+a.width()/2>Math.floor(r/2)?1:0},overflow:{top:s>0,left:l>0,right:d>0}}}function sticker__editor_hotkeys(e,t,a){$(document).off("keydown"),e&&$(document).on("keydown",function(e){e.preventDefault();var i=$(".bundle .asset[data-asset_id='"+a+"']"),r={top:parseInt(i.css("top"))||0,left:parseInt(i.css("left"))||0},o=Object.assign({},r);switch(e.keyCode){case 13:case 27:case 32:return void sticker__paste({bundle_id:t,asset_id:a});case 37:o.left-=15;break;case 38:o.top-=15;break;case 39:o.left+=15;break;case 40:o.top+=15;break;case 8:case 46:return void sticker__remove({bundle_id:t,asset_id:a})}var n=sticker__draggable_handle(t,a);n.overflow.left?n.overflow.right?n.overflow.top?sticker__update(t,a,"position",n.pos):o.top=r.top+15:o.left=r.left-15:o.left=5,i.animate(o,25);var s=parseInt(i.get(0).offsetTop-2*$(".bk-list .bk-page").height()/5);s<$(".bk-list .bk-page").height()+100&&$(".bk-list .bk-page").animate({scrollTop:s},60)})}function network_status(e,t){var a=$(".warning-underlayer");e.length>0&&e.forEach(function(e){t?a.filter("."+e).slideDown("fast"):a.filter("."+e).fadeOut()})}function flip_book(){$(".bk-flip").click()}function book__initialize(e){(function(){var e=$(".bk-list .bk-book"),t=e.length;return{init:function(){e.each(function(){var a=$(this),i=e.not(a),r=a.parent(),o=$(".bk-read"),n=$(".bk-flip");o.on("click",function(){var e=$(this);i.data("opened",!1).removeClass("bk-viewinside").parent().css("z-index",0).find(".bk-read").removeClass("bk-active"),i.hasClass("bk-filp")||i.addClass("bk-default"),a.data("opened")?(e.removeClass("bk-active"),a.data({opened:!1,flip:!1}).removeClass("bk-viewinside").addClass("bk-default")):(e.addClass("bk-active"),a.data({opened:!0,flip:!1}).removeClass("bk-filp bk-default").addClass("bk-viewinside"),r.css("z-index",t))}),n.on("click",function(){o.removeClass("bk-active"),a.data("flip")?a.data({opened:!1,flip:!1}).removeClass("bk-filp").addClass("bk-default"):a.data({opened:!1,flip:!0}).removeClass("bk-viewinside bk-default").addClass("bk-filp")})})}}})().init(),$(".mask_loading").delay(300).queue(function(){$(this).fadeOut("fast",function(){$(".bk-viewinside").length||$(".bk-list .bk-book").addClass("bk-rotate").delay(100).queue(function(){e&&open_book(!0),$(this).removeClass("bk-rotate").dequeue(),window.d0.resolve()})}).dequeue()}),$(".bk-list .bk-cover, .bk-left").on("click",function(){open_book(!0),$(".bk-page, .bk-cover-back .catalog").scrollTop(0)}),$(".bk-list .bk-back").on("click",flip_book),$(".bk-underlayer").on("click",function(){$(".bk-page .sticker_editing").length>0?sticker__paste():$(".bk-viewinside").length>0?open_book(!1):flip_book()}),$(".stickerbook .stickerlist .stickerdir").scroll(function(){$(this).scrollTop()>200?$(".stickerbook .fa-chevron-square-up").fadeIn():$(".stickerbook .fa-chevron-square-up").fadeOut(),$(".item[data-sticker='0']:visible").length>0&&$(this).data("scrolled",$(this).scrollTop())}),$(".bk-list .bk-page, .bk-cover-back .catalog").delay(800).queue(function(){$(this).scrollTop(0).dequeue()}),(navigator.userAgent||"").indexOf("Edge/")>0&&$(".bk-cover-back .catalog").scrollTop($(".bk-cover-back .catalog").get(0).scrollHeight)}function editable__initialize(){is_touch_device()&&$(".bk-list .bk-page").get(0).addEventListener("touchmove",function(e){if(e.cancelable)return!0},{passive:!0}),cssFeatureSupported("-webkit-user-modify","read-write-plaintext-only")||$("#editor_editable").keydown(function(e){if(13==e.keyCode)return document.execCommand("insertHTML",!1,"<br> "),!1})}function period__initialize(){var e=$(".periods");e.data("loaded")||hj_getScript("//cdn.jsdelivr.net/gh/chennien/hearty.me@e36955f95eca4b9447359f2af7782f8c1f822ff2/public/periods.min.js",function(){e.slideDown("slow").data("loaded",!0)})}function createCaretPlacer(e){var t=$(".bk-page #editor_editable").get(0);if(t.focus({preventScroll:!1}),null!=window.getSelection&&null!=document.createRange){var a=document.createRange();a.selectNodeContents(t),a.collapse(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}else if(null!=document.body.createTextRange){var r=document.body.createTextRange();r.moveToElementText(t),r.collapse(e),r.select()}}function compatibility_handle(){var e=(navigator.userAgent||"").toLowerCase(),t=e.indexOf("version/")>0&&e.indexOf("; wv")>0,a=window.innerWidth;!cssFeatureSupported("width","calc(100%-1em)")&&a<1024&&($(".bk-list, .bk-front, .bk-back, .bk-cover").width(.85*a),$(".bk-list .bk-page, .bk-cover-back").width(.82*a)),cssFeatureSupported("transition","transform")||cssFeatureSupported("-webkit-transition","transform")||cssFeatureSupported("moz-transition","transform")||(t?confirm("手機裡的系統程式太舊，是否要試著更新？ \nℹ️ 缺少功能：CSS Transitions")&&window.open("market://details?id=com.google.android.webview"):hj_alert("請更新瀏覽器\nℹ️ 缺少功能：CSS Transitions"))}function catalog_query(){var e,t=$(".catalog"),a="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),i={},r=[];if(!Object.keys(i).length){var o=update({action:"catalog_page",writer:hj_writer,page:0});switch(o.Status){case 0:case 2:update_failed();break;case 1:o.Values.catalog.forEach(function(e,t){e.title_decoded=htmlDecode(e.title),i[e.post_id]={title:e.title_decoded,post_id:e.post_id,privacy:e.privacy,page:Math.ceil((t+1)/10)}}),hj__cache({set:!0,bucket:a,data:JSON.stringify(i)})}}for(var n in i)e=i[n],r.unshift($("<li>",{title:"📝 "+e.title,onclick:"if(this.dataset.active==null && !post_query(this.dataset.post_id)) $(this).remove();","data-post_id":n,"data-page":e.page,"data-privacy":e.privacy}).text(e.title));t.find(".diaries").html(r),$(".bk-cover-back .catalog").get(0).scrollHeight>$(".bk-cover-back > div").height()&&$(".bk-cover-back .catalog").scroll(function(){$(this).scrollTop()>100?$(".bk-cover-back .fa-chevron-square-up").fadeIn():$(".bk-cover-back .fa-chevron-square-up").fadeOut()}),$(".catalog[data-mobile] > div > div").scroll(function(){$(this).scrollTop()>100?$(".catalog[data-mobile] .fa-chevron-square-up").fadeIn():$(".catalog[data-mobile] .fa-chevron-square-up").fadeOut()})}function catalog_lookup(e){var t=catalog_cached();if(null==t)return catalog_query(),!1;var a=Object.keys(t);if(a.length>0){if(e>0)return e in t?t[e]:null;if(0===e)return t[a[a.length-1]];if(-1===e)return t[a[0]]}return null}function catalog_page(e,t,a){e=Number(e)||1;var i=$(".catalog"),r=i.find(".diaries"),o=i.find(".pagination");if(r.children("li[data-active]").removeAttr("data-active"),null!==t&&t>0){var n=catalog_lookup(t);if(null==n)return catalog_page(1,null),!1;if(!n)return catalog_page(null,t),!1;e=n.page,r.children("li[data-post_id='"+t+"']").attr("data-active","")}else null!==a&&$(a).filter(".fal").toggleClass("fal fas").delay(450).queue(function(){$(this).toggleClass("fas fal").dequeue()});e>1?o.children(".fa-caret-circle-left").attr("onclick","$(this).removeAttr('onclick'); catalog_page("+(e-1)+", null, this);").removeClass("disabled"):o.children(".fa-caret-circle-left").addClass("disabled"),r.children("li[data-page='"+(e+1)+"']").length>0?o.children(".fa-caret-circle-right").addClass("disabled").attr("onclick","$(this).removeAttr('onclick'); catalog_page("+(e+1)+", null, this);").removeClass("disabled"):o.children(".fa-caret-circle-right").addClass("disabled"),r.children("li").not("[data-page="+e+"]").hide(),r.children("li[data-page="+e+"]").fadeIn("slow")}function catalog_cached(){var e=hj__cache({bucket:"hearty_diaries_"+hj_writer+"__"+bucket_suffix()});return null==e?null:JSON.parse(e)||{}}function stickers__initialize(){sticker__uniqID(!0),stickers__detach();var e=update({action:"sticker_query",post_id:current_post().post_id});switch(e.Status){case 1:var t=e.Values;sticker__save_local(t),t.forEach(function(e){sticker__createDOM(e.id,e)});break;case 2:signin_required();break;default:hj_alert("發生錯誤")}}function sticker__initialize(e,t,a){var i=$(".bundle .asset[data-asset_id='"+t+"']"),r=i.children(".sticker_img"),o=sticker__new_blank("asset",e,a);"angle"in a?r.css({transform:"rotate("+a.angle.deg+"deg)"}):a.angle=o.angle,"size"in a?r.css({width:a.size.width,height:a.size.height}):a.size=o.size,"position"in a?i.css({top:a.position.top,left:a.position.left}):a.position=o.position,current_post().editable?sticker__editor_initialize(e,t,a):sticker__paste({bundle_id:e,asset_id:t})}function sticker__editor_initialize(e,t,a){var i=is_touch_device(),r=$(".bundle .asset[data-asset_id='"+t+"']"),o=r.children(".sticker_img");r.draggable({start:function(e,t){i?o.addClass("dragging"):o.addClass("grabbing"),o.hasClass("dragthis")&&o.removeClass("dragthis")},stop:function(a,r){a.stopPropagation();var n=sticker__draggable_handle(e,t);sticker__update(e,t,"position",n.pos),i?o.removeClass("dragging"):o.removeClass("grabbing")},snap:!0,containment:"#editor",scroll:!1,cursor:"move",grid:[5,5],cancel:".ui-rotatable-handle"});var n=a.angle.deg,s={angle:h=n/57.296,rotationCenterOffset:{top:0,left:0},start:function(e){o.data("rotate-mode",1)},rotate:function(a,i){0===o.data("rotate-mode")&&(a.stopPropagation(),h=i.angle.current,n=i.angle.degrees,sticker__update(e,t,"angle",{deg:n,rad:h}),sticker__rotation_margin_fixes(e,t))},stop:function(a,i){h=i.angle.current,n=i.angle.degrees,sticker__update(e,t,"angle",{deg:n,rad:h}),o.data("rotate-mode",0),sticker__rotation_margin_fixes(e,t)},rotationCenterOffset:{top:0,left:0},wheelRotate:!0};o.rotatable(s).data("rotate-mode",0),o.find(".ui-rotatable-handle").remove();var l=$("<div>",{class:"ui-rotatable-handle",title:"旋轉"});if(!i){var d=l.clone(),c=l.clone(),u=l.clone();d.addClass("ui-rotatable-handle-ne"),c.addClass("ui-rotatable-handle-nw"),u.addClass("ui-rotatable-handle-sw"),o.append(d,c,u)}if(l.addClass("ui-rotatable-handle-se segrip"),o.append(l),o.find("div[class*='ui-rotatable-handle-']").bind("mousedown",function(e){o.rotatable("instance").startRotate(e)}),!i){var _=o.width()/o.height(),p=i?{}:{n:".ngrip",e:".egrip",s:".sgrip"};o.resizable({resize:function(e,t){r.css({"min-width":t.size.width})},stop:function(a,i){sticker__update(e,t,"size",{width:i.size.width,height:Math.round(i.size.height)}),$(this).height(i.size.width/_).css({top:0,left:0})},containment:"#editor",aspectRatio:!0,grid:5,minWidth:80,minHeight:80,maxWidth:.85*$("#editor_editable").width(),maxHeight:640,handles:p})}if(i){$(".ui-resizable-n, \t\t\t.ui-resizable-e, \t\t\t.ui-resizable-s").remove(),o.get(0).addEventListener("touchmove",function(a){if("touches"in a){var i={x:0,y:0,sum:0},r=hj__cache({bucket:"hearty_sticker_finger_gap"})||null,n=0,s=o.width(),l=o.height(),d={max:.85*$("#editor_editable").width(),min:80};if(o.data("aspect_ratio"))c=o.data("aspect_ratio");else{var c=s/l;o.data("aspect_ratio",c)}if(a.touches.length>1){i.x=Math.abs(a.touches[1].pageX-a.touches[0].pageX),i.y=Math.abs(a.touches[1].pageY-a.touches[0].pageY),i.sum=Math.floor(Math.sqrt(Math.floor(i.x**2+i.y**2))),null!==r&&(n=i.sum-r),n=isNaN(n)?0:n,hj__cache({set:!0,bucket:"hearty_sticker_finger_gap",data:i.sum}),l=(s+=s*(n/s*.4))/c,s<d.min?(l*=d.min/s,s=d.min):s>d.max&&(l*=d.max/s,s=d.max),s=Math.round(1e3*s)/1e3,l=Math.round(1e3*l)/1e3;var u=Math.floor(.45*Math.min(s,l));o.width(s).height(l).css({"font-size":u>100?100:u}),sticker__update(e,t,"size",{width:s,height:l}),Math.abs(n)>0&&o.hasClass("rotating")&&o.removeClass("rotating"),o.addClass("resizing"),o.hasClass("dragthis")&&o.removeClass("dragthis")}}},{passive:!0}),o.get(0).addEventListener("touchend",function(e){hj__cache({set:!0,bucket:"hearty_sticker_finger_gap"}),o.removeClass("resizing")},{passive:!0}),window.interact(".asset[data-asset_id='"+t+"']").on("hold",function(a){0===$(".asset[data-asset_id='"+t+"'] .sticker_editing").length&&(sticker__cut({bundle_id:e,asset_id:t}),"vibrate"in navigator&&navigator.vibrate([80]))});var h=(n=parseFloat(a.angle.deg))/57.296;window.interact(".asset[data-asset_id='"+t+"'] .sticker_img").gesturable({onmove:function(a){n+=a.da,o.css({"-webkit-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)",transform:"rotate("+n+"deg)"}),n>360?n-=360:n<0&&(n+=360),sticker__update(e,t,"angle",{deg:n,rad:h=n/57.296}),sticker__rotation_margin_fixes(e,t),Math.abs(a.da)>.5&&o.removeClass("resizing").addClass("rotating"),sticker__log("* 更新貼紙角度 "+t+"："+parseFloat(n).toFixed(2)+" °")}}).on({gestureend:function(e){o.removeClass("rotating")}}),o.css({"-webkit-transform":"rotate("+n+"deg)","-ms-transform":"rotate("+n+"deg)",transform:"rotate("+n+"deg)"})}sticker__paste({bundle_id:e,asset_id:t}),sticker__log("🏮 初始化貼紙："+e+"（"+t+"）")}function stickers__detach(){sticker__save_local([]),$("#editor .bundle").remove()}function sticker__oncreate(e,t){var a=current_post().post_id;Number(t)>0?(nav_toggle($(".stickerbook"),!1),popup_toggle(!0,"upgrade")):sticker__create(e),hj_mixpanel("Sticker Created",{post_id:a,sticker_set_num:e.set_num,sticker_set_alias:e.set_alias,sticker_num:e.num,sticker_name:e.name}),ga_event_push("Sticker Create",{event_category:"Posts",event_label:"Sticker Create"})}function sticker__create(e,t){if(!current_post().editable)return!1;var a,i="page"in(b=sticker__lookup("page"))[1]?b[1].page:{},r="bundles"in b[1]?b[1].bundles:[],o=null==t,n=sticker__uniqID(),s=160,l=160,d=Math.min(s/e.width,l/e.height);if(e.width=Math.ceil(e.width*d),e.height=Math.ceil(e.height*d),e.align_right=1,o){a=sticker__new_blank("bundle",t=sticker__uniqID(),e);var c=r.map(function(e,t){return r[t].position.sum});c.push(0);var u=Math.max.apply(null,c);a.position.top=u,i[t]=a;var _=$(".bk-list .bk-page").scrollTop()||0,p={width:$("#editor").width()||0,height:$(".bk-list .bk-page").height()||0},h=$("#editor").get(0).offsetTop;_<h&&(_=h,$(".bk-list .bk-page").animate({scrollTop:_},100));var g={move:{top:_-.5*p.height-u},def:{top:_-h+.5*p.height-e.height+50,left:e.align_right?p.width-e.width||0:.1*p.width||0}},f={top:Math.ceil(g.move.top),left:Math.round(g.move.left)}}else{f=null;a=i[t]}if(i[t].assets[n]=a.assets[n]=sticker__new_blank("asset",t,e),sticker__save_local(r=Object.keys(i).map(function(e){return i[e]})),sticker__createDOM(t,a,f),o){a.position=a.assets[n].position={top:Math.floor(g.def.top),left:Math.round(g.def.left),right:0,align_right:1},i[t].assets[n]=a.assets[n],sticker__update(t,n,"position",a.assets[n].position);var b,k=a.assets[n];switch((b=update({action:"sticker_create",post_id:current_post().post_id,data:{bundle_id:t,asset_id:n,bundle_top:a.position.top,bundle_left:a.position.left,bundle_right:a.position.right,bundle_align_right:a.position.align_right,item_num:k.item_num,asset_width:k.size.width,asset_height:k.size.height}})).Status){case 0:return void update_failed();case 2:return void signin_required();case 3:return void hj_alert("超過貼紙數上限")}}sticker__cut({bundle_id:t,asset_id:n}),open_book(!0),"vibrate"in navigator&&navigator.vibrate([30]),sticker__log("➕ 新增貼紙："+t+"（"+n+"）")}function sticker__createDOM(e,t,a){var i,r,o,n;for(var s in r=$("<div>",{class:"bundle","data-bundle_id":e,onContextMenu:"return false;"}).html($("<div>",{class:"bundle_innerbox"})).data("bundle-id",e).insertBefore("#editor_editable"),t.assets)n=t.assets[s],i=$(".hj-sample .asset").clone().attr({title:n.item_name,"data-editing":!0,"data-bundle_id":e,"data-asset_id":s}).data("asset-id",s).fadeTo("slow",.35),r.children(".bundle_innerbox").append(i),(o=$(".asset[data-asset_id='"+s+"'] .sticker_img")).width(n.size.width).height(n.size.height).addClass("dragthis").css({"background-image":"url('//"+wpCDN+"/s.hearty.me/images/stickers/"+n.set_alias+"/"+n.item_num+".png'), url('//"+wpCDN+"/c.hearty.me/images/stickers/"+n.set_alias+"/"+n.item_num+".png'), url('//c.hearty.me/images/stickers/"+n.set_alias+"/"+n.item_num+".png')"}),is_touch_device()&&o.children(".detach").get(0).addEventListener("touchmove",function(e){e.stopPropagation()},{passive:!0}),null==a?i.fadeTo("slow",1):window.setTimeout(function(){i.animate(a,150).fadeTo("slow",1)},0),sticker__initialize(e,s,t.assets[s])}function sticker__rotation_margin_fixes(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img"),r=Math.floor(.9*i.get(0).getBoundingClientRect().width),o=Math.floor(.9*i.get(0).getBoundingClientRect().height);if(sticker__log("貼紙尺寸："+r+" x "+o),!r||!o)return!1;sticker__update(e,t,"size",{width:r,height:o},!0),a.css({"min-width":r,"max-height":o})}function sticker__new_blank(e,t,a){var i={};return i.position={top:isNaN(a.top)?0:a.top,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right,topmargin:0,align_right:isNaN(a.align_right)?0:a.align_right},i.size={width:a.width,height:a.height},"asset"==e?(i.item_num=isNaN(a.num)?0:a.num,i.item_name=a.name,i.set_num=isNaN(a.set_num)?0:a.set_num,i.set_alias=a.set_alias,i.angle={deg:0,rad:0}):"bundle"==e&&(i.id=t||sticker__uniqID(),i.assets={},i.position.sum=0),i}function sticker__exec(e,t,a){var i=!1;if(null==a){var r=sticker__lookup("page");if(!r[0])return!1;r[1].page,a=r[1].bundles}switch(e){case"add":var o=a.length;if(o)for(var n=0;n<o;n++)if(i){if(a[n].position.sum>a[n].position.top)for(var s=a[n].position.sum-a[n].position.top,l=n;l<o;l++)a[l].position.top+=s}else(a[n].position.top>t.position.top||n+1===o)&&(a[n].position.topmargin=n>0?a[n].position.top-a[n-1].position.sum:a[n].position.top,a[n].position.sum=a[n].position.top+a[n].size.height,a.splice(n,0,t),i=!0);else a.push(t);return sticker__save_local(a),sticker__createDOM(t.id,t),sticker__place(sticker__calc(sticker__order(a)));case"remove":for(n=0;n<a.length;n++)a[n].id==t.id?(a.splice(n,1),i=!0):i&&a[n].position.align_right==a[n-1].position.align_right&&(a[n].position.topmargin+=a[n-1].position.topmargin+a[n-1].size.height,i=!1);return sticker__save_local(a),$(".bundle[data-bundle_id='"+t.id+"']").fadeOut(200,function(){$(this).remove()}),sticker__place(a)}}function sticker__order(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page,e=t[1].bundles}return e.length>1&&e.sort(function(e,t){return e.position.top-t.position.top}),e.forEach(function(e){$(".bundle[data-bundle_id='"+e.id+"']").detach().insertBefore("#editor_editable")}),e}function sticker__calc(e,t,a){if(null==e){var i=sticker__lookup("page");if(!i[0])return!1;i[1].page,e=i[1].bundles}switch(t){case"add":e=sticker__exec("add",a,e);break;case"remove":e=sticker__exec("remove",a,e)}var r=["left","right"],o={alignment:"",top:0,sum:{left:0,right:0}};return e.forEach(function(t,a){var i=t.position.align_right,n=i;if(i=r[i],n=r[n^=1],t.position.top=Math.max(t.position.top,0),a>0&&i!==o.alignment?t.position.topmargin=t.position.top-o.top:(t.position.top=Math.max(t.position.top,o.sum[i]+1),t.position.topmargin=t.position.top-o.sum[i]),t.position.topmargin=Math.max(t.position.topmargin,0),o.sum[i]=t.position.sum=t.position.top+t.size.height,a>0&&i==o.alignment)for(var s in o.sum)o.sum[s]=t.position.sum;for(var l in t.assets)t.assets[l].position.top=t.position.top,t.assets[l].position.topmargin=t.position.topmargin,t.assets[l].position.align_right=t.position.align_right;e[a]=t,o.alignment=i,o.top=t.position.top,0===a&&sticker__top_edge(t),sticker__log("📄 調整貼紙位置 "+t.id+"："+JSON.stringify(t.position))}),sticker__save_local(e),e}function sticker__top_edge(e){return!1}function sticker__place(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page,e=t[1].bundles}var a=$(".hj-styles");return e.forEach(function(e){if(a.children("style[data-bundle_id='"+e.id+"']").length){var t=e.position.align_right?'.bundle.bundle_right[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}":'.bundle.bundle_left[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}";a.children("style[data-bundle_id='"+e.id+"']").text(t)}else a.append($("<style>",{"data-bundle_id":e.id}))}),$("#editor .complement").remove(),$("#editor .bundle").each(function(e){var t=$(this).attr("class").split(" "),a=$("#editor .bundle").length>e+1?$(this).nextAll("#editor .bundle").eq(0).attr("class").split(" "):[];t.indexOf("bundle_left")>=0&&a.indexOf("bundle_left")>=0?$(this).after($("<div>",{class:"complement complement_right"})):t.indexOf("bundle_right")>=0&&a.indexOf("bundle_right")>=0&&$(this).after($("<div>",{class:"complement complement_left"}))}),e}function sticker__lookup(e,t,a){var i=hj__cache({bucket:"hearty_sticker_cache__"+current_post().post_id}),r=[null!==r,JSON.parse(i)||[]],o=[!1,{}];if(r[0]){var n,s={},l=r[1];l.forEach(function(e){s[e.id]=e}),o[1].page=l.length>0?s:{},o[1].bundles=l.length>0?l:[],"page"==e?(o[0]=!0,o[1].status=4):t in s?(n=o[1].bundle=s[t],"asset"==e&&a in n.assets?(o[0]=!0,o[1].status=3,o[1].asset=n.assets[a]):(o[0]="bundle"==e,o[1].status=2)):(o[0]=!1,o[1].status=1)}else o[0]=!1,o[1].status=0;return o}function sticker__update(e,t,a,i,r){var o,n=sticker__lookup("asset",e,t);if("angle"==a)i.deg=Math.abs(i.deg)>=360?Math.abs(i.deg).toFixed(0)-360:i.deg.toFixed(0),i.rad=Math.abs(i.rad)>=2*Math.PI?(Math.abs(i.rad)-2*Math.PI).toFixed(5):i.rad.toFixed(5);else for(var s in i)i[s]=Math.max(Math.floor(i[s]),0);if(!(n[0]&&a in n[1].asset))return!1;o=n[1].page,r||(o[e].assets[t][a]=i),["position","size"].indexOf(a)>=0&&(o[e][a]=i),sticker__save_local(Object.keys(o).map(function(e){return o[e]})),sticker__log("💾 暫存貼紙 "+e+"（"+t+"）的 "+a+" 為："+JSON.stringify(i))}function sticker__cut(e){if(!current_post().editable||$(".bk-page .sticker_editing").length>0)return!1;var t,a=e.bundle_id,i=e.asset_id,r=$(".bundle[data-bundle_id='"+a+"']"),o=r.find(".asset[data-asset_id='"+i+"']"),n=o.children(".sticker_img"),s=$(".editor_toolbelt"),l=sticker__lookup("asset",a,i),d=is_touch_device();if(!(l[0]&&"position"in l[1].asset))return r.remove(),!1;t=l[1].asset.position,r.children(".bundle_innerbox").css({top:t.top,left:t.left});var c=t.align_right?-1*(t.right+Math.floor(1.05*n.get(0).getBoundingClientRect().width)):t.left;return o.animate({left:c},0),o.draggable("enable"),n.rotatable("enable").children(".ui-resizable-handle, .ui-rotatable-handle").fadeIn(),d?window.interact(".asset[data-asset_id='"+i+"'] .sticker_img").gesturable({enabled:!0}):(n.resizable("enable"),sticker__editor_hotkeys(!0,a,i)),$("#editor_editable").addClass("readonly").prop("contenteditable",!1).disableSelection(),r.children(".bundle_innerbox").width(0).css({"margin-left":"-1px","margin-right":"-1px"}),n.addClass("sticker_editing").removeClass("sticker_static"),$("#editor .bundle .sticker_static").fadeTo("fast",.5),o.attr("data-editing",!0),$(".editor_toolbelt #paste, #editor_editable").attr("onclick","sticker__paste("+JSON.stringify({bundle_id:a,asset_id:i})+"); saved(false);"),n.children(".detach").fadeIn(),s.find(".kits").hide(),s.find(".sticker span").fadeIn(),$(".mh-head .btn_stickerbook, .stickerbook .stickerlist").hide(),nav_toggle($(".stickerbook"),!1),d&&($(".bk-page header, .bk-page .picture").hide(),$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(Math.floor(t.top-1*$(".bk-list .bk-page").height()/4)).css({"border-top":"none"})),sticker__log("✂️ 剪下貼紙："+a+"（"+i+"）"),!0}function sticker__paste(e){if(0===(n=$(".bk-page .sticker_editing")).length)return!1;var t,a=e.bundle_id||n.attr("data-bundle-id"),i=e.asset_id||n.attr("data-asset-id"),r=$(".bundle[data-bundle_id='"+a+"']"),o=r.find(".asset[data-asset_id='"+i+"']"),n=o.children(".sticker_img"),s=$(".hj-styles"),l=sticker__calc(sticker__order()),d=sticker__lookup("asset",a,i),c=is_touch_device();if(d[0]&&"position"in d[1].asset&&((t=d[1].asset.position).align_right?(r.addClass("bundle_right").removeClass("bundle_left"),r.children(".bundle_innerbox").addClass("alignment_right").removeClass("alignment_left"),s.children("style[data-bundle_id='"+a+"']").length||s.append($("<style>",{"data-bundle_id":a})),s.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_right::before{height:"+t.topmargin+"px}"),r.children(".bundle_innerbox").css({"margin-left":0,"margin-right":t.right+"px"})):(r.addClass("bundle_left").removeClass("bundle_right"),r.children(".bundle_innerbox").addClass("alignment_left").removeClass("alignment_right"),s.children("style[data-bundle_id='"+a+"']").length||s.append($("<style>",{"data-bundle_id":a})),s.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_left::before{height:"+t.topmargin+"px}"),r.children(".bundle_innerbox").css({"margin-left":t.left+"px","margin-right":0})),cssFeatureSupported("width","min-content")?r.children(".bundle_innerbox").width("min-content").height("min-content"):cssFeatureSupported("width","min-intrinsic")?r.children(".bundle_innerbox").width("min-intrinsic").height("min-intrinsic"):r.children(".bundle_innerbox").width("auto").height("auto")),sticker__place(l),$("#editor .bundle .sticker_static").fadeTo("fast",1),n.children(".detach").fadeOut(),$(".editor_toolbelt .sticker a").hide(),$(".editor_toolbelt .kits").fadeIn(),c){$(".bk-page header, .bk-page .picture").show();var u=$("#editor").get(0).offsetTop,_=$(".bk-list .bk-page").scrollTop()||0;$(".bk-list .bk-page").scrollTop(_+u).addClass("scroll-smoothly").css({"border-top":"1em solid transparent"})}return sticker__rotation_margin_fixes(a,i),o.attr("data-editing",!1).css({top:0,left:0}),n.children(".ui-resizable-handle, .ui-rotatable-handle").hide(),current_post().editable&&(o.draggable("disable"),n.rotatable("disable"),c?window.interact(".bundle .asset[data-asset_id='"+i+"'] .sticker_img").gesturable({enabled:!1}):(n.resizable("disable"),sticker__editor_hotkeys(!1,a,i))),$("#editor_editable").removeClass("readonly").prop("contenteditable",!0).enableSelection(),n.addClass("sticker_static").removeClass("sticker_editing"),$(".mh-head .btn_stickerbook, .stickerbook .stickerlist").show(),sticker__log("📋 黏貼貼紙："+a+"（"+i+"）"),!0}function sticker__remove(e){var t=current_post().post_id,a=e.bundle_id,i=e.asset_id;if(sticker__paste({bundle_id:a,asset_id:i}))switch(sticker__exec("remove",{id:a}),sticker__top_edge(),"vibrate"in navigator&&navigator.vibrate([80]),$("#editor .bundle").length<2&&nav_toggle($(".stickerbook"),!0),createCaretPlacer(!1),update({action:"sticker_remove",bundle_id:a,asset_id:i,post_id:t}).Status){case 0:return void update_failed();case 2:return void signin_required()}hj_mixpanel("Sticker Removed",{post_id:t}),ga_event_push("Sticker Remove",{event_category:"Posts",event_label:"Sticker Remove"}),sticker__log("🗑️ 刪除貼紙："+a+"（"+i+"）")}function sticker__save_remote(){var e=sticker__lookup("bundles"),t="bundles"in e[1]?e[1].bundles:[];if(!t.length)return!1;switch((e=update({action:"sticker_save",post_id:current_post().post_id,bundles:JSON.stringify(t)})).Status){case 0:case 3:update_failed();break;case 1:break;case 2:signin_required()}}function sticker__save_local(e){hj__cache({set:!0,bucket:"hearty_sticker_cache__"+current_post().post_id,data:JSON.stringify(e)})}function sticker__uniqID(e){var t,a="hearty_sticker_uniqIDs",i=JSON.parse(hj__cache({bucket:a,local:!0}))||[];return i.length>0?(t=i.shift(),hj__cache({set:!0,bucket:a,data:JSON.stringify(i),local:!0})):e||(t=sticker__generate_uniqID()),i.length<6&&window.setTimeout(function(){for(var e=i.length;e<6;e++)i.push(sticker__generate_uniqID());hj__cache({set:!0,bucket:a,data:JSON.stringify(i),local:!0})},0),t}function hj__cache(e){var t="set"in e,a="local"in e?"localStorage":"sessionStorage";if(a in window){if(!t)return window.eval(a).getItem(e.bucket)||$("body").data(e.bucket)||null;try{window.eval(a).setItem(e.bucket,e.data)}catch(t){$("body").data(e.bucket,e.data)}}else{if(!t)return $("body").data(e.bucket)||null;$("body").data(e.bucket,e.data)}}function sticker__generate_uniqID(){var e=update({action:"uniqid"}),t=(new Date).getTime().toString(16)+Math.floor(90*Math.random()+10);return e&&e.Status?e.Values.uniqid:t}function sticker__log(e){"console"in window&&"log"in window.console&&window.console.log(e)}function post_privacy(e){autosave_the_change(),e=Number(e);var t=current_post().post_id,a=$(".bk-page #editor_editable");$(".popup.share .sharable_url");switch(update({action:"post_privacy",post_id:t,privacy:e}).Status){case 1:var i=a.data("current_post");return i.privacy=e,a.data("current_post",i),post_privacy_toggle(e),$(".catalog .diaries li[data-post_id='"+t+"']").attr("data-privacy",e),e?alertify.success("日記已設為公開"):alertify.error("日記已上鎖"),hj_mixpanel("Post Privacy",{post_id:t,privacy:e}),ga_event_push("Privacy",{event_category:"Posts",event_label:e?"Public":"Private"}),!0;case 2:signin_required();break;default:hj_alert("糟糕，出錯了，請稍候再試")}}function post_privacy_toggle(e){var t=$(".popup.share .sharable_url");Number(e)?(t.slideDown(),post_get_sharable_link()):t.slideUp();var a=$(".privacy_selector li");a.removeAttr("data-selected"),a.filter("[data-privacy='"+e+"']").attr("data-selected","")}function post_get_sharable_link(){var e=Number(current_post().privacy),t=$(".popup.share .sharable_url input"),a=t.val()||"";if(e<9)return!1;if(!a.length){var i=update({action:"post_get_sharable_link",post_id:current_post().post_id});if(!i.Status)return!1;i.Values&&"token"in i.Values&&(a="https://hj.rs/"+i.Values.token,t.val(a))}}function hj_native_share(){var e=$(".popup.share .sharable_url input").val()||window.location.href.replace(window.location.host,"o.hearty.me");if("share"in window.navigator)navigator.share({title:document.title,text:$("meta[name='description']").attr("content"),url:e});else{if(!/Hearty_iOS|Hearty_Android/i.test(navigator.userAgent||""))return!1;window.location.assign("//hearty.me/wv?s="+encodeURIComponent(e.replace(/(^\w+:|^)\/\//,"")))}}function post_contribute(){var e=$(".bk-page #editor_editable"),t=$(".bk-page #subject").text(),a=Number(current_post().privacy),i=a?"確定投稿「"+t+"」嗎？":"投稿文章需為公開，請問是否將其公開並投稿呢？",r=new Date;alertify.set({labels:{ok:"投稿",cancel:"取消"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-paperclip'></i> "+i,function(i){if(i){hj_loading(!0),a||post_privacy(9);var o=current_post().post_id,n=e.text().replace(/^\s+|\s+$/g,"");switch(update({action:"gform_post",uri:"1FAIpQLSejAwJP2dSgdhGz79S9Q_JzqthM4JrAXhFB3dfKNCCfSJGi_A",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]","entry.1497216280":"[hj_email]","entry.355700800":o,"entry.1270264487":n,"entry.1259076046":[r.getFullYear(),("0"+r.getMonth()).slice(-2),("0"+r.getDate()).slice(-2)].join("-"),"entry.124585191":navigator.userAgent||""})}).Status){case 1:msg("📝「"+t+"」已傳送給溫度小編"),$(".privacy_selector li[data-contribute]").attr("data-selected",""),hj_loading(!1);break;default:hj_loading(!1)}}})}function hj_feedback_toggle(e){if(popup_toggle(e,"feedback"),!/Hearty_iOS|Hearty_Android/i.test(navigator.userAgent||"")&&void 0!==window.FB)if($(".fb-customerchat").length>0)e?FB.CustomerChat.show():FB.CustomerChat.hide();else{var t=(Math.random()>=.5?"嗨":"哈囉")+"！ 我是溫度日記"+(Math.random()>=.5?"創辦人 Nien":"的珈宜");if($("<div>",{class:"fb-customerchat",attribution:"setup_tool",page_id:0x690f22312b23,theme_color:"#F16D6E",logged_in_greeting:t,logged_out_greeting:t,greeting_dialog_display:"show"}).appendTo($(".popup.feedback")),"XFBML"in FB)try{FB.XFBML.parse($(".popup.feedback:eq(0)").get(0))}catch(e){}}}function hj_feedback(){var e=$(".popup.feedback"),t=e.find("input[name='name']"),a=e.find("input[name='email']"),i=e.find("textarea"),r=e.find(".notice"),o=e.find(".btns_action li");return t.val().length<2?(r.text("請填寫姓名"),t.focus(),shake(t),!1):/@/.test(a.val())?i.val().length<5?(r.text("意見回饋的字數不足"),i.focus(),shake(i),!1):(hj_loading(!0),void o.slideUp("fast",function(){switch(update({action:"gform_post",uri:"1FAIpQLScPq53DlC8PjlQCJEMqHm-7ykRPEDosDrIsaAbj3YUT32rTgQ",data:$.param({"entry.434422115":"[hj_user_id]","entry.1958440920":t.val()||"[hj_username]","entry.803572147":a.val()||"[hj_email]","entry.1027128888":i.val()||"","entry.858322988":navigator.userAgent||""})}).Status){case 1:e.find("form").get(0).reset(),hj_feedback_toggle(!1),r.text("謝謝您的意見"),msg("已收到反饋，將儘速以 Email 回覆"),$(this).slideDown(),hj_loading(!1);break;default:r.text("出錯了，請稍候再試"),msg("對不起，似乎出錯了，請稍候再試"),$(this).slideDown(),hj_loading(!1)}})):(r.text("Email 格式不正確"),a.focus(),shake(a),!1)}function copy(e){e.select(),document.execCommand("Copy",!1,null),alertify.success("已複製到剪貼簿。")}function sticker__list(e,t){var a=$(".stickerbook"),i=a.find(".stickertabs"),r=a.find(".stickerlist .stickerdir"),o=[],n="hearty_sticker_list__"+bucket_suffix(),s=hj__cache({bucket:n});if(null===s){var l=update({action:"sticker_list"});l.Status>0?(s=l.Values,hj__cache({set:!0,bucket:n,data:JSON.stringify(s)})):s={}}else s=JSON.parse(s)||{};if(null==e){var d=[];for(var e in s)d=s[e],o.push($("<div>",{class:"item",onclick:"sticker__list('"+e+"', '"+d.alias+"');",title:d.name,"data-sticker":0}).html($("<div>",{"data-src":d.alias+"/"+d.cover+".png"})).append($("<h3>").text(d.name)));r.append(o).find(".item div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i0.wp.com/s.hearty.me/images/stickers/thumbnails/",appendScroll:r,onError:function(e){var t="//c.hearty.me/images/stickers/thumbnails/"+e.attr("data-src");e.attr({"data-src-backup":t}).css({"background-image":"url("+t+")"})}}),a.find(".tab_main").fadeIn()}else{if(!e)return void $(".mh-head .btn_stickerbook").hide();if(a.find(".item").hide(),isNaN(e)){i.find(".tab_category").hide(),a.find(".item[data-sticker='0']").add(i.find(".tab_main")).fadeIn();var c=r.data("scrolled");c&&r.scrollTop(c)}else{r.scrollTop(0);var u=a.find(".item[data-sticker='"+e+"']");u.length||(s[e].stickers.forEach(function(a){a.set_num=e,a.set_alias=t,a.type=0,Number(a.type)>0,o.push($("<div>",{class:"item",onclick:"sticker__oncreate($(this).data('sticker'), this.dataset.premium);",title:a.name,"data-sticker":e,"data-premium":a.type}).html($("<div>",{"data-src":t+"/"+a.num+".png"})).data("sticker",a).append($("<h3>").text(a.name)))}),r.append(o),(u=a.find(".item[data-sticker='"+e+"']")).find("div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//i0.wp.com/s.hearty.me/images/stickers/thumbnails/",appendScroll:r,onError:function(e){var t="//c.hearty.me/images/stickers/thumbnails/"+e.attr("data-src");e.attr({"data-src-backup":t}).css({"background-image":"url("+t+")"})}})),u.css({display:"-webkit-inline-flex",display:"inline-flex"}).fadeIn(),i.find(".tab_category span:nth-child(1)").text(s[e].name),i.find(".tab_category span:nth-child(2)").text(s[e].illustrator),i.find(".tab_main").hide(),i.find(".tab_category").fadeIn()}}$(".mh-head .btn_stickerbook").show()}function mobile_editor_focus(){if(!is_touch_device()||$(window).width()>768)return!1;var e=$("#editor").get(0).offsetTop;$("#editor_editable").focus(function(){$(".mh-head .left, \t\t\t.mh-head .right:first > div, \t\t\t.bk-underlayer, \t\t\t.editor_toolbelt, \t\t\t.bk-page header, \t\t\t.bk-page .picture").hide(),$(".mh-head .right:last").fadeIn(),$("body").scrollTop(0).css({"overflow-y":"hidden"}),$(".hj-main").css({padding:"1.6em 0 0 0"}),$(".bk-list .bk-page, .bk-list #editor").css({"border-top":"none"}),$("#editor .bundle").css({"pointer-events":"none"}).fadeTo("fast",.6),createCaretPlacer(!1),isAndroid()&&hj_editor_history("add","[editable_blur]")}).blur(function(){$(".mh-head .left, \t\t\t.bk-underlayer, \t\t\t.bk-page header, \t\t\t.bk-page .picture, \t\t\t.mh-head .right:first > div").show(),$(".editor_toolbelt").slideDown(),$(".mh-head .right:last").hide(),$("body").css({"overflow-y":"auto"}),$(".hj-main").css({padding:"3.6em 0 2em 0"}),$(".bk-list .bk-page").css({"border-top":"1em solid transparent"}),$(".bk-list #editor").css({"border-top":"1px dashed #ccc"}),$("#editor .bundle").css({"pointer-events":"auto"}).fadeTo("fast",1),$(".bk-list .bk-page").scrollTop()<e&&$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(e).addClass("scroll-smoothly"),autosave_the_change(),isAndroid()&&hj_editor_history("detach","[editable_blur]")})}function hj_video(e,t){var a=$(".bk-page .picture");switch(t=t||"UnP0ljFhd6c",e){case"init":a.children("#youtube").css({background:"url('//img.youtube.com/vi/"+t+"/0.jpg') no-repeat center","background-size":"cover"}).data("youtube",t).fadeIn().find("iframe").hide();break;case"play":a.find("#youtube iframe").attr({src:"//www.youtube.com/embed/"+t+"?"+$.param({controls:1,fs:1,modestbranding:1,loop:1,cc_load_policy:1,rel:0,autoplay:1,playsinline:1})}).show(),a.find(".far").slideUp();break;case"update":var i=current_post().post_id;alertify.set({labels:{ok:"🎥 加入影片",cancel:"取消"},buttonReverse:!1}),alertify.prompt("<i class='fab fa-youtube'></i> Youtube 網址",function(e,t){if(e)if(t=YoutubeURLparser(t)){hj_video("init",t);var a=update({action:"post_update",field:"youtube_video",post_id:i,youtube_video:t});switch(a.Status){case 1:alertify.success("影片已加入"),hj_mixpanel("Video Added",{post_id:i,youtube:t}),ga_event_push("Video Added",{event_category:"Posts",event_label:"Video_Added"});break;case 2:signin_required();break;default:hj_alert("Error: "+JSON.stringify(a))}}else hj_alert("Youtube 網址格式不正確"),hj_video("update")},"https://www.youtube.com/watch?v="+t);break;case"reset":hj_video("clear"),update({action:"post_update",field:"youtube_video",post_id:current_post().post_id,youtube_video:""});break;case"clear":a.children("#youtube").data("youtube",null).fadeOut().find("iframe").removeAttr("src")}}function YoutubeURLparser(e){var t=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!t||11!=t[2].length)&&t[2]}function post_query(e,t){if(autosave_the_change(),null==t){var a=Number(current_post().post_id);a>0&&hj_editor_history("add",Number(a))}e=Number(e);var i=$(".bk-list .bk-page"),r=i.find("#subject"),o=i.find("#editor_editable"),n=$(".catalog .diaries li");if(e<=0){var s=catalog_lookup(e);return null!==s&&post_query(s.post_id),null!==s}nav_toggle($(".catalog[data-mobile]"),!1),i.children(".prologue").add(o).add(r).hide(),i.children(".diary").show(),r.slideDown("normal").promise().then(function(){o.slideDown("normal")}),$(".bk-page .picture").fadeTo("normal",0).fadeTo("slow",1);e=Number(e||1);var l=update({action:"post_query",writer:hj_writer,post_id:e,passcode:""});switch(l.Status){case 1:var d=l.Values;illustration_random();d.title_decoded=htmlDecode(d.title),o.data("current_post",{post_id:e,privacy:d.privacy,editable:!!d.editable,vip:hj_isVIP()}).html(linkify(d.post)),r.text(d.title_decoded).attr("title",d.title_decoded),sticker__top_edge(),stickers__initialize(),d.image=illustration_show(d.gallery_id),d.youtube_video?hj_video("init",d.youtube_video):hj_video("clear"),post_privacy_toggle(d.privacy);var c=$(".popup.share input");d.shortened_url?(d.shortened_url="https://hj.rs/"+d.shortened_url,c.val(d.shortened_url).attr({placeholder:d.shortened_url})):c.val("").attr({placeholder:""}),n.filter("[data-active]").removeAttr("data-active"),n.filter("[data-post_id='"+e+"']").attr("data-active","").text(d.title_decoded),d.title+=" ♥ 溫度日記 Hearty Journal",document.title=d.title_decoded,$('meta[property="og:title"]').attr("content",d.title_decoded),$('meta[name="description"], meta[property="og:description"]').attr("content",d.post.replace(/\n/g,"").substring(0,48)+"…"),$('meta[property="og:image"]').attr("content",d.image),$('meta[property="og:url"]').attr("content",window.location.href),i.find(".bookmark").attr("data-bookmarked",d.bookmarked);var u=d.created_date.split("-");u=u[0]+"年 "+Number(u[1])+"月 "+Number(u[2])+"日",i.find("header").attr("data-post_date",u),$(".post_attr #post_created").val(d.created_date).attr("title",u),i.find(".wi").removeAttr("class").addClass(d.weather),i.animate({scrollTop:0},"fast"),"function"==typeof history.replaceState&&window.history.replaceState({},d.title_decoded+" ♥ 溫度日記 Hearty Journal","/"+hj_writer+"/"+e),editor_enable(),setcookie("hearty_last_viewed",[hj_writer,e].toString(),1),hj_mixpanel("Post Loaded",{post_id:e}),ga_event_push("Post Loaded",{event_category:"Posts",event_label:"Post Loaded"});break;case 3:post_query(0);break;case 4:signin_required()}return 1===l.Status}function linkify(e){return e=(e=(e=e.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a onclick="open_external(\'$&\');" title="$&">$&</a>')).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a onclick="open_external(\'http://$2\');" title="$2">$2</a>')).replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/,'<a onclick="document.execCommand(\'selectAll\',false,null); copy($(this));" title="$&">$&</a>')}function post_create(e){var t;if(open_book(!0),"geolocation"in navigator)if(getcookie("hearty_position_gps"))t=JSON.parse(decodeURIComponent(getcookie("hearty_position_gps")))||{};else if(e&&confirm("⛅ 是否開啟定位，並為日記加入天氣呢？"))return $.when(window.positioning_gps_deferred).done(function(){post_create(!1)}),positioning_gps_trigger(!0),$(".mask_loading").show().delay(8e3).queue(function(){post_create(!1),$(this).fadeOut().dequeue()}),void msg("⛅ 麻煩「允許」定位權限，並稍待一會兒。。。","好");var a=update(null==t?{action:"post_create"}:{action:"post_create",location_lat:t.latitude||"",location_lon:t.longitude||"",place:t.address||"",weather_id:t.weather_id||""});switch(a.Status){case 1:var i=a.Values,r=i.post_id,o=i.title;$("<li>",{title:"📝 "+o,onclick:"if(this.dataset.active==null && !post_query(this.dataset.post_id)) $(this).remove();","data-active":"","data-post_id":r,"data-page":1,"data-privacy":0}).text(o).prependTo($(".catalog .diaries")),catalog_page(1),post_query(r),$(".alertify-dialog .alertify-button-ok").click(),hj_mixpanel("Post Created",{post_id:r}),ga_event_push("Create",{event_category:"Posts",event_label:"Create"});break;case 2:signin_required();break;default:hj_alert("糟糕，出錯了，請稍候再試")}}function post_revise(){var e=$(".bk-page #editor_editable"),t=current_post().post_id,a=e.text().replace(/^\s+|\s+$/g,"")+"\n";switch(update({action:"post_update",field:"revise",post_id:t,post:a}).Status){case 1:saved(!0),$(".editor_toolbelt .kit.save").removeClass("btn_blink"),hj_mixpanel("Post Revised",{post_id:t}),ga_event_push("Revise",{event_category:"Posts",event_label:"Revise"});break;case 2:signin_required();break;default:hj_alert("糟糕，出錯了，請稍候再試")}}function post_created_date(e){switch(update({action:"post_update",field:"created_date",post_id:current_post().post_id,post_created:e}).Status){case 1:alertify.success("發文日期已更新："+e),hj_mixpanel("Created Date Updated",{post_id:post_id}),ga_event_push("Created Date Updated",{event_category:"Posts",event_label:"Created Date Updated"});break;case 2:signin_required()}}function autosave_the_change(){return!(null===window.onbeforeunload||!current_post().editable)&&(post_revise(),!0)}function autosaver_30s(){window.hj_autosaver=setInterval(function(){null!==window.onbeforeunload&&current_post().editable&&post_revise()},29900)}function saved(e){var t=$(".editor_toolbelt .kit.save");1==e?(window.onbeforeunload=null,t.removeClass("btn_blink").attr("data-saving","").delay(950).queue(function(){$(this).removeAttr("data-saving").dequeue()})):(window.onbeforeunload=function(e){return current_post().editable&&post_revise(),"已儲存文章，確認要離開嗎？"},t.addClass("btn_blink"))}function title_editing(e){var t=current_post().post_id;alertify.set({labels:{ok:"📝 更新",cancel:"取消"},buttonReverse:!1}),alertify.prompt("<i class='far fa-pen'></i> 日記標題",function(e,a){if(e){if(!a.replace(/\s+/g,"").length)return!1;switch(a=capitalizeFirstLetter(a),update({action:"post_update",field:"title",post_id:t,title:a}).Status){case 1:$(".bk-page #subject, .catalog .diaries li[data-active]").attr("title",a).text(a),alertify.success("標題修改為："+a),hj_mixpanel("Title Edited",{post_id:t,post_title:a}),ga_event_push("Edit Title",{event_category:"Posts",event_label:"Edit Title"}),a+=" ♥ 溫度日記 Hearty Journal",document.title=a,$("meta[property='og\\:title']").attr("content",a);break;case 2:signin_required();break;default:hj_alert("糟糕，出錯了，請稍候再試")}}},e||$(".bk-page #subject").text())}function post_archive(){if(!current_post().editable)return!1;autosave_the_change(),open_book(!0);var e=current_post().post_id,t=$("#subject").text(),a=$(".bk-list .bk-page");alertify.set({labels:{ok:"否",cancel:"是的，忘記這一切"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-exclamation-triangle'></i> 要刪除（"+t+"）嗎？",function(i){if(!i)switch(update({action:"post_update",field:"archive",post_id:e}).Status){case 1:catalog_page(1),a.find(".diary").hide(),a.find(".prologue").slideDown(),$(".catalog .diaries li[data-post_id='"+e+"']").remove(),alertify.error("刪除了「"+t+"」"),"function"==typeof history.replaceState&&window.history.replaceState({},t+" ♥ 溫度日記 Hearty Journal","/"+hj_writer),a.find("#editor_editable").data("current_post",null),hj_mixpanel("Post Archived",{post_id:e}),ga_event_push("Archive",{event_category:"Posts",event_label:"Archive"});break;case 2:signin_required();break;default:hj_alert("糟糕，出錯了，請稍候再試")}})}function open_external(e){if(null==e)return!1;/(https?:\/\/(.+?\.)?(hearty\.me|hearty\.app|hearty\.tw|hj\.rs|nien\.co)(\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\(\)\*\+,;\=]*)?)/g.test(e)&&window.open(e);var t=$(".external_link");t.find(".snapshot").attr({src:"//s0.wp.com/mshots/v1/"+encodeURIComponent(e)+(e.indexOf("?")>0?"&":"?")+"w=320"}),t.find(".url").text(e),t.find("li[data-url]").attr("data-url",e),popup_toggle(!0,"external_link"),$("#editor_editable").blur(),hj_mixpanel("Open External URL",{url:e}),ga_event_push("Open External URL",{event_category:"Posts",event_label:"Open External URL"})}function hj_fullscreen(e){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen()}function update_failed(){network_status(["offline"],!0)}function screenlock(e,t){var a=$(".screenlock"),i=a.data("pincode"),r=a.find(".pin"),o=!(null==i);switch(e){case!0:a.is(":hidden")&&($(".menu, .catalog[data-mobile], .stickerbook").each(function(){nav_toggle($(this),!1)}),open_book(!1),a.slideDown("fast").find("input:first").focus(),$(".hj-main").addClass("blur"));break;case!1:a.is(":visible")&&(a.fadeOut("normal"),$(".hj-main").removeClass("blur"),open_book(!0)),a.find("input").val("");break;case"status":return o;case"initialize":t?(screenlock("set",t),screenlock(!0)):getcookie("hearty_screenlock")&&(screenlock("set",getcookie("hearty_screenlock")),screenlock(!0));break;case"activate":o?screenlock(!0):o||(alertify.set({labels:{ok:"設置",cancel:"否"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-lock'></i> 是否設置「螢幕鎖」？ 防止暫離時旁人窺探",function(e){e&&screenlock(!0)}));break;case"set":a.data("pincode",t||"0000");break;case"unset":o?(alertify.set({labels:{ok:"清除螢幕鎖",cancel:"否"},buttonReverse:!1}),alertify.prompt("<i class='fal fa-lock-open'></i> 輸入 Pin 碼 或 溫度密碼",function(e,t){if(e)if(t==i)screenlock("disable");else switch(update({action:"screenlock_unset",password:t}).Status){case 0:msg("密碼似乎不正確","再試試"),screenlock("unset");break;case 1:screenlock("disable")}})):(screenlock(!1),a.removeAttr("pincode"),r.attr("title","🔒 請輸入 Pin 碼"));break;case"disable":update({action:"screenlock_setup",pincode:""}),screenlock(!1),setcookie("hearty_screenlock","",1),a.data("pincode",null),r.attr("title","🔒 請輸入 Pin 碼"),alertify.success("螢幕鎖已清除"),hj_mixpanel("Screenlock Clear"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Clear"});break;case"next":var n=t[0],s=t[1];isNaN(s)?(n.val(""),hj_alert("Pin 碼僅限數字")):s.length>0&&n.next(".screenlock input").length>0&&n.next(".screenlock input").focus();break;default:var l="";if(a.find("input").each(function(){l+=$(this).val()}).val(""),o)l==i?(screenlock(!1),screenlock("activate"),r.attr("title","🔒 請輸入 Pin 碼")):(r.attr("title","🔒 Pin 碼不正確"),shake(r));else if(null==a.attr("pincode"))a.attr("pincode",l),r.attr("title","🔒 再次確認 Pin 碼");else if(l==a.attr("pincode")){update({action:"screenlock_setup",pincode:l});setcookie("hearty_screenlock",l,12),a.data("pincode",l).attr("pincode",null),r.attr("title","請輸入 Pin 碼"),screenlock(!1),hj_alert("🔒 Pin 碼設定為："+l),hj_mixpanel("Screenlock Setup"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Setup"})}else a.attr("pincode",null),r.attr("title","🔒 兩次輸入不一樣，請重設"),shake(r);a.find("input:first").focus()}}function feature_notavailable(e){popup_toggle(!0,"feature_notavailable"),$(".popup.feature_notavailable q").text(e),$(".popup.feature_notavailable").finish().delay(2500).queue(function(){popup_toggle(!1,"feature_notavailable"),$(this).dequeue()})}function pricing(){price_selector(4),popup_toggle(!1,"upgrade"),popup_toggle(!0,"purchase")}function price_selector(e){var t=$(".package[data-col='deposit']"),a={1:{unit:179,subtotal:179},3:{unit:149,subtotal:894},4:{unit:109,subtotal:1308}};e in a&&(a=a[e],t.find(".price_unit").text(a.unit),t.find("[data-subtotal]").attr({"data-subtotal":a.subtotal}),t.find(".btns_action[data-pkg]").attr({"data-pkg":e}),t.find(".price_selector li").removeAttr("data-active").filter("[data-pkg='"+e+"']").attr("data-active",""));var i=user_country()||"TW";$(".package .btns_action[data-pkg]").attr({"data-country":i,"data-vat":"TW"==i?1:0})}function apply_coupon(e){e=null==e?"":e,alertify.set({labels:{ok:"兌換",cancel:"取消"},buttonReverse:!1}),alertify.prompt("<i class='far fa-birthday-cake'></i> 請填寫邀請碼",function(e,t){if(e){if(!t.trim().length)return!1;switch(t.trim()){case"iii2019":confirm("即將使用「資策會員購方案」訂購")&&(window.location.href="//hearty.me/shop/buy?pkg=7&recurring=1&vat=1");break;case"innosquare":confirm("即將使用「創力坊團隊方案」訂購")&&(window.location.href="//hearty.me/shop/buy?pkg=7&recurring=1&vat=1");break;default:msg("找不到這組「"+t+"」邀請碼")}apply_coupon(t)}},e)}function hj_picture(){var e=$(".ajax-upload-dragdrop input[type='file']");e.length>0&&e.attr({accept:"image/jpeg",onchange:"hj_uploader_preview(this.files);"}).get(0).click()}function image_uploader_initialize(){$(".bk-page #editor_editable");$(".img_uploader").find("#mulitplefileuploader").uploadFile({url:window.location.origin+"/update",dragDrop:!0,fileName:"myfile",allowedTypes:"jpg,jpeg",returnType:"json",showDone:!1,showDelete:!1,formData:{category:1},dynamicFormData:function(){return{post_id:current_post().post_id,privacy:current_post().privacy}},onSubmit:function(e){saved(!1)},onSuccess:function(e,t,a){illustration_show(t.gallery_id),alertify.success("相片已上傳"),post_revise(),hj_mixpanel("Image Added",{post_id:current_post().post_id,privacy:current_post().privacy}),ga_event_push("Image Added",{event_category:"Posts",event_label:"Image Added"})},onError:function(e,t,a,i){msg()}})}function hj_uploader_preview(e){hj_video("reset");var t=$(".image-zoom img"),[a]=e,i=hj_uploader_createImageFromFile(t.get(0),a),r=hj_uploader_getFileBase64Encode(a);Promise.all([i,r]).then(e=>{var[a,i]=e;$(".bk-page .picture #picture").css({background:"url('"+i+"')","background-size":"cover"}).addClass("uploading"),t.attr("src",i)})}function hj_uploader_createImageFromFile(e,t){return new Promise((a,i)=>{e.src=URL.createObjectURL(t),e.onload=(()=>{URL.revokeObjectURL(e.src),a(e)}),e.onerror=(()=>reject("Failure to load image"))})}function hj_uploader_getFileBase64Encode(e){return new Promise((t,a)=>{var i=new FileReader;i.readAsDataURL(e),i.onload=(()=>t(i.result)),i.onerror=(e=>a(e))})}function hj_loading(e){e?$("body.hj").addClass("loading"):$("body.hj").removeClass("loading")}function hj_screenshot(){autosave_the_change(),hj_loading(!0);var e=current_post().post_id,t=$(".bk-list .bk-page"),a=t.find(".diary"),i=$(".diary_screenshot");t.removeClass("scroll-smoothly").scrollTop(0).addClass("scroll-smoothly"),t.find("#editor_editable").removeClass("editor_margin_bottom"),t.find(".picture .far").hide(),a.addClass("screenshoted"),hj_getScript("//cdn.jsdelivr.net/npm/html2canvas@1.0.0-alpha.12/dist/html2canvas.min.js",function(){window.html2canvas(a.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:a.get(0).scrollWidth+10,height:a.get(0).scrollHeight}).then(r=>{var o=r.toDataURL("image/png"),n=t.find("#subject").text();i.empty(),$("<a>",{target:"_blank",href:o,download:"溫度日記_"+n+".png",title:"下載："+n}).html($("<img>",{src:o})).appendTo(i).get(0).click(),a.removeClass("screenshoted").find("#editor_editable").addClass("editor_margin_bottom"),t.find(".picture .far").show(),popup_toggle(!0,"diary_screenshot"),hj_loading(!1),hj_mixpanel("Post Screenshoted",{post_id:e}),ga_event_push("Screenshot",{event_category:"Posts",event_label:"Screenshot"})})})}function hj_bookmark(){var e=current_post().post_id,t=update({action:"bookmark",post_id:e});if(!t)return!1;switch(t.Status){case 1:hj_mixpanel("Post Bookmarked",{post_id:e}),ga_event_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:signin_required()}}function free_trial_activate(){var e=update({action:"free_trial_activate"});switch(e.Status){case 1:alertify.set({labels:{ok:"開始體驗",cancel:"比較版本"},buttonReverse:!1}),alertify.confirm("<i class='far fa-gift-card'></i> 您專屬的 VIP 30天試用開啟囉，<br>"+e.Values.expiration+"前可使用所有功能、素材 <i class='far fa-heart'></i>",function(e){e||popup_toggle(!0,"upgrade")}),hj_mixpanel("Trial Activated"),ga_event_push("Trial Activate",{event_category:"Account",event_label:"Trial Activate"})}return 1===e.Status}function signin_required(){alertify.set({labels:{ok:"立即登入",cancel:"否"}}),alertify.confirm("<i class='fal fa-user-lock'></i> 登入以使用完整功能",function(e){e&&(window.location.href="https://hearty.me/?r="+window.location.href.replace(window.location.origin,"")+"#signin")});var e=update({action:"account_status"});e&&1===e.Status&&window.location.reload(!0)}function bucket_suffix(){var e=new Date;return e.getDate()+e.getHours()}function illustration_show(e){var t,a=$(".image-zoom img");if(null===e)do{(t=illustration_random()).image=["//"+wpCDN+"/hearty.me/images/illustrations/"+t.image+".jpg","//"+wpCDN+"/ftp.hearty.me/images/illustrations/"+t.image+".jpg","//res.cloudinary.com/nien/image/upload/v1475732434/hearty.me/illustrations/"+t.image+".jpg"]}while(a.attr("src")==t.image);else t={image:["//hearty.me/i/"+e],position:"center"};return a.attr("src",t.image[0]),$(".bk-page .picture #picture").css({"background-image":t.image.map(function(e){return'url("'+e+'")'}).join(", "),"background-repeat":"no-repeat","background-position":t.position+" center","background-size":"cover"}).removeClass("uploading"),t.image[0]}function htmlDecode(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0].nodeValue}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}"function"==typeof history.replaceState&&/(beta|classic)/.test(l.pathname)&&window.history.replaceState({},document.title,l.href.replace(/beta\/|classic\//g,"")),window.onerror=function(e,t,a,i,r){e.toLowerCase().indexOf("script error");if("sendBeacon"in navigator&&navigator.sendBeacon("//hearty.me/err",JSON.stringify({user:window.hj_user||"",uri:t.replace(window.location.origin,"")||"",msg:e,err:r,line:a,col:i,ua:navigator.userAgent||""})),"function"==typeof autosave_the_change&&autosave_the_change(),!getUrlPara("reloaded")){var o=new URL(window.location);o.searchParams.set("reloaded",1),window.location.href=o.href}};