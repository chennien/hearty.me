"use strict";var timer,hj_editor_loaded=!0,wpCDN=wpCDN||"i0.wp.com";function hj_console_hook(e){if(window.console)try{if(e)({channel:"hearty",api:"//console.re/connector.js",ready:function(e){var t,a=document,i=a.createElement("script");i.src=this.api,i.id="consolerescript",i.setAttribute("data-channel",this.channel),i.onreadystatechange=i.onload=function(){t||e(),t=!0},(a.head||a.getElementsByTagName("head")[0]).appendChild(i)}}).ready(function(){console.log("init: "+location.href.replace(location.origin,""))});console.defaultError=console.error.bind(console),console.errors=[],console.error=function(){console.defaultError.apply(console,arguments),hj_console_push("error",Array.from(arguments).join(", "))},console.defaultWarn=console.warn.bind(console),console.warns=[],console.warn=function(){console.defaultWarn.apply(console,arguments),hj_console_push("warn",Array.from(arguments).join(", "))},console.defaultLog=console.log.bind(console),console.logs=[],console.log=function(){console.defaultLog.apply(console,arguments),hj_console_push("log",Array.from(arguments).join(", "))}}catch(e){}}function hj_console_push(e,t){if(t.indexOf("console.re")<0){var a="re"in console;window.hj_username&&hj_username;switch(e){case"error":console.errors.push(t),a&&console.re.error(t);break;case"warn":console.warns.push(t),a&&console.re.info("[orange]"+t+"[/orange]");break;case"log":console.logs.push(t),a&&console.re.log(t)}"log"!==e&&hj_console_push_gform(e,t)}}function hj_console_push_gform(e,t){hj_update({action:"gform_post",uri:"1FAIpQLSdDlZ_3DpLcbRo2ufXBufvG3F5nuAKBHyyEaaNs1-T_8xbGbw",data:$.param({"entry.1537657449":"[hj_user_id]","entry.1470526977":"[hj_username]",emailAddress:"[hj_email]","entry.1332414907":e,"entry.164417788":t,"entry.777942776":location.href.replace(location.origin,""),"entry.657077146":(new Date).toISOString().split("T")[0],"entry.1894817984":check_browser()+", "+check_OS()})})}function hj_console_get(){var e=console.errors||[],t=console.warns||[],a=console.logs||[];return(e=e.length?"Error: "+e.join(", ")+"; ":"")+(t=t.length?"Warns: "+t.join(", ")+"; ":"")+(a=a.length?"Logs: "+a.join(", ")+"; ":"")}function URL_handling(){getUrlPara("first")&&whats_your_name(),getUrlPara("preview")&&$(".mh-head, .btn_feedback").hide(),(getUrlPara("purchased")||getUrlPara("iap"))&&hj_after_purchase(),getUrlPara("plans")&&hj_upgrade_toggle(!0),getUrlPara("img")&&post_create().then(function(){hj_picture(!0)});var e=getUrlPara("f");if(e&&(hj_feedback_toggle(!0),e.length>1&&$(".feedback textarea[name='feedback']").val(decodeURIComponent(e))),get_gift_stickers_init(),!check_hjapp())try{var t=new URL(location.href);["v","first","purchased","iap","preview","plans","f"].forEach(function(e){getUrlPara(e)&&t.searchParams.delete(e)}),"function"==typeof history.replaceState&&window.history.replaceState({},document.title,t.pathname+t.search)}catch(e){}}function whats_your_name(e){e=e||"",alertify.set({labels:{ok:"<i class='far fa-check'></i> å¥½äº†",cancel:"å¦"},buttonReverse:!1}),alertify.prompt("<i class='fal fa-smile-wink'></i> è¦ªæ„›çš„ï¼Œå¯ä»¥æ€éº¼ç¨±å‘¼ä½ å‘¢ï¼Ÿ",function(e,t){e?(t=(t||"").trim()).length>0?hj_update({action:"profile_update",field:"nickname",data:t}).then(function(){msg("<i class='far fa-flower'></i> æ­¡è¿ "+t+" ä¾†åˆ°é€™è£¡ï¼Œå°ˆå±¬æ–¼ä½ ç§˜å¯†èŠ±åœ’","é€²å…¥æ—¥è¨˜ <i class='fas fa-heart'></i>"),$(".hj_user .name").attr("data-text",t),free_trial_activate()}):(whats_your_name(),alertify_input_shake()):free_trial_activate()},(e||"").toString()),alertify_input_custom({placeholder:"æˆ‘çš„åå­—",autocomplete:"on",maxlength:20},{"letter-spacing":"4px"})}function get_gift_stickers_init(){"User_Reactive"==getUrlPara("utm_campaign")?window.hj_login?get_gift_stickers():(popup_toggle(!0,"notice_gift"),get_gift_stickers_stats("gift_notice")):getUrlPara("gift")&&get_gift_stickers()}function get_gift_stickers(){if(window.hj_login)msg("<i class='far fa-gift-card'></i> Yaï¼ å·²é ˜å–äº†ä½ çš„å°ˆå±¬è²¼åœ– <i class='far fa-grin-wink'></i>","èµ°ï¼Œå»çœ‹çœ‹",function(){nav_toggle($(".stickerbook"),!0),get_gift_stickers_stats("toggle_stickerbook")});else{get_gift_stickers_stats("signin_redirect");var e=getcookie("hearty_account")||getUrlPara("a")||"";e=e?"&account="+e:"",window.top.location.href=location.origin+"/?r=/"+(hj_writer||"")+"ï¼Ÿgift=1"+e+"#signin"}}function get_gift_stickers_stats(e){hj_update({action:"gform_post",uri:"1FAIpQLSd2vEj_DmNKt2_6K_X99NJZh4JtEzQ7eu49mXwpmnOelaZmFw",data:$.param({"entry.355700800":getUrlPara("utm_medium")||"","entry.1270264487":e||"","entry.783049182":"[hj_user_id]","entry.866865386":getcookie("hearty_account")||getUrlPara("a")||"[hj_username]","entry.1497216280":"[hj_email]","entry.124585191":check_browser()+", "+check_OS(),"entry.1259076046":(new Date).toISOString().split("T")[0]})})}function network_watch(){window.addEventListener("online",function(){network_status(["offline"],!1)},{passive:!0}),window.addEventListener("offline",function(){network_status(["offline"],!0)},{passive:!0}),"connection"in navigator&&(navigator.connection.addEventListener("change",network_watch_speed),network_watch_speed())}function network_watch_speed(){network_status(["slow"],/2g/.test(navigator.connection.effectiveType))}function battery_watch(){if("battery"in navigator)battery_watch_handle(navigator.battery);else if("getBattery"in navigator)try{navigator.getBattery().then(battery_watch_handle)}catch(e){}}function battery_watch_handle(e){battery_watch_level(e),e.onlevelchange=function(){battery_watch_level(e)}}function battery_watch_level(e){var t=parseFloat((100*e.level).toFixed(2));return t<20&&($(".warning-underlayer[data-issue='battery'] > div").attr("data-battery",t),network_status(["battery"],!0)),t}function hj_idle(){var e=$(".editor_toolbelt"),t=$(".screenlock"),a=!is_touch_device()&&current_post().editable;function i(){hj__cache({set:!0,bucket:"hearty_idle",data:0}),a&&e.slideDown("normal")}$(document).mousemove(i).keypress(i),$("#editor_editable").keydown(i),i(),window.setInterval(function(){var i=Number(hj__cache({bucket:"hearty_idle"}));switch(hj__cache({set:!0,bucket:"hearty_idle",data:++i}),!0){case 4==i&&autosave_the_change():break;case 8==i&&a&&e.is(":visible"):e.slideUp("slow");break;case 60==i&&screenlock("status")&&t.is(":hidden"):screenlock(!0);break;case 90==i:catalog_query(null,{page:1}),notifications_query(1)}},1e3)}function hj_editor_history_init(){"function"==typeof history.pushState&&(history.pushState(null,document.title,location.href),window.addEventListener("popstate",function(e){var t=hj_editor_history("load");if(null!=t){var a=$("#editor_editable");switch(!0){case/^\d+$/.test(t):post_query(t,!0);break;case t.indexOf("editable_blur")>0:return void a.blur();case t.indexOf("popup_toggle")>0:return t=t.split("]",2).slice(-1)[0],void popup_toggle(!1,t);case t.indexOf("editable_focus")>0:a.get(0).focus({preventScroll:!1})}}else open_book(!1),history.pushState(null,document.title,location.href);$("nav").each(function(){null!=$(this).data("mmenu")&&$(this).data("mmenu").close()})},!1))}function hj_editor_history(e,t){if("function"==typeof history.pushState){var a="hearty_editor_history",i=JSON.parse(hj__cache({bucket:a}))||[];switch(e){case"load":t=i.pop();break;case"add":history.pushState(null,document.title,location.href),i.push(t);break;case"detach":i=i.filter(e=>e!==t)}return hj__cache({set:!0,bucket:a,data:JSON.stringify(i)}),t}}function editor_versioning(e,t){var a="hearty_editor_version",i=new Date;if(i.setDate(i.getDate()+1),t=Number(t)||0,e)document.cookie=a+"="+t+"; expires="+i.toGMTString()+"; path=/;secure";else{var n=Number(getcookie(a))||0,r=0;if(!n){var o=update({action:"versioning_diary"});1===o.Status&&"latest"in o.Values&&(r=Number(o.Values.latest)||0)}(t<n||t<r)&&(autosave_the_change(),document.cookie=a+"="+t+"; expires="+i.toGMTString()+"; path=/;secure",hj_mixpanel("Force Update",{version:r}),ga_event_push("Force Update"),location.reload(!0))}}function editor_enable(e){e=e||current_post().editable||!1;var t=$(".bk-page #editor_editable"),a=t.data("editor_loaded")||!1,i=$(".picture").find(".fa-video-plus, .fa-camera-alt").add(".hj_rmenu li[data-editing]");e?(a||(editable__initialize(),hj_idle(),screenlock("initialize",pincode||""),hj_getScript_gh({path:"public/jquery.uploadfile.min.js",commit:"1.0.21"},image_uploader_initialize),t.data("editor_loaded",!0),$(".editor_toolbelt .kit.save").on("mouseover",autosave_the_change),post_penpal_listing()),sticker__list(),editor_focus_zoomin(),i.slideDown(),$(".image-zoom:not([data-gallery_id='0']) .img_btns").show()):(sticker__list(!1),i.slideUp(),$(".image-zoom .img_btns").hide(),$(".toast_signin_reminder").fadeIn("fast").delay(6500).queue(function(){$(this).fadeOut().dequeue()})),t.prop("contenteditable",e),toolbelt_toggle(e)}function vip_init(){var e=hj_membership()[0];if(e){var t=$(".popup.feedback input[name='ver']");t.filter("[data-ver='vip']").prop({checked:!0,disabled:!1}),t.filter("[data-ver='free']").prop({checked:!1,disabled:!0}),$(".mm-panel [data-vip='1']").show(),$(".mm-panel [data-vip='0']").hide()}return e}function vip_fn(e){var t=current_post();if(t.vip)switch(e){case"picture":t.editable&&hj_picture();break;case"video":t.editable&&hj_video("update");break;case"catalog_search":catalog_search();break;case"post_attr":t.editable&&popup_toggle(!0,"post_attr");break;case"screenshot":hj_screenshot();break;case"screenlock":screenlock("activate")}else{switch(e){case"screenlock":screenlock("unset")}hj_upgrade_toggle(!0),hj_vibrate(80)}return t.vip}function hj_rmenu_init(e){var t=$(".hj_rmenu");!is_touch_device()&&t.length>0&&(e.get(0).addEventListener("contextmenu",function(t){hj_rmenu_toggle(t,!0,e)},{passive:!1}),t.get(0).addEventListener("mouseleave",function(t){hj_rmenu_toggle(t,!1,e)},{passive:!0}))}function hj_rmenu_toggle(e,t,a){var i=$(".hj_rmenu");t?(e.preventDefault(),i.css({top:Math.min(e.clientY,a.height()-i.height()-30)+"px",left:Math.min(e.clientX,a.width()-i.width()-30)+"px"}).show()):i.fadeOut("slow")}function load_datepicker(){$("<link>").attr({rel:"stylesheet",href:"//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.21/public/jquery.ui.datepicker.custom.min.css"}).appendTo("head"),hj_getScript_gh({path:"public/safari.datepicker.tw.min.js",commit:"1.0.21"},function(){$(".post_attr #post_created").attr({type:"text",onclick:"$(this).datepicker('show')"}).datepicker({dateFormat:"yy-mm-dd",showAnim:"slideDown",minDate:$(this).attr("min")||"",maxDate:$(this).attr("max")||""})})}function editor_include_once(){var e=$("#editor_editable");new MutationObserver(function(e){e.forEach(saved)}).observe(e.get(0),{characterData:!0,subtree:!0});e.get(0).addEventListener("paste",saved,{passive:!0}),autosaver_30s(),document.addEventListener("visibilitychange",function(){document.hidden?autosave_the_change():editor_versioning(!1,hj_version)},{passive:!0}),check_OS("iOS")&&current_post().editable&&window.addEventListener("pagehide",post_revise,!1),(check_OS("iOS")||check_browser("Safari"))&&load_datepicker(),vip_init()}function editor_editable_scroll_to_bottom(e,t){if(is_touch_device()&&13==e.keyCode){var a=$(".bk-page"),i=window.getSelection().getRangeAt(0),n=document.createRange(),r=Number(a.find("#editor_editable").height());n.selectNodeContents(t),n.setStart(i.endContainer,i.endOffset),n.cloneContents().textContent.toString().length<2&&(check_OS("iOS")?$("body").scrollTop(r-(window.screen.availHeight>=812?333:258)):a.scrollTop(r))}}function hj_fontresize(e,t){(t=t||$(".bk-page").find("#subject, #editor_editable")).css("font-size",parseInt(t.css("font-size")||16)+e)}function toolbelt_toggle(e){var t=$(".btn_stickerbook"),a=$(".editor_toolbelt");e?(t.show(),a.removeClass("off")):(t.hide(),a.addClass("off"))}function page_gps_trigger(e){var t=$("#gps_trigger");switch(e){case"granted":t.removeAttr("onclick").css("background","#00c78c").text("å·²é–‹å•Ÿ");break;case"prompt":t.attr("onclick","page_gps_trigger('loading'); positioning_gps_trigger(!0);").css("background","#ffa500").text("é»æ­¤é–‹å•Ÿå®šä½");break;case"denied":t.attr("onclick","open_url(positioning_gps_reset_support())").css("background","#c40000").text("éœ€è¨­å®šç€è¦½å™¨");break;case"loading":t.css("background","#555").text("è«‹ç¨å€™")}}function sticker__draggable_handle(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img"),n=$("#editor").width(),r=$(".bk-list .bk-page").scrollTop()||0,o=$("#editor").get(0).offsetTop,s=a.position().top+r-o,l=a.get(0).offsetLeft,c=n-(l+i.width())-30;return c>0&&i.length>0&&(c=Math.max(0,Math.ceil(c+i.width()-i.get(0).getBoundingClientRect().width))),{pos:{top:s,left:l,right:c,align_right:l+a.width()/2>Math.floor(n/2)?1:0},overflow:{top:s>0,left:l>0,right:c>0}}}function sticker__editor_hotkeys(e,t,a){$(document).off("keydown"),e&&$(document).on("keydown",function(e){e.preventDefault();var i=$(".bundle .asset[data-asset_id='"+a+"']"),n={top:parseInt(i.css("top"))||0,left:parseInt(i.css("left"))||0},r=Object.assign({},n);switch(e.keyCode){case 13:case 27:case 32:return void sticker__paste({bundle_id:t,asset_id:a});case 37:r.left-=15;break;case 38:r.top-=15;break;case 39:r.left+=15;break;case 40:r.top+=15;break;case 8:case 46:return void sticker__remove({bundle_id:t,asset_id:a})}var o=sticker__draggable_handle(t,a);o.overflow.left?o.overflow.right?o.overflow.top?sticker__update(t,a,"position",o.pos):r.top=n.top+15:r.left=n.left-15:r.left=5,i.animate(r,25);var s=parseInt(i.get(0).offsetTop-2*$(".bk-list .bk-page").height()/5);s<$(".bk-list .bk-page").height()+100&&$(".bk-list .bk-page").animate({scrollTop:s},60)})}function scheduled_maintenance(e,t){var a=timestamping();e?2===(t=t||[]).length&&a>t[0]&&a<t[1]&&network_status(["maintenance"],!0):(t=new Date(1e3*(t||3600*Math.ceil(a/3600))).toLocaleString("zh-TW",{timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Taipei"}),msg("ğŸš§ ç³»çµ±å‡ç´šæ™‚é–“ï¼š"+t+"ï¼Œ<br>å±†æ™‚å°‡æš«åœæœå‹™ä¸€å°æ™‚"),network_status(["maintenance"],!1),t=t.split(" ")[0],hj_mixpanel("Maintenance Notice",{maintenance_date:t}),ga_event_push("Maintenance Notice",{event_category:"Maintenance",event_label:t}))}function network_status(e,t){var a=$(".warning-underlayer[data-issue]");e.length>0&&e.forEach(function(e){t?a.filter("[data-issue='"+e+"']").fadeTo("fast",1).attr("data-clickable",1).delay(8e3).queue(function(){$(this).attr("data-clickable",0).fadeTo("normal",0).dequeue()}):a.filter("[data-issue='"+e+"']").finish().fadeTo("fast",0).attr("data-clickable",0)}),t&&beep()}function flip_book(){$(".bk-flip").click()}function book__initialize(e){(function(){var e=$(".bk-list .bk-book"),t=e.length;return{init:function(){e.each(function(){var a=$(this),i=e.not(a),n=a.parent(),r=$(".bk-read"),o=$(".bk-flip");r.on("click",function(){var e=$(this);i.data("opened",!1).removeClass("bk-viewinside").parent().css("z-index",0).find(".bk-read").removeClass("bk-active"),i.hasClass("bk-filp")||i.addClass("bk-default"),a.data("opened")?(e.removeClass("bk-active"),a.data({opened:!1,flip:!1}).removeClass("bk-viewinside").addClass("bk-default")):(e.addClass("bk-active"),a.data({opened:!0,flip:!1}).removeClass("bk-filp bk-default").addClass("bk-viewinside"),n.css("z-index",t))}),o.on("click",function(){r.removeClass("bk-active"),a.data("flip")?a.data({opened:!1,flip:!1}).removeClass("bk-filp").addClass("bk-default"):a.data({opened:!1,flip:!0}).removeClass("bk-viewinside bk-default").addClass("bk-filp")})})}}})().init(),$(".mask_loading").delay(600).queue(function(){$(this).finish().fadeOut("fast",function(){$(".bk-viewinside").length||$(".bk-list .bk-book").addClass("bk-rotate").delay(1200).queue(function(){e&&open_book(!0),$(this).removeClass("bk-rotate").dequeue(),window.$d0.resolve()})})}),$(".bk-list .bk-cover, .bk-left").on("click",function(){open_book(!0),$(".bk-page, .bk-cover-back .catalog").scrollTop(0)}),$(".bk-list .bk-back").on("click",flip_book),$(".bk-underlayer").on("click",function(){$(".bk-page .sticker_editing").length>0?sticker__paste():$(".bk-viewinside").length>0?open_book(!1):flip_book()}),$(".stickerbook .stickerlist .stickerdir").scroll(function(){$(this).scrollTop()>200?$(".stickerbook .fa-chevron-square-up").fadeIn():$(".stickerbook .fa-chevron-square-up").fadeOut(),$(".item[data-sticker='0']:visible").length>0&&$(this).data("scrolled",$(this).scrollTop())}),$(".bk-list .bk-page, .bk-cover-back .catalog").delay(800).queue(function(){$(this).scrollTop(0).dequeue()}),(navigator.userAgent||"").indexOf("Edge/")>0&&$(".bk-cover-back .catalog").scrollTop($(".bk-cover-back .catalog").get(0).scrollHeight)}function editable__initialize(){is_touch_device()&&$(".bk-list .bk-page").get(0).addEventListener("touchmove",function(e){if(e.cancelable)return!0},{passive:!0}),cssFeatureSupported("-webkit-user-modify","read-write-plaintext-only")||$("#editor_editable").keydown(function(e){if(13==e.keyCode)return document.execCommand("insertHTML",!1,"<br> "),!1})}function period__initialize(){var e=$(".periods");e.data("loaded")||hj_getScript_gh({path:"public/periods.min.js",commit:"1.0.21"},function(){e.slideDown("slow").data("loaded",!0)})}function createCaretPlacer(e){var t=$(".bk-page #editor_editable").get(0);if(t.focus({preventScroll:!1}),null!=window.getSelection&&null!=document.createRange){var a=document.createRange();a.selectNodeContents(t),a.collapse(e);var i=window.getSelection();i.removeAllRanges(),i.addRange(a)}else if(null!=document.body.createTextRange){var n=document.body.createTextRange();n.moveToElementText(t),n.collapse(e),n.select()}}function compatibility_handle(){var e=(navigator.userAgent||"").toLowerCase(),t=e.indexOf("version/")>0&&e.indexOf("; wv")>0,a=window.innerWidth;!cssFeatureSupported("width","calc(100% - 1em)")&&a<1024&&($(".bk-list, .bk-front, .bk-back, .bk-cover").width(.85*a),$(".bk-list .bk-page, .bk-cover-back").width(.82*a)),cssFeatureSupported("transition","transform")||cssFeatureSupported("-webkit-transition","transform")||cssFeatureSupported("moz-transition","transform")||(t?confirm("æ‰‹æ©Ÿè£¡çš„ç³»çµ±ç¨‹å¼å¤ªèˆŠï¼Œæ˜¯å¦è¦è©¦è‘—æ›´æ–°ï¼Ÿ \nâ„¹ï¸ ç¼ºå°‘åŠŸèƒ½ï¼šCSS Transitions")&&open_url("market://details?id=com.google.android.webview"):msg("è«‹æ›´æ–°ç€è¦½å™¨\nâ„¹ï¸ ç¼ºå°‘åŠŸèƒ½ï¼šCSS Transitions"));var i="hearty_update_required",n=new Date;/Hearty_(Android\/1.(8|9.0)|iOS\/1.(1|2.0))/.test(navigator.userAgent||"")&&!getcookie(i)&&(alertify.set({labels:{ok:"æ˜å¤©æé†’æˆ‘",cancel:"<i class='fas fa-arrow-circle-up'></i> ç«‹å³æ›´æ–°"},buttonReverse:!0}),alertify.confirm("<i class='fal fa-info-circle'></i> æ‚¨æ­£ä½¿ç”¨èˆŠç‰ˆ Appï¼Œéœ€æ›´æ–°ä»¥å–å¾—æ–°åŠŸèƒ½",function(e){e||(location.href=check_hjapp("iOS")?"https://itunes.apple.com/app/id1423459636":"market://details?id=com.hearty.me&referrer=utm_source%3Dhearty.me%26utm_medium%3Dwebsite%26utm_campaign%3Dupdate_required")}),n.setDate(n.getDate()+1),document.cookie=i+"=1; expires="+n.toGMTString()+"; path=/;secure")}function catalog_search_toggle(e){switch(e){case!0:vip_fn("catalog_search");break;case!1:catalog_toggle(),catalog_search_toggle("toggle");break;case"toggle":$(".catalog").find(".diaries").slideUp("fast",function(){$(this).html($("<div>",{class:"catalog_loading"})).slideDown("slow")})}}function catalog_search(e){e=e||"",alertify.set({labels:{ok:"ğŸ” æ‰¾æ‰¾çœ‹",cancel:"å¦"},buttonReverse:!1}),alertify.prompt("<i class='fad fa-search'></i> æœå°‹æˆ‘å¯«éçš„æ—¥è¨˜",function(e,t){e&&(t=(t||"").trim()).length>0?(catalog_query(t,{page:1}),catalog_search_toggle("toggle")):catalog_toggle()},e),alertify_input_custom({type:"search",placeholder:"æœå°‹é—œéµå­—",autocomplete:"on",maxlength:30},{"letter-spacing":"2px"})}function catalog_query(e,t){"resolved"==window.$d2.state()&&(window.$d2=$.Deferred()),e=e||"";var a="hearty_diaries_"+hj_writer+"__"+bucket_suffix(),i=[];i.length?window.$d2.resolve():hj_update({action:"catalog_query",writer:hj_writer,page:0,keyword:e}).then(function(e){switch(e.Status){case 0:case 2:update_failed(),window.$d2.reject();break;case 1:i=e.Values.catalog.map(function(e,t){return e.title=e.title||"æ–°çš„æ—¥è¨˜",e.title_decoded=htmlDecode(e.title),{post_id:e.post_id,title:e.title_decoded,privacy:e.privacy,editable:e.editable,outbound_count:e.outbound_count,page:Math.ceil((t+1)/10)}}),hj__cache({set:!0,bucket:a,data:JSON.stringify(i)}),window.$d2.resolve(),$(".catalog .pagination").attr("data-stats",e.Values.catalog.length+"ç¯‡æ–‡ç« ")}}).fail(function(e){hj_update_failed({fn:"catalog_query",flag:1,err:e}),window.$d2.reject()}),$.when(window.$d2).done(function(){catalog_listing(i,t),e.length>0&&catalog_toggle("search");var a=[$(".bk-cover-back .fa-chevron-square-up"),$(".catalog[data-mobile] .fa-chevron-square-up")];$(".catalog[data-desktop]").get(0).scrollHeight>$(".bk-cover-back > div").height()&&$(".catalog[data-desktop]").scroll(function(){$(this).scrollTop()>10?a[0].fadeIn():a[0].fadeOut()}),$(".catalog[data-mobile] > div > div").scroll(function(){$(this).scrollTop()>10?a[1].fadeIn():a[1].fadeOut()}),window.$d2=$.Deferred()}).fail(function(e){hj_update_failed({fn:"catalog_query",flag:2,err:e}),window.$d2=$.Deferred()})}function catalog_listing(e,t){var a=e.map(function(e){return $("<li>",{title:"ğŸ“ "+e.title,onclick:"if(this.dataset.active==null && !post_query(this.dataset.post_id)) $(this).remove();","data-post_id":e.post_id,"data-page":e.page,"data-privacy":e.privacy,"data-editable":e.editable,"data-outbound_count":e.outbound_count}).text(e.title)});$(".catalog .diaries").html(a),null!=t&&catalog_page(t)}function catalog_lookup(e){var t=catalog_cached(),a=[];if(null==t)return catalog_query(null,{page:1}),!1;if(t.length>0){if(t.forEach(function(e,t){a[e.post_id]=t}),e>0)return e in a?t[a[e]]:null;if(0===e)return t[0];if(-1===e)return t[t.length-1]}return null}function catalog_page(e){var t=Number(e.page)||1,a=e.post_id||0,i=$(".catalog"),n=i.find(".diaries"),r=i.find(".pagination");if(n.children("li[data-active]").removeAttr("data-active"),a>0){var o=catalog_lookup(a);if(null==o)return catalog_page({page:1}),!1;if(!o)return catalog_page({post_id:a}),!1;t=o.page,n.children("li[data-post_id='"+a+"']").attr("data-active","")}else null!=e.btn&&e.btn.filter(".fal").toggleClass("fal fas").delay(450).queue(function(){$(this).toggleClass("fas fal").dequeue()});var s=r.children(".fa-caret-circle-left"),l=r.children(".fa-caret-circle-right");t>1?s.attr("onclick","$(this).removeAttr('onclick'); catalog_page({page: "+(t-1)+", btn: $(this)});").removeClass("disabled"):s.addClass("disabled"),n.children("li[data-page='"+(t+1)+"']").length>0?l.attr("onclick","$(this).removeAttr('onclick'); catalog_page({page: "+(t+1)+", btn: $(this)});").removeClass("disabled"):l.addClass("disabled"),n.children("li").not("[data-page="+t+"]").hide(),n.children("li[data-page="+t+"]").fadeIn("slow")}function catalog_cached(){var e=hj__cache({bucket:"hearty_diaries_"+hj_writer+"__"+bucket_suffix()});return null==e?null:JSON.parse(e)||{}}function catalog_toggle(e){var t=$(".catalog .tabs .btn_diary"),a=$(".catalog .diaries li"),i=$(".catalog[data-desktop] .diaries li"),n=0,r=$(".catalog .pagination"),o=$(".catalog .btn_search");switch(e){case"shared":a.slideUp("fast",function(){$(this).filter("[data-editable='0']").slideDown()}),n=i.filter("[data-editable='0']").length,r.attr("data-stats",n>0?n+"ç¯‡æ–‡ç« ":"é‚„æ²’æœ‰äººèˆ‡ä½ äº¤æ›æ—¥è¨˜");break;case"personal":case"search":catalog_page({page:1}),a.slideUp("fast",function(){$(this).filter("[data-editable='1']").show()}),n=i.filter("[data-editable='1']").length,r.attr("data-stats",n>0?n+"ç¯‡æ–‡ç« ":"æ²’æœ‰æœå°‹çµæœ");break;default:catalog_query(null,{page:1})}t.removeAttr("data-active"),o.attr("data-queried",0),"search"==e?o.attr("data-queried",1):"shared"==e?t.filter("[data-shared]").attr("data-active",""):t.filter("[data-primary]").attr("data-active",""),"shared"!=e&&"search"!=e||r.children(".fa-caret-circle-left, .fa-caret-circle-right").removeAttr("onclick").addClass("disabled")}function stickers__initialize(){sticker__uniqID(!1),stickers__detach();var e=Number(current_post().post_id);e>0&&hj_update({action:"sticker_query",post_id:e}).then(function(e){switch(e.Status){case 1:var t=e.Values;sticker__save_local(t),t.forEach(function(e){sticker__createDOM(e.id,e)});break;case 2:signin_required();break;default:hj_update_failed({fn:"stickers__initialize",flag:0})}}).fail(function(e){hj_update_failed({fn:"stickers__initialize",flag:1,err:e})})}function sticker__initialize(e,t,a){var i=$(".bundle .asset[data-asset_id='"+t+"']"),n=i.children(".sticker_img"),r=sticker__new_blank("asset",e,a);"angle"in a?n.css({transform:"rotate("+a.angle.deg+"deg)"}):a.angle=r.angle,"size"in a?n.css({width:a.size.width,height:a.size.height}):a.size=r.size,"position"in a?i.css({top:a.position.top,left:a.position.left}):a.position=r.position,current_post().editable?sticker__editor_initialize(e,t,a):sticker__paste({bundle_id:e,asset_id:t})}function sticker__editor_initialize(e,t,a){var i=is_touch_device(),n=$(".bundle .asset[data-asset_id='"+t+"']"),r=n.children(".sticker_img");n.draggable({start:function(e,t){i?r.addClass("dragging"):r.addClass("grabbing"),r.hasClass("dragthis")&&r.removeClass("dragthis")},stop:function(a,n){a.stopPropagation();var o=sticker__draggable_handle(e,t);sticker__update(e,t,"position",o.pos),i?r.removeClass("dragging"):r.removeClass("grabbing")},snap:!0,containment:"#editor",scroll:!1,cursor:"move",grid:[5,5],cancel:".ui-rotatable-handle"});var o=a.angle.deg,s={angle:h=o/57.296,rotationCenterOffset:{top:0,left:0},start:function(e){r.data("rotate-mode",1)},rotate:function(a,i){0===r.data("rotate-mode")&&(a.stopPropagation(),h=i.angle.current,o=i.angle.degrees,sticker__update(e,t,"angle",{deg:o,rad:h}),sticker__rotation_margin_fixes(e,t))},stop:function(a,i){h=i.angle.current,o=i.angle.degrees,sticker__update(e,t,"angle",{deg:o,rad:h}),r.data("rotate-mode",0),sticker__rotation_margin_fixes(e,t)},rotationCenterOffset:{top:0,left:0},wheelRotate:!0};r.rotatable(s).data("rotate-mode",0),r.find(".ui-rotatable-handle").remove();var l=$("<div>",{class:"ui-rotatable-handle",title:"æ—‹è½‰"});if(!i){var c=l.clone(),d=l.clone(),u=l.clone();c.addClass("ui-rotatable-handle-ne"),d.addClass("ui-rotatable-handle-nw"),u.addClass("ui-rotatable-handle-sw"),r.append(c,d,u)}if(l.addClass("ui-rotatable-handle-se segrip"),r.append(l),r.find("div[class*='ui-rotatable-handle-']").bind("mousedown",function(e){r.rotatable("instance").startRotate(e)}),!i){var _=r.width()/r.height(),p=i?{}:{n:".ngrip",e:".egrip",s:".sgrip"};r.resizable({resize:function(e,t){n.css({"min-width":t.size.width})},stop:function(a,i){sticker__update(e,t,"size",{width:i.size.width,height:Math.round(i.size.height)}),$(this).height(i.size.width/_).css({top:0,left:0})},containment:"#editor",aspectRatio:!0,grid:5,minWidth:80,minHeight:80,maxWidth:.85*$("#editor_editable").width(),maxHeight:640,handles:p})}if(i){$(".ui-resizable-n, \t\t\t.ui-resizable-e, \t\t\t.ui-resizable-s").remove(),r.get(0).addEventListener("touchmove",function(a){if("touches"in a){var i={x:0,y:0,sum:0},n=hj__cache({bucket:"hearty_sticker_finger_gap"})||null,o=0,s=r.width(),l=r.height(),c={max:.85*$("#editor_editable").width(),min:80};if(r.data("aspect_ratio"))d=r.data("aspect_ratio");else{var d=s/l;r.data("aspect_ratio",d)}if(a.touches.length>1){i.x=Math.abs(a.touches[1].pageX-a.touches[0].pageX),i.y=Math.abs(a.touches[1].pageY-a.touches[0].pageY),i.sum=Math.floor(Math.sqrt(Math.floor(i.x**2+i.y**2))),null!==n&&(o=i.sum-n),o=isNaN(o)?0:o,hj__cache({set:!0,bucket:"hearty_sticker_finger_gap",data:i.sum}),l=(s+=s*(o/s*.4))/d,s<c.min?(l*=c.min/s,s=c.min):s>c.max&&(l*=c.max/s,s=c.max),s=Math.round(1e3*s)/1e3,l=Math.round(1e3*l)/1e3;var u=Math.floor(.45*Math.min(s,l));r.width(s).height(l).css({"font-size":u>100?100:u}),sticker__update(e,t,"size",{width:s,height:l}),Math.abs(o)>0&&r.hasClass("rotating")&&r.removeClass("rotating"),r.addClass("resizing"),r.hasClass("dragthis")&&r.removeClass("dragthis")}}},{passive:!0}),r.get(0).addEventListener("touchend",function(e){hj__cache({set:!0,bucket:"hearty_sticker_finger_gap"}),r.removeClass("resizing")},{passive:!0}),window.interact(".asset[data-asset_id='"+t+"']").on("hold",function(a){0===$(".asset[data-asset_id='"+t+"'] .sticker_editing").length&&(sticker__cut({bundle_id:e,asset_id:t}),hj_vibrate(80))});var h=(o=parseFloat(a.angle.deg))/57.296;window.interact(".asset[data-asset_id='"+t+"'] .sticker_img").gesturable({onmove:function(a){o+=a.da,r.css({"-webkit-transform":"rotate("+o+"deg)","-ms-transform":"rotate("+o+"deg)",transform:"rotate("+o+"deg)"}),o>360?o-=360:o<0&&(o+=360),sticker__update(e,t,"angle",{deg:o,rad:h=o/57.296}),sticker__rotation_margin_fixes(e,t),Math.abs(a.da)>.5&&r.removeClass("resizing").addClass("rotating"),hj_log("* æ›´æ–°è²¼ç´™è§’åº¦ "+t+"ï¼š"+parseFloat(o).toFixed(2)+" Â°")}}).on({gestureend:function(e){r.removeClass("rotating")}}),r.css({"-webkit-transform":"rotate("+o+"deg)","-ms-transform":"rotate("+o+"deg)",transform:"rotate("+o+"deg)"})}sticker__paste({bundle_id:e,asset_id:t}),hj_log("ğŸ® åˆå§‹åŒ–è²¼ç´™ï¼š"+e+"ï¼ˆ"+t+"ï¼‰")}function stickers__detach(){sticker__save_local([]),$("#editor .bundle").remove()}function sticker__oncreate(e,t){var a=current_post().post_id;Number(t)>0?(nav_toggle($(".stickerbook"),!1),hj_upgrade_toggle(!0)):(sticker__create(e),hj_mixpanel("Sticker Created",{post_id:a,sticker_set_num:e.set_num,sticker_set_alias:e.set_alias,sticker_num:e.num,sticker_name:e.name}),ga_event_push("Sticker Create",{event_category:"Posts",event_label:"Sticker Create"}))}function sticker__create(e,t){if(!current_post().editable)return!1;var a,i=sticker__lookup("page"),n="page"in i[1]?i[1].page:{},r="bundles"in i[1]?i[1].bundles:[],o=null==t,s=sticker__uniqID(!0),l=160,c=160,d=Math.min(l/e.width,c/e.height);if(e.width=Math.ceil(e.width*d),e.height=Math.ceil(e.height*d),e.align_right=1,o){a=sticker__new_blank("bundle",t=sticker__uniqID(!0),e);var u=r.map(function(e,t){return r[t].position.sum});u.push(0);var _=Math.max.apply(null,u);a.position.top=_,n[t]=a;var p=$(".bk-list .bk-page").scrollTop()||0,h={width:$("#editor").width()||0,height:$(".bk-list .bk-page").height()||0},f=$("#editor").get(0).offsetTop;p<f&&(p=f,$(".bk-list .bk-page").animate({scrollTop:p},100));var g={move:{top:p+(is_touch_device()?f:0)-.4*h.height-_},def:{top:p-f+.5*h.height-e.height+50,left:e.align_right?h.width-e.width||0:.1*h.width||0}},m={top:Math.ceil(g.move.top),left:Math.round(g.move.left)}}else{m=null;a=n[t]}if(n[t].assets[s]=a.assets[s]=sticker__new_blank("asset",t,e),sticker__save_local(r=Object.keys(n).map(function(e){return n[e]})),sticker__createDOM(t,a,m),o){a.position=a.assets[s].position={top:Math.floor(g.def.top),left:Math.round(g.def.left),right:0,align_right:1},n[t].assets[s]=a.assets[s],sticker__update(t,s,"position",a.assets[s].position);var b=a.assets[s];hj_update({action:"sticker_create",post_id:current_post().post_id,data:{bundle_id:t,asset_id:s,bundle_top:a.position.top,bundle_left:a.position.left,bundle_right:a.position.right,bundle_align_right:a.position.align_right,item_num:b.item_num,asset_width:b.size.width,asset_height:b.size.height}}).then(function(e){switch(e.Status){case 0:return void update_failed();case 2:return void signin_required();case 3:return void msg("è¶…éè²¼ç´™æ•¸ä¸Šé™","<i class='fas fa-star'></i> äº†è§£å‡ç´šå„ªæƒ ",function(){hj_upgrade_toggle(!0)})}})}sticker__cut({bundle_id:t,asset_id:s}),open_book(!0),hj_vibrate(30),hj_log("â• æ–°å¢è²¼ç´™ï¼š"+t+"ï¼ˆ"+s+"ï¼‰")}function sticker__createDOM(e,t,a){var i,n,r,o;for(var s in n=$("<div>",{class:"bundle","data-bundle_id":e,onContextMenu:"return false;"}).html($("<div>",{class:"bundle_innerbox"})).data("bundle-id",e).insertBefore("#editor_editable"),t.assets){o=t.assets[s],i=$(".hj-sample .asset").clone().attr({title:o.item_name,"data-editing":!0,"data-bundle_id":e,"data-asset_id":s}).data("asset-id",s).fadeTo("slow",.35),n.children(".bundle_innerbox").append(i),r=$(".asset[data-asset_id='"+s+"'] .sticker_img");var l="/images/stickers/"+o.set_alias+"/"+o.item_num+".png";r.width(o.size.width).height(o.size.height).addClass("dragthis").css({"background-image":["//s.hearty.app"+l,"//"+wpCDN+"/s.hearty.app"+l].map(function(e){return'url("'+e+'")'}).join(", ")}),is_touch_device()&&r.children(".detach").get(0).addEventListener("touchmove",function(e){e.stopPropagation()},{passive:!0}),null==a?i.fadeTo("slow",1):window.setTimeout(function(){i.animate(a,150).fadeTo("slow",1)},0),sticker__initialize(e,s,t.assets[s])}}function sticker__rotation_margin_fixes(e,t){var a=$(".bundle .asset[data-asset_id='"+t+"']"),i=a.children(".sticker_img");if(!(i.length<1)){var n=Math.floor(.9*i.get(0).getBoundingClientRect().width),r=Math.floor(.9*i.get(0).getBoundingClientRect().height);if(hj_log("è²¼ç´™å°ºå¯¸ï¼š"+n+" x "+r),!n||!r)return!1;sticker__update(e,t,"size",{width:n,height:r},!0),a.css({"min-width":n,"max-height":r})}}function sticker__new_blank(e,t,a){var i={};return i.position={top:isNaN(a.top)?0:a.top,left:isNaN(a.left)?0:a.left,right:isNaN(a.right)?0:a.right,topmargin:0,align_right:isNaN(a.align_right)?0:a.align_right},i.size={width:a.width,height:a.height},"asset"==e?(i.item_num=isNaN(a.num)?0:a.num,i.item_name=a.name,i.set_num=isNaN(a.set_num)?0:a.set_num,i.set_alias=a.set_alias,i.angle={deg:0,rad:0}):"bundle"==e&&(i.id=t||sticker__uniqID(!0),i.assets={},i.position.sum=0),i}function sticker__exec(e,t,a){var i=!1;if(null==a){var n=sticker__lookup("page");if(!n[0])return!1;n[1].page,a=n[1].bundles}switch(e){case"add":var r=a.length;if(r)for(var o=0;o<r;o++)if(i){if(a[o].position.sum>a[o].position.top)for(var s=a[o].position.sum-a[o].position.top,l=o;l<r;l++)a[l].position.top+=s}else(a[o].position.top>t.position.top||o+1===r)&&(a[o].position.topmargin=o>0?a[o].position.top-a[o-1].position.sum:a[o].position.top,a[o].position.sum=a[o].position.top+a[o].size.height,a.splice(o,0,t),i=!0);else a.push(t);return sticker__save_local(a),sticker__createDOM(t.id,t),sticker__place(sticker__calc(sticker__order(a)));case"remove":for(o=0;o<a.length;o++)a[o].id==t.id?(a.splice(o,1),i=!0):i&&a[o].position.align_right==a[o-1].position.align_right&&(a[o].position.topmargin+=a[o-1].position.topmargin+a[o-1].size.height,i=!1);return sticker__save_local(a),$(".bundle[data-bundle_id='"+t.id+"']").fadeOut(200,function(){$(this).remove()}),sticker__place(a)}}function sticker__order(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page,e=t[1].bundles}return e.length>1&&e.sort(function(e,t){return e.position.top-t.position.top}),e.forEach(function(e){$(".bundle[data-bundle_id='"+e.id+"']").detach().insertBefore("#editor_editable")}),e}function sticker__calc(e,t,a){if(null==e){var i=sticker__lookup("page");if(!i[0])return!1;i[1].page,e=i[1].bundles}switch(t){case"add":e=sticker__exec("add",a,e);break;case"remove":e=sticker__exec("remove",a,e)}var n=["left","right"],r={alignment:"",top:0,sum:{left:0,right:0}};return e.forEach(function(t,a){var i=t.position.align_right,o=i;if(i=n[i],o=n[o^=1],t.position.top=Math.max(t.position.top,0),a>0&&i!==r.alignment?t.position.topmargin=t.position.top-r.top:(t.position.top=Math.max(t.position.top,r.sum[i]+1),t.position.topmargin=t.position.top-r.sum[i]),t.position.topmargin=Math.max(t.position.topmargin,0),r.sum[i]=t.position.sum=t.position.top+t.size.height,a>0&&i==r.alignment)for(var s in r.sum)r.sum[s]=t.position.sum;for(var l in t.assets)t.assets[l].position.top=t.position.top,t.assets[l].position.topmargin=t.position.topmargin,t.assets[l].position.align_right=t.position.align_right;e[a]=t,r.alignment=i,r.top=t.position.top,0===a&&sticker__top_edge(t),hj_log("ğŸ“„ èª¿æ•´è²¼ç´™ä½ç½® "+t.id+"ï¼š"+JSON.stringify(t.position))}),sticker__save_local(e),e}function sticker__top_edge(e){return!1}function sticker__place(e){if(null==e){var t=sticker__lookup("page");if(!t[0])return!1;t[1].page,e=t[1].bundles}var a=$(".hj-styles");return e.forEach(function(e){if(a.children("style[data-bundle_id='"+e.id+"']").length){var t=e.position.align_right?'.bundle.bundle_right[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}":'.bundle.bundle_left[data-bundle_id="'+e.id+'"]::before{height:'+e.position.topmargin+"px}";a.children("style[data-bundle_id='"+e.id+"']").text(t)}else a.append($("<style>",{"data-bundle_id":e.id}))}),$("#editor .complement").remove(),$("#editor .bundle").each(function(e){var t=$(this).attr("class").split(" "),a=$("#editor .bundle").length>e+1?$(this).nextAll("#editor .bundle").eq(0).attr("class").split(" "):[];t.indexOf("bundle_left")>=0&&a.indexOf("bundle_left")>=0?$(this).after($("<div>",{class:"complement complement_right"})):t.indexOf("bundle_right")>=0&&a.indexOf("bundle_right")>=0&&$(this).after($("<div>",{class:"complement complement_left"}))}),e}function sticker__lookup(e,t,a){var i=hj__cache({bucket:"hearty_sticker_cache__"+current_post().post_id}),n=[null!==n,JSON.parse(i)||[]],r=[!1,{}];if(n[0]){var o,s={},l=n[1];l.forEach(function(e){s[e.id]=e}),r[1].page=l.length>0?s:{},r[1].bundles=l.length>0?l:[],"page"==e?(r[0]=!0,r[1].status=4):t in s?(o=r[1].bundle=s[t],"asset"==e&&a in o.assets?(r[0]=!0,r[1].status=3,r[1].asset=o.assets[a]):(r[0]="bundle"==e,r[1].status=2)):(r[0]=!1,r[1].status=1)}else r[0]=!1,r[1].status=0;return r}function sticker__update(e,t,a,i,n){var r,o=sticker__lookup("asset",e,t);if("angle"==a)i.deg=Math.abs(i.deg)>=360?Math.abs(i.deg).toFixed(0)-360:i.deg.toFixed(0),i.rad=Math.abs(i.rad)>=2*Math.PI?(Math.abs(i.rad)-2*Math.PI).toFixed(5):i.rad.toFixed(5);else for(var s in i)i[s]=Math.max(Math.floor(i[s]),0);if(!(o[0]&&a in o[1].asset))return!1;r=o[1].page,n||(r[e].assets[t][a]=i),["position","size"].indexOf(a)>=0&&(r[e][a]=i),sticker__save_local(Object.keys(r).map(function(e){return r[e]})),hj_log("ğŸ’¾ æš«å­˜è²¼ç´™ "+e+"ï¼ˆ"+t+"ï¼‰çš„ "+a+" ç‚ºï¼š"+JSON.stringify(i))}function sticker__cut(e){if(!current_post().editable||$(".bk-page .sticker_editing").length>0)return!1;var t,a=e.bundle_id,i=e.asset_id,n=$(".bundle[data-bundle_id='"+a+"']"),r=n.find(".asset[data-asset_id='"+i+"']"),o=r.children(".sticker_img"),s=$(".editor_toolbelt"),l=sticker__lookup("asset",a,i),c=is_touch_device();if(!(l[0]&&"position"in l[1].asset))return n.remove(),!1;t=l[1].asset.position,n.children(".bundle_innerbox").css({top:t.top,left:t.left});var d=t.align_right?-1*(t.right+Math.floor(1.05*o.get(0).getBoundingClientRect().width)):t.left;return r.animate({left:d},0),r.draggable("enable"),o.rotatable("enable").children(".ui-resizable-handle, .ui-rotatable-handle").fadeIn(),c?window.interact(".asset[data-asset_id='"+i+"'] .sticker_img").gesturable({enabled:!0}):(o.resizable("enable"),sticker__editor_hotkeys(!0,a,i)),$("#editor_editable").addClass("readonly").prop("contenteditable",!1).disableSelection(),n.children(".bundle_innerbox").width(0).css({"margin-left":"-1px","margin-right":"-1px"}),o.addClass("sticker_editing").removeClass("sticker_static"),$("#editor .bundle .sticker_static").fadeTo("fast",.5),r.attr("data-editing",!0),$(".editor_toolbelt #paste, #editor").attr("onclick","sticker__paste("+JSON.stringify({bundle_id:a,asset_id:i})+"); saved(false);"),o.children(".detach").fadeIn(),s.find(".kits").hide(),s.find(".sticker span").fadeIn(),$(".mh-head .btn_stickerbook, .stickerbook .stickerlist").hide(),nav_toggle($(".stickerbook"),!1),c&&($(".bk-page header, .bk-page .picture").hide(),$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(Math.floor(t.top-1*$(".bk-list .bk-page").height()/4)).css({"border-top":"none"})),hj_log("âœ‚ï¸ å‰ªä¸‹è²¼ç´™ï¼š"+a+"ï¼ˆ"+i+"ï¼‰"),!0}function sticker__paste(e){if(0===(o=$(".bk-page .sticker_editing")).length)return!1;var t,a=null!=e&&"bundle_id"in e?e.bundle_id:o.attr("data-bundle-id"),i=null!=e&&"asset_id"in e?e.asset_id:o.attr("data-asset-id"),n=$(".bundle[data-bundle_id='"+a+"']"),r=n.find(".asset[data-asset_id='"+i+"']"),o=r.children(".sticker_img"),s=$(".hj-styles"),l=sticker__calc(sticker__order()),c=sticker__lookup("asset",a,i),d=is_touch_device();if(c[0]&&"position"in c[1].asset&&((t=c[1].asset.position).align_right?(n.addClass("bundle_right").removeClass("bundle_left"),n.children(".bundle_innerbox").addClass("alignment_right").removeClass("alignment_left"),s.children("style[data-bundle_id='"+a+"']").length||s.append($("<style>",{"data-bundle_id":a})),s.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_right::before{height:"+t.topmargin+"px}"),n.children(".bundle_innerbox").css({"margin-left":0,"margin-right":t.right+"px"})):(n.addClass("bundle_left").removeClass("bundle_right"),n.children(".bundle_innerbox").addClass("alignment_left").removeClass("alignment_right"),s.children("style[data-bundle_id='"+a+"']").length||s.append($("<style>",{"data-bundle_id":a})),s.children("style[data-bundle_id='"+a+"']").text(".bundle[data-bundle_id='"+a+"'].bundle_left::before{height:"+t.topmargin+"px}"),n.children(".bundle_innerbox").css({"margin-left":t.left+"px","margin-right":0})),cssFeatureSupported("width","min-content")?n.children(".bundle_innerbox").width("min-content").height("min-content"):cssFeatureSupported("width","min-intrinsic")?n.children(".bundle_innerbox").width("min-intrinsic").height("min-intrinsic"):n.children(".bundle_innerbox").width("auto").height("auto")),sticker__place(l),$("#editor .bundle .sticker_static").fadeTo("fast",1),o.children(".detach").fadeOut(),$(".editor_toolbelt .sticker a").hide(),$(".editor_toolbelt .kits").fadeIn(),d){$(".bk-page header, .bk-page .picture").show();var u=$("#editor").get(0).offsetTop,_=$(".bk-list .bk-page").scrollTop()||0;$(".bk-list .bk-page").scrollTop(_+u).addClass("scroll-smoothly").css({"border-top":"1em solid transparent"})}return sticker__rotation_margin_fixes(a,i),r.attr("data-editing",!1).css({top:0,left:0}),o.children(".ui-resizable-handle, .ui-rotatable-handle").hide(),current_post().editable&&(r.draggable("disable"),o.rotatable("disable"),d?window.interact(".bundle .asset[data-asset_id='"+i+"'] .sticker_img").gesturable({enabled:!1}):(o.resizable("disable"),sticker__editor_hotkeys(!1,a,i)),$("#editor_editable").prop("contenteditable",!0),$(".mh-head .btn_stickerbook, .stickerbook .stickerlist").show()),$("#editor").removeAttr("onclick"),$("#editor_editable").removeClass("readonly").enableSelection(),o.addClass("sticker_static").removeClass("sticker_editing"),hj_log("ğŸ“‹ é»è²¼è²¼ç´™ï¼š"+a+"ï¼ˆ"+i+"ï¼‰"),!0}function sticker__remove(e){var t=current_post().post_id,a=e.bundle_id,i=e.asset_id;sticker__paste({bundle_id:a,asset_id:i})&&(sticker__exec("remove",{id:a}),sticker__top_edge(),hj_vibrate(80),$("#editor .bundle").length<2&&nav_toggle($(".stickerbook"),!0),createCaretPlacer(!1),hj_update({action:"sticker_remove",bundle_id:a,asset_id:i,post_id:t}).then(function(e){switch(e.Status){case 0:return void update_failed();case 2:return void signin_required()}})),hj_mixpanel("Sticker Removed",{post_id:t}),ga_event_push("Sticker Remove",{event_category:"Posts",event_label:"Sticker Remove"}),hj_log("ğŸ—‘ï¸ åˆªé™¤è²¼ç´™ï¼š"+a+"ï¼ˆ"+i+"ï¼‰")}function sticker__save_remote(){var e=sticker__lookup("bundles"),t="bundles"in e[1]?e[1].bundles:[];if(!t.length)return!1;hj_update({action:"sticker_save",post_id:current_post().post_id,bundles:JSON.stringify(t)}).then(function(e){switch(e.Status){case 0:case 3:update_failed();break;case 2:signin_required()}})}function sticker__save_local(e){hj__cache({set:!0,bucket:"hearty_sticker_cache__"+current_post().post_id,data:JSON.stringify(e)})}function sticker__uniqID(e){var t,a="hearty_sticker_uniqIDs",i=JSON.parse(hj__cache({bucket:a,local:!0}))||[];if(e&&(i.length>0?(t=i.shift(),hj__cache({set:!0,bucket:a,data:JSON.stringify(i),local:!0})):t=sticker__generate_uniqID(!1)),i.length<6)for(var n=i.length;n<6;n++)$.when(sticker__generate_uniqID(!0)).then(function(e){i.push(e),hj__cache({set:!0,bucket:a,data:JSON.stringify(i),local:!0})});return t}function hj__cache(e){var t="set"in e,a="local"in e?"localStorage":"sessionStorage";if(a in window){if(!t)return window.eval(a).getItem(e.bucket)||$("body").data(e.bucket)||null;try{window.eval(a).setItem(e.bucket,e.data)}catch(t){$("body").data(e.bucket,e.data)}}else{if(!t)return $("body").data(e.bucket)||null;$("body").data(e.bucket,e.data)}}function sticker__generate_uniqID(e){var t=generate_uniqID();if(e)return hj_update({action:"uniqid"}).then(function(e){return e.Status?e.Values.uniqid:t}).fail(function(e){return hj_update_failed({fn:"sticker__generate_uniqID",flag:0,err:e}),t});var a=update({action:"uniqid"});return a&&a.Status?a.Values.uniqid:t}function generate_uniqID(){return(new Date).getTime().toString(16)+Math.floor(90*Math.random()+10)}function hj_log(e){window.console&&window.hj_test&&console.log(e)}function post_privacy(e){autosave_the_change(),e=Number(e);var t=current_post().post_id,a=$(".bk-page #editor_editable");$(".popup.share .sharable_url");return hj_update({action:"post_privacy",post_id:t,privacy:e}).then(function(i){switch(i.Status){case 1:var n=a.data("current_post");return n.privacy=e,a.data("current_post",n),post_privacy_toggle(e),$(".catalog .diaries li[data-post_id='"+t+"']").attr("data-privacy",e),e?alertify.success("<i class='far fa-lock-open'></i> æ—¥è¨˜å…¬é–‹"):alertify.error("<i class='far fa-lock'></i> æ—¥è¨˜ä¸Šé–äº†"),hj_mixpanel("Post Privacy",{post_id:t,privacy:e}),ga_event_push("Privacy",{event_category:"Posts",event_label:e?"Public":"Private"}),!0;case 2:signin_required();break;default:hj_update_failed({fn:"post_privacy",flag:0})}}).fail(function(e){hj_update_failed({fn:"post_privacy",flag:1,err:e})})}function post_privacy_toggle(e,t){var a=$(".popup.share .sharable_url"),i=$(".popup.share .penpals");t=(e=Number(e))?Number(t||0):0,e?(i.hide(),post_get_sharable_link()):(a.hide(),i.slideDown());var n=$(".privacy_selector li"),r=n.filter("[data-publish]");n.removeAttr("data-selected"),n.filter("[data-privacy='"+e+"']").attr("data-selected",""),t?r.attr("data-selected",""):r.removeAttr("data-selected")}function post_get_sharable_link(){var e=Number(current_post().privacy),t=$(".popup.share .sharable_url"),a=t.find("input"),i=a.val()||"";if(e<9)return!1;i.length?t.slideDown():hj_update({action:"post_get_sharable_link",post_id:current_post().post_id}).then(function(e){e.Status&&e.Values&&"token"in e.Values&&(i="https://hj.rs/"+e.Values.token,a.val(i),t.slideDown())})}function hj_native_share(){var e=$(".popup.share .sharable_url input").val()||location.href.replace(location.host,"o.hearty.me");if("share"in navigator)navigator.share({title:document.title,text:$("meta[name='description']").attr("content"),url:e});else{if(!1===check_hjapp())return!1;location.assign("//hearty.me/wv?s="+encodeURIComponent(e.replace(/(^\w+:|^)\/\//,"")))}}function post_publish(){var e=Number(current_post().privacy),t=$(".bk-page #subject").text(),a=current_post().post_id,i=$(".bk-page #editor_editable").text().replace(/^\s+|\s+$/g,"")||"",n=$(".privacy_selector li[data-publish]"),r=!n.is("[data-selected]");if(r){if(i.length<90)return void msg("<i class='fal fa-pen'></i> æ–‡ç« ä¼¼ä¹æœ‰é»çŸ­ï¼Œä½ æ˜¯å¤§æ–‡è±ªï¼Œå†å¤šå¯«ä¸€é»å§~ (è‡³å°‘ 100å­—)","å¥½å–”");var o=e?"ä½ è¦å°‡ã€Œ"+t+"ã€åˆ†äº«åˆ°æ—¥è¨˜ç‰†å—ï¼Ÿ":"æŠ•ç¨¿æ–‡ç« éœ€å…¬é–‹ï¼Œæ˜¯å¦å…¬é–‹ä»¥åˆ†äº«åˆ°æ—¥è¨˜ç‰†ï¼Ÿ";alertify.set({labels:{ok:"<i class='fas fa-inbox-out'></i> å…¬é–‹æŠ•ç¨¿",cancel:"å–æ¶ˆ"},buttonReverse:!1})}else{o="ä½ è¦æ”¶å›å·²æŠ•ç¨¿çš„ã€Œ"+t+"ã€å—ï¼Ÿ";alertify.set({labels:{ok:"<i class='fas fa-inbox-in'></i> æ”¶å›æ–‡ç« ",cancel:"å–æ¶ˆ"},buttonReverse:!1})}alertify.confirm("<i class='fal fa-file-alt'></i> "+o,function(o){o&&(hj_loading(!0),e||post_privacy(9),hj_update({action:"post_publish",post_id:a,published:+r}).then(function(e){switch(e.Status){case 1:r?(alertify.set({labels:{ok:"<i class='fas fa-eye'></i> å»çœ‹çœ‹",cancel:"<i class='fas fa-reply'></i> å›æ—¥è¨˜"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-paperclip'></i> ã€Œ"+t+"ã€æŠ•ç¨¿åˆ°æ—¥è¨˜ç‰†å›‰",function(e){e&&(location.href=location.origin+"/feed?p=1&post="+a)}),n.attr("data-selected",""),hj_mixpanel("Post Published"),ga_event_push("Post Published",{event_category:"Posts",event_label:"Post Published"})):(n.removeAttr("data-selected"),alertify.error("<i class='far fa-eye-slash'></i> æ–‡ç« å·²æ”¶å›"));break;case 2:signin_required();break;default:msg()}hj_loading(!1)}).fail(function(e){hj_update_failed({fn:"post_publish",flag:1,err:e})}),hj_update({action:"gform_post",uri:"1FAIpQLSejAwJP2dSgdhGz79S9Q_JzqthM4JrAXhFB3dfKNCCfSJGi_A",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]","entry.1497216280":"[hj_email]",emailAddress:"[hj_email]","entry.355700800":a,"entry.1270264487":i,"entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":check_browser()+", "+check_OS()})}))})}function post_penpal_listing(){var e=$(".popup.share .penpals select");hj_update({action:"post_penpal_listing"}).then(function(t){switch(t.Status){case 1:var a=t.Values.penpals.map(function(e){return $("<option>",{value:e.penpal_id,title:e.nickname,"data-user_id":e.user_id,"data-username":e.username}).text(e.nickname)});e.html(a).hide().slideDown();break;default:hj_update_failed({fn:"post_penpal_listing",flag:0})}}).fail(function(e){hj_update_failed({fn:"post_penpal_listing",flag:1,err:e})})}function post_penpal_init(e){var t=$(".popup.share .penpals select"),a=t.children("option");a.prop({selected:!1}),e.forEach(function(e){a.filter("[data-user_id='"+e+"']").prop({selected:!0})}),t.data("penpals",JSON.stringify(t.val()||[]))}function post_penpal_add(e){alertify.set({labels:{ok:"<i class='fas fa-plus'></i> è¨­ç‚ºç­†å‹",cancel:"å–æ¶ˆ"},buttonReverse:!1}),alertify.prompt("<i class='far fa-user-plus'></i> æœ‹å‹çš„ æº«åº¦ ID æˆ– Email",function(e,t){if(e){if(!t.replace(/\s+/g,"").length)return!1;hj_update({action:"post_penpal_add",penpal:t}).then(function(e){switch(e.Status){case 1:post_penpal_listing(),hj_mixpanel("Penpal Add"),ga_event_push("Penpal",{event_category:"Add User",event_label:"Penpal"});break;case 2:signin_required();break;case 3:msg("<i class='far fa-grin'></i> ã€Œ"+t+"ã€å·²åŠ å…¥éå›‰");break;case 4:$("#alertify .alertify-text").val(""),msg("<i class='far fa-grin-beam-sweat'></i> æ¬¸ï¼Œä¸èƒ½è¼¸å…¥ä½ è‡ªå·±");break;default:msg("<i class='far fa-grin-beam-sweat'></i> æ‰¾ä¸åˆ°å°æ‡‰çš„æº«åº¦æ—…äººã€Œ"+t+"ã€","å†è©¦è©¦",function(){alertify_input_shake()}),post_penpal_add(t)}})}},(e||"").toString()),alertify_input_custom({placeholder:"è¼¸å…¥æº«åº¦ ID æˆ– Email",minlength:3,maxlength:64})}function post_penpal_share(){var e=current_post().post_id,t=$(".popup.share .penpals select"),a=t.children("option"),i=t.val()||[],n=JSON.parse(t.data("penpals")||null)||[];t.data("penpals",JSON.stringify(i)),i={added:$(i).not(n).get().map(e=>({penpal_id:e,user_id:a.filter("[value='"+e+"']").attr("data-user_id"),nickname:a.filter("[value='"+e+"']").text()})),removed:$(n).not(i).get().map(e=>({penpal_id:e,user_id:a.filter("[value='"+e+"']").attr("data-user_id"),nickname:a.filter("[value='"+e+"']").text()}))},hj_update({action:"post_penpal_send",post_id:e,penpals:JSON.stringify(i)}).then(function(a){switch(a.Status){case 1:var n=i.added.map(function(e){return e.nickname}).join("ã€")||$("select option:selected").text()||"";alertify.success("<i class='far fa-book-alt'></i>"+(n.length>0?"èˆ‡ "+n+" äº¤æ›":"äº¤æ›è¨­å®šå·²æ›´æ–°")),$(".catalog .diaries li[data-post_id='"+e+"']").attr("data-outbound_count",t.val().length);break;case 2:case 3:signin_required()}})}function hj_feedback_toggle(e){popup_toggle(e,"feedback");var t=$(".popup.feedback .support_pincode");e&&null==t.attr("data-pincode")&&hj_update({action:"support_pincode"}).then(function(e){1==e.Status&&t.attr("data-pincode",e.Values.pincode).show().on("click",function(){msg('<i class="far fa-comment-dots"></i> å®¢æœ PIN ç¢¼ï¼š'+e.Values.pincode+"<br>(è¯ç¹«æ™‚ï¼Œæä¾›é€™çµ„æ•¸å­—å¯åŠ å¿«èº«ä»½èªè­‰)")})}),hj_smallchat(e,"pc")}function hj_smallchat(e,t){var a=$("#Smallchat iframe");a.length>0?e?(a.fadeIn(),hj_smallchat_init(t)):a.fadeOut():e&&hj_getScript("//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.21/public/plugin.smallchat.min.js").then(function(){window.addEventListener("smallchat:ready",function(){hj_smallchat_init(t)},{passive:!0})})}function hj_smallchat_toggle(e){var t=$("#Smallchat iframe");return t.length>0&&(t.contents().find(e?".Launcher":".Messenger_close").click(),e&&(hj_smallchat_customized(),t.contents().find(".Input_field").focus())),t.length>0}function hj_smallchat_init(e){if(1==e||"pc"==e&&!is_touch_device())hj_smallchat_toggle(!0);else{var t=$("#Smallchat iframe");t.length>0&&t.contents().find(".Launcher").on("click",function(){hj_smallchat_customized(),t.contents().find(".Input_field").focus(),hj_fcm_init()})}}function hj_smallchat_customized(){var e=$("#Smallchat iframe"),t=hj_username.toString(),a=($(".hj_user .name").attr("data-text")||"").toString();window.hj_username&&!e.get(0).contentWindow.window.hj0&&e.contents().find("body").append("<script>if(!window.hj0)var hj0=setInterval(function(){var n=document.getElementsByName('name')[0],c=document.getElementsByName('contact')[0],b=document.getElementsByClassName('Contact_submit')[0];if(!!n&&!n.value){n.placeholder='"+a+"';n.setAttribute('placeholder','"+a+"');} if(!!c&&!c.value){c.placeholder='æº«åº¦ IDï¼š"+t+"';c.setAttribute('placeholder','æº«åº¦ IDï¼š"+t+"');}},2e3);<\/script>")}function hj_feedback(){var e=$(".popup.feedback"),t=e.find("input[name='name']"),a=e.find("input[name='email']"),i=e.find("textarea"),n=e.find(".notice"),r=e.find(".btns_action li"),o=["åŸºæœ¬ç‰ˆ",,,,"VIP è©¦ç”¨ç‰ˆ","VIP ç‰ˆ"][hj_membership()[1]||0];return t.val().length<2?(n.text("è«‹å¡«å¯«æ‚¨çš„å¤§å"),t.focus(),shake(t),!1):/@/.test(a.val())?i.val().length<5?(n.text("æ„è¦‹å›é¥‹çš„å­—æ•¸ä¸è¶³"),i.focus(),shake(i),!1):(hj_loading(!0),void r.slideUp("fast",function(){hj_update({action:"gform_post",uri:"1FAIpQLScPq53DlC8PjlQCJEMqHm-7ykRPEDosDrIsaAbj3YUT32rTgQ",data:$.param({"entry.434422115":"[hj_user_id]","entry.1958440920":t.val()||"[hj_username]","entry.803572147":a.val()||"[hj_email]",emailAddress:a.val()||"[hj_email]","entry.1027128888":i.val()||"","entry.206183814":o,"entry.2103260912":e.find("#addfiles").prop("checked")?"https://ppt.cc/fVplxx":"N","entry.858322988":navigator.userAgent||""})}).then(function(t){switch(t.Status){case 1:e.find("form").get(0).reset(),hj_feedback_toggle(!1),n.text("è¬è¬æ‚¨çš„æ„è¦‹"),alertify.set({labels:{ok:"<i class='fas fa-check'></i> å®Œæˆ",cancel:"<i class='far fa-comment-dots'></i> ç›´æ¥ç§è¨Šå®¢æœ"},buttonReverse:!1}),alertify.confirm("<i class='far fa-grin'></i> å·²æ”¶åˆ°ä¿¡ä»¶<br>æˆ‘å€‘éå¸¸é‡è¦–æ‚¨çš„å•é¡Œèˆ‡å»ºè­°ï¼Œå°‡é€Ÿé€Ÿä»¥ Email å›è¦†<br><br><i class='fal fa-hashtag'></i> æº«åº¦æ—¥è¨˜ "+hj_teammate_rand(),function(e){e||hj_smallchat(!0,!0)}),$(this).slideDown(),hj_loading(!1);break;default:n.text("å‡ºéŒ¯äº†ï¼Œè«‹ç¨å€™å†è©¦"),msg("å°ä¸èµ·ï¼Œä¼¼ä¹å‡ºéŒ¯äº†ï¼Œè«‹ç¨å€™å†è©¦"),$(this).slideDown(),hj_loading(!1)}})})):(n.text("Email æ ¼å¼ä¸ç¬¦åˆ"),a.focus(),shake(a),!1)}function hj_feedback_addfiles(){open_url("//go.hearty.me/K5XJG")}function hj_teammate_rand(){return Math.random()>=.5?"å‰µè¾¦äºº Nien":"å…±åŒå‰µè¾¦äºº Mia"}function hj_copy(e){e.length>0&&(select_input_text(e),document.execCommand("Copy",!1,null)&&alertify.success("<i class='far fa-copy'></i> å·²è¤‡è£½"),e.blur())}function select_input_text(e){e.length>0&&(check_OS("iOS")?(e.get(0).focus(),e.get(0).setSelectionRange(0,99999)):e.select())}function sticker__list(e,t){var a=hj_membership()[0],i=$(".stickerbook"),n=i.find(".stickertabs"),r=i.find(".stickerlist .stickerdir"),o=[],s="hearty_sticker_list__"+bucket_suffix(),l=hj__cache({bucket:s});if(null===l){var c=$.Deferred();l={},hj_update({action:"sticker_list"}).then(function(e){e.Status>0&&(l=e.Values,hj__cache({set:!0,bucket:s,data:JSON.stringify(l)})),c.resolve()}).fail(function(e){hj_update_failed({fn:"sticker__list",flag:0,err:e}),c.reject()})}else l=JSON.parse(l)||{};if(null==e)$.when(c).done(function(){var e=[];for(var t in l)e=l[t],o.push($("<div>",{class:"item",onclick:"sticker__list('"+t+"', '"+e.alias+"');",title:e.name,"data-sticker":0}).html($("<div>",{"data-src":e.alias+"/"+e.cover+".png"})).append($("<h3>").text(e.name)));r.append(o).find(".item div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//s.hearty.app/images/stickers/thumbnails/",appendScroll:r,onError:function(e){var t=["//i0.wp.com/s.hearty.app"+("/images/stickers/thumbnails/"+e.attr("data-src"))];e.attr({"data-src-backup":t[0]}).css({"background-image":t.map(function(e){return'url("'+e+'")'}).join(", ")})}}),i.find(".tab_main").fadeIn()});else{if(!e)return void $(".mh-head .btn_stickerbook").hide();if(i.find(".item").hide(),isNaN(e)){n.find(".tab_category").hide(),i.find(".item[data-sticker='0']").add(n.find(".tab_main")).fadeIn();var d=r.data("scrolled");d&&r.scrollTop(d)}else{r.scrollTop(0);var u=i.find(".item[data-sticker='"+e+"']");u.length||(l[e].stickers.forEach(function(i){i.set_num=e,i.set_alias=t,o.push($("<div>",{class:"item",onclick:"sticker__oncreate($(this).data('sticker'), this.dataset.premium);",title:i.name,"data-sticker":e,"data-premium":Number(i.type)>0&&!a?1:0}).html($("<div>",{"data-src":t+"/"+i.num+".png"})).data("sticker",i).append($("<h3>").text(i.name)))}),r.append(o),(u=i.find(".item[data-sticker='"+e+"']")).find("div").lazy({threshold:100,effect:"fadeIn",effectTime:200,imageBase:"//s.hearty.app/images/stickers/thumbnails/",appendScroll:r,onError:function(e){var t=["//i0.wp.com/s.hearty.app"+("/images/stickers/thumbnails/"+e.attr("data-src"))];e.attr({"data-src-backup":t[0]}).css({"background-image":t.map(function(e){return'url("'+e+'")'}).join(", ")})}})),u.css({display:"-webkit-inline-flex",display:"inline-flex"}).fadeIn(),n.find(".tab_category span:nth-child(1)").text(l[e].name),n.find(".tab_category span:nth-child(2)").text(l[e].illustrator),n.find(".tab_main").hide(),n.find(".tab_category").fadeIn()}}$(".mh-head .btn_stickerbook").show()}function editor_focus_zoomin(){var e=is_touch_device()||$(window).width()<=767,t=check_OS("iOS"),a=$("#editor").get(0).offsetTop;$("#editor_editable").focus(function(){$(".mh-head .left, \t\t\t.mh-head .right:first > div, \t\t\t.bk-underlayer").hide(),$(".bk-page header, .bk-page .picture").slideUp(80,function(){ios_body_position_fix()}),$(".mh-head .right:last").fadeIn(),e&&$(".editor_toolbelt").hide(),$("body").scrollTop(0).css({"overflow-y":"hidden"}),$(".hj-main").css({padding:"1.6em 0 0 0"}),$(".bk-list .bk-page, .bk-list #editor").css({"border-top":"none"}),$("#editor .bundle").css({"pointer-events":"none"}).fadeTo("fast",.4),t||hj_editor_history("add","[editable_blur]")}).blur(function(){$(".mh-head .left, \t\t\t.bk-underlayer, \t\t\t.bk-page header, \t\t\t.bk-page .picture, \t\t\t.mh-head .right:first > div").show(),$(".bk-page header, .bk-page .picture").slideDown(80),e&&$(".editor_toolbelt").slideDown(),$(".mh-head .right:last").hide(),$("body").css({"overflow-y":"auto"}),$(".hj-main").css({padding:"3.6em 0 2em 0"}),$(".bk-list .bk-page").css({"border-top":"1em solid transparent"}),$(".bk-list #editor").css({"border-top":"1px dashed #ccc"}),$("#editor .bundle").css({"pointer-events":"auto"}).fadeTo("fast",1),$(".bk-list .bk-page").scrollTop()<a&&$(".bk-list .bk-page").removeClass("scroll-smoothly").scrollTop(a).addClass("scroll-smoothly"),autosave_the_change(),t?ios_body_position_fix():hj_editor_history("detach","[editable_blur]")})}function hj_video(e,t){var a=$(".bk-page .picture");switch(t=t||"UnP0ljFhd6c",e){case"init":a.children("#youtube").css({background:"url('//img.youtube.com/vi/"+t+"/0.jpg') no-repeat center","background-size":"cover"}).data("youtube",t).fadeIn().find("iframe").hide();break;case"play":a.find("#youtube iframe").attr({src:"//www.youtube.com/embed/"+t+"?"+$.param({controls:1,fs:1,modestbranding:1,loop:1,cc_load_policy:1,rel:0,autoplay:1,playsinline:1})}).show(),a.find(".far").slideUp();break;case"update":var i=current_post().post_id;alertify.set({labels:{ok:"<i class='fas fa-plus'></i> åŠ å…¥å½±ç‰‡",cancel:"å–æ¶ˆ"},buttonReverse:!1}),alertify.prompt("<i class='fab fa-youtube'></i> Youtube ç¶²å€",function(e,t){e&&((t=YoutubeURLparser(t))?(hj_video("init",t),hj_update({action:"post_update",field:"youtube_video",post_id:i,youtube_video:t}).then(function(e){switch(e.Status){case 1:var a=hj_video("get_title",t);a?(alertify.success("<i class='far fa-play'></i> "+(null==a?"å½±ç‰‡":"ã€Œ"+a+"ã€")+"åŠ å…¥"),hj_mixpanel("Video Added",{post_id:i,youtube:t}),ga_event_push("Video Added",{event_category:"Posts",event_label:"Video_Added"})):(hj_video("reset"),msg("<i class='fal fa-video-slash'></i> å½±ç‰‡å¯èƒ½å·²åˆªé™¤ã€æœªå…¬é–‹ï¼Œæˆ–æ˜¯ä¸å…è¨±åµŒå…¥<br>è«‹é‡æ–°æª¢æŸ¥åŸé€£çµ","å¥½",function(){hj_video("update"),alertify_input_shake()}));break;case 2:signin_required();break;default:hj_alert("Error: "+JSON.stringify(e))}})):msg("<i class='fal fa-video-slash'></i> Youtube ç¶²å€æ ¼å¼ä¸æ­£ç¢º","å¥½",function(){hj_video("update"),alertify_input_shake()}))},"https://www.youtube.com/watch?v="+t),alertify_input_custom({type:"url",placeholder:"https://www.youtube.com/watch?v=vYFnZdUiUyg",onclick:"select_input_text($(this))",onpaste:"$.wait(50).then(function(){$('.alertify-text').blur()})",onchange:"if(!!YoutubeURLparser(this.value)) $('.alertify-button-ok').click()"});break;case"reset":hj_video("clear"),hj_update({action:"post_update",field:"youtube_video",post_id:current_post().post_id,youtube_video:""});break;case"clear":a.children("#youtube").data("youtube",null).fadeOut().find("iframe").removeAttr("src");break;case"get_title":var n;return $.ajax({url:"//www.googleapis.com/youtube/v3/videos?part=snippet&key=AIzaSyDEPs16fsPzTBnxvqFnWPrcnzXPx7NbbSE&id="+t,crossDomain:!0,async:!1,dataType:"json",success:function(e){n=e.items.length>0&&e.items[0].snippet.title},error:function(){n=!1}}),n;case"load_player_api":if(!window.YT)var r={loading:0,loaded:0};if(!window.YTConfig)var o={host:"https://www.youtube.com"};r.loading||(r.loading=1,function(){var e=[];r.ready=function(t){r.loaded?t():e.push(t)},window.onYTReady=function(){r.loaded=1;for(var t=0;t<e.length;t++)try{e[t]()}catch(e){}},r.setConfig=function(e){for(var t in e)e.hasOwnProperty(t)&&(o[t]=e[t])};var t=document.createElement("script");t.id="www-widgetapi-script",t.src="//s.ytimg.com/yts/jsbin/www-widgetapi-vflN9jQ3_/www-widgetapi.js",t.async=!0;var a=document.currentScript;if(a){var i=a.nonce||a.getAttribute("nonce");i&&t.setAttribute("nonce",i)}var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n)}())}}function YoutubeURLparser(e){var t=e.match(/^.*(youtu\.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);return!(!t||11!=t[2].length)&&t[2]}function post_query(e,t){if(autosave_the_change(),null==t){var a=Number(current_post().post_id);a>0&&hj_editor_history("add",Number(a))}e=Number(e);var i=$(".bk-list .bk-page"),n=i.find("#subject"),r=i.find("#editor_editable"),o=$(".catalog .diaries li");if(e<=0){if(0==e&&window.hj_writer==window.hj_username&&only_shared_posts_listed())return!1;var s=catalog_lookup(e);return null!==s&&post_query(s.post_id),null!==s}nav_toggle($(".catalog[data-mobile]"),!1);var l=update({action:"post_query",writer:hj_writer,post_id:e,passcode:""});switch(l.Status){case 1:case 3:i.children(".prologue").hide(),i.children(".diary").removeAttr("data-hidden"),n.add(r).hide(),n.slideDown("fast",function(){r.slideDown("fast")}),$(".bk-page .picture").fadeTo("normal",0).fadeTo("slow",1);var c=hj_writer,d=l.Values;illustration_random();d.title=d.title||"æ–°çš„æ—¥è¨˜",d.title_decoded=htmlDecode(d.title),d.editable=Number(d.editable)>0,r.data("current_post",{post_id:e,privacy:d.privacy,editable:d.editable,vip:hj_membership()[0]}).html(linkify(d.post)),n.text(d.title_decoded).attr("title",d.title_decoded),sticker__top_edge(),stickers__initialize(),d.image=illustration_show({gallery_id:d.gallery_id,gallery_rotated:d.gallery_rotated,gallery_cssgram:d.gallery_cssgram}),d.youtube_video?hj_video("init",d.youtube_video):hj_video("clear"),post_privacy_toggle(d.privacy,d.published);var u=$(".popup.share input");d.shortened_url?(d.shortened_url="https://hj.rs/"+d.shortened_url,u.val(d.shortened_url).attr({placeholder:d.shortened_url})):u.val("").attr({placeholder:""}),o.filter("[data-active]").removeAttr("data-active"),o.filter("[data-post_id='"+e+"']").attr("data-active","").text(d.title_decoded),d.title_decoded+=" â™¥ æº«åº¦æ—¥è¨˜ Hearty Journal",document.title=d.title_decoded,$('meta[property="og:title"]').attr("content",d.title_decoded),$('meta[name="description"], meta[property="og:description"]').attr("content",d.post.replace(/\n/g,"").substring(0,48)+"â€¦"),$('meta[property="og:image"]').attr("content",d.image),$('meta[property="og:url"]').attr("content",location.href),i.find(".bookmark").attr("data-bookmarked",d.bookmarked);var _=diary_date_format(d.created_date);i.find(".diary").attr("data-date",_),$(".post_attr #post_created").val(d.created_date).attr("title",_),i.find(".wi").removeAttr("class").addClass(d.weather),post_penpal_init(d.penpals),"username"in d.writer&&(c=d.writer.username),r.attr("data-writer","nickname"in d.writer?d.writer.nickname:""),i.animate({scrollTop:0},"fast"),"function"==typeof history.replaceState&&window.history.replaceState({},d.title_decoded,"/"+c+"/"+e+location.search),editor_enable(d.editable),setcookie("hearty_last_viewed",[c,e].toString(),1),prefetch_link_screenshots(),hj_mixpanel("Post Loaded",{post_id:e}),ga_event_push("Post Loaded",{event_category:"Posts",event_label:"Post Loaded"});break;case 2:post_query(0);break;case 4:signin_required()}return 1===l.Status}function linkify(e){return e=(e=(e=e.replace(/\b(?:https?|ftp):\/\/[a-z0-9-+&@#\/%?=~_|!:,.;]*[a-z0-9-+&@#\/%=~_|]/gim,'<a onclick="open_external(this.dataset.link)" title="$&" data-link="$&">$&</a>')).replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a onclick="open_external(this.dataset.link)" title="$2" data-link="https://$2">$2</a>')).replace(/[\w.]+@[a-zA-Z_-]+?(?:\.[a-zA-Z]{2,6})+/,'<a onclick="document.execCommand(\'selectAll\',false,null); hj_copy($(this));" title="$&">$&</a>')}function only_shared_posts_listed(){var e=$(".catalog .diaries li[data-editable]");return e.filter("[data-editable='0']").length>0&&!e.filter("[data-editable='1']").length}function post_create(e){open_book(!0);var t=!1,a=$(".notifications li[data-notification_id='1']").length>0&&$(".catalog[data-desktop] .diaries li[data-editable='1']").length>2;if("geolocation"in navigator&&!(t=JSON.parse(decodeURIComponent(getcookie("hearty_position_gps"))||!1))&&e&&confirm("â›… æ˜¯å¦æ‰“é–‹å®šä½ï¼Œç‚ºæ—¥è¨˜åŠ å…¥å¤©æ°£å‘¢ï¼Ÿ")){var i=$.Deferred();return $.when(i).then(function(){post_create(!1),alertify.success("<i class='far fa-cloud'></i> åŠ å…¥äº†å¤©æ°£")}).fail(function(){post_create(!1),alertify.error("<i class='far fa-map-marker-alt-slash'></i> æ²’æœ‰ GPSè¨Šè™Ÿï¼Œæœªèƒ½åŠ å…¥å¤©æ°£")}),$.when(window.positioning_gps_deferred).done(function(){i.resolve()}),positioning_gps_trigger(!0),$(".mask_loading").show().delay(7e3).queue(function(){i.reject(),$(this).fadeOut().dequeue()}),void msg("â›… è«‹ã€Œå…è¨±ã€è®€å– GPSï¼Œä¸¦ç¨å¾…ä¸€æœƒå…’â€¦","å¥½")}return hj_update(t?{action:"post_create",location_lat:t.latitude||"",location_lon:t.longitude||"",place:t.address||"",weather_id:t.weather_id||""}:{action:"post_create"}).then(function(e){switch(e.Status){case 1:$(".alertify-button-ok").click();var t=(e=e.Values).post_id,i=e.title;if($("<li>",{title:"ğŸ“ "+i,onclick:"if(this.dataset.active==null && !post_query(this.dataset.post_id)) $(this).remove();","data-active":"","data-post_id":t,"data-page":1,"data-privacy":0,"data-editable":1}).text(i).prependTo($(".catalog .diaries")),catalog_page({page:1}),hj_membership()[0])post_query(t);else{var n=Number(e.chars)||0,r=Number(e.char_limit)||5800;n>r&&(n=numberWithCommas(n),alertify.set({labels:{ok:"å†æé†’æˆ‘",cancel:"<i class='fas fa-star'></i> ç«‹å³å‡ç´š"},buttonReverse:!0}),alertify.confirm("<i class='fab fa-wordpress-simple'></i> æ‚¨å¯«äº† "+n+"å­—ï¼Œå·²è¶…éåŸºæœ¬ç‰ˆé¡åº¦ ("+numberWithCommas(r)+"å­—)",function(e){post_query(t),e||hj_upgrade_toggle(!0)}),customized_notification("char_limit_exceed",n),hj_mixpanel("Chars Limit Notice",{post_id:t}),ga_event_push("Chars Limit Notice",{event_category:"Posts",event_label:"Chars Limit Notice"}))}hj_vibrate(80),hj_mixpanel("Post Created",{post_id:t}),ga_event_push("Create",{event_category:"Posts",event_label:"Create"}),a&&(alertify.set({labels:{ok:"å–æ¶ˆ",cancel:"<i class='fas fa-hand-point-up'></i> å¥½çš„"},buttonReverse:!0}),alertify.confirm("<i class='far fa-envelope-open'></i> éœ€èªè­‰ Email åŠå®Œå–„åŸºæœ¬è³‡æ–™ï¼Œä»¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½",function(e){e||open_url(location.origin+"/account?ev=1")}));break;case 2:signin_required();break;case 3:if(hj_membership()[0])location.reload(!0);else{n=numberWithCommas(e.Values.chars);msg("<i class='fab fa-wordpress-simple'></i> æ‚¨å¯«äº† "+n+"å­—ï¼Œå·²è¶…éåŸºæœ¬ç‰ˆé¡åº¦ ("+numberWithCommas(e.Values.char_limit)+"å­—)","<i class='fas fa-star'></i> äº†è§£å‡ç´šå„ªæƒ ",function(){hj_upgrade_toggle(!0),customized_notification("char_limit_exceed",n)}),hj_mixpanel("Chars Limit Blocked"),ga_event_push("Chars Limit Blocked",{event_category:"Posts",event_label:"Chars Limit Blocked"})}break;default:msg()}})}function post_revise(e){var t=$(".bk-page #editor_editable"),a=current_post().post_id,i=check_browser("Firefox")?htmlDecode(t.html().replace(/(<br\/>|<br>|<BR>|<BR\/>)/g,"\n")):t.text().replace(/^\s+|\s+$/g,"")+"\n";e=Number(e||0),hj_update({action:"post_update",field:"revise",post_id:a,post:i}).then(function(t){switch(t.Status){case 1:saved(!0),$(".editor_toolbelt .kit.save").removeClass("btn_blink"),hj_mixpanel("Post Revised",{post_id:a}),ga_event_push("Revise",{event_category:"Posts",event_label:"Revise"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_revise",flag:"a"+e}),e<4&&(clearTimeout(timer),timer=setTimeout(function(){post_revise(e+1)},2e3))}}).fail(function(t){hj_update_failed({fn:"post_revise",flag:"b"+e,err:t}),e<4&&(clearTimeout(timer),timer=setTimeout(function(){post_revise(e+1)},2e3))})}function save_btn(){open_book(!0),post_revise(),sticker__save_remote();var e=$(".bk-page #editor_editable"),t=e.text();/(https?|www\.)/.test(t)&&e.html(linkify(t))}function post_created_date(e){hj_update({action:"post_update",field:"created_date",post_id:current_post().post_id,post_created:e}).then(function(t){switch(t.Status){case 1:e=diary_date_format(e),$(".bk-list .bk-page .diary").attr("data-date",e),alertify.success("<i class='far fa-calendar'></i> æ—¥æœŸè¨­ç‚ºï¼š"+e),hj_mixpanel("Created Date Updated",{post_id:post_id}),ga_event_push("Created Date Updated",{event_category:"Posts",event_label:"Created Date Updated"});break;case 2:signin_required()}})}function autosave_the_change(){return!(null===window.onbeforeunload||!current_post().editable)&&(post_revise(),!0)}function autosaver_30s(){window.hj_autosaver=setInterval(function(){null!==window.onbeforeunload&&current_post().editable&&post_revise()},29900)}function saved(e){var t=$(".editor_toolbelt .kit.save");1==e?(window.onbeforeunload=null,t.finish().removeClass("btn_blink").removeAttr("data-unsaved").attr("data-saving","").delay(1e3).queue(function(){$(this).removeAttr("data-saving").dequeue()})):(window.onbeforeunload=function(e){return current_post().editable&&post_revise(),"å·²å„²å­˜æ–‡ç« ï¼Œç¢ºèªè¦é›¢é–‹å—ï¼Ÿ"},t.addClass("btn_blink"))}function title_editing(e){var t=current_post().post_id;alertify.set({labels:{ok:"ğŸ“ æ›´æ–°",cancel:"å–æ¶ˆ"},buttonReverse:!1}),alertify.prompt("<i class='far fa-pen'></i> æ—¥è¨˜æ¨™é¡Œ",function(e,a){if(e){if(!a.replace(/\s+/g,"").length)return!1;a=capitalizeFirstLetter(a),hj_update({action:"post_update",field:"title",post_id:t,title:a}).then(function(e){switch(e.Status){case 1:$(".bk-page #subject, .catalog .diaries li[data-active]").attr("title",a).text(a),alertify.success("<i class='far fa-paperclip'></i> æ–°æ¨™é¡Œã€Œ"+htmlspecialchars(a)+"ã€"),hj_mixpanel("Title Edited",{post_id:t,post_title:a}),ga_event_push("Edit Title",{event_category:"Posts",event_label:"Edit Title"}),a+=" â™¥ æº«åº¦æ—¥è¨˜ Hearty Journal",document.title=a,$("meta[property='og\\:title']").attr("content",a);break;case 2:signin_required();break;default:hj_update_failed({fn:"title_editing",flag:0})}}).fail(function(e){hj_update_failed({fn:"title_editing",flag:1,err:e})})}},e||$(".bk-page #subject").text()),alertify_input_custom({placeholder:"æ—¥è¨˜æ¨™é¡Œ",maxlength:255},{"letter-spacing":"2px"})}function post_archive(){if(!current_post().editable)return!1;autosave_the_change(),open_book(!0);var e=current_post().post_id,t=$("#subject").text(),a=$(".bk-list .bk-page");alertify.set({labels:{ok:"å¦",cancel:"æ˜¯çš„ï¼Œå¿˜è¨˜é€™ä¸€åˆ‡"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-exclamation-triangle'></i> ç¢ºå®šåˆªé™¤ï¼ˆ"+t+"ï¼‰å—ï¼Ÿ",function(i){i||hj_update({action:"post_update",field:"archive",post_id:e}).then(function(i){switch(i.Status){case 1:catalog_page({page:1}),a.find(".diary").attr("data-hidden",""),a.find(".prologue").slideDown(),$(".catalog .diaries li[data-post_id='"+e+"']").remove(),alertify.error("<i class='far fa-trash-alt'></i> åˆªé™¤ã€Œ"+t+"ã€"),"function"==typeof history.replaceState&&window.history.replaceState({},t+" â™¥ æº«åº¦æ—¥è¨˜ Hearty Journal","/"+hj_writer+location.search),a.find("#editor_editable").data("current_post",null),hj_vibrate(80),hj_mixpanel("Post Archived",{post_id:e}),ga_event_push("Archive",{event_category:"Posts",event_label:"Archive"});break;case 2:signin_required();break;default:hj_update_failed({fn:"post_archive",flag:0})}}).fail(function(e){hj_update_failed({fn:"post_archive",flag:1,err:e})})})}function hj_own_domains(e){return/(https?:\/\/(.+?\.)?(hearty(\.(me|tw|app)|(corp|mail)\.com)|hj\.rs|ht\.mk|(chen|)nien\.(co|org)|miss\.com\.tw|(alice|mia)\.tw|jiayi\.life)(\/[A-Za-z0-9\-\._~:\/\?#\[\]@!$&'\(\)\*\+,;\=]*)?)/g.test(e||"")}function open_external(e){if(null==e)return!1;if(hj_own_domains(e))return open_url(e),!0;var t=$(".external_link"),a=t.find(".snapshot"),i="//s0.wp.com/mshots/v1/"+encodeURIComponent(e)+(e.indexOf("?")>0?"&":"?")+"w=320";if(a.hide(),"naturalWidth"in a.get(0)){var n=[3,1,1,1,1,1,1,1,1,1,1,1,1];!function e(){var t=n.length;t>0&&a.attr({src:i+"&t="+t}).on("load",function(){t>0&&400==$(this).get(0).naturalWidth?($(this).off("load"),$.wait(1e3*n.shift()).then(e)):$(this).fadeIn().off("load")})}()}else a.attr({src:i}).show();t.find(".url").text(e),t.find("li[data-url]").attr("data-url",e),popup_toggle(!0,"external_link"),$("#editor_editable").blur(),hj_mixpanel("Open External URL",{url:e}),ga_event_push("Open External URL",{event_category:"Posts",event_label:"Open External URL"})}function prefetch_link_screenshots(){var e=$("#editor_editable a[data-link]");e.length>0&&"sendBeacon"in navigator&&e.each(function(){var e=$(this).attr("data-link")||"https://hearty.me";navigator.sendBeacon("//s0.wp.com/mshots/v1/"+encodeURIComponent(e)+(e.indexOf("?")>0?"&":"?")+"?w=320")})}function hj_fullscreen(e){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen(),hj_mixpanel("Fullscreen"),ga_event_push("Fullscreen",{event_category:"Posts",event_label:"Fullscreen"})):document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen()}function update_failed(){network_status(["offline"],!0),alertify.error("<i class='far fa-wifi-slash'></i> ç¶²è·¯å»¶é²ï¼Œè«‹ç¨å€™å†è©¦"),$(".editor_toolbelt .kit.save").finish().removeClass("btn_blink").removeAttr("data-saving").attr("data-unsaved","").delay(7e3).queue(function(){$(this).removeAttr("data-unsaved").dequeue()}),hj_vibrate(30)}function screenlock(e,t){var a=$(".screenlock"),i=a.data("pincode"),n=a.find(".pin"),r=!(null==i);switch(e){case!0:a.is(":hidden")&&($(".menu, .catalog[data-mobile], .stickerbook").each(function(){nav_toggle($(this),!1)}),open_book(!1),a.slideDown("fast").find("input:first").focus(),$(".hj-main").addClass("blur"));break;case!1:a.is(":visible")&&(a.fadeOut("normal"),$(".hj-main").removeClass("blur"),open_book(!0)),a.find("input").val("");break;case"status":return r&&hj_membership()[0];case"initialize":var o=getcookie("hearty_screenlock");o&&hj_membership()[0]?(screenlock("set",o),screenlock(!0)):t&&hj_update({action:"screenlock_lookup"}).then(function(e){1==e.Status&&""!==(t=e.Values.pincode)&&(screenlock("set",t),screenlock(!0))}).fail(function(){screenlock("set",t),screenlock(!0)});break;case"activate":r?screenlock(!0):r||(alertify.set({labels:{ok:"<i class='fas fa-lock'></i> è¨­ç½®",cancel:"å¦"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-lock'></i> æ˜¯å¦è¨­ç½®ã€Œè¢å¹•é–ã€ï¼Ÿ é˜²æ­¢æš«é›¢æ™‚æ—äººçªºæ¢",function(e){e&&screenlock(!0)}));break;case"set":a.data("pincode",t||"0000");break;case"unset":r?(alertify.set({labels:{ok:"<i class='fas fa-cut'></i> æ¸…é™¤è¢å¹•é–",cancel:"å¦"},buttonReverse:!1}),alertify.prompt("<i class='fal fa-lock-open'></i> è¼¸å…¥ Pin ç¢¼ æˆ– æº«åº¦å¯†ç¢¼",function(e,t){e&&(t==i?screenlock("disable"):hj_update({action:"screenlock_unset"}).then(function(e){switch(e.Status){case 0:msg("<i class='far fa-flushed'></i> å¯†ç¢¼ä¼¼ä¹ä¸æ­£ç¢º","å†è©¦è©¦"),screenlock("unset");break;case 1:screenlock("disable")}hj_vibrate(80)}))}),alertify_input_custom({type:"password",placeholder:"Pin ç¢¼æˆ–æº«åº¦å¯†ç¢¼",autocomplete:"new-password",minlength:4,maxlength:20},{"letter-spacing":"3px"})):(screenlock(!1),a.removeAttr("pincode"),n.attr({title:"ğŸ”’ è«‹è¼¸å…¥ Pin ç¢¼"}));break;case"disable":hj_update({action:"screenlock_setup",pincode:""}),screenlock(!1),setcookie("hearty_screenlock","",1),a.data("pincode",null),n.attr({title:"ğŸ”’ è«‹è¼¸å…¥ Pin ç¢¼"}),alertify.error("<i class='far fa-lock-open'></i> æ¸…é™¤è¢å¹•é–"),hj_mixpanel("Screenlock Clear"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Clear"});break;case"next":var s=t[0],l=t[1];isNaN(l)?(s.val(""),hj_alert("Pin ç¢¼åƒ…é™æ•¸å­—")):l.length>0&&s.next(".screenlock input").length>0&&s.next(".screenlock input").focus();break;default:var c="";a.find("input").each(function(){c+=$(this).val()}).val(""),r?c==i?(screenlock(!1),screenlock("activate"),n.attr("title","ğŸ”’ è«‹è¼¸å…¥ Pin ç¢¼")):(n.attr("title","ğŸ”’ Pin ç¢¼ä¸æ­£ç¢º"),shake(n),hj_vibrate(80)):null==a.attr("pincode")?(a.attr("pincode",c),n.attr("title","ğŸ”’ å†æ¬¡ç¢ºèª Pin ç¢¼")):c==a.attr("pincode")?(hj_update({action:"screenlock_setup",pincode:c}),setcookie("hearty_screenlock",c,12),a.data("pincode",c).attr("pincode",null),n.attr("title","è«‹è¼¸å…¥ Pin ç¢¼"),screenlock(!1),hj_alert("ğŸ”’ Pin ç¢¼è¨­å®šç‚ºï¼š"+c),hj_mixpanel("Screenlock Setup"),ga_event_push("Screenlock",{event_category:"Screenlock",event_label:"Setup"})):(a.attr("pincode",null),n.attr("title","ğŸ”’ å…©æ¬¡è¼¸å…¥ä¸ä¸€æ¨£ï¼Œè«‹é‡è¨­"),shake(n),hj_vibrate(80)),a.find("input:first").focus()}}function feature_notavailable(e){popup_toggle(!0,"feature_notavailable"),$(".popup.feature_notavailable q").text(e),$(".popup.feature_notavailable").finish().delay(2500).queue(function(){popup_toggle(!1,"feature_notavailable"),$(this).dequeue()})}function hj_upgrade_toggle(e){popup_toggle(e,"upgrade"),hj_smallchat(e,!1)}function pricing(){price_selector(3),hj_upgrade_toggle(!1),popup_toggle(!0,"purchase")}function price_selector(e){var t=$(".package[data-col='deposit']"),a={2:{unit:179,subtotal:179},3:{unit:149,subtotal:894},4:{unit:99,subtotal:1188}};e in a&&(a=a[e],t.find(".price_unit").text(a.unit),t.find("[data-subtotal]").attr({"data-subtotal":a.subtotal}),t.find(".btns_action[data-pkg]").attr({"data-pkg":e}),t.find(".price_selector li").removeAttr("data-active").filter("[data-pkg='"+e+"']").attr("data-active",""));var i=user_country()||"TW";$(".package .btns_action[data-pkg]").attr({"data-country":i,"data-vat":+("TW"==i)})}function apply_coupon(e){e=e||"";var t={iii2019:[7,"è³‡ç­–æœƒå“¡è³¼"],innosquare:[7,"å‰µåŠ›åŠåœ˜éšŠ"],yaker:[7,"å„ªé›…å®¢åœ˜éšŠ"]};window.hj_username&&(t[hj_username||"hearty"]=[8,"æˆ‘çš„å°ˆå±¬å„ªæƒ "]),alertify.set({labels:{ok:"<i class='fas fa-check-circle'></i> å…Œæ›",cancel:"å–æ¶ˆ"},buttonReverse:!1}),alertify.prompt("<i class='far fa-birthday-cake'></i> è«‹å¡«å¯«é‚€è«‹ç¢¼",function(e,a){if(e){if(!(a=a.trim()).length)return!1;a in t?confirm("å³å°‡ä½¿ç”¨ã€Œ"+t[a][1]+"æ–¹æ¡ˆã€è¨‚è³¼")&&(window.top.location.href=location.origin+"/shop/buy?pkg="+t[a][0]+"&recurring=1&vat=1"):msg("<i class='far fa-flushed'></i> æ‰¾ä¸åˆ°é€™çµ„ã€Œ"+a+"ã€é‚€è«‹ç¢¼","å†è©¦è©¦",function(){alertify_input_shake()}),apply_coupon(a)}},e),alertify_input_custom({placeholder:"é‚€è«‹ç¢¼"},{"letter-spacing":"2px"})}function hj_picture(e){if(e)return alertify.set({labels:{ok:"å–æ¶ˆ",cancel:"<i class='fas fa-arrow-circle-up'></i> ä¸Šå‚³"},buttonReverse:!0}),void alertify.confirm("<i class='fal fa-image'></i> è«‹é¸æ“‡ä¸€å¼µç…§ç‰‡",function(e){e||hj_picture()});var t=$(".ajax-upload-dragdrop input[type='file']");t.length>0&&t.attr({accept:"image/jpeg",onchange:"hj_uploader_preview(this.files);"}).get(0).click()}function image_uploader_initialize(){$(".bk-page #editor_editable");$(".img_uploader").find("#mulitplefileuploader").uploadFile({url:location.origin+"/update",dragDrop:!0,fileName:"myfile",allowedTypes:"jpg,jpeg",returnType:"json",showDone:!1,showDelete:!1,formData:{category:1},dynamicFormData:function(){return{post_id:current_post().post_id,privacy:current_post().privacy}},onSubmit:function(e){saved(!1)},onSuccess:function(e,t,a){illustration_show({gallery_id:t.gallery_id}),alertify.success("<i class='far fa-image'></i> ç›¸ç‰‡ä¸Šå‚³äº†"),post_revise(),popup_toggle(!0,"image-zoom"),hj_mixpanel("Image Added",{post_id:current_post().post_id,privacy:current_post().privacy}),ga_event_push("Image Added",{event_category:"Posts",event_label:"Image Added"})},onError:function(e,t,a,i){msg()}})}function hj_uploader_preview(e){hj_video("reset");var t=$(".image-zoom img"),[a]=e,i=hj_uploader_createImageFromFile(t.get(0),a),n=hj_uploader_getFileBase64Encode(a);Promise.all([i,n]).then(e=>{var[a,i]=e;$(".bk-page .picture #picture").css({background:"url('"+i+"')","background-size":"cover"}).addClass("uploading"),t.attr("src",i)})}function hj_uploader_createImageFromFile(e,t){return new Promise((a,i)=>{e.src=URL.createObjectURL(t),e.onload=(()=>{URL.revokeObjectURL(e.src),a(e)}),e.onerror=(()=>i("Failure to load image"))})}function hj_uploader_getFileBase64Encode(e){return new Promise((t,a)=>{var i=new FileReader;i.readAsDataURL(e),i.onload=(()=>t(i.result)),i.onerror=(e=>a(e))})}function hj_loading(e){var t=$("body.hj");e?t.addClass("loading"):t.removeClass("loading")}function hj_screenshot(){if(0==current_post().post_id)return!1;autosave_the_change(),hj_loading(!0);var e=current_post().post_id,t=$(".bk-list .bk-page"),a=t.find(".diary"),i=$(".diary_screenshot");t.removeClass("scroll-smoothly").scrollTop(0).addClass("scroll-smoothly"),t.find("#editor_editable").removeClass("editor_margin_bottom"),t.find(".picture .far").hide(),a.addClass("screenshoted"),hj_getScript_npm("html2canvas@1.0.0-rc.5/dist/html2canvas.min.js",function(){window.html2canvas(a.get(0),{useCORS:!0,scale:window.devicePixelRatio,width:a.get(0).scrollWidth+10,height:a.get(0).scrollHeight}).then(n=>{var r=n.toDataURL("image/png"),o=t.find("#subject").text();i.empty();$("<a>",{target:"_blank",href:r,download:"æº«åº¦æ—¥è¨˜_"+o+".png",title:o,rel:"noopener",onclick:"hj_screenshot_share($(this)); event.stopPropagation()"}).html($("<img>",{src:r})).appendTo(i).get(0).click();a.removeClass("screenshoted").find("#editor_editable").addClass("editor_margin_bottom"),t.find(".picture .far").show(),popup_toggle(!0,"diary_screenshot"),hj_loading(!1),hj_vibrate(80),hj_mixpanel("Post Screenshoted",{post_id:e}),ga_event_push("Screenshot",{event_category:"Posts",event_label:"Screenshot"})})})}function hj_screenshot_share(e){if(null!=e&&!check_hjapp()&&"share"in navigator&&"canShare"in navigator){var t="æº«åº¦æ—¥è¨˜ï¼š"+e.attr("title");urltoFile(e.attr("href"),t+".png","image/png").then(function(e){var a={files:[e]};navigator.canShare(a)&&(a.title=a.text=t,navigator.share(a).then(()=>console.log("- File Shared")).catch(e=>console.log("- Error",e)))})}}function urltoFile(e,t,a){return a=a||(e.match(/^data:([^;]+);/)||"")[1],fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:a})})}function hj_bookmark(){var e=current_post().post_id;hj_update({action:"bookmark",post_id:e}).then(function(t){switch(t.Status){case 1:hj_vibrate(80),hj_mixpanel("Post Bookmarked",{post_id:e}),ga_event_push("Bookmark",{event_category:"Posts",event_label:"Bookmark"});break;case 2:signin_required()}})}function free_trial_activate(){hj_update({action:"free_trial_activate"}).then(function(e){switch(e.Status){case 1:alertify.set({labels:{ok:"é–‹å§‹é«”é©—",cancel:"æ¯”è¼ƒç‰ˆæœ¬"},buttonReverse:!1}),alertify.confirm("<i class='far fa-gift-card'></i> æ‚¨å°ˆå±¬çš„ VIP 30å¤©è©¦ç”¨é–‹é€šå›‰ï¼Œå·²è§£é–å…¨ç«™åŠŸèƒ½ã€ç´ æ<br><br><small style='display: inline-block; text-align: left;'><i class='far fa-heart'></i> "+e.Values.expiration+" ä¹‹å¾Œï¼Œ<br>æ‚¨å¯ä»¥å‡ç´šç‚º VIPï¼Œæˆ–é™ç‚ºå…è²»ç‰ˆç¹¼çºŒä½¿ç”¨åŸºæœ¬åŠŸèƒ½<br>æ‚¨æ‰€æ’°å¯«éçš„æ–‡ç« ï¼Œéƒ½å°‡èƒ½æ°¸ä¹…ä¿å­˜æ–¼æº«åº¦æ—¥è¨˜ä¸­</small>",function(e){e||hj_upgrade_toggle(!0)}),hj_mixpanel("Trial Activated"),ga_event_push("Trial Activate",{event_category:"Account",event_label:"Trial Activate"})}})}function signin_required(){account_status().then(function(e){if(1===e.Status){var t=e.Values.username;"hj_writer"in window&&hj_writer!=t?window.top.location.href=location.origin+"/"+t:location.reload(!0)}}),signin_ask()}function signin_ask(e,t){var a=getcookie("hearty_account")||getUrlPara("a")||"";a=a?"&account="+a:"";var i=location.origin+"/?r="+location.href.split("#")[0].split("?")[0].replace(location.origin,"")+a+"#signin";e?window.top.location.href=i:(alertify.set({labels:{ok:"å¦",cancel:"<i class='fas fa-door-open'></i> ç«‹å³ç™»å…¥"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-user-lock'></i> ç™»å…¥ä»¥"+(t||"ä½¿ç”¨å®Œæ•´åŠŸèƒ½"),function(e){e||(window.top.location.href=i)}),hj_vibrate(80))}function hj_after_purchase(){alertify.set({labels:{ok:"<i class='fas fa-pen'></i> é–‹å§‹å¡«å¯«",cancel:"å¦"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-gifts'></i> VIP æ–¹æ¡ˆé–‹é€šåš•ï¼<br>æ˜¯å¦æ’¥ 3 åˆ†é˜å¡«ç­”å•å·ï¼Œæº«åº¦ç›¼å›é¥‹ä½ æ›´å¤š<br>(é¦–æ¬¡å¡«ç­”ï¼Œå°‡è‡´è´ˆ 7å¤© VIP ä½œç‚ºå°ç¦®ç‰©)",function(e){e&&open_url("//go.hearty.me/hjvip"),hj_mixpanel("VIP Survey",{accepted:e?"Y":"N"}),ga_event_push("VIP Survey",{event_category:"Membership",event_label:"VIP Survey",accepted:e?"Y":"N"})})}function customized_notification(e,t){switch(e){case"email_verify_required":notifications_new([{notification_id:1,msg:"èªè­‰ "+(t||"Email")+"ï¼Œä»¥ä½¿ç”¨å®Œæ•´åŠŸèƒ½",clk:"open_url(location.origin+'/account?ev=1')",unread:1,icon:"far fa-envelope"}],!1),$(".popup.feedback .notice").text("é»æ­¤é©—è­‰ Emailï¼Œä»¥ä¾¿æ”¶å–å›è¦†").on("click",function(){open_url(location.origin+"/account?ev=1")});break;case"phone_verify_required":hj_lang_zhcn()||notifications_new([{notification_id:8,msg:"ç¶å®šæ‰‹æ©Ÿè™Ÿç¢¼ï¼Œä»¥å¢åŠ å¸³è™Ÿå®‰å…¨æ€§",clk:"open_url(location.origin+'/account?pv=1')",unread:1,icon:"far fa-mobile"}],Math.random()>=.5);break;case"vip_expired":notifications_new([{notification_id:2,msg:"VIP "+t+"åˆ°æœŸï¼ŒæŒ‰æ­¤äº†è§£å°ˆå±¬çºŒè¨‚å„ªæƒ ",clk:"hj_upgrade_toggle(true)",unread:1,icon:"far fa-crown"}],!1);break;case"char_limit_exceed":notifications_new([{notification_id:9,msg:"å¯«äº† "+t+"å­—ï¼Œå·²é”å­—æ•¸é™é¡ï¼Œç«‹å³å‡ç´š",clk:"hj_upgrade_toggle(true)",unread:1,icon:"far fa-arrow-circle-up"}],!1);break;case"daily_checkin":notifications_new([{notification_id:10,msg:"ä¾†æ”¶é›†å°å¸ƒé»ï¼Œä»Šå¤©é‚„æ²’ç°½åˆ°å”·",clk:"hj_daily_checkin('init')",unread:1,icon:"far fa-mitten"}],!1)}}function bucket_suffix(){var e=new Date;return e.getDate()+e.getHours()}function illustration_show(e){var t,a=$(".image-zoom img");if(null===e.gallery_id){do{(t=illustration_random()).image=["//"+wpCDN+"/hearty.me/images/illustrations/"+t.image+".jpg","//res.cloudinary.com/nien/image/upload/v1475732434/hearty.me/illustrations/"+t.image+".jpg"]}while(a.attr("src")==t.image);$(".image-zoom .img_btns").hide()}else t={image:["//hearty.me/i/"+e.gallery_id+(["gallery_rotated"]in e&&Number(e.gallery_rotated)>0?"?r="+e.gallery_rotated:"")],position:"center"};return["rotate"]in e||a.attr("src",t.image[0]).css({transform:"rotate(0)"}),"gallery_cssgram"in e&&post_picture_cssgram("display",e.gallery_cssgram),$(".image-zoom").attr("data-gallery_id","gallery_id"in e?e.gallery_id:0),$(".bk-page .picture #picture").css({"background-image":t.image.map(function(e){return'url("'+e+'")'}).join(", "),"background-repeat":"no-repeat","background-position":t.position+" center","background-size":"cover"}).removeClass("uploading"),t.image[0]}function post_picture_rotate(){var e=$(".image-zoom"),t=e.find("img"),a=e.attr("data-gallery_id")||0,i=Number(getDeg(t))+90;t.css({transform:"rotate("+i+"deg)"}),hj_update({action:"post_picture_rotate",gallery_id:a}).then(function(e){switch(e.Status){case 1:illustration_show({gallery_id:a,gallery_rotated:e.Values.gallery_rotated,rotate:!0}),hj_vibrate(80),hj_mixpanel("Rotate Picture",{degree:i}),ga_event_push("Rotate Picture",{event_category:"Posts",event_label:"Rotate Picture",degree:i});break;case 2:signin_required()}})}function getDeg(e){var t=e.css("-webkit-transform")||e.css("-moz-transform")||e.css("-ms-transform")||e.css("transform");if("none"==t)var a=0;else{var i=t.split("(")[1].split(")")[0].split(",");a=Math.round(Math.atan2(i[1],i[0])*(180/Math.PI))}return a<0?a+360:a}function post_picture_download(e){e.attr({href:"//hearty.me/i/"+($(".image-zoom").attr("data-gallery_id")||1)+".jpg",download:($(".bk-page #subject").text()||"æº«åº¦æ—¥è¨˜").replace(/[&\/\\#,+()$~%.'":*?<>{}]/g,""),onclick:"event.stopPropagation()"}).get(0).click(),alertify.success("<i class='far fa-arrow-alt-to-bottom'></i> ä¸‹è¼‰ä¸­ï¼Œè«‹ç¨å€™")}function post_picture_cssgram(e,t){var a=$(".image-zoom"),i=Number(a.attr("data-gallery_id")||0),n=["original","_1977","aden","brannan","brooklyn","clarendon","earlybird","gingham","hudson","inkwell","kelvin","lark","lofi","maven","mayfair","moon","nashville","perpetua","reyes","rise","slumber","stinson","toaster","valencia","walden","willow","xpro2"],r=[0,1,2,4,6,7,8,9,12,14,16,17,18,22,24,26],o=n[r[t=(t=Number(null==t?a.data("cssgram")||1:t))>r.length-1?0:t]];return a.data("cssgram",t+1).children("div").add($(".picture #picture")).removeClass(n.join(" ")).addClass(o),o=capitalizeFirstLetter(o),"apply"==e&&(i>0&&hj_update({action:"post_picture_cssgram",gallery_id:i,cssgram:t}),alertify.success("<i class='fas fa-wand-magic'></i> æ¿¾é¡ #"+(t+1)+" "+o)),o}function hj_daily_checkin(e){var t=$(".popup.notice_checkin");switch(e){case"init":popup_toggle(!0,"notice_checkin"),hj_update({action:"hearty_point",query:"balance_lookup"}).then(function(e){switch(e.Status){case 1:t.find("[data-point]").attr("data-point",Number(e.Values.point)),hj_vibrate(80);break;case 2:signin_required()}});break;case"customized_notification":hj_update({action:"hearty_point",query:"daily_checkin_already"}).then(function(e){e.Status<1&&customized_notification("daily_checkin")});break;default:hj_update({action:"hearty_point",query:"daily_checkin"}).then(function(e){switch(e.Status){case 1:var a,i=t.find("[data-point]");a=Number(i.attr("data-point")||0)+1,i.attr("data-point",a),t.find("img").attr("data-shaking",1),msg("<i class='far fa-coin'></i> æ”¶é›†åˆ° 1é»å°å¸ƒé»ï¼Œç¾åœ¨å…±æœ‰ "+a+"é»","å¥½è€¶",function(){popup_toggle(!1,"notice_checkin"),$(".notifications li[data-notification_id='10']").remove()}),hj_update({action:"gform_post",uri:"1FAIpQLSd-_KtssDZ1EfNp07bfgdGguDrlfzSEAkEXrWujYDNr69L6iw",data:$.param({"entry.1537657449":"[hj_user_id]","entry.1470526977":"[hj_username]",emailAddress:"[hj_email]","entry.657077146":(new Date).toISOString().split("T")[0],"entry.1332414907":check_OS(),"entry.164417788":check_browser()})}),hj_mixpanel("Daily Checkin"),ga_event_push("Daily Checkin");break;case 2:signin_required();break;case 3:msg("<i class='far fa-check-circle'></i> ä»Šå¤©ç°½åˆ°éäº†å”·ï¼Œæ˜å¤©å†ä¾†å§","å¥½çš„",function(){popup_toggle(!1,"notice_checkin")});break;default:msg()}}).fail(function(){msg()})}}function htmlDecode(e){return $("<i>").html(e||"").text()}function diary_date_format(e){return e=e.split("-"),(new Date).getFullYear()==e[0]?Number(e[1])+"æœˆ"+Number(e[2])+"æ—¥":Number(e[0])+"."+Number(e[1])+"."+Number(e[2])}function beep(){if(!check_browser("Safari"))try{new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()}catch(e){}}function hj_darkmode(e){hj_getScript_npm("darkmode-js@1.4.0/lib/darkmode-js.min.js",function(){new Darkmode(e||{bottom:"18px",left:"unset",right:"18px",time:"0.3s",mixColor:"#fff",backgroundColor:"#fff",buttonColorDark:"#100f2c",buttonColorLight:"#fff",saveInCookies:!1,label:"ğŸŒ“"}).showWidget(),$(".darkmode-toggle").css("z-index",2)})}function hj_update_failed(e){hj_update({action:"gform_post",uri:"1FAIpQLSdiUW7RDQ6DoFHFMX55DZSSTU4JAIQt9kyGXAjDsuN9CyVndA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]","entry.1497216280":"[hj_email]",emailAddress:"[hj_email]","entry.355700800":"fn"in e?e.fn:"","entry.1270264487":"flag"in e?e.flag:"","entry.705828998":"err"in e?JSON.stringify(e.err):"","entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":navigator.userAgent||""})}),update_failed()}function hj_onerror(){window.onerror=function(e,t,a,i,n){if(console.warn("JS Error: "+e+" on line "+a+" for "+t),"sendBeacon"in navigator&&navigator.sendBeacon("//hearty.me/err",JSON.stringify({user:window.hj_user||"",uri:t.replace(location.origin,"")||"",msg:e||"",err:n||"",line:a||"",col:i||"",ua:navigator.userAgent||""})),"function"==typeof autosave_the_change&&autosave_the_change(),getUrlPara("retry"))alertify.set({labels:{ok:"<i class='fas fa-inbox-out'></i> å›å ±ç•°å¸¸",cancel:"å¦"},buttonReverse:!1}),alertify.prompt("<i class='far fa-exclamation-circle'></i> é é¢ä¼¼ä¹é‡åˆ°äº†å•é¡Œ<br>è«‹å•æ‚¨å‰›å‰›åœ¨ç”¨ä»€éº¼åŠŸèƒ½ï¼Ÿ",function(e,t){e&&(t=(t||"").trim()).length>0&&hj_update({action:"gform_post",uri:"1FAIpQLScPq53DlC8PjlQCJEMqHm-7ykRPEDosDrIsaAbj3YUT32rTgQ",data:$.param({"entry.434422115":"[hj_user_id]","entry.1958440920":"[hj_username]","entry.803572147":"[hj_email]",emailAddress:"[hj_email]","entry.1027128888":"* ç¨‹å¼ç•°å¸¸æƒ…å½¢ï¼š"+t+"\n (URL: "+location.href+" )\n"+hj_console_get(),"entry.206183814":["åŸºæœ¬ç‰ˆ",,,,"VIP è©¦ç”¨ç‰ˆ","VIP ç‰ˆ"][hj_membership()[1]||0],"entry.2103260912":"N","entry.858322988":navigator.userAgent||""})}).then(function(e){var a=check_hjapp(),i=["<i class='far fa-smile'></i> å·²æ”¶åˆ°è¨Šæ¯ï¼šã€Œ "+t+"ã€","æˆ‘å€‘å°‡ç«‹å³æª¢ä¿®","","","<i class='fal fa-hashtag'></i> æº«åº¦æ—¥è¨˜ "+hj_teammate_rand()];a&&i.splice(2,0,"å¦‚å•é¡Œä»æŒçºŒï¼Œåœ¨ä¿®å¾©å‰ï¼Œè«‹è©¦è‘—æ”¹ç”¨ç¶²é ç‰ˆ"),alertify.set({labels:{ok:"<i class='fas fa-reply'></i> è¿”å›",cancel:a?"<i class='fab fa-chrome'></i> å‰å¾€ç¶²é ç‰ˆ":"<i class='fas fa-sync'></i> é‡æ–°æ•´ç†"},buttonReverse:!1}),alertify.confirm(i.join("<br>"),function(e){e?hj_smallchat(!0,!0):a?location.href="//hearty.me/wv?o=hearty.me/?r=/"+hj_writer+"#signin":location.reload(!0)}),hj_vibrate(80)})},""),alertify_input_custom({placeholder:"æè¿°ä½¿ç”¨ç‹€æ³ã€å•é¡Œ",maxlength:64},{"letter-spacing":"1px"}),hj_vibrate(80);else try{var r="hj_writer"in window&&location.pathname.indexOf(hj_writer)>0?new URL(location):new URL(hj_writer,location.origin);r.searchParams.set("retry",1),location.href=r.href}catch(e){}}}window.top.location.hostname.split(".").splice(-2).join(".")!==window.self.location.hostname.split(".").splice(-2).join(".")?window.top.location.href=window.self.location.href:hj_debug&&hj_debug.on&&hj_console_hook(hj_debug.re),function(e){e(document).ready(function(){$d1=e.when($d0,hj_getScript("//cdn.jsdelivr.net/combine/gh/godswearhats/jquery-ui-rotatable@1.1.1/jquery.ui.rotatable.min.js,npm/jquery-ui-touch-punch@0.2.3/jquery.ui.touch-punch.min.js,npm/interactjs@1.8.1/dist/interact.min.js")).then(function(){editor_include_once(),editor_enable()}),compatibility_handle(),editor_versioning(!0,hj_version),hj_editor_history_init(),hj_rmenu_init(e("[data-hj_rmenu]")),e(".popup-underlayer .popup, .popup.feedback, .popup.diary_screenshot a, .prologue .start, .asset .detach, .popup.notifications ul, .image-zoom .img_btns").on("click",function(e){e.stopPropagation()}),hj_getScript_gh({path:"public/ytbox.min.js",commit:"1.0.21"}),network_watch(),battery_watch(),"undefined"==typeof zh_translatePage?hj_getScript_gh({path:"public/editor.zhongwen.min.js",commit:"1.0.21"},function(){hj_localize_cn()}):hj_localize_cn(),URL_handling(),img_cdn_fallback();try{e.get(location.origin+"/cdn-cgi/trace",function(e){e.indexOf("colo=")>0&&(e=e.replace(/(\r\n|\n|\r)/gm,"").split("colo=")[1].split("http=")[0],hj_mixpanel("Post Init",3===e.length?{cf_colo:e}:{}),ga_event_push("Post Init",{event_category:"Posts",event_label:3===e.length?e:""}))}).fail(function(){hj_mixpanel("Post Init"),ga_event_push("Post Init",{event_category:"Posts"})})}catch(e){}})}(jQuery),window.addEventListener("unhandledrejection",e=>{var t={fn:"unhandledrejection",flag:e.reason||""};hj_update({action:"gform_post",uri:"1FAIpQLSdiUW7RDQ6DoFHFMX55DZSSTU4JAIQt9kyGXAjDsuN9CyVndA",data:$.param({"entry.783049182":"[hj_user_id]","entry.866865386":"[hj_username]","entry.1497216280":"[hj_email]",emailAddress:"[hj_email]","entry.355700800":t.fn,"entry.1270264487":t.flag,"entry.1259076046":(new Date).toISOString().split("T")[0],"entry.124585191":navigator.userAgent||""})})}),hj_onerror();