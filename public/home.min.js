var _h$=_h$||{};function home_init(){$(function(){browser_check(),os_targeting(),hj_localize_cn(),"function"==typeof a2hs_init&&a2hs_init();var e=getcookie("hearty_account")||getUrlPara("account")||"";e?($("#account").val(e),$(".toggler").removeClass("off"),$(".toggle_signin").css({color:"#fff",background:"#555"})):box("signup");var a,t=getUrlPara("verified"),s=getUrlPara("reset"),i=getUrlPara("app"),o=getUrlPara("ref"),n=getUrlPara("err"),r=getUrlPara("song");if(t){switch(parseInt(t)){case 1:a=_h("i-email-0");break;case 2:a=_h("i-email-1");break;case 3:a=_h("i-email-2"),shake($(".authform"));break;default:a=_h("i-email-3"),shake($(".authform"))}authbox(!0),toast(a)}else s?("1"==s?(authbox(!0),toast(_h("i-reset-1")),$("#account").val(getUrlPara("account")||""),$("#password").val(getUrlPara("token")||""),signin("profile")):(toast(_h("i-reset-2")),shake($(".authform"))),history.replaceState({},document.title,location.pathname)):o&&!i?(authbox(!0),box("signup"),toast(_h("i-ref-0",{$user:getUrlPara("ref")}))):n?msg(_h("i-404")):r&&soundtrack(!0);var c=Number(getcookie("hearty_reset_suspended"));c&&c>timestamping()&&reset_suspended(!0,c),(c=Number(getcookie("hearty_email_verification_suspended")))&&c>timestamping()&&email_verification_suspended(!0,c),/(sign(in|up)|apply)/.test(location.hash.substring(1))&&($("body").css("overflow-y","hidden"),authbox(!0)),$(".chat_btn").on("click",chat_notice)})}function os_targeting(){var e=check_hjapp();switch(e?$(".non-"+e+"app, [data-os]").remove():check_hjpwa()&&$("[data-os='Windows'],[data-os='Macintosh']").remove(),e=check_OS(),$("[data-os]").hide(),e){case"Windows":case"Macintosh":$("[data-os='"+(check_browser("Chrome")?e:"default")+"']").show();break;default:$("[data-os='"+(/iOS|Android/.test(e)?e:"default")+"']").show()}}function browser_check(e){if(e){if(!navigator.cookieEnabled)return alertify.set({labels:{ok:'<i class="fas fa-question-circle"></i> '+_h("i-cookie-1"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.confirm('<i class="fab fa-chrome"></i> '+_h("i-cookie-0"),function(e){if(e){var a="goo.gl/QcQ5ju";switch(check_browser()){case"Safari":a="support.apple.com/"+(check_OS("iOS")?"HT201265":"guide/safari/sfri11471");break;case"Firefox":a="mzl.la/1BAQKUb";break;case"OPR":case"Opera":a="help.opera.com/web-preferences/#cookies"}window.open("//"+a,"_blank")}}),!0;if(hj_ip_cn(function(){msg('<i class="fal fa-info-circle"></i> 在中国，需「<i class="fal fa-swimming-pool"></i> 搭梯子」才能使用完整功能')}),window.attachEvent&&!window.addEventListener)alert(_h("i-browser-0"));else if("values"in Object){if(!(["Edge","Trident","MSIE"].indexOf(check_browser())>-1))return!0;alert(_h("i-browser-1"))}else alert(_h("i-browser-0"));return!1}leave_InAppBrowser(),browser_check(!0)||window.open(check_OS("Android")?"market://details?id=com.android.chrome":"//google.c"+(hj_lang_zhcn()?"n":"om")+"/chrome","_blank")}function signin(e){var a=$(".authform"),t=($("#status"),$("#account")),s=$("#password"),i=t.val().toLowerCase(),o=!!window.via_API;return i.length<3?(shake(a),toast(_h("i-signin-2")),void t.focus()):s.val().length<6?(shake(a),toast(_h("i-signin-8")),void s.focus()):void hj_update({action:"signin",account:i,password:s.val(),app:getUrlPara("app")||"",via_API:o}).then(function(n){switch(n.Status){case 1:var r,c=n.Values;if($("#signin").hide(),$(".loading-bars").show(),$("a.toggler").hasClass("off")?setcookie("hearty_account","",90):setcookie("hearty_account",i,90),toast(_h("i-signin-1",{$user:i})),$("body").css({cursor:"wait"}),"undefined"!=typeof mixpanel&&(mixpanel.identify(c.user_id),mixpanel.people.set({$username:c.username,$email:c.email,$last_login:new Date})),ga_event_push("Sign In",{event_category:"Auth",event_label:"Sign In"}),o)r=Return_URL,r+=(r.indexOf("?")<0?"?":"&")+"Hearty_Signin="+c.token_signin,location.assign(r);else if(getUrlPara("r"))location.assign(htmlspecialchars(getUrlPara("r")).replace("？","?").replace(/＆/g,"&"));else{switch(e){case"first":r="/"+c.username+"?first=1";break;case"profile":r="/account?pc=1";break;default:r="/"+c.username}location.assign(r)}break;case 2:shake(a),toast(_h("i-signin-"+i.indexOf("@")<0?3:4)),t.focus();break;case 3:shake(a),toast(_h("i-signin-5",{$user:i})),msg(_h("i-signin-6",{$user:i}));break;default:shake(a),toast(_h("i-signin-7")),s.val("").focus()}})}function signin_viaapi(e){e&&$(function(){toast(_h("i-signin-9",{$client:e})),authbox(!0)})}function signup(){var e=$("#account"),a=e.val().toLowerCase().replace(/((g(|oogle)|y(|7)|hot|fox|live|zoho|proton|rocket)mail|outlook|msn|live|passport|aol|ya(hoo|ndex)|qq|1(26|63)|icloud|mac|me)(com([a-z]{2}|)|[a-z]{2})/gi,"").replace(/[^a-z0-9]/gi,"");e.val(a);var t=$(".authform"),s=($("#status"),$("#email")),i=$("#password"),o=s.val().toLowerCase().replace(/\s+/g,""),n=o.split("@").pop(),r=i.val(),c=$("#password2").val(),l=getUrlPara("ref")||"",u=document.referrer||"",h=window.Intl&&(new Intl.DateTimeFormat).resolvedOptions().timeZone||"Asia/Taipei";return isNaN(a)?a.length<4||a.length>20?(shake(t),toast(_h("i-signup-1")),void e.focus()):o.length<6||!/@/.test(o)?(shake(t),toast(_h("i-signup-2")),void s.focus()):n.indexOf("heart")>=0||n.indexOf("relay.firefox")>=0||"email.com"==n?(shake(t),toast(_h("i-signup-3")),void s.val("").focus()):r.length<6||r.length>20?(shake(t),toast(_h("i-signup-4")),void i.focus()):r!==c?(shake(t),toast(_h("i-signup-5")),void i.focus()):void(o.indexOf("@yahoo.")>0&&!confirm(_h("i-signup-6"))||(!getcookie("hearty_referrer")&&l?setcookie("hearty_referrer",l,90):getcookie("hearty_referrer")&&!l&&(l=getcookie("hearty_referrer")),hj_update({action:"signup",account:a,email:o,password:r,timezone:h,referrer:l,referral:u}).then(function(i){switch(i.Status){case 0:msg(_h("i-signup-7")),e.focus();break;case 1:var n=i.Values;n.verification?(alert(_h("i-signup-8",{$user:a})),email_verification_suspended(!0)):alertify.success(_h("i-signup-9",{$user:a})),$("a.toggler").removeClass("off"),box("signin"),signin("first"),"undefined"!=typeof mixpanel&&(mixpanel.identify(n.user_id),mixpanel.people.set({$username:n.username,$email:n.email,$created:new Date})),ga_event_push("conversion",{send_to:"AW-1027812032/VU59COmFmNIBEMDVjOoD"}),ga_event_push("Sign Up",{event_category:"Auth",event_label:"Sign Up"}),fb_event_push(!1,"CompleteRegistration");break;case 2:box("signin"),toast(_h("i-signup-9")),shake(t),e.focus();break;case 3:box("signin"),toast(_h("i-signup-10")),shake(t),e.val(o).focus();break;case 4:toast(_h("i-signup-11")),shake(t),e.focus();break;case 5:toast(_h("i-signup-12")),shake(t),s.focus();break;case 6:toast(_h("i-signup-13")),shake(t),s.focus();break;case 9:toast(_h("i-signup-14")),shake(t),msg();break;default:msg()}}))):(shake(t),toast(_h("i-signup-0")),void e.focus())}function hj_reset(){var e=$("#account").val().toLowerCase();if(e.length<3)return shake($(".authform")),toast(_h("i-reset-3")),void $("#account").focus();hj_update({action:"password_reset",account:e}).then(function(e){switch(e.Status){case 1:reset_suspended(!0);var a=e.Values;alert(_h("i-reset-5",{$domain:a.email_domain})),a.email_login_url.length>0&&(alertify.set({labels:{ok:_h("i-go"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.confirm(_h("i-reset-6",{$url:a.email_login_url[0]}),function(e){e?location.href="//"+a.email_login_url[1]:box("signin"),toast(_h("i-reset-4"))}));break;default:shake($(".authform")),toast(_h("i-reset-7")),$("#account").focus()}})}function authbox(e){var a=$(".home_signin"),t=$(".content");e?(a.show(),t.hide(),setTimeout(function(){a.fadeIn()},200)):(a.fadeOut(),t.show()),$("body").css("overflow-y",e?"hidden":"auto")}function box(e){$("#status");var a=$("#account"),t=$("#password"),s=$(".signup"),i=$(".signin"),o=$(".reset");switch(e){case"signup":$(".toggle_signup").css({color:"#fff",background:"#555"}),$(".toggle_signin").css({color:"#222",background:"transparent"}),toast(_h("i-box-3")),a.add(t).attr({onkeypress:"press_enter(event,'signup')"}),s.show(),i.add(o).hide("slide"),password_show(!0),t.val().length&&password2_show(!0);break;case"signin":$(".toggle_signin").css({color:"#fff",background:"#555"}),$(".toggle_signup").css({color:"#222",background:"transparent"}),toast(_h("i-box-4")),a.add(t).attr({onkeypress:"press_enter(event,'signin')"}),s.add(o).hide("slide"),i.show(),password_show(!0),password2_show(!1);break;case"reset":toast(_h("i-box-5")),a.attr({onkeypress:"press_enter(event,'hj_reset')"}),s.add(i).hide("slide"),o.show(),password_show(!1),$("#captcha").html()||(window.recaptcha||(window.recaptcha=function(){var e=$("#reset");hcaptcha.render("captcha",{sitekey:"5ee3e1cd-7bc2-4623-bb21-df1295a52d98",callback:function(){e.show()},"expired-callback":function(){e.slideUp()}})}),hj_getScript("//hcaptcha.com/1/api.js?onload=recaptcha&render=explicit"))}var n=_h("i-box-"+("signup"==e?6:7)),r="this.value=(this.value||'').toLowerCase().replace("+("signup"==e?"/[^a-z0-9]/g":"/[^a-z0-9-_.@]/g")+",'')";a.focus().attr({title:n,placeholder:n,oninput:r}).parent("td").attr("data-tooltip",n)}function toast(e){return $("#status").text(e||"").show()}function password_show(e,a){var t=$("#password"+(null==a?"":"2")).parent().parent();e?t.css({display:"table-row"}):t.hide("slide")}function password2_show(e){password_show(e,!0)}function email_verification_suspended(e,a){e&&setcookie("hearty_email_verification_suspended",a||timestamping()+180,1)}function reset_suspended(e,a){var t,s,i,o,n,r=$("#reset");e?(a=a||timestamping()+180,setcookie("hearty_reset_suspended",a,1),window.reset_suspended_timer=(t=Math.max(0,a-timestamping()),s=r,n=t,window.setInterval(function(){i=parseInt(n/60,10),o=parseInt(n%60,10),i=i<10?"0"+i:i,o=o<10?"0"+o:o,s.text(_h("i-timer",{$min:i,$sec:o})),--n<0&&(window.clearInterval(reset_suspended_timer),reset_suspended(!1))},1e3)),r.attr({onclick:"shake($('.authform'))"}).css({cursor:"not-allowed"})):r.attr({onclick:"hj_reset()"}).css({cursor:"pointer"}).text(_h("i-reset-0")),r.toggleClass("pure-button-default pure-button-gray")}function hj_preview(e){var a=$("body"),t=$(".hj_preview"),s=t.find("iframe"),i="Sample Preview";e?(s.attr("src")||s.attr({src:s.attr("data-url")}),t.fadeIn(),a.css({"overflow-y":"hidden","touch-action":"none"}),hj_mixpanel(i),ga_event_push(i)):(t.fadeOut(),a.css({"overflow-y":"auto","touch-action":"auto"}))}function soundtrack(e){var a="Soundtrack",t=$(".content"),s=$(".home_soundtrack");switch(e){case"onplay":hj_mixpanel(a+" Play"),ga_event_push(a+" Play");break;case!0:if(!$("#harmony").length){var i=_h("i-song-0");$("<audio>",{id:"harmony",preload:"auto",controls:"",controlsList:"nodownload",loop:"",title:i,html:$("<source>",{src:"//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.40/dist/audio/wendu.mp3",type:"audio/mpeg"}).text(i)}).on("play",function(){soundtrack("onplay")}).prependTo(".home_soundtrack .lyrics>div>div").get(0).volume=.6,hj_mixpanel(a),ga_event_push(a)}t.fadeOut(),s.fadeIn();break;default:$("body").css("overflow-y","auto"),t.show(),s.fadeOut()}}function chat_notice(){alertify.set({labels:{ok:'<i class="fas fa-door-open"></i> '+_h("i-signin-0"),cancel:'<i class="fas fa-envelope"></i> '+_h("i-chat-2")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-info-circle"></i> '+_h("i-chat-1"),function(e){if(e)authbox(!0),box("signup");else{var a="46jzwia2w@relay.firefox.com";alertify.set({labels:{ok:'<i class="fas fa-copy"></i> '+_h("i-copy-0"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-envelope"></i> '+_h("i-chat-3"),function(e){e&&(hj_copy($("#alertify .alertify-text")),msg('<i class="fal fa-copy"></i> '+_h("i-copy-1")+a))},a),alertify_input_custom({type:"email",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy","letter-spacing":"1px"}),hj_copy_text(a)}})}function account_notice(){msg('<i class="fal fa-user"></i> '+_h("i-id_notice-0")+'<br><i class="far fa-cloud-upload"></i> '+_h("i-id_notice-1"),'<i class="fas fa-mug-hot"></i> '+_h("i-ok-0"))}_h$.i=_h$.i||{ok:["好的"],no:["否","取消"],go:"走吧！",back:"返回",copy:["複製","複製了："],email:["Email 認證成功","Email 已認證過了","認證連結已失效","Email 認證連結不完整"],reset:["重置密碼","重設及登入中。。。","重設連結不正確","帳號未正確填寫","重設連結已寄出","重設連結已寄至您的 ***@$domain 信箱","要到 $url 收信嗎？","沒有這個帳號"],ref:["🎁 $user 邀請你來到這裡"],cookie:["請打開 Cookie 功能，才能登入","如何開啟"],browser:["瀏覽器版本過舊","不支援 Internet Explorer"],signin:["登入","以 $user 加密登入。。。","帳號未正確填寫","帳號 $user 是空號","沒有以 $user 註冊的帳號","帳號 $user 暫時停權","帳號 $user 因故無法使用，請與客服聯繫","密碼有誤","密碼至少需有 6字元","以溫度 ID 登入「$client」"],signup:["帳號應為英字母，或英數混合","帳號為 4 ~ 20個英數字","Email 格式不符","請認真填寫 Email","密碼格式：6 ~ 20 字元","兩次輸入的密碼不同","⚠ Yahoo! 信箱容易丟信，\n將無法接受到筆友訊息，您仍要使用這組信箱嗎？","Email 格式不符 或 密碼格式不正確！","$user 帳號註冊成功！ 請前往收取認證信","$user 帳號註冊成功！","帳號已註冊過，請直接登入","Email 已註冊過，請直接登入","此 ID 已有人使用，請重選","Email 不正確","不能以臨時或免洗信箱註冊","系統忙碌中"],box:["註冊","登入","重置密碼","註冊新帳號","登入溫度日記","重置密碼 | 找回帳號","💡 溫度 ID ( 4 ~ 20 英數字)","💡 溫度 ID 或 Email"],timer:"$min:$sec 後可重發",chat:["溫度客服","登入後，可連絡線上客服，以進一步協助您","Email 聯繫","溫度站長信箱："],id_notice:["溫度 ID<br>4-20 英字母(或英數組合)，於交流社群中公開","日記將加密、儲存於這組帳號中，可在手機 App 及電腦版上同步使用"],song:["溫度日記 ─ 哈默妮","溫度日記主題曲"],404:"您輸入的網址不存在",title:["溫度日記 Hearty Journal","溫度日記，療癒系心情日記App/女生手帳"],topbar:["溫度日記","Windows 桌面版","macOS App","登入"],slogan:["溫度日記","<br>療癒系心情日記","，","100,000+人好評推薦，since 2016","連線全程使用高強度加密，與信用卡交易同級"],scroll:"請向下捲動",preview:["日記本預覽","結束預覽"],feature:["為自己而寫","歲月靜好，留下每一天的美好","插畫風圖文日誌","可愛療癒的手帳貼紙，隨心所貼","交換日記","與知己/閨蜜/伴侶，分享生活日常","安全私密","銀行級別的安全加密連線"],testimonial:["喜愛溫度日記的大家說","寫下那些想說但沒說出口的話，推薦溫度日記","科普心理作家 海苔熊","輕輕柔柔，很適合跟自己說說話","Cindy Liu","版面漂亮，自動存檔功能也很貼心","Wu Chi","謝謝溫度，陪我走過不少低潮時光","閻璇","很喜歡電腦版，也下載了手機版","小君"],press:["媒體報導","數位時代","免費資源網路社群","電獺少女","女人迷","她渴望","社企流","Taiwan Startup Stadium","新北創力坊","聯合新聞網","生命力新聞"],action:["開始暖心生活","立即體驗"],rate:"給溫度日記 5顆小星星",footer:["language 語言","Windows 電腦版","macOS 應用程式","功能介紹","關於溫度","品牌合作","媒體資料","常見問題","資料安全","用戶條款","隱私權","溫度主題曲","創辦人陳年"],auth:["立即免費註冊","有帳號了？ 立即登入","忘記的話點這裡","想起來了嗎？ 立即登入","帳號","💡 溫度 ID 或 Email","密碼","🔑 格式：6 ~ 20 個字元","再確認","🔑 再輸入一次密碼","記住我","我已年滿 18歲並同意使用條款"]},home_init();