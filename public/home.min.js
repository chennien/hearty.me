function check_OS(e){var a=navigator.userAgent||"",t=/iP(ad|hone|od)|watchOS/i.test(a)?["iOS"]:a.match(/Windows|Macintosh|Android|Linux/gi)||[];return"Macintosh"==(t=t.length>0?t.slice(-1)[0]:"")&&is_touch_device()&&(t="iOS"),null==e?t:e==t}function home_init(){$(function(){browser_check(),os_targeting(),hj_localize_cn(),"function"==typeof a2hs_init&&a2hs_init();var e=getcookie("hearty_account")||getUrlPara("account")||"";e?($("#account").val(e),$(".toggler").removeClass("off"),$(".toggle_signin").css({color:"#fff",background:"#555"})):box("signup");var a,t=getUrlPara("verified"),s=getUrlPara("reset"),o=getUrlPara("app"),i=getUrlPara("ref"),n=getUrlPara("err"),r=getUrlPara("song");if(t){switch(parseInt(t)){case 1:a="Email èªè­‰æˆåŠŸ";break;case 2:a="Email å·²èªè­‰éäº†";break;case 3:a="èªè­‰é€£çµå·²å¤±æ•ˆ",shake($(".authform"));break;default:a="Email èªè­‰é€£çµä¸å®Œæ•´",shake($(".authform"))}authbox(!0),toast(a)}else s?("1"==s?(authbox(!0),toast("é‡è¨­åŠç™»å…¥ä¸­ã€‚ã€‚ã€‚"),$("#account").val(getUrlPara("account")||""),$("#password").val(getUrlPara("token")||""),signin("profile")):(toast("é‡è¨­é€£çµä¸æ­£ç¢º"),shake($(".authform"))),history.replaceState({},document.title,location.pathname)):i&&!o?(authbox(!0),box("signup"),toast("ğŸ "+getUrlPara("ref")+" é‚€è«‹ä½ ä¾†åˆ°é€™è£¡")):n?msg("æ‚¨è¼¸å…¥çš„ç¶²å€ä¸å­˜åœ¨"):r&&soundtrack(!0);var c=Number(getcookie("hearty_reset_suspended"));c&&c>timestamping()&&reset_suspended(!0,c),(c=Number(getcookie("hearty_email_verification_suspended")))&&c>timestamping()&&email_verification_suspended(!0,c),/(sign(in|up)|apply)/.test(location.hash.substring(1))&&($("body").css("overflow-y","hidden"),authbox(!0)),$(".chat_btn").on("click",chat_notice)})}function os_targeting(){var e=check_hjapp();switch(e?$(".non-"+e+"app, [data-os]").remove():check_hjpwa()&&$("[data-os='Windows'],[data-os='Macintosh']").remove(),e=check_OS(),$("[data-os]").hide(),e){case"Windows":case"Macintosh":$("[data-os='"+(check_browser("Chrome")?e:"default")+"']").show();break;default:$("[data-os='"+(/iOS|Android/.test(e)?e:"default")+"']").show()}}function browser_check(e){if(e){if(!navigator.cookieEnabled)return alertify.set({labels:{ok:"<i class='fas fa-question-circle'></i> å¦‚ä½•é–‹å•Ÿ",cancel:"å¦"},buttonReverse:!1}),alertify.confirm("<i class='fab fa-chrome'></i> è«‹æ‰“é–‹ Cookie åŠŸèƒ½ï¼Œæ‰èƒ½ç™»å…¥",function(e){if(e){var a="goo.gl/QcQ5ju";switch(check_browser()){case"Safari":a="support.apple.com/"+(check_OS("iOS")?"HT201265":"guide/safari/sfri11471");break;case"Firefox":a="mzl.la/1BAQKUb";break;case"OPR":case"Opera":a="//help.opera.com/en/latest/web-preferences/#cookies"}window.open("//"+a,"_blank")}}),!0;if(hj_ip_cn(function(){msg("<i class='fal fa-info-circle'></i> åœ¨ä¸­å›½ï¼Œéœ€ã€Œ<i class='fal fa-swimming-pool'></i> æ­æ¢¯å­ã€æ‰èƒ½ä½¿ç”¨å®Œæ•´åŠŸèƒ½")}),window.attachEvent&&!window.addEventListener)alert("ç€è¦½å™¨ç‰ˆæœ¬éèˆŠ");else if("values"in Object){if(!(["Edge","Trident","MSIE"].indexOf(check_browser())>-1))return!0;alert("ä¸æ”¯æ´ Internet Explorer")}else alert("ç€è¦½å™¨ç‰ˆæœ¬éèˆŠ");return!1}leave_InAppBrowser(),browser_check(!0)||window.open(check_OS("Android")?"market://details?id=com.android.chrome":"//www.google.c"+(hj_lang_zhcn()?"n":"om")+"/chrome","_blank")}function signin(e){var a=$(".authform"),t=($("#status"),$("#account")),s=$("#password"),o=t.val().toLowerCase(),i=!!window.via_API;return o.length<3?(shake(a),toast("å¸³è™Ÿæœªæ­£ç¢ºå¡«å¯«"),void t.focus()):s.val().length<6?(shake(a),toast("å¯†ç¢¼è‡³å°‘éœ€æœ‰ 6å­—å…ƒ"),void s.focus()):void hj_update({action:"signin",account:o,password:s.val(),app:getUrlPara("app")||"",via_API:i}).then(function(n){switch(n.Status){case 1:var r,c=n.Values;if($("#signin").hide(),$(".loading-bars").show(),$("a.toggler").hasClass("off")?setcookie("hearty_account","",90):setcookie("hearty_account",o,90),toast("ä»¥ "+o+" åŠ å¯†ç™»å…¥ã€‚ã€‚ã€‚"),$("body").css({cursor:"wait"}),"undefined"!=typeof mixpanel&&(mixpanel.identify(c.user_id),mixpanel.people.set({$username:c.username,$email:c.email,$last_login:new Date})),ga_event_push("Sign In",{event_category:"Auth",event_label:"Sign In"}),i)r=Return_URL,r+=(r.indexOf("?")<0?"?":"&")+"Hearty_Signin="+c.token_signin,location.assign(r);else if(getUrlPara("r"))location.assign(htmlspecialchars(getUrlPara("r")).replace("ï¼Ÿ","?").replace(/ï¼†/g,"&"));else{switch(e){case"first":r="/"+c.username+"?first=1";break;case"profile":r="/account?pc=1";break;default:r="/"+c.username}location.assign(r)}break;case 2:shake(a),toast(o.indexOf("@")>0?"æ²’æœ‰ä»¥ "+o+" è¨»å†Šçš„å¸³è™Ÿ":"å¸³è™Ÿ "+o+" æ˜¯ç©ºè™Ÿ"),t.focus();break;case 3:shake(a),toast("å¸³è™Ÿ "+o+" æš«æ™‚åœæ¬Š"),msg("å¸³è™Ÿ "+o+" å› æ•…ç„¡æ³•ä½¿ç”¨ï¼Œè«‹èˆ‡å®¢æœè¯ç¹«");break;default:shake(a),toast("å¯†ç¢¼æœ‰èª¤"),s.val("").focus()}})}function signin_viaapi(e){e&&$(function(){toast("ä»¥æº«åº¦ ID ç™»å…¥ã€Œ"+e+"ã€"),authbox(!0)})}function signup(){var e=$("#account"),a=e.val().toLowerCase().replace(/((g(|oogle)|y(|7)|hot|fox|live|zoho|proton|rocket)mail|outlook|msn|live|passport|aol|ya(hoo|ndex)|qq|1(26|63)|icloud|mac|me)(com([a-z]{2}|)|[a-z]{2})/gi,"").replace(/[^a-z0-9]/gi,"");e.val(a);var t=$(".authform"),s=($("#status"),$("#email")),o=$("#password"),i=s.val().toLowerCase().replace(/\s+/g,""),n=i.split("@").pop(),r=o.val(),c=$("#password2").val(),l=getUrlPara("ref")||"",u=document.referrer||"",d=window.Intl&&(new Intl.DateTimeFormat).resolvedOptions().timeZone||"Asia/Taipei";return isNaN(a)?a.length<4||a.length>20?(shake(t),toast("å¸³è™Ÿç‚º 4 ~ 20å€‹è‹±æ•¸å­—"),void e.focus()):i.length<6||!/@/.test(i)?(shake(t),toast("Email æ ¼å¼ä¸ç¬¦"),void s.focus()):n.indexOf("heart")>=0||n.indexOf("relay.firefox")>=0||"email.com"==n?(shake(t),toast("è«‹èªçœŸå¡«å¯« Email"),void s.val("").focus()):r.length<6||r.length>20?(shake(t),toast("å¯†ç¢¼æ ¼å¼ï¼š6 ~ 20 å­—å…ƒ"),void o.focus()):r!==c?(shake(t),toast("å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸åŒ"),void o.focus()):void(i.indexOf("@yahoo.co")>0&&!confirm("âš  Yahoo! ä¿¡ç®±å®¹æ˜“ä¸Ÿä¿¡ï¼Œ\nå°‡ç„¡æ³•æ¥å—åˆ°ç­†å‹è¨Šæ¯ï¼Œæ‚¨ä»è¦ä½¿ç”¨é€™çµ„ä¿¡ç®±å—ï¼Ÿ")||(!getcookie("hearty_referrer")&&l?setcookie("hearty_referrer",l,90):getcookie("hearty_referrer")&&!l&&(l=getcookie("hearty_referrer")),hj_update({action:"signup",account:a,email:i,password:r,timezone:d,referrer:l,referral:u}).then(function(o){switch(o.Status){case 0:msg("Email æ ¼å¼ä¸ç¬¦ æˆ– å¯†ç¢¼æ ¼å¼ä¸æ­£ç¢ºï¼"),e.focus();break;case 1:var n=o.Values;n.verification?(alert(a+" å¸³è™Ÿè¨»å†ŠæˆåŠŸï¼ è«‹å‰å¾€æ”¶å–èªè­‰ä¿¡ã€‚"),email_verification_suspended(!0)):alertify.success(a+" å¸³è™Ÿè¨»å†ŠæˆåŠŸï¼"),$("a.toggler").removeClass("off"),box("signin"),signin("first"),"undefined"!=typeof mixpanel&&(mixpanel.identify(n.user_id),mixpanel.people.set({$username:n.username,$email:n.email,$created:new Date})),ga_event_push("conversion",{send_to:"AW-1027812032/VU59COmFmNIBEMDVjOoD"}),ga_event_push("Sign Up",{event_category:"Auth",event_label:"Sign Up"}),fb_event_push(!1,"CompleteRegistration");break;case 2:box("signin"),toast("å¸³è™Ÿå·²è¨»å†Šéï¼Œè«‹ç›´æ¥ç™»å…¥"),shake(t),e.focus();break;case 3:box("signin"),toast("Email å·²è¨»å†Šéï¼Œè«‹ç›´æ¥ç™»å…¥"),shake(t),e.val(i).focus();break;case 4:toast("æ­¤ ID å·²æœ‰äººä½¿ç”¨ï¼Œè«‹é‡é¸"),shake(t),e.focus();break;case 5:toast("Email ä¸æ­£ç¢º"),shake(t),s.focus();break;case 6:toast("æ‚¨ä¸èƒ½ä»¥å…æ´—ä¿¡ç®±è¨»å†Š"),shake(t),s.focus();break;case 9:toast("ç³»çµ±å¿™ç¢Œä¸­"),shake(t),msg("å°ä¸èµ·ï¼Œç›®å‰ç³»çµ±å¿™ç·šä¸­ï¼Œè«‹ç¨å€™å†è©¦");break;default:msg()}}))):(shake(t),toast("å¸³è™Ÿæ‡‰ç‚ºè‹±å­—æ¯ï¼Œæˆ–è‹±æ•¸æ··åˆ"),void e.focus())}function hj_reset(){var e=$("#account").val().toLowerCase();if(e.length<3)return shake($(".authform")),toast("å¸³è™Ÿæœªæ­£ç¢ºå¡«å¯«"),void $("#account").focus();hj_update({action:"password_reset",account:e}).then(function(e){switch(e.Status){case 1:reset_suspended(!0);var a=e.Values;alert("é‡è¨­é€£çµå·²å¯„è‡³æ‚¨çš„ ***@"+a.email_domain+" ä¿¡ç®±"),a.email_login_url.length>0&&(alertify.set({labels:{ok:"èµ°å§ï¼",cancel:"å…ˆä¸ç”¨"},buttonReverse:!1}),alertify.confirm("è¦åˆ° "+a.email_login_url[0]+" æ”¶ä¿¡å—ï¼Ÿ",function(e){e?location.href="//"+a.email_login_url[1]:box("signin"),toast("é‡è¨­é€£çµå·²å¯„å‡º")}));break;default:shake($(".authform")),toast("æ²’æœ‰é€™å€‹å¸³è™Ÿ"),$("#account").focus()}})}function authbox(e){var a=$(".home_signin"),t=$(".content");e?(a.show(),t.hide(),setTimeout(function(){a.fadeIn()},200)):(a.fadeOut(),t.show()),$("body").css("overflow-y",e?"hidden":"auto")}function box(e){$("#status");var a=$("#account"),t=$("#password"),s=$(".signup"),o=$(".signin"),i=$(".reset");switch(e){case"signup":$(".toggle_signup").css({color:"#fff",background:"#555"}),$(".toggle_signin").css({color:"#222",background:"transparent"}),toast("è¨»å†Šæ–°å¸³è™Ÿ"),a.add(t).attr({onkeypress:"press_enter(event,'signup')"}),s.show(),o.add(i).hide("slide"),password_show(!0),t.val().length&&password2_show(!0);break;case"signin":$(".toggle_signin").css({color:"#fff",background:"#555"}),$(".toggle_signup").css({color:"#222",background:"transparent"}),toast("ç™»å…¥æº«åº¦æ—¥è¨˜").show(),a.add(t).attr({onkeypress:"press_enter(event,'signin')"}),s.add(i).hide("slide"),o.show(),password_show(!0),password2_show(!1);break;case"reset":toast("é‡è¨­å¯†ç¢¼ / æ‰¾å›å¸³è™Ÿ"),a.attr({onkeypress:"press_enter(event,'hj_reset')"}),s.add(o).hide("slide"),i.show(),password_show(!1),$("#captcha").html()||(window.recaptcha||(window.recaptcha=function(){var e=$("#reset");hcaptcha.render("captcha",{sitekey:"5ee3e1cd-7bc2-4623-bb21-df1295a52d98",callback:function(){e.show()},"expired-callback":function(){e.slideUp()}})}),hj_getScript("//hcaptcha.com/1/api.js?onload=recaptcha&render=explicit"))}var n="signup"==e?"ğŸ’¡ æº«åº¦ ID ( 4 ~ 20 è‹±æ•¸å­—)":"ğŸ’¡ æº«åº¦ ID æˆ– Email",r="this.value=(this.value||'').toLowerCase().replace("+("signup"==e?"/[^a-z0-9]/g":"/[^a-z0-9-_.@]/g")+",'')";a.focus().attr({title:n,placeholder:n,oninput:r}).parent("td").attr("data-tooltip",n)}function toast(e){return $("#status").text(e||"").show()}function password_show(e,a){var t=$("#password"+(null==a?"":"2")).parent().parent();e?t.css({display:"table-row"}):t.hide("slide")}function password2_show(e){password_show(e,!0)}function email_verification_suspended(e,a){e&&setcookie("hearty_email_verification_suspended",a||timestamping()+180,1)}function reset_suspended(e,a){var t,s,o,i,n,r=$("#reset");e?(a=a||timestamping()+180,setcookie("hearty_reset_suspended",a,1),window.reset_suspended_timer=(t=Math.max(0,a-timestamping()),s=r,n=t,window.setInterval(function(){o=parseInt(n/60,10),i=parseInt(n%60,10),o=o<10?"0"+o:o,i=i<10?"0"+i:i,s.text(o+":"+i+" å¾Œå¯é‡ç™¼"),--n<0&&(window.clearInterval(reset_suspended_timer),reset_suspended(!1))},1e3)),r.attr({onclick:"shake($('.authform'))"}).css({cursor:"not-allowed"})):r.attr({onclick:"hj_reset()"}).css({cursor:"pointer"}).text("é‡ç½®å¯†ç¢¼"),r.toggleClass("pure-button-default pure-button-gray")}function hj_preview(e){var a=$("body"),t=$(".hj_preview"),s=t.find("iframe"),o="Sample Preview";e?(s.attr("src")||s.attr({src:s.attr("data-url")}),t.fadeIn(),a.css({"overflow-y":"hidden","touch-action":"none"}),hj_mixpanel(o),ga_event_push(o)):(t.fadeOut(),a.css({"overflow-y":"auto","touch-action":"auto"}))}function soundtrack(e){var a="Soundtrack",t=$(".content"),s=$(".home_soundtrack");switch(e){case"onplay":hj_mixpanel(a+" Play"),ga_event_push(a+" Play");break;case!0:if(!$("#harmony").length){var o="æº«åº¦æ—¥è¨˜ â”€ å“ˆé»˜å¦®";$("<audio>",{id:"harmony",preload:"auto",controls:"",loop:"",title:o,onplay:"soundtrack('onplay')",html:$("<source>",{src:"//cdn.jsdelivr.net/gh/chennien/hearty.me@1.0.37/dist/audio/wendu.mp3",type:"audio/mpeg"}).text(o)}).prependTo(".home_soundtrack .lyrics>div>div").get(0).volume=.6,hj_mixpanel(a),ga_event_push(a)}t.fadeOut(),s.fadeIn();break;default:$("body").css("overflow-y","auto"),t.show(),s.fadeOut()}}function account_notice(){msg("<i class='fal fa-user'></i> æº«åº¦ ID<br>4-20 è‹±å­—æ¯(æˆ–è‹±æ•¸çµ„åˆ)ï¼Œæ–¼äº¤æµç¤¾ç¾¤ä¸­å…¬é–‹<br><i class='far fa-cloud-upload'></i> æ—¥è¨˜å°‡åŠ å¯†ã€å„²å­˜æ–¼é€™çµ„å¸³è™Ÿä¸­ï¼Œå¯åœ¨æ‰‹æ©Ÿ App åŠé›»è…¦ç‰ˆä¸ŠåŒæ­¥ä½¿ç”¨","<i class='fas fa-mug-hot'></i> å¥½çš„")}function chat_notice(){alertify.set({labels:{ok:"<i class='fas fa-door-open'></i> ç™»å…¥",cancel:"<i class='fas fa-envelope'></i>  Email è¯ç¹«"},buttonReverse:!1}),alertify.confirm("<i class='fal fa-info-circle'></i> ç™»å…¥å¾Œï¼Œå¯é€£çµ¡ç·šä¸Šå®¢æœï¼Œä»¥é€²ä¸€æ­¥å”åŠ©æ‚¨",function(e){if(e)authbox(!0),box("signup");else{var a="8gcmof7k6@relay.firefox.com";alertify.set({labels:{ok:"<i class='fas fa-copy'></i> è¤‡è£½",cancel:"å¦"},buttonReverse:!1}),alertify.prompt("<i class='fal fa-envelope'></i> æº«åº¦ç«™é•·ä¿¡ç®±ï¼š",function(e){e&&(hj_copy($("#alertify .alertify-text")),msg("<i class='fal fa-copy'></i> å·²è¤‡è£½ï¼š"+a))},a),alertify_input_custom({type:"email",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy","letter-spacing":"1px"})}})}home_init();