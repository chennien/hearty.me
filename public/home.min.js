"use strict";function home_init(){$(function(){browser_check(),os_targeting(),language_switch("init"),hj_localize_cn(),document.title=_h("i-title-1")+" | \u{1F49D} Hearty Journal \u6EAB\u5EA6\u65E5\u8A18","function"==typeof a2hs_init&&a2hs_init();var c=getcookie("hearty_account")||getUrlPara("account")||"";c?($("#account").val(c),$(".toggler").removeClass("off"),$(".toggle_signup").css({color:"#fff",background:"#555"})):box("signup");var b,d=getUrlPara("verified"),e=getUrlPara("reset"),f=getUrlPara("app"),g=getUrlPara("ref"),h=getUrlPara("err"),i=getUrlPara("song");if(d){switch(parseInt(d)){case 1:b=_h("i-email-0");break;case 2:b=_h("i-email-1");break;case 3:b=_h("i-email-2"),shake($(".authform"));break;default:b=_h("i-email-3"),shake($(".authform"))}authbox(!0),toast(b)}else e?("1"==e?(authbox(!0),toast(_h("i-reset-1")),$("#account").val(getUrlPara("account")||""),$("#password").val(getUrlPara("token")||""),signin("profile")):(toast(_h("i-reset-2")),shake($(".authform"))),history.replaceState({},document.title,location.pathname)):g&&!f?(authbox(!0),box("signup"),toast(_h("i-ref-0",{$user:getUrlPara("ref")}))):h?msg(_h("i-404")):i&&soundtrack(!0);var a=Number(getcookie("hearty_reset_suspended"));a&&a>timestamping()&&reset_suspended(!0,a),(a=Number(getcookie("hearty_email_verification_suspended")))&&a>timestamping()&&email_verification_suspended(!0,a),/(sign(in|up)|apply)/.test(location.hash.substring(1))&&($("body").css("overflow-y","hidden"),authbox(!0)),$(".chat_btn").on("click",chat_notice)})}function os_targeting(){var a=check_hjapp();a?$(".non-"+a+"app,[data-os]").remove():check_hjpwa()&&$("[data-os='Windows'],[data-os='Macintosh']").remove(),a=check_OS(),$("[data-os]").hide(),"Macintosh"==a?$("[data-os='"+(["Chrome","Edg"].indexOf(check_browser())>=0?a:"default")+"']").show():$("[data-os='"+(/iOS|Android|Windows/.test(a)?a:"default")+"']").show()}function browser_check(a){if(a){if(!navigator.cookieEnabled)return alertify.set({labels:{ok:'<i class="fas fa-question-circle"></i> '+_h("i-cookie-1"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.confirm('<i class="fab fa-chrome"></i> '+_h("i-cookie-0"),function(b){if(b){var a="goo.gl/QcQ5ju";switch(check_browser()){case"Safari":a="support.apple.com/"+(check_OS("iOS")?"HT201265":"guide/safari/sfri11471");break;case"Firefox":a="mzl.la/1BAQKUb";break;case"OPR":case"Opera":a="help.opera.com/web-preferences/#cookies"}open_url("//"+a)}}),!0;if(hj_ip().then(function(b){var a=b.loc||"",c=$(".cookies");$("body").attr({"data-ip":b.ip||"","data-cc":a}),!getcookie("hearty_cookies")&&["BE","BG","CZ","DK","DE","EE","IE","EL","ES","FR","HR","IT","CY","LV","LT","LU","HU","MT","NL","AT","PL","PT","RO","SI","SK","FI","SE"].indexOf(a)>=0?(c.removeClass("hide").on("click",function(){$(this).remove()}),setcookie("hearty_cookies",1,365)):c.remove(),"CN"==a?msg('<i class="fal fa-info-circle"></i> \u5728\u4E2D\u56FD \u{1F1E8}\u{1F1F3}\uFF0C\u9700\u300C<i class="fal fa-swimming-pool"></i> \u642D\u68AF\u5B50\u300D\u624D\u80FD\u4F7F\u7528\u5B8C\u6574\u529F\u80FD'):"UA"==a&&msg("\u{1F1FA}\u{1F1E6} \u043C\u044B \u043D\u0430 \u0441\u0442\u043E\u0440\u043E\u043D\u0435 \u0443\u043A\u0440\u0430\u0438\u043D\u044B \u{1F1FA}\u{1F1E6}")}),window.attachEvent&&!window.addEventListener)alert(_h("i-browser-0"));else if("values"in Object){if(!(["Edge","Trident","MSIE"].indexOf(check_browser())> -1))return!0;alert(_h("i-browser-1"))}else alert(_h("i-browser-0"));return!1}leave_InAppBrowser(),browser_check(!0)||window.open(check_OS("Android")?"market://details?id=com.android.chrome":"//google.c"+(hj_lang_zhcn()?"n":"om")+"/chrome","_blank")}function signin(g){var b=$(".authform"),c=($("#status"),$("#account")),a=$("#password"),d=$("body"),e=c.val().toLowerCase(),f=!!window.via_API;if(e.length<3){shake(b),toast(_h("i-signin-2")),c.focus();return}if(a.val().length<6){shake(b),toast(_h("i-signin-8")),a.focus();return}hj_update({action:"signin",account:e,password:a.val(),ip:d.attr("data-ip")||"",cc:d.attr("data-cc")||"",app:+(!!check_hjapp()||check_hjpwa()),via_API:f}).then(function(i){switch(i.Status){case 1:var d,h=i.Values;if($("#signin").hide(),$(".loading-bars").show(),$("a.toggler").hasClass("off")?setcookie("hearty_account","",90):setcookie("hearty_account",e,90),toast(_h("i-signin-1",{$user:e})),$("body").css({cursor:"wait"}),"undefined"!=typeof mixpanel&&(mixpanel.identify(h.user_id),mixpanel.people.set({"$username":h.username,"$email":h.email,"$last_login":new Date})),ga_event_push("Sign In",{event_category:"Auth",event_label:"Sign In"}),f)d=Return_URL,d+=(0>d.indexOf("?")?"?":"&")+"Hearty_Signin="+h.token_signin,location.assign(d);else if(getUrlPara("r"))location.assign(htmlspecialchars(getUrlPara("r")).replace("\uFF1F","?").replace(/ï¼†/g,"&"));else{switch(g){case"first":d="/"+h.username+"?first=1";break;case"profile":d="/account?pc=1";break;default:d="/"+h.username}location.assign(d)}break;case 2:shake(b),toast(_h("i-signin-"+(0>e.indexOf("@")?3:4),{$user:e})),c.focus();break;case 3:shake(b),toast(_h("i-signin-5",{$user:e})),msg(_h("i-signin-6",{$user:e}));break;default:shake(b),toast(_h("i-signin-7")),a.val("").focus()}}).fail(function(){msg()})}function signin_viaapi(a){a&&$(function(){toast(_h("i-signin-9",{$client:a})),authbox(!0)})}function signup(){var e=$("#account"),b=e.val().toLowerCase().replace(/((g(|oogle)|y(|7)|hot|fox|live|zoho|proton|rocket)mail|outlook|msn|live|passport|aol|ya(hoo|ndex)|qq|1(26|63)|icloud|mac|me)(com([a-z]{2}|)|[a-z]{2})/gi,"").replace(/[^a-z0-9]/gi,"");e.val(b);var a=$(".authform"),c=($("#status"),$("#email")),i=$("#password"),j=$("#password2"),f=c.val().toLowerCase().replace(/\s+/g,""),g=f.split("@").pop(),h=i.val(),k=$("#password2").val(),d=getUrlPara("ref")||"",l=document.referrer||"",m=window.Intl&&new Intl.DateTimeFormat().resolvedOptions().timeZone||"Asia/Taipei";if(isNaN(b)){if(b.length<4||b.length>20){shake(a),toast(_h("i-signup-1")),e.focus();return}if(f.length<6||!/@/.test(f)){shake(a),toast(_h("i-signup-2")),c.focus();return}if(/relay\.firefox|nien\.co|heart/.test(g)||"email.com"==g){shake(a),toast(_h("i-signup-3")),c.val("").focus();return}else if(h.length<6||h.length>20){shake(a),toast(_h("i-signup-4")),j.val(""),i.val("").focus();return}else if(h!=k){shake(a),toast(_h("i-signup-5")),j.val(""),i.val("").focus();return}else if(/yahoo\.co/.test(g)&&!confirm(_h("i-signup-6")))return}else{shake(a),toast(_h("i-signup-0")),e.focus();return}var n=!1;if($.ajax({url:"//api.mailcheck.ai/domain/"+g,type:"GET",crossDomain:!0,dataType:"json",async:!1,timeout:2e3,success:function(a){n=!0==(a.disposable||"")}}),n){toast(_h("i-signup-14")),shake(a),c.val(""),c.focus();return}!getcookie("hearty_referrer")&&d?setcookie("hearty_referrer",d,90):getcookie("hearty_referrer")&&!d&&(d=getcookie("hearty_referrer")),hj_update({action:"signup",account:b,email:f,password:h,language:$(".language").val()||0,timezone:m,referrer:d,referral:l}).then(function(g){switch(g.Status){case 0:msg(_h("i-signup-7")),e.focus();break;case 1:var d=g.Values;d.verification?(alert(_h("i-signup-8",{$user:b})),email_verification_suspended(!0)):alertify.success(_h("i-signup-9",{$user:b})),$("a.toggler").removeClass("off"),box("signin"),signin("first"),"undefined"!=typeof mixpanel&&(mixpanel.identify(d.user_id),mixpanel.people.set({"$username":d.username,"$email":d.email,"$created":new Date})),ga_event_push("conversion",{send_to:"AW-1027812032/VU59COmFmNIBEMDVjOoD"}),ga_event_push("Sign Up",{event_category:"Auth",event_label:"Sign Up"}),fb_event_push(!1,"CompleteRegistration");break;case 2:box("signin"),toast(_h("i-signup-10")),shake(a),e.focus();break;case 3:box("signin"),toast(_h("i-signup-11")),shake(a),e.val(f).focus();break;case 4:toast(_h("i-signup-12")),shake(a),e.focus();break;case 5:toast(_h("i-signup-13")),shake(a),c.focus();break;case 9:toast(_h("i-signup-15")),shake(a),msg();break;default:msg()}}).fail(function(){msg()})}function hj_reset(){var a=$("#account").val().toLowerCase();if(a.length<3){shake($(".authform")),toast(_h("i-reset-3")),$("#account").focus();return}hj_update({action:"password_reset",account:a}).then(function(b){if(1===b.Status){reset_suspended(!0);var a=b.Values;alert(_h("i-reset-5",{$domain:a.email_domain})),a.email_login_url.length>0&&(alertify.set({labels:{ok:_h("i-go"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.confirm(_h("i-reset-6",{$url:a.email_login_url[0]}),function(b){b?location.href="//"+a.email_login_url[1]:box("signin"),toast(_h("i-reset-4"))}))}else shake($(".authform")),toast(_h("i-reset-7")),$("#account").focus()}).fail(function(){msg()})}function authbox(a){var b=$(".home_signin"),c=$(".content");a?(b.show(),c.hide(),setTimeout(function(){b.fadeIn()},200)):(b.fadeOut(),c.show()),$("body").css("overflow-y",a?"hidden":"auto")}function box(b){$("#status");var a=$("#account"),c=$("#password"),d=$(".signup"),e=$(".signin"),f=$(".reset");switch(b){case"signup":$(".toggle_signup").css({color:"#fff",background:"#555"}),$(".toggle_signin").css({color:"#222",background:"transparent"}),toast(_h("i-box-3")),a.add(c).attr({onkeypress:"press_enter(event,'signup')"}),d.show(),e.add(f).hide("slide"),password_show(!0),c.val().length&&password2_show(!0);break;case"signin":$(".toggle_signin").css({color:"#fff",background:"#555"}),$(".toggle_signup").css({color:"#222",background:"transparent"}),toast(_h("i-box-4")),a.add(c).attr({onkeypress:"press_enter(event,'signin')"}),d.add(f).hide("slide"),e.show(),password_show(!0),password2_show(!1);break;case"reset":toast(_h("i-box-5")),a.attr({onkeypress:"press_enter(event,'hj_reset')"}),d.add(e).hide("slide"),f.show(),password_show(!1),$("#captcha").html()||(window.recaptcha||(window.recaptcha=function(){var a=$("#reset");hcaptcha.render("captcha",{sitekey:"5ee3e1cd-7bc2-4623-bb21-df1295a52d98",callback:function(){a.show()},"expired-callback":function(){a.slideUp()}})}),hj_getScript("//js.hcaptcha.com/1/api.js?onload=recaptcha&render=explicit"))}var g=_h("i-box-"+("signup"==b?6:7)),h="this.value=(this.value||'').toLowerCase().replace("+("signup"==b?"/[^a-z0-9]/g":"/[^a-z0-9-_.@]/g")+",'')";a.focus().attr({title:g,placeholder:g,oninput:h}).parent("td").attr("data-tooltip",g)}function toast(a){return $("#status").text(a||"").show()}function password_show(b,c){var a=$("#password"+(null==c?"":"2")).parent().parent();b?a.css({display:"table-row"}):a.hide("slide")}function password2_show(a){password_show(a,!0)}function email_verification_suspended(a,b){a&&setcookie("hearty_email_verification_suspended",b||timestamping()+180,1)}function reset_suspended(d,b){var c,e,g,h,f,a=$("#reset");d?(setcookie("hearty_reset_suspended",b=b||timestamping()+180,1),window.reset_suspended_timer=(c=Math.max(0,b-timestamping()),e=a,f=c,window.setInterval(function(){g=parseInt(f/60,10),h=parseInt(f%60,10),g=g<10?"0"+g:g,h=h<10?"0"+h:h,e.text(_h("i-timer",{$min:g,$sec:h})),--f<0&&(window.clearInterval(reset_suspended_timer),reset_suspended(!1))},1e3)),a.attr({onclick:"shake($('.authform'))"}).css({cursor:"not-allowed"})):a.attr({onclick:"hj_reset()"}).css({cursor:"pointer"}).text(_h("i-reset-0")),a.toggleClass("pure-button-default pure-button-gray")}function language_switch(a,d){var b=$(".language"),c='<i class="far fa-language" style="font-size:26px"></i> '+_h("i-footer-0")+":<br>";if("init"==a){var a=parseInt(getcookie("hearty_language"));isNaN(a)&&setcookie("hearty_language",a=+/zh/i.test(hj_lang()),730),b.val(a).find("[value="+a+"]").attr("selected","selected")}else a?(setcookie("hearty_language",a,730),$(".alertify-button-ok").click(),msg(c+_h("i-lang",{$lang:d})),location.reload(!0)):msg(c+b.prop("outerHTML"),'<i class="fas fa-reply"></i> '+_h("i-back"))}function hj_preview(f,a){var d=$("body"),b=$(".hj_preview"),c=b.find("iframe"),e="Sample Preview";a=a||"//go.hearty.me/hjview",f?(c.attr("src")&&a==c.attr("src")||c.attr({src:a}),b.fadeIn(),d.css({"overflow-y":"hidden","touch-action":"none"}),hj_mixpanel(e),ga_event_push(e)):(b.fadeOut(),d.css({"overflow-y":"auto","touch-action":"auto"}))}function hj_reviews(){hj_preview(!0,"//go.hearty.me/hjreviews")}function soundtrack(e){var a="Soundtrack",b=$(".content"),c=$(".home_soundtrack");switch(e){case"onplay":hj_mixpanel(a+" Play"),ga_event_push(a+" Play");break;case!0:if(!$("#harmony").length){var d=_h("i-song-0");$("<audio>",{id:"harmony",preload:"auto",controls:"",controlsList:"nodownload noplaybackrate",loop:"",title:d,html:$("<source>",{src:"//cdn.jsdelivr.net/gh/chennien/d.hearty.app@6/docs/wendu.mp3",type:"audio/mpeg"}).text(d)}).on("play",function(){soundtrack("onplay")}).prependTo(".home_soundtrack .lyrics>div>div").get(0).volume=.6,hj_mixpanel(a),ga_event_push(a)}b.fadeOut(),c.fadeIn();break;default:$("body").css("overflow-y","auto"),b.show(),c.fadeOut()}}function chat_notice(){alertify.set({labels:{ok:'<i class="fas fa-door-open"></i> '+_h("i-signin-0"),cancel:'<i class="fas fa-envelope"></i> '+_h("i-chat-2")},buttonReverse:!1}),alertify.confirm('<i class="fal fa-info-circle"></i> '+_h("i-chat-1"),function(b){if(b)authbox(!0),box("signup");else{var a="alwy8z02@nien.co";alertify.set({labels:{ok:'<i class="fas fa-copy"></i> '+_h("i-copy-0"),cancel:_h("i-no-0")},buttonReverse:!1}),alertify.prompt('<i class="fal fa-envelope"></i> '+_h("i-chat-3"),function(b){b&&(hj_copy($("#alertify .alertify-text")),msg('<i class="fal fa-copy"></i> '+_h("i-copy-1")+a))},a),alertify_input_custom({type:"email",inputmode:"none",placeholder:a,onclick:"hj_copy($(this))"},{cursor:"copy","letter-spacing":"1px"}),hj_copy_text(a)}})}function account_notice(){msg('<i class="fal fa-user"></i> '+_h("i-id_notice-0")+'<br><i class="far fa-cloud-upload"></i> '+_h("i-id_notice-1"),'<i class="fas fa-mug-hot"></i> '+_h("i-ok-0"))}function hj_intro(){open_url("//"+(is_touch_device()?"get":"try")+".hearty.me/")}home_init()